{
  "data": [
    {
      "updatedAt": "2025-11-22T17:34:47.000Z",
      "createdAt": "2025-11-22T15:05:15.611Z",
      "id": "7BdKngA6qCAySGXs",
      "name": "Prototype Gemini 3",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {},
          "type": "n8n-nodes-base.manualTrigger",
          "typeVersion": 1,
          "position": [
            -400,
            0
          ],
          "id": "bdb8a018-e32d-415d-a3a1-dd729779f8cb",
          "name": "When clicking â€˜Execute workflowâ€™"
        },
        {
          "parameters": {
            "authentication": "predefinedCredentialType",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            -192,
            0
          ],
          "id": "eb6878db-9641-4096-b79b-61399547b911",
          "name": "HTTP Request"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "typeVersion": 1.4,
          "position": [
            16,
            0
          ],
          "id": "d3a34b06-e8db-4f60-89f5-37cf9a76482a",
          "name": "When chat message received",
          "webhookId": "ee094aa7-72ca-46b4-ad64-3c42c7cf0225"
        }
      ],
      "connections": {
        "When clicking â€˜Execute workflowâ€™": {
          "main": [
            [
              {
                "node": "HTTP Request",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When chat message received": {
          "main": [
            []
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "0139ef37-7053-4fb5-b61b-3d9c5cb6b56a",
      "activeVersionId": null,
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-11-22T15:05:15.618Z",
          "createdAt": "2025-11-22T15:05:15.618Z",
          "role": "workflow:owner",
          "workflowId": "7BdKngA6qCAySGXs",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": null,
      "tags": []
    },
    {
      "updatedAt": "2025-12-04T19:32:55.000Z",
      "createdAt": "2025-11-23T15:45:35.268Z",
      "id": "BFYzOmXZPvhoUbBS",
      "name": "fonio AGS Nachbearbeitung Transkript alt",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "fonio-ags-transkript",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            0,
            0
          ],
          "id": "dbb2ce2e-7047-422a-b8a2-7cd7f735f599",
          "name": "Webhook",
          "webhookId": "d9a56c84-3178-44a5-9d50-e8a42a1f9a00"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "04f27e3e-ebed-4ae5-a22f-23d0f7c61904",
                  "name": "body[0].body.formattedTranscript",
                  "value": "={{ $json.body[0].body.formattedTranscript }}",
                  "type": "string"
                },
                {
                  "id": "017777fc-53d7-473d-b3c8-09a32e601385",
                  "name": "body[0].body.fromNumber",
                  "value": "={{ $json.body[0].body.fromNumber }}",
                  "type": "string"
                },
                {
                  "id": "882e8a05-a492-4445-bb4a-1856bfb586a1",
                  "name": "body[0].body.context.anrufer_name",
                  "value": "={{ $json.body[0].body.context.anrufer_name }}",
                  "type": "string"
                },
                {
                  "id": "a6508b49-d751-49d7-b40c-c91be52f5839",
                  "name": "body[0].body.context.einrichtung_typ",
                  "value": "={{ $json.body[0].body.context.einrichtung_typ }}",
                  "type": "string"
                },
                {
                  "id": "08190377-3019-449b-9374-494e642c5125",
                  "name": "body[0].body.context.einrichtung_name",
                  "value": "={{ $json.body[0].body.context.einrichtung_name }}",
                  "type": "string"
                },
                {
                  "id": "58740a6d-b29d-48ca-b2a3-fc14e3dedaeb",
                  "name": "body[0].body.context.technisch",
                  "value": "={{ $json.body[0].body.context.technisch }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            224,
            0
          ],
          "id": "b905e673-945d-4303-8ddb-de9c95625fc3",
          "name": "Daten extrahieren"
        },
        {
          "parameters": {
            "options": {
              "systemMessage": "<system_prompt>\nDU BIST EIN HOCHSPEZIALISIERTER KLASSIFIKATIONS-AGENT FÃœR IT-HOTLINE-TRANSKRIPTE. DEINE HAUPTAUFGABE IST ES, JEDE ANFRAGE PRÃ„ZISE IN EINE DER DRINGLICHKEITSKATEGORIEN A, B, C ODER D EINZUORDNEN. DIE GRUNDLAGE DEINER KLASSIFIKATION SIND DIE **DEFINITIONEN, REGELN UND BEISPIELE**, DIE IN EINEM EXTERN GEPFLEGTEN **GOOGLE SHEET** ENTHALTEN SIND.\n\n###ZIEL###\n\nSTELLE SICHER, DASS TECHNIKER DURCH DEINE KATEGORISIERUNG **HOCHVORBEREITET UND ZIELGERICHTET** AUF DIE ANFRAGE REAGIEREN KÃ–NNEN. JEDE EINORDNUNG MUSS DIE **DRINGLICHKEIT** DER TECHNISCHEN ANFRAGE REALISTISCH UND ZUVERLÃ„SSIG ABBILDEN.\n\n---\n\n###CHAIN OF THOUGHTS###\n\nFOLGE DIESER SYSTEMATISCHEN VORGEHENSWEISE, UM DIE TRANSKRIPTE ZU ANALYSIEREN UND DIE RICHTIGE DRINGLICHKEITSSTUFE FESTZULEGEN:\n\n1. **UNDERSTAND**  \n   - LESE DAS TRANSKRIPT GRÃœNDLICH UND IDENTIFIZIERE DAS KONKRETE TECHNISCHE PROBLEM SOWIE DIE AUSWIRKUNGEN AUF DEN ANRUFER (z.â€¯B. ProduktivitÃ¤tsausfall, Datenverlust, Eskalationsdrohung).\n\n2. **BASICS**  \n   - ERKENNE ZENTRALE SCHLÃœSSELBEGRIFFE UND SIGNALWÃ–RTER, DIE AUF HOHE/NIEDRIGE DRINGLICHKEIT HINDEUTEN (z.â€¯B. â€žNICHT ARBEITSFÃ„HIGâ€œ, â€žWARTEN AUF KUNDENâ€œ, â€žIST DRINGENDâ€œ, â€žNICHT ZEITKRITISCHâ€œ).\n\n3. **BREAK DOWN**  \n   - IDENTIFIZIERE:\n     - OB EIN GESCHÃ„FTSKRITISCHER AUSFALL VORLIEGT\n     - OB MEHRERE NUTZER BETROFFEN SIND\n     - OB ES SICH UM EINEN STANDARDVORGANG HANDELT\n     - OB FRISTEN / SLA-RELEVANTE ZEITPUNKTE BENANNT WERDEN\n\n4. **ANALYZE**  \n   - VERGLEICHE DIE ERKANNTEN MERKMALE MIT DEN REFERENZBEISPIELEN IM GOOGLE SHEET.\n   - WÃ„HLE DIE DRINGLICHKEITSSTUFE (Aâ€“D), DIE DER FALLBESCHREIBUNG IM TRANSKRIPT **AM NÃ„CHSTEN KOMMT**.\n\n5. **BUILD**  \n   - FASSE DEINE ANALYSE IN EINEM KURZEN BEGRÃœNDETEN KOMMENTAR ZUSAMMEN.\n   - GIB DIE FINAL ZUGEORDNETE KATEGORIE AUS.\n\n6. **EDGE CASES**  \n   - WENN DAS TRANSKRIPT **UNKLAR ODER WIDERSPRÃœCHLICH** IST, WÃ„HLE DIE KONSERVATIVERE (HÃ–HERE) KATEGORIE UND WEISE EXPLIZIT AUF DIE UNSICHERHEIT HIN.\n\n7. **FINAL ANSWER FORMAT**  \n   - GIB DEINE ANTWORT IM FOLGENDEN FORMAT AUS:\n\n```json\n{\n  \"Dringlichkeit\": \"B\",\n  \"BegrÃ¼ndung\": \"Der Kunde ist arbeitsfÃ¤hig, jedoch blockiert ein IT-Fehler einen zeitkritischen GeschÃ¤ftsprozess. Ã„hnliche FÃ¤lle wurden im Sheet als B eingestuft.\"\n}\n```\n\n---\n\n###WAS NICHT ZU TUN IST###\n\nVERMEIDE UNBEDINGT FOLGENDE FEHLER:\n\n- **NIEMALS** KATEGORIEN OHNE BEZUG ZUM GOOGLE SHEET FESTLEGEN  \n- **VERMEIDE VAGE BEGRÃœNDUNGEN** WIE â€žHÃ–RT SICH DRINGEND ANâ€œ ODER â€žKLINGT NICHT WICHTIGâ€œ  \n- **NICHT EINFACH NACH SCHLÃœSSELWORTEN KLASSIFIZIEREN**, SONDERN IMMER DIE GESAMTSITUATION ANALYSIEREN  \n- **NIEMALS AUSSAGEN ERFINDEN**, DIE NICHT IM TRANSKRIPT ENTHALTEN SIND  \n- **NICHT ÃœBERKATEGORISIEREN**: WÃ„HLE NICHT â€žAâ€œ, NUR WEIL EIN KUNDE UNZUFRIEDEN IST, WENN DIE TECHNISCHE LAGE ES NICHT RECHTFERTIGT  \n- **IGNORIERE KEINESFALLS** HINWEISE AUF SYSTEMRELEVANZ ODER PRODUKTIONSSTOPP\n\n---\n\n###FEW-SHOT BEISPIELE###\n\n####Beispiel 1:\n**Transkript (Auszug):**  \nâ€žIch kann mich nicht mehr in SAP anmelden, wir mÃ¼ssen heute unbedingt die Monatsabrechnung machen.â€œ\n\n**Ausgabe:**  \n```json\n{\n  \"Dringlichkeit\": \"A\",\n  \"BegrÃ¼ndung\": \"Ein geschÃ¤ftskritischer Prozess (Monatsabrechnung) ist blockiert. Entsprechend der ReferenzfÃ¤lle im Sheet ist dies Kategorie A.\"\n}\n```\n\n####Beispiel 2:\n**Transkript (Auszug):**  \nâ€žIch wollte nur fragen, ob man den Drucker auch Ã¼ber WLAN verbinden kann â€“ ist aber nicht eilig.â€œ\n\n**Ausgabe:**  \n```json\n{\n  \"Dringlichkeit\": \"D\",\n  \"BegrÃ¼ndung\": \"Kein akuter Vorfall, Informationsanfrage ohne Zeitdruck. Entspricht klar Kategorie D im Sheet.\"\n}\n```\n\n</system_prompt>"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 3,
          "position": [
            432,
            0
          ],
          "id": "0aeac5e6-c9be-4642-9858-9cf4394bc907",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "claude-sonnet-4-20250514",
              "mode": "list",
              "cachedResultName": "Claude Sonnet 4"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
          "typeVersion": 1.3,
          "position": [
            304,
            208
          ],
          "id": "b72b4dd9-4588-4dc0-996c-834b03ded117",
          "name": "Anthropic Chat Model",
          "credentials": {
            "anthropicApi": {
              "id": "6RlfJdXsmselCNpN",
              "name": "Anthropic account 2"
            }
          }
        }
      ],
      "connections": {
        "Webhook": {
          "main": [
            [
              {
                "node": "Daten extrahieren",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Daten extrahieren": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Anthropic Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "d5df5744-7d36-4fbb-ac6a-a36b16241341",
      "activeVersionId": null,
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-11-23T15:45:35.270Z",
          "createdAt": "2025-11-23T15:45:35.270Z",
          "role": "workflow:owner",
          "workflowId": "BFYzOmXZPvhoUbBS",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": null,
      "tags": []
    },
    {
      "updatedAt": "2025-12-21T18:40:20.348Z",
      "createdAt": "2025-12-15T21:35:40.591Z",
      "id": "C3QqvJAGjf0KhCZH",
      "name": "n8n to GitHub Auto-Backup (inkrementell)",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "field": "minutes",
                  "minutesInterval": 15
                },
                {
                  "field": "hours"
                },
                {
                  "field": "hours"
                }
              ]
            }
          },
          "id": "7b387171-2246-4827-8c8b-1293ad9ede50",
          "name": "Schedule: 7-18 Uhr (alle 15min)",
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.2,
          "position": [
            -720,
            -304
          ]
        },
        {
          "parameters": {},
          "id": "e5ca91e2-f818-4bdb-b748-d122e2021c3a",
          "name": "Manual Trigger",
          "type": "n8n-nodes-base.manualTrigger",
          "typeVersion": 1,
          "position": [
            -720,
            -160
          ]
        },
        {
          "parameters": {
            "url": "http://localhost:5678/api/v1/workflows",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {
              "response": {
                "response": {
                  "responseFormat": "json"
                }
              },
              "pagination": {
                "pagination": {
                  "parameters": {
                    "parameters": [
                      {
                        "name": "cursor",
                        "value": "={{ $response.body.nextCursor }}"
                      }
                    ]
                  },
                  "paginationCompleteWhen": "other",
                  "completeExpression": "={{ !$response.body.nextCursor }}",
                  "limitPagesFetched": true
                }
              }
            }
          },
          "id": "7965aee1-74f5-4967-8296-d7fb7bff9e18",
          "name": "Get All Workflows",
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -496,
            -208
          ],
          "credentials": {
            "httpHeaderAuth": {
              "id": "4gc7MePUZVuCyowB",
              "name": "Header Auth account"
            }
          }
        },
        {
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "// Wir holen das aktuelle Item sicher ab\nconst workflow = $input.item.json || {};\n\n// 1. Name sicher abgreifen (Fallback, falls Name fehlt)\nconst rawName = workflow.name || \"unnamed-workflow\";\n\n// 2. Kategorie basierend auf Tags bestimmen (mit SicherheitsprÃ¼fung)\nlet category = 'uncategorized';\nconst tags = workflow.tags || [];\n\nif (tags.length > 0 && tags[0] && tags[0].name) {\n  const tagName = tags[0].name.toLowerCase();\n  \n  if (['ai', 'agent', 'langchain'].some(t => tagName.includes(t))) {\n    category = 'ai-agents';\n  } else if (['communication', 'slack', 'email', 'discord'].some(t => tagName.includes(t))) {\n    category = 'communication';\n  } else if (['analysis', 'data', 'report'].some(t => tagName.includes(t))) {\n    category = 'analysis';\n  } else if (['business', 'crm', 'sales'].some(t => tagName.includes(t))) {\n    category = 'business';\n  }\n}\n\n// 3. Dateinamen bereinigen (Sanitize)\n// Wir wandeln alles in einen String um, bevor wir .replace() nutzen\nconst sanitizedName = String(rawName)\n  .replace(/[^a-zA-Z0-9-_Ã¤Ã¶Ã¼Ã„Ã–ÃœÃŸ ]/g, '') // Entfernt Sonderzeichen\n  .trim()\n  .replace(/\\s+/g, '-') // Ersetzt Leerzeichen durch Bindestriche\n  .toLowerCase();\n\n// 4. Inhalt fÃ¼r GitHub vorbereiten\nconst content = JSON.stringify(workflow, null, 2);\nconst contentBase64 = Buffer.from(content).toString('base64');\n\n// RÃ¼ckgabe der Daten\nreturn {\n  id: workflow.id,\n  name: rawName,\n  category: category,\n  filename: `${sanitizedName}.json`,\n  filepath: `workflows/${category}/${sanitizedName}.json`,\n  content: content,\n  contentBase64: contentBase64,\n  updatedAt: workflow.updatedAt || new Date().toISOString()\n};"
          },
          "id": "0c7c1907-8647-4cea-9838-f3596f88098b",
          "name": "Process Workflows",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -272,
            -208
          ]
        },
        {
          "parameters": {
            "url": "=https://api.github.com/repos/peerendees/n8n-workflows/contents/{{ $json.filepath }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {
              "response": {
                "response": {
                  "neverError": true
                }
              }
            }
          },
          "id": "8dc69d6e-8347-4352-9a66-6fc2a413a21b",
          "name": "Check if File Changed",
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            784,
            -208
          ],
          "credentials": {
            "httpHeaderAuth": {
              "id": "4gc7MePUZVuCyowB",
              "name": "Header Auth account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "// PrÃ¼fe ob Datei neu ist oder sich geÃ¤ndert hat\nconst githubResponse = $('Check if File Changed').first().json;\nconst originalData = $('Process Workflows').item.json;\n\n// Wenn Datei nicht existiert (404)\nif (githubResponse.message === 'Not Found') {\n  return [{ \n    json: { \n      ...originalData,\n      action: 'create',\n      changed: true,\n      reason: 'new_file'\n    } \n  }];\n}\n\n// FÃ¼r Update: Vergleiche nur die Timestamps\nconst existingTimestamp = githubResponse.sha; // Vereinfacht: nutze SHA als Vergleich\nif (existingTimestamp !== originalData.hash) {\n  return [{ \n    json: { \n      ...originalData,\n      action: 'update',\n      changed: true,\n      sha: githubResponse.sha,\n      reason: 'content_changed'\n    } \n  }];\n}\n\n// Keine Ã„nderung\nreturn [{ \n  json: { \n    ...originalData,\n    action: 'skip',\n    changed: false,\n    reason: 'no_change'\n  } \n}];"
          },
          "id": "9dfafbfd-d03f-44ec-bbd2-1b0e20baab3b",
          "name": "Detect Changes",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1008,
            -208
          ]
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 1
              },
              "conditions": [
                {
                  "id": "has-changes",
                  "leftValue": "={{ $json.changed }}",
                  "rightValue": true,
                  "operator": {
                    "type": "boolean",
                    "operation": "equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "id": "00a4df03-0b77-4f50-9fba-3030d2ab2403",
          "name": "Has Changes?",
          "type": "n8n-nodes-base.if",
          "typeVersion": 2,
          "position": [
            1232,
            -208
          ]
        },
        {
          "parameters": {
            "method": "PUT",
            "url": "=https://api.github.com/repos/peerendees/n8n-workflows/contents/{{ $json.filepath }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "message",
                  "value": "=ðŸ¤– Auto-Backup: {{ $json.name }} ({{ $json.action }})"
                },
                {
                  "name": "content",
                  "value": "={{ $json.contentBase64 }}"
                },
                {
                  "name": "branch",
                  "value": "main"
                },
                {
                  "name": "sha",
                  "value": "={{ $json.sha }}"
                }
              ]
            },
            "options": {}
          },
          "id": "5de3d43a-8ae0-4b28-bb44-4487d37d09f8",
          "name": "Commit to GitHub",
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            672,
            -336
          ],
          "credentials": {
            "httpHeaderAuth": {
              "id": "aZMd0okvVFkvyGnj",
              "name": "GitHub Token"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "// Sammle Statistiken Ã¼ber das Backup\nconst items = $input.all();\nconst stats = {\n  total: items.length,\n  created: items.filter(i => i.json.action === 'create').length,\n  updated: items.filter(i => i.json.action === 'update').length,\n  skipped: items.filter(i => i.json.action === 'skip').length,\n  timestamp: new Date().toISOString(),\n  timezone: 'Europe/Berlin'\n};\n\n// Liste der geÃ¤nderten Workflows\nconst changedWorkflows = items\n  .filter(i => i.json.changed)\n  .map(i => `â€¢ ${i.json.name} (${i.json.category})`);\n\nreturn [{\n  json: {\n    stats: stats,\n    hasChanges: stats.created + stats.updated > 0,\n    changedWorkflows: changedWorkflows,\n    summary: `âœ… Backup abgeschlossen\\n${stats.created} neu, ${stats.updated} aktualisiert, ${stats.skipped} unverÃ¤ndert`\n  }\n}];"
          },
          "id": "da117cd8-c031-4d5f-8313-701cdfe54c64",
          "name": "Collect Backup Stats",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1680,
            -208
          ]
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict"
              },
              "conditions": [
                {
                  "id": "stats-has-changes",
                  "leftValue": "={{ $json.hasChanges }}",
                  "rightValue": true,
                  "operator": {
                    "type": "boolean",
                    "operation": "equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "id": "9765e155-b5b2-4532-84dc-4815626bdbca",
          "name": "Should Notify?",
          "type": "n8n-nodes-base.if",
          "typeVersion": 2,
          "position": [
            1904,
            -208
          ]
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://msgapi.threema.ch/send_simple",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "from",
                  "value": "*DEINE_THREEMA_ID"
                },
                {
                  "name": "to",
                  "value": "*EMPFÃ„NGER_THREEMA_ID"
                },
                {
                  "name": "secret",
                  "value": "*DEIN_THREEMA_SECRET"
                },
                {
                  "name": "text",
                  "value": "=ðŸ”„ n8n Backup erfolgreich\\n\\n{{ $json.summary }}\\n\\nGeÃ¤nderte Workflows:\\n{{ $json.changedWorkflows.join('\\n') }}\\n\\nðŸ”— https://github.com/peerendees/n8n-workflows"
                }
              ]
            },
            "options": {}
          },
          "id": "1a8aaca0-70af-4dd0-b513-4f3de2c10ef5",
          "name": "Send Threema Notification",
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            2128,
            -208
          ]
        },
        {
          "parameters": {
            "content": "## ðŸ”„ n8n â†’ GitHub Auto-Backup\n\nAutomatisches Backup System\n\nTrigger:**\\n\n1. â° Schedule: 7:00-18:00 Uhr (alle 15min)\n2. ðŸ‘† Manual: On-Demand auÃŸerhalb der Zeit\n\n**Ablauf:**\n1. Alle Workflows abrufen (n8n API)\n2. In Kategorien sortieren\n3. Ã„nderungen erkennen (SHA256 Hash)\n4. Nur geÃ¤nderte pushen â†’ GitHub\n5. Statistik sammeln\n6. Bei Ã„nderungen: Threema Notification\n\n**Kategorien:**\nâ€“ ai-agents\nâ€“ communication\nâ€“ business\nâ€“ analysis\nâ€“ uncategorized\n\n**Features:**\nâœ… Inkrementell (nur Ã„nderungen)\nâœ… Automatische Kategorisierung\nâœ… Hash-basierte Change Detection\nâœ… Zeitgesteuert + Manuell\nâœ… Threema Work Benachrichtigung\n\n**Setup erforderlich:**\n1. n8n API Key (Settings â†’ API)\n2. GitHub Personal Access Token (repo scope)\n3. Threema Work API Credentials",
            "height": 708,
            "width": 544,
            "color": 4
          },
          "id": "208c8c16-9e72-47de-994e-af1aee214010",
          "name": "Workflow Documentation",
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1088,
            -624
          ]
        },
        {
          "parameters": {
            "content": "âš™ï¸ **Credentials Setup:**\\n\\n1. **n8n API Key**\\n   - Type: Header Auth\\n   - Name: `X-N8N-API-KEY`\\n   - Value: Dein API Key\\n\\n2. **GitHub Token**\\n   - Type: Header Auth\\n   - Name: `Authorization`\\n   - Value: `Bearer DEIN_GITHUB_TOKEN`\\n\\n3. **Threema Work**\\n   - From: *DEINE_ID\\n   - To: *EMPFÃ„NGER_ID\\n   - Secret: API Secret",
            "height": 312,
            "width": 876,
            "color": 6
          },
          "id": "f8b230c1-bf74-41ee-a4ab-4ffc86df8471",
          "name": "Credentials Setup",
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -544,
            -368
          ]
        },
        {
          "parameters": {
            "resource": "file",
            "operation": "get",
            "owner": {
              "__rl": true,
              "value": "peerendees",
              "mode": "name"
            },
            "repository": {
              "__rl": true,
              "value": "n8n-workflows",
              "mode": "list",
              "cachedResultName": "n8n-workflows",
              "cachedResultUrl": "https://github.com/peerendees/n8n-workflows"
            },
            "filePath": "={{ $json.filepath }}",
            "asBinaryProperty": false,
            "additionalParameters": {}
          },
          "type": "n8n-nodes-base.github",
          "typeVersion": 1.1,
          "position": [
            -64,
            -208
          ],
          "id": "ca6d1fd3-4d01-49ba-86f8-98929e969590",
          "name": "Check GitHub for File",
          "webhookId": "694567e2-c3e8-4bfc-91af-aae5697aca36",
          "credentials": {
            "githubApi": {
              "id": "uE78TkEY6lWLV4oP",
              "name": "GitHub account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "// Daten vom Code-Node davor abgreifen (unser lokaler Workflow)\nconst local = $(\"Process Workflows\").item.json;\n// Daten von GitHub abgreifen\nconst remote = $input.item.json;\n\nlet action = 'skip';\nlet sha = null;\nlet reason = '';\n\n// Fall 1: Datei existiert noch nicht auf GitHub\nif (remote.error || !remote.sha) {\n  action = 'create';\n  reason = 'New workflow';\n} \nelse {\n  // Fall 2: Datei existiert. Wir vergleichen den Inhalt.\n  // GitHub schickt den Inhalt in Base64, aber oft mit ZeilenumbrÃ¼chen (\\n).\n  const remoteContentClean = remote.content.replace(/\\n/g, '');\n  const localContent = local.contentBase64;\n\n  if (remoteContentClean !== localContent) {\n    action = 'update';\n    sha = remote.sha; // Wir brauchen den SHA fÃ¼r das Update!\n    reason = 'Changes detected';\n  } else {\n    action = 'skip';\n    reason = 'No changes';\n  }\n}\n\n// Alles zusammenfÃ¼hren\nreturn {\n  ...local,\n  action,\n  sha,\n  reason\n};"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            144,
            -208
          ],
          "id": "f03cf7be-e43f-4b2d-945d-2662dd6a2baa",
          "name": "Determine Action"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "8842bb3c-3f3b-4b97-a118-01cb0866a8bb",
                  "leftValue": "={{ $json.action !== 'skip' }}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            352,
            -208
          ],
          "id": "c5e4a411-fe36-42d3-9fe5-cf284bc5d850",
          "name": "If"
        },
        {
          "parameters": {
            "resource": "file",
            "operation": "edit",
            "owner": {
              "__rl": true,
              "value": "peerendees",
              "mode": "name"
            },
            "repository": {
              "__rl": true,
              "value": "n8n-workflows",
              "mode": "list",
              "cachedResultName": "n8n-workflows",
              "cachedResultUrl": "https://github.com/peerendees/n8n-workflows"
            },
            "filePath": "={{ $('Process Workflows').item.json.filepath }}",
            "fileContent": "={{ $('Process Workflows').item.json.content }}",
            "commitMessage": "=ðŸ¤– Auto-Backup: {{ $node[\"Process Workflows\"].json.name }} ({{ $node[\"Determine Action\"].json.action }})"
          },
          "type": "n8n-nodes-base.github",
          "typeVersion": 1.1,
          "position": [
            560,
            -720
          ],
          "id": "57e663a8-80f8-4270-9bb5-0a8aaf4b9cee",
          "name": "Commit to GitHub1",
          "webhookId": "bc53628b-0532-403d-95a8-34635212af18",
          "credentials": {
            "githubApi": {
              "id": "uE78TkEY6lWLV4oP",
              "name": "GitHub account"
            }
          }
        }
      ],
      "connections": {
        "Schedule: 7-18 Uhr (alle 15min)": {
          "main": [
            [
              {
                "node": "Get All Workflows",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Manual Trigger": {
          "main": [
            [
              {
                "node": "Get All Workflows",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get All Workflows": {
          "main": [
            [
              {
                "node": "Process Workflows",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Process Workflows": {
          "main": [
            [
              {
                "node": "Check GitHub for File",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Check if File Changed": {
          "main": [
            [
              {
                "node": "Detect Changes",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Detect Changes": {
          "main": [
            [
              {
                "node": "Has Changes?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Has Changes?": {
          "main": [
            [],
            [
              {
                "node": "Collect Backup Stats",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Commit to GitHub": {
          "main": [
            []
          ]
        },
        "Collect Backup Stats": {
          "main": [
            [
              {
                "node": "Should Notify?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Should Notify?": {
          "main": [
            [
              {
                "node": "Send Threema Notification",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Check GitHub for File": {
          "main": [
            [
              {
                "node": "Determine Action",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Determine Action": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Commit to GitHub",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Commit to GitHub1": {
          "main": [
            []
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "7c00e602-9fc4-4299-ae6b-b23a0f3f2fc6",
      "activeVersionId": null,
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-12-15T21:35:40.595Z",
          "createdAt": "2025-12-15T21:35:40.595Z",
          "role": "workflow:owner",
          "workflowId": "C3QqvJAGjf0KhCZH",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": null,
      "tags": []
    },
    {
      "updatedAt": "2025-12-03T14:11:05.000Z",
      "createdAt": "2025-11-17T21:03:36.257Z",
      "id": "CCJmgqzH9XCESXGz",
      "name": "My Sub-workflow",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.code",
          "typeVersion": 1,
          "position": [
            -640,
            336
          ],
          "id": "7529b4b9-a2c9-4732-8dc8-8c7b4e924aa9",
          "name": "LangChain Code"
        },
        {
          "parameters": {
            "inputSource": "passthrough"
          },
          "id": "414d8426-53cf-4db3-ae65-58b9ab576d9a",
          "typeVersion": 1.1,
          "name": "Start",
          "type": "n8n-nodes-base.executeWorkflowTrigger",
          "position": [
            -848,
            336
          ]
        },
        {
          "parameters": {
            "authentication": "serviceAccount",
            "documentId": {
              "__rl": true,
              "value": "1kyIdVpLg4Ate6b0o2yyB4wzu3e7stQjcILLVrWX6RD8",
              "mode": "id"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Anrufer",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1kyIdVpLg4Ate6b0o2yyB4wzu3e7stQjcILLVrWX6RD8/edit#gid=0"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -320,
            224
          ],
          "id": "86ba2908-e79b-4cea-b516-72436f22c05c",
          "name": "Get row(s) in sheet",
          "credentials": {
            "googleApi": {
              "id": "vRVq7GTwn9kTIi8N",
              "name": "Google Sheets account 2"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.manualTrigger",
          "typeVersion": 1,
          "position": [
            -640,
            128
          ],
          "id": "d6d88f12-945d-485a-ad0e-19afa6233241",
          "name": "When clicking â€˜Execute workflowâ€™",
          "disabled": true
        },
        {
          "parameters": {
            "jsCode": "const items = $input.all();\nconst now = new Date();\n\nconsole.log(\"Aktuelle Zeit:\", now.toISOString());\n\nconst itemsToCall = items.filter(item => {\n  const anrufzeitpunkt = item.json.Anrufzeitpunkt;\n  console.log(\"Anrufzeitpunkt aus Sheet:\", anrufzeitpunkt);\n  \n  const callTime = new Date(anrufzeitpunkt);\n  console.log(\"Geparste callTime:\", callTime.toISOString());\n  \n  const timeDiff = now.getTime() - callTime.getTime();\n  console.log(\"TimeDiff in ms:\", timeDiff);\n  console.log(\"Bedingung erfÃ¼llt?\", timeDiff >= 0 && timeDiff <= 60000);\n  \n  return timeDiff >= 0 && timeDiff <= 60000;\n});\n\nreturn itemsToCall;"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -112,
            224
          ],
          "id": "fa54ed68-a3f2-4ce1-9b59-597e25d9d736",
          "name": "Check Time"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "fcd2afab-561c-46c7-85fb-cf7f44ae08d4",
                  "leftValue": "",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            96,
            224
          ],
          "id": "3ff081fa-082a-4377-afa3-93cdd34f1b3f",
          "name": "If"
        }
      ],
      "connections": {
        "When clicking â€˜Execute workflowâ€™": {
          "main": [
            [
              {
                "node": "Get row(s) in sheet",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get row(s) in sheet": {
          "main": [
            [
              {
                "node": "Check Time",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Check Time": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "99d3901b-455e-4629-804b-823baef4fa18",
      "activeVersionId": "99d3901b-455e-4629-804b-823baef4fa18",
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-11-17T21:03:36.264Z",
          "createdAt": "2025-11-17T21:03:36.264Z",
          "role": "workflow:owner",
          "workflowId": "CCJmgqzH9XCESXGz",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": {
        "updatedAt": "2025-12-18T10:08:31.967Z",
        "createdAt": "2025-12-18T10:08:31.967Z",
        "versionId": "99d3901b-455e-4629-804b-823baef4fa18",
        "workflowId": "CCJmgqzH9XCESXGz",
        "nodes": [
          {
            "parameters": {},
            "type": "@n8n/n8n-nodes-langchain.code",
            "typeVersion": 1,
            "position": [
              -640,
              336
            ],
            "id": "7529b4b9-a2c9-4732-8dc8-8c7b4e924aa9",
            "name": "LangChain Code"
          },
          {
            "parameters": {
              "inputSource": "passthrough"
            },
            "id": "414d8426-53cf-4db3-ae65-58b9ab576d9a",
            "typeVersion": 1.1,
            "name": "Start",
            "type": "n8n-nodes-base.executeWorkflowTrigger",
            "position": [
              -848,
              336
            ]
          },
          {
            "parameters": {
              "authentication": "serviceAccount",
              "documentId": {
                "__rl": true,
                "value": "1kyIdVpLg4Ate6b0o2yyB4wzu3e7stQjcILLVrWX6RD8",
                "mode": "id"
              },
              "sheetName": {
                "__rl": true,
                "value": "gid=0",
                "mode": "list",
                "cachedResultName": "Anrufer",
                "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1kyIdVpLg4Ate6b0o2yyB4wzu3e7stQjcILLVrWX6RD8/edit#gid=0"
              },
              "options": {}
            },
            "type": "n8n-nodes-base.googleSheets",
            "typeVersion": 4.7,
            "position": [
              -320,
              224
            ],
            "id": "86ba2908-e79b-4cea-b516-72436f22c05c",
            "name": "Get row(s) in sheet",
            "credentials": {
              "googleApi": {
                "id": "vRVq7GTwn9kTIi8N",
                "name": "Google Sheets account 2"
              }
            }
          },
          {
            "parameters": {},
            "type": "n8n-nodes-base.manualTrigger",
            "typeVersion": 1,
            "position": [
              -640,
              128
            ],
            "id": "d6d88f12-945d-485a-ad0e-19afa6233241",
            "name": "When clicking â€˜Execute workflowâ€™",
            "disabled": true
          },
          {
            "parameters": {
              "jsCode": "const items = $input.all();\nconst now = new Date();\n\nconsole.log(\"Aktuelle Zeit:\", now.toISOString());\n\nconst itemsToCall = items.filter(item => {\n  const anrufzeitpunkt = item.json.Anrufzeitpunkt;\n  console.log(\"Anrufzeitpunkt aus Sheet:\", anrufzeitpunkt);\n  \n  const callTime = new Date(anrufzeitpunkt);\n  console.log(\"Geparste callTime:\", callTime.toISOString());\n  \n  const timeDiff = now.getTime() - callTime.getTime();\n  console.log(\"TimeDiff in ms:\", timeDiff);\n  console.log(\"Bedingung erfÃ¼llt?\", timeDiff >= 0 && timeDiff <= 60000);\n  \n  return timeDiff >= 0 && timeDiff <= 60000;\n});\n\nreturn itemsToCall;"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              -112,
              224
            ],
            "id": "fa54ed68-a3f2-4ce1-9b59-597e25d9d736",
            "name": "Check Time"
          },
          {
            "parameters": {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fcd2afab-561c-46c7-85fb-cf7f44ae08d4",
                    "leftValue": "",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "options": {}
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 2.2,
            "position": [
              96,
              224
            ],
            "id": "3ff081fa-082a-4377-afa3-93cdd34f1b3f",
            "name": "If"
          }
        ],
        "connections": {
          "When clicking â€˜Execute workflowâ€™": {
            "main": [
              [
                {
                  "node": "Get row(s) in sheet",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get row(s) in sheet": {
            "main": [
              [
                {
                  "node": "Check Time",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Check Time": {
            "main": [
              [
                {
                  "node": "If",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "system migration",
        "name": null,
        "description": null
      },
      "tags": []
    },
    {
      "updatedAt": "2025-11-11T22:29:55.000Z",
      "createdAt": "2025-11-11T22:01:32.621Z",
      "id": "CKF3dFWeZX0gTU1U",
      "name": "YouTube-Transkript fÃ¼r Notion",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {},
          "id": "0529cc23-465a-4869-905d-7ffdf002f3f5",
          "name": "Manueller Start",
          "type": "n8n-nodes-base.manualTrigger",
          "typeVersion": 1,
          "position": [
            -544,
            128
          ]
        },
        {
          "parameters": {
            "options": {}
          },
          "id": "08656112-da08-41bd-8afe-0f30a17bb215",
          "name": "Kanal Konfiguration",
          "type": "n8n-nodes-base.set",
          "typeVersion": 3,
          "position": [
            -368,
            128
          ]
        },
        {
          "parameters": {},
          "id": "2911386d-5ba0-4f0a-8f54-72534aed4e3a",
          "name": "YouTube Videos abrufen",
          "type": "n8n-nodes-youtube.youtube",
          "typeVersion": 1,
          "position": [
            -192,
            128
          ]
        },
        {
          "parameters": {},
          "id": "c37e66e7-bd0c-47bb-ad6e-977633822372",
          "name": "Video Details",
          "type": "n8n-nodes-youtube.youtube",
          "typeVersion": 1,
          "position": [
            0,
            0
          ]
        },
        {
          "parameters": {
            "url": "=https://api.youtubetranscript.com/?video_id={{ $json.id.videoId }}",
            "options": {
              "timeout": 30000
            }
          },
          "id": "6008e63c-6c09-4572-ab87-e5340024d883",
          "name": "Transkript extrahieren",
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.1,
          "position": [
            0,
            144
          ]
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict"
              },
              "conditions": [
                {
                  "id": "has-transcript",
                  "leftValue": "={{ $json.transcript || $json.text || '' }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty"
                  }
                },
                {
                  "id": "min-length",
                  "leftValue": "={{ ($json.transcript || $json.text || '').length }}",
                  "rightValue": "100",
                  "operator": {
                    "type": "number",
                    "operation": "gt"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "id": "7319f50a-bdf6-4a97-9e8e-90e64d0b3eb4",
          "name": "Transkript validieren",
          "type": "n8n-nodes-base.if",
          "typeVersion": 2,
          "position": [
            176,
            144
          ]
        },
        {
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "// Alle Daten aus vorherigen Nodes sammeln\nconst searchData = $('youtube-search').item(0).json;\nconst videoDetails = $('video-details').item(0).json;\nconst transcriptData = $('get-transcript').item(0).json;\nconst config = $('config').item(0).json;\n\n// Transkript extrahieren und bereinigen\nlet rawTranscript = transcriptData.transcript || transcriptData.text || '';\nif (Array.isArray(transcriptData)) {\n  rawTranscript = transcriptData.map(item => item.text || item.content || '').join(' ');\n}\n\n// Text bereinigen und formatieren\nconst cleanTranscript = rawTranscript\n  .replace(/\\[.*?\\]/g, '')           // [Musik], [Applaus] etc.\n  .replace(/\\(.*?\\)/g, '')           // (inaudible) etc.\n  .replace(/\\s+/g, ' ')              // Mehrfache Leerzeichen\n  .replace(/\\n+/g, '\\n\\n')           // AbsÃ¤tze formatieren\n  .trim();\n\n// Video-Dauer aus ISO 8601 Format parsen (PT4M13S -> 4:13)\nfunction parseDuration(duration) {\n  if (!duration) return 'Unknown';\n  const match = duration.match(/PT(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+)S)?/);\n  if (!match) return duration;\n  \n  const hours = parseInt(match[1] || 0);\n  const minutes = parseInt(match[2] || 0);\n  const seconds = parseInt(match[3] || 0);\n  \n  if (hours > 0) {\n    return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n  } else {\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n  }\n}\n\n// Tags aus Video-Titel und Beschreibung extrahieren\nfunction extractTags(title, description) {\n  const tags = [];\n  const text = (title + ' ' + description).toLowerCase();\n  \n  // AI/KI-bezogene Keywords\n  if (text.match(/(ai|artificial intelligence|chatgpt|gpt|claude|llm|machine learning|automation)/)) {\n    tags.push('AI');\n  }\n  \n  // Marketing Keywords\n  if (text.match(/(marketing|sales|business|growth|strategy|revenue)/)) {\n    tags.push('Marketing');\n  }\n  \n  // Tutorial Keywords\n  if (text.match(/(tutorial|how to|guide|step by step|walkthrough|setup)/)) {\n    tags.push('Tutorial');\n  }\n  \n  // Tool Keywords\n  if (text.match(/(tool|software|app|platform|api|integration)/)) {\n    tags.push('Tools');\n  }\n  \n  return tags.length > 0 ? tags : ['AI']; // Default fallback\n}\n\nreturn {\n  // Video Grunddaten\n  videoId: searchData.id.videoId,\n  title: videoDetails.snippet.title,\n  channelTitle: videoDetails.snippet.channelTitle,\n  authorName: config.authorName,\n  publishedAt: videoDetails.snippet.publishedAt,\n  description: videoDetails.snippet.description,\n  \n  // Statistiken\n  viewCount: parseInt(videoDetails.statistics?.viewCount || 0),\n  likeCount: parseInt(videoDetails.statistics?.likeCount || 0),\n  duration: parseDuration(videoDetails.contentDetails?.duration),\n  \n  // URLs\n  videoUrl: `https://youtube.com/watch?v=${searchData.id.videoId}`,\n  thumbnailUrl: videoDetails.snippet?.thumbnails?.high?.url || '',\n  \n  // Transkript\n  cleanTranscript: cleanTranscript,\n  transcriptLength: cleanTranscript.length,\n  wordCount: cleanTranscript.split(' ').length,\n  estimatedReadingTime: Math.ceil(cleanTranscript.split(' ').length / 200),\n  \n  // Auto-Tags\n  autoTags: extractTags(videoDetails.snippet.title, videoDetails.snippet.description)\n};"
          },
          "id": "dcfdaf32-c774-400d-8290-bdd6e2f6d4e9",
          "name": "Daten zusammenfÃ¼hren",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            368,
            48
          ]
        },
        {
          "parameters": {
            "text": "={{ $json.cleanTranscript }}",
            "translateTo": "DE",
            "additionalFields": {}
          },
          "id": "fdb1c480-70bf-4817-93bc-8648c73e5b7b",
          "name": "DeepL Ãœbersetzen",
          "type": "n8n-nodes-base.deepL",
          "typeVersion": 1,
          "position": [
            544,
            48
          ]
        },
        {
          "parameters": {
            "resource": "databasePage",
            "databaseId": "22f31cc6-fd56-80f8-9a68-da6f99f3dade",
            "options": {}
          },
          "id": "575440c2-7ac3-4366-9f15-2bd1fbb4a40c",
          "name": "Notion Eintrag erstellen",
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2,
          "position": [
            720,
            48
          ]
        },
        {
          "parameters": {},
          "id": "1f1a0e3c-192b-4300-bf97-9bee858e0220",
          "name": "Threema Benachrichtigung",
          "type": "n8n-nodes-base.threema",
          "typeVersion": 1,
          "position": [
            896,
            48
          ]
        }
      ],
      "connections": {},
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": null,
      "pinData": {},
      "versionId": "56bf5671-3ae3-43b6-9d15-7293f763a9a2",
      "activeVersionId": null,
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-11-11T22:01:32.624Z",
          "createdAt": "2025-11-11T22:01:32.624Z",
          "role": "workflow:owner",
          "workflowId": "CKF3dFWeZX0gTU1U",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": null,
      "tags": []
    },
    {
      "updatedAt": "2025-11-11T23:07:15.000Z",
      "createdAt": "2025-11-11T22:30:16.638Z",
      "id": "DKEKrzFx9oYFubkV",
      "name": "YouTube-Transkript fÃ¼r Notion",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "youtube-transcript",
            "responseMode": "responseNode",
            "options": {
              "rawBody": true
            }
          },
          "id": "8578df34-bc02-4bd1-9715-42f75f19702a",
          "name": "Webhook Trigger",
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 1.1,
          "position": [
            -240,
            112
          ],
          "webhookId": "youtube-transcript-webhook"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "youtube-url",
                  "name": "youtubeUrl",
                  "value": "={{ $json.body.url || $json.query.url || $json.url }}",
                  "type": "string"
                },
                {
                  "id": "video-id",
                  "name": "videoId",
                  "value": "={{ $json.body.url ? $json.body.url.match(/(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/)([^&]+)/)?.[1] : '' }}",
                  "type": "string"
                },
                {
                  "id": "author-name",
                  "name": "authorName",
                  "value": "={{ $json.body.author || 'Unbekannt' }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "id": "bc66bf3f-464a-4a6c-a242-22b99c3fdf87",
          "name": "Webhook Daten extrahieren",
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.3,
          "position": [
            -16,
            112
          ]
        },
        {
          "parameters": {
            "operation": "get",
            "part": "snippet,contentDetails,statistics"
          },
          "id": "f38ef7ea-6f13-4373-8c7d-ac4cac265458",
          "name": "YouTube Video Details",
          "type": "n8n-nodes-base.youTube",
          "typeVersion": 1,
          "position": [
            208,
            112
          ]
        },
        {
          "parameters": {
            "url": "=https://api.youtubetranscript.com/?video_id={{ $json.videoId }}",
            "options": {
              "timeout": 30000
            }
          },
          "id": "dd98d656-4525-4c0d-9927-df71725dfe4b",
          "name": "Transkript extrahieren",
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            432,
            112
          ]
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict"
              },
              "conditions": [
                {
                  "id": "has-transcript",
                  "leftValue": "={{ $json.transcript || $json.text || '' }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty"
                  }
                },
                {
                  "id": "min-length",
                  "leftValue": "={{ ($json.transcript || $json.text || '').length }}",
                  "rightValue": "100",
                  "operator": {
                    "type": "number",
                    "operation": "gt"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "id": "44540dcd-3aa0-4f12-a9b9-1545880563b9",
          "name": "Transkript validieren",
          "type": "n8n-nodes-base.if",
          "typeVersion": 2,
          "position": [
            656,
            112
          ]
        },
        {
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "// Alle Daten aus vorherigen Nodes sammeln\nconst config = $('Webhook Daten extrahieren').item.json;\nconst videoDetails = $('YouTube Video Details').item.json;\nconst transcriptData = $('Transkript extrahieren').item.json;\n\n// Transkript extrahieren und bereinigen\nlet rawTranscript = transcriptData.transcript || transcriptData.text || '';\nif (Array.isArray(transcriptData)) {\n  rawTranscript = transcriptData.map(item => item.text || item.content || '').join(' ');\n}\n\n// Text bereinigen und formatieren\nconst cleanTranscript = rawTranscript\n  .replace(/\\[.*?\\]/g, '')           // [Musik], [Applaus] etc.\n  .replace(/\\(.*?\\)/g, '')           // (inaudible) etc.\n  .replace(/\\s+/g, ' ')              // Mehrfache Leerzeichen\n  .replace(/\\n+/g, '\\n\\n')           // AbsÃ¤tze formatieren\n  .trim();\n\n// Video-Dauer aus ISO 8601 Format parsen (PT4M13S -> 4:13)\nfunction parseDuration(duration) {\n  if (!duration) return 'Unknown';\n  const match = duration.match(/PT(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+)S)?/);\n  if (!match) return duration;\n  \n  const hours = parseInt(match[1] || 0);\n  const minutes = parseInt(match[2] || 0);\n  const seconds = parseInt(match[3] || 0);\n  \n  if (hours > 0) {\n    return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n  } else {\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n  }\n}\n\n// Tags aus Video-Titel und Beschreibung extrahieren\nfunction extractTags(title, description) {\n  const tags = [];\n  const text = (title + ' ' + description).toLowerCase();\n  \n  // AI/KI-bezogene Keywords\n  if (text.match(/(ai|artificial intelligence|chatgpt|gpt|claude|llm|machine learning|automation)/)) {\n    tags.push('AI');\n  }\n  \n  // Marketing Keywords\n  if (text.match(/(marketing|sales|business|growth|strategy|revenue)/)) {\n    tags.push('Marketing');\n  }\n  \n  // Tutorial Keywords\n  if (text.match(/(tutorial|how to|guide|step by step|walkthrough|setup)/)) {\n    tags.push('Tutorial');\n  }\n  \n  // Tool Keywords\n  if (text.match(/(tool|software|app|platform|api|integration)/)) {\n    tags.push('Tools');\n  }\n  \n  return tags.length > 0 ? tags : ['AI']; // Default fallback\n}\n\nreturn {\n  // Video Grunddaten\n  videoId: config.videoId,\n  title: videoDetails.snippet?.title || 'Unbekannt',\n  channelTitle: videoDetails.snippet?.channelTitle || 'Unbekannt',\n  authorName: config.authorName || 'Unbekannt',\n  publishedAt: videoDetails.snippet?.publishedAt || new Date().toISOString(),\n  description: videoDetails.snippet?.description || '',\n  \n  // Statistiken\n  viewCount: parseInt(videoDetails.statistics?.viewCount || 0),\n  likeCount: parseInt(videoDetails.statistics?.likeCount || 0),\n  duration: parseDuration(videoDetails.contentDetails?.duration),\n  \n  // URLs\n  videoUrl: `https://youtube.com/watch?v=${config.videoId}`,\n  thumbnailUrl: videoDetails.snippet?.thumbnails?.high?.url || '',\n  \n  // Transkript\n  cleanTranscript: cleanTranscript,\n  transcriptLength: cleanTranscript.length,\n  wordCount: cleanTranscript.split(' ').length,\n  estimatedReadingTime: Math.ceil(cleanTranscript.split(' ').length / 200),\n  \n  // Auto-Tags\n  autoTags: extractTags(videoDetails.snippet?.title || '', videoDetails.snippet?.description || '')\n};"
          },
          "id": "8da16805-22c9-4587-9123-d9adeeef36ff",
          "name": "Daten zusammenfÃ¼hren",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            880,
            112
          ]
        },
        {
          "parameters": {
            "text": "={{ $json.cleanTranscript }}",
            "translateTo": "DE",
            "additionalFields": {}
          },
          "id": "b1940f22-06d0-4976-ae4e-4b1d42ebb692",
          "name": "DeepL Ãœbersetzen",
          "type": "n8n-nodes-base.deepL",
          "typeVersion": 1,
          "position": [
            1104,
            112
          ]
        },
        {
          "parameters": {
            "resource": "databasePage",
            "databaseId": {
              "__rl": true,
              "mode": "url",
              "value": "=22f31cc6fd5680f89a68da6f99f3dade",
              "__regex": "(?:https|http)://www\\.notion\\.so/(?:[a-z0-9-]{2,}/)?([0-9a-f]{8}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{12})"
            },
            "title": "YouTube Transkripte",
            "simple": false,
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "Autor"
                }
              ]
            },
            "options": {}
          },
          "id": "0c40d5b2-9606-4b6f-9e8f-634b726738d4",
          "name": "Notion Eintrag erstellen",
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2,
          "position": [
            1328,
            112
          ],
          "notesInFlow": true,
          "credentials": {
            "notionApi": {
              "id": "KpKj51GJ0big0oYv",
              "name": "Notion account"
            }
          },
          "notes": "Datenbank-ID als ENV-Variable: NOTION_DATABASE_ID"
        },
        {
          "parameters": {
            "authentication": "generic",
            "options": {}
          },
          "id": "b35e4ad7-9a42-4754-b9fd-b5da476968d9",
          "name": "Threema Work Benachrichtigung",
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1552,
            112
          ],
          "notesInFlow": true,
          "notes": "Threema Work API - EmpfÃ¤nger-ID noch anzupassen"
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={{ {\n  \"success\": true,\n  \"message\": \"Video erfolgreich verarbeitet\",\n  \"videoId\": $('Webhook Daten extrahieren').item.json.videoId,\n  \"title\": $('Daten zusammenfÃ¼hren').item.json.title,\n  \"notionUrl\": $('Notion Eintrag erstellen').item.json.url || 'Erstellt'\n} }}",
            "options": {}
          },
          "id": "bb891e48-698a-4b94-8eac-61cbc94e57fc",
          "name": "Webhook Response",
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1,
          "position": [
            1776,
            112
          ]
        }
      ],
      "connections": {
        "Webhook Trigger": {
          "main": [
            [
              {
                "node": "Webhook Daten extrahieren",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Webhook Daten extrahieren": {
          "main": [
            [
              {
                "node": "YouTube Video Details",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "YouTube Video Details": {
          "main": [
            [
              {
                "node": "Transkript extrahieren",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Transkript extrahieren": {
          "main": [
            [
              {
                "node": "Transkript validieren",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Transkript validieren": {
          "main": [
            [
              {
                "node": "Daten zusammenfÃ¼hren",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Daten zusammenfÃ¼hren": {
          "main": [
            [
              {
                "node": "DeepL Ãœbersetzen",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "DeepL Ãœbersetzen": {
          "main": [
            [
              {
                "node": "Notion Eintrag erstellen",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Notion Eintrag erstellen": {
          "main": [
            [
              {
                "node": "Threema Work Benachrichtigung",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Threema Work Benachrichtigung": {
          "main": [
            [
              {
                "node": "Webhook Response",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "d75fc063-4a08-4b66-8e53-d17f55ae58aa",
      "activeVersionId": null,
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-11-11T22:30:16.641Z",
          "createdAt": "2025-11-11T22:30:16.641Z",
          "role": "workflow:owner",
          "workflowId": "DKEKrzFx9oYFubkV",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": null,
      "tags": []
    },
    {
      "updatedAt": "2025-11-23T13:53:12.000Z",
      "createdAt": "2025-11-23T09:39:02.746Z",
      "id": "FW97dPOfs3cg6oqO",
      "name": "fonio-ags-anrufername alt",
      "active": false,
      "isArchived": true,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "anrufer-check",
            "responseMode": "streaming",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -640,
            16
          ],
          "id": "d60b24e2-8942-43cb-83d8-b34df837b7d7",
          "name": "Webhook",
          "webhookId": "b8ea38a3-1648-4893-9832-ffce7ef7d3ce",
          "alwaysOutputData": false,
          "executeOnce": false
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('Anrufername').first() }}",
                        "rightValue": 1,
                        "operator": {
                          "type": "object",
                          "operation": "notEmpty",
                          "singleValue": true
                        },
                        "id": "aa7cfa1c-48e4-4932-91f9-a2334b600d96"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Bekannt"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "afc9691c-cfdc-4dad-a1b4-278ad46c5076",
                        "leftValue": "={{ $('Anrufername') }}",
                        "rightValue": 0,
                        "operator": {
                          "type": "object",
                          "operation": "empty",
                          "singleValue": true
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Unbekannt"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.3,
          "position": [
            -192,
            16
          ],
          "id": "fbb3825c-a9cd-4698-9d18-d0c6839479e2",
          "name": "Switch"
        },
        {
          "parameters": {
            "authentication": "serviceAccount",
            "documentId": {
              "__rl": true,
              "value": "1kyIdVpLg4Ate6b0o2yyB4wzu3e7stQjcILLVrWX6RD8",
              "mode": "id"
            },
            "sheetName": {
              "__rl": true,
              "value": "Anrufer",
              "mode": "name"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "Telefonnumer",
                  "lookupValue": "={{ $json.body.fromNumber }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -416,
            16
          ],
          "id": "a9fec415-876a-43b3-90b2-fc4881fd0a17",
          "name": "Anrufername",
          "alwaysOutputData": true,
          "credentials": {
            "googleApi": {
              "id": "vRVq7GTwn9kTIi8N",
              "name": "Google Sheets account 2"
            }
          }
        },
        {
          "parameters": {
            "mode": "raw",
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            32,
            -80
          ],
          "id": "34a729fc-9802-429b-8df0-f3ab3d7d8724",
          "name": "Anrufer bekannt"
        },
        {
          "parameters": {
            "mode": "raw",
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            32,
            112
          ],
          "id": "7c1d4587-97b9-4a81-9619-ccc35d30d0dd",
          "name": "Anrufer unbekannt"
        }
      ],
      "connections": {
        "Webhook": {
          "main": [
            [
              {
                "node": "Anrufername",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Anrufername": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "Anrufer bekannt",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Anrufer unbekannt",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Anrufer bekannt": {
          "main": [
            []
          ]
        },
        "Anrufer unbekannt": {
          "main": [
            []
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "2c6b34a5-183b-4269-a9e3-4033dde41c44",
      "activeVersionId": null,
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-11-23T09:39:02.750Z",
          "createdAt": "2025-11-23T09:39:02.750Z",
          "role": "workflow:owner",
          "workflowId": "FW97dPOfs3cg6oqO",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": null,
      "tags": []
    },
    {
      "updatedAt": "2025-12-09T15:44:57.090Z",
      "createdAt": "2025-12-09T15:44:57.090Z",
      "id": "MNVWOs19VgaZTF6G",
      "name": "fonio AGS Nachbearbeitung Transkript Version 0.9 20251209 16:45",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "c439b942-fec5-44c5-af5f-4dbb41cf58b9",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -352,
            -256
          ],
          "id": "77a1257d-7d34-4671-b10d-b83268a2c853",
          "name": "Webhook",
          "webhookId": "c439b942-fec5-44c5-af5f-4dbb41cf58b9"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "011ef203-63fd-49f7-ae0d-4ed7318ad11f",
                  "name": "headers.host",
                  "value": "={{ $json.headers.host }}",
                  "type": "string"
                },
                {
                  "id": "04f27e3e-ebed-4ae5-a22f-23d0f7c61904",
                  "name": "body[0].body.formattedTranscript",
                  "value": "={{ $json.body[0].body.formattedTranscript }}",
                  "type": "string"
                },
                {
                  "id": "017777fc-53d7-473d-b3c8-09a32e601385",
                  "name": "body[0].body.fromNumber",
                  "value": "={{ $json.body[0].body.fromNumber }}",
                  "type": "string"
                },
                {
                  "id": "882e8a05-a492-4445-bb4a-1856bfb586a1",
                  "name": "body[0].body.context.anrufer_name",
                  "value": "={{ $json.body[0].body.context.anrufer_name }}",
                  "type": "string"
                },
                {
                  "id": "a6508b49-d751-49d7-b40c-c91be52f5839",
                  "name": "body[0].body.context.einrichtung_typ",
                  "value": "={{ $json.body[0].body.context.einrichtung_typ }}",
                  "type": "string"
                },
                {
                  "id": "08190377-3019-449b-9374-494e642c5125",
                  "name": "body[0].body.context.einrichtung_name",
                  "value": "={{ $json.body[0].body.context.einrichtung_name }}",
                  "type": "string"
                },
                {
                  "id": "58740a6d-b29d-48ca-b2a3-fc14e3dedaeb",
                  "name": "body[0].body.context.technisch",
                  "value": "={{ $json.body[0].body.context.technisch }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -128,
            -352
          ],
          "id": "9cf46d84-24bf-4147-979c-e1273e9e4839",
          "name": "Daten extrahieren"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=FÃ¼hre die Klassifikation durch.",
            "hasOutputParser": true,
            "options": {
              "systemMessage": "=DU BIST EIN HOCHSPEZIALISIERTER KLASSIFIKATIONS-AGENT FÃœR IT-HOTLINE-TRANSKRIPTE.\n\n###DEINE HAUPTAUFGABE###\nAnalysiere Telefon-Transkripte und ordne sie prÃ¤zise in eine Dringlichkeitskategorie (A, B, C oder D) ein, basierend auf den Kriterien aus der bereitgestellten Wissensdatenbank. Deine Klassifikation ermÃ¶glicht Technikern eine zielgerichtete, priorisierte Bearbeitung.\n\n---\n\n###VERFÃœGBARE DATEN###\n\n**DRINGLICHKEITSKRITERIEN (aus Google Sheet):**\n{{ $('Dringlichkeitskriterien laden').all().slice(1).map(item =>\n`Kategorie ${item.json.Dringlichkeit}: ${item.json.Kategorie}\nSchlÃ¼sselworte: ${item.json.Schlagworte}\nBeispiele: ${item.json.Beispiele}`\n).join('\\n\\n') }}\n\n**ZU ANALYSIERENDES TRANSKRIPT:**\n{{ $json.anonymizedText }}\n\n---\n\n###ANALYSE-METHODIK (CHAIN OF THOUGHTS)###\n\n1. **UNDERSTAND**\n   - Lies das Transkript grÃ¼ndlich und identifiziere das konkrete technische Problem\n   - Erkenne die Auswirkungen: ProduktivitÃ¤tsausfall, Datenverlust, Eskalation, GeschÃ¤ftskritikalitÃ¤t\n\n2. **IDENTIFY KEY SIGNALS**\n   - SchlÃ¼sselbegriffe fÃ¼r hohe Dringlichkeit: \"nicht arbeitsfÃ¤hig\", \"Produktion steht\", \"Kunde wartet\", \"dringend\", \"sofort\"\n   - SchlÃ¼sselbegriffe fÃ¼r niedrige Dringlichkeit: \"nicht eilig\", \"wenn Zeit ist\", \"Informationsfrage\", \"optional\"\n\n3. **ASSESS IMPACT**\n   - Ist ein geschÃ¤ftskritischer Prozess blockiert?\n   - Sind mehrere Nutzer betroffen?\n   - Gibt es Fristen oder SLA-relevante Zeitpunkte?\n   - Handelt es sich um einen Standardvorgang oder eine Informationsanfrage?\n\n4. **MATCH WITH CRITERIA**\n   - Vergleiche die erkannten Merkmale mit den Referenzbeispielen aus dem Google Sheet\n   - WÃ¤hle die Kategorie, die der Fallbeschreibung AM NÃ„CHSTEN kommt\n\n5. **HANDLE EDGE CASES**\n   - Bei unklaren oder widersprÃ¼chlichen Transkripten: WÃ¤hle die konservativere (hÃ¶here) Kategorie\n   - Weise explizit auf Unsicherheiten hin\n\n---\n\n###AUSGABEFORMAT###\n\n***WICHTIGER HINWEIS ZUR DATENSCHUTZ-KONFORMITÃ„T***\nDer Text enthÃ¤lt anonymisierte Platzhalter wie [PERSON_1], [PERSON_2].\nWenn du Namen extrahierst (z.B. fÃ¼r \"AnsprechpartnerName\" oder in der \"Beschreibung\"),\nNUTZE AUSSCHLIESSLICH DIESE PLATZHALTER.\nWandle sie NICHT um und erfinde keine Namen.\nBeispiel korrekt: \"AnsprechpartnerName\": \"[PERSON_2]\"\n\nGib deine Analyse im folgenden JSON-Format zurÃ¼ck:\n```json\n{\n  \"Dringlichkeit\": \"B\",\n  \"Kategorie\": \"Dringend\",\n  \"Problemtyp\": \"Technisch\",\n  \"Themenstichwort\": \"Server-Ausfall\",\n  \"Beschreibung\": [\n    \"Mehrere Mitarbeiter betroffen (Buchhaltung)\",\n    \"Datenbankverbindung unterbrochen seit 8 Uhr\",\n    \"Fehlende Rechnungen der letzten 2 Wochen\",\n    \"Zeitkritisch: Jahresabschluss-Termin in 2 Stunden\"\n  ],\n  \"AnsprechpartnerBleibt\": true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\n  \"AnsprechpartnerName\": \"Frau Weber\",\n  \"RueckrufnummerAnders\": true = andere RÃ¼ckrufnummer gewÃ¼nscht, false = unter anrufender Nummer zurÃ¼ckrufen\n  \"Rueckrufnummer\": Die vom Anrufer genannte RÃ¼ckrufnummer (mit Durchwahl falls vorhanden)\n  \"BegrÃ¼ndung\": \"Der Kunde ist grundsÃ¤tzlich arbeitsfÃ¤hig, jedoch blockiert ein IT-Fehler einen zeitkritischen GeschÃ¤ftsprozess. Entspricht den Beispielen fÃ¼r Kategorie B im Sheet.\"\n}\n```\n\n**WICHTIG: Feldbeschreibungen** \n- Die Dringlichkeit MUSS ein einzelner Buchstabe sein: A, B, C oder D, entsprechend der MÃ¶glichkeiten im Google Sheet\n- Die Kategorie MUSS sich auf die entsprechende Spalte im Google Sheet beziehen\n- Problemtyp: Klassifiziere in GENAU EINE dieser Kategorien:\n  â€¢ \"Technisch\" = Hardware-Probleme, NetzwerkausfÃ¤lle, GerÃ¤tedefekte, Server-AusfÃ¤lle\n  â€¢ \"Software\" = Programmfehler, Anmeldeprobleme, SoftwarestÃ¶rungen, Datenbankprobleme\n  â€¢ \"Anliegen\" = Informationsanfragen, Beratung, allgemeine Fragen ohne akutes technisches Problem\n- Themenstichwort: Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z. B. \"SAP-Login\", \"E-Mail-Sync\", \"Drucker-WLAN\")\n- Beschreibung: Array mit 3-6 Stichpunkten, die wichtigsten Informationen zuerst:\n  â€¢ Betroffene Personen/Systeme\n  â€¢ Zeitpunkt des Auftretens\n  â€¢ Konkrete Symptome/Fehler\n  â€¢ GeschÃ¤ftliche Auswirkungen\n  â€¢ Fristen/Zeitdruck\n  â€¢ Bereits versuchte LÃ¶sungen\n- AnsprechpartnerBleibt: true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\n- AnsprechpartnerName: Name des Ansprechpartners (falls abweichend vom Anrufer, sonst leer lassen)\n- AnsprechpartnerTelefon: Telefonnummer des Ansprechpartners (falls abweichend, sonst leer lassen)\n- RueckrufnummerAnders: true = andere RÃ¼ckrufnummer als anrufende Nummer, false = unter anrufender Nummer zurÃ¼ckrufen\n- Rueckrufnummer: Die RÃ¼ckrufnummer (kann identisch mit AnsprechpartnerTelefon sein)\n- Die BegrÃ¼ndung MUSS sich auf die Kriterien im Google Sheet beziehen\n- Halte dich strikt an das JSON-Format\n\n---\n\n###WAS NICHT ZU TUN IST###\n\nNIEMALS Kategorien ohne Bezug zum Google Sheet festlegen\nVERMEIDE vage BegrÃ¼ndungen wie \"klingt dringend\" oder \"scheint wichtig\"\nNICHT nur nach einzelnen SchlÃ¼sselworten klassifizieren â€“ analysiere die Gesamtsituation\nNIEMALS Aussagen erfinden, die nicht im Transkript stehen\nNICHT Ã¼berkategorisieren: Unzufriedenheit allein rechtfertigt keine Kategorie A\nIGNORIERE NIEMALS Hinweise auf Systemrelevanz, Produktionsstopp oder geschÃ¤ftskritische Prozesse\n\n---\n\n###FEW-SHOT BEISPIELE###\n\n**Beispiel 1 - Kategorie A:**\nTranskript: \"Ich kann mich nicht mehr in SAP anmelden, wir mÃ¼ssen heute unbedingt die Monatsabrechnung machen.\"\nAusgabe:\n```json\n{\n  \"Dringlichkeit\": \"A\",\n  \"Kategorie\": \"Notfall\",\n  \"Problemtyp\": \"Software\",\n  \"Themenstichwort\": \"Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')\",\n  \"BegrÃ¼ndung\": \"GeschÃ¤ftskritischer Prozess (Monatsabrechnung) ist komplett blockiert. Entspricht den ReferenzfÃ¤llen fÃ¼r Kategorie A im Sheet.\"\n}\n```\n\n**Beispiel 2 - Kategorie D:**\nTranskript: \"Ich wollte nur fragen, ob man den Drucker auch Ã¼ber WLAN verbinden kann â€“ ist aber nicht eilig.\"\nAusgabe:\n```json\n{\n  \"Dringlichkeit\": \"D\",\n  \"Kategorie\": \"Informativ\",\n  \"Problemtyp\": \"Technisch\",\n  \"Themenstichwort\": \"Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')\",\n  \"BegrÃ¼ndung\": \"Informationsanfrage ohne Zeitdruck, kein akuter Vorfall. Entspricht klar Kategorie D im Sheet.\"\n}\n```\n\n**Beispiel 3 - Kategorie B:**\nTranskript: \"Mein Outlook synchronisiert nicht mehr. Ich kann arbeiten, aber wichtige E-Mails von Kunden kommen nicht an.\"\nAusgabe:\n```json\n{\n  \"Dringlichkeit\": \"B\",\n  \"Kategorie\": \"Dringend\",\n  \"Problemtyp\": \"Technisch\",\n  \"Themenstichwort\": \"Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')\",\n  \"BegrÃ¼ndung\": \"EingeschrÃ¤nkte ArbeitsfÃ¤higkeit bei einem wichtigen Kommunikationskanal. Keine komplette Blockade, aber geschÃ¤ftsrelevant. Entspricht Kategorie B.\"\n}\n```"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 3,
          "position": [
            1168,
            -256
          ],
          "id": "d2d54986-6130-46cd-9a5b-51bd5c1bc20f",
          "name": "AI Agent",
          "executeOnce": true
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "claude-3-5-haiku-20241022",
              "mode": "list",
              "cachedResultName": "Claude Haiku 3.5"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
          "typeVersion": 1.3,
          "position": [
            1240,
            -32
          ],
          "id": "9eeded28-e2c0-44e0-b5a8-d55da2461c18",
          "name": "Anthropic Chat Model",
          "credentials": {
            "anthropicApi": {
              "id": "6RlfJdXsmselCNpN",
              "name": "Anthropic account 2"
            }
          }
        },
        {
          "parameters": {
            "authentication": "serviceAccount",
            "documentId": {
              "__rl": true,
              "value": "1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw",
              "mode": "id"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Dringlichkeiten",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw/edit#gid=0"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -128,
            -160
          ],
          "id": "c9cf5d34-b600-4077-9458-1ac6f92a000a",
          "name": "Dringlichkeitskriterien laden",
          "credentials": {
            "googleApi": {
              "id": "vRVq7GTwn9kTIi8N",
              "name": "Google Sheets account 2"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            96,
            -256
          ],
          "id": "7684c1a2-a32e-4758-a773-d3a8a4e8e8cd",
          "name": "Merge"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "9cac8552-e981-44e5-bfc7-854012461c3f",
                  "name": "subject",
                  "value": "={{ $json.Kategorie }} | {{ $('Daten extrahieren').first().json.body[0].body.context.einrichtung_name }}, {{ $('Daten extrahieren').first().json.body[0].body.context.anrufer_name }}| {{ $json.Themenstichwort }}",
                  "type": "string"
                },
                {
                  "id": "988dd2a7-83ea-48b9-9e7e-bcc66745c72c",
                  "name": "htmlBody",
                  "value": "=<h3>Problemtyp: {{ $json.Problemtyp }}</h3>\n\n<h4>KI-EinschÃ¤tzung</h4>\n<p>\n  <b>Einrichtung:</b> {{ $('Daten extrahieren').first().json.body[0].body.context.einrichtung_typ }}<br>\n  <b>Anrufer:</b> {{ $('Daten extrahieren').first().json.body[0].body.context.anrufer_name }} ({{ $('Daten extrahieren').first().json.body[0].body.fromNumber }})<br>\n  <b>Ansprechpartner:</b> {{ $json.AnsprechpartnerName ? $json.AnsprechpartnerName : \"Wie Anrufer\" }}<br>\n  <b>RÃ¼ckrufnummer:</b> {{ $json.Rueckrufnummer ? $json.Rueckrufnummer : $('Daten extrahieren').first().json.body[0].body.fromNumber }}<br>\n  <b>Thema:</b> {{ $json.Themenstichwort }}\n</p>\n\n<b>Beschreibung:</b>\n<ul>\n{{ $json.Beschreibung.map(item => `<li>${item}</li>`).join('') }}\n</ul>\n\n<b>BegrÃ¼ndung der Dringlichkeitseinstufung:</b>\n<p>{{ $json.BegrÃ¼ndung }}</p>\n\n<hr>\n\n<h4>VollstÃ¤ndiges Transkript</h4>\n<p style=\"white-space: pre-wrap; color: #555;\">\n{{ $('Azure Request Vorbereitung').first().json.messages[1].content }}\n</p>",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1744,
            -256
          ],
          "id": "7a4b14e3-b2c1-4b91-86da-a1a85cd49aaf",
          "name": "E-Mail vorbereiten"
        },
        {
          "parameters": {
            "fromEmail": "office@berent.ai",
            "toEmail": "office@berent.ai",
            "subject": "={{ $json.subject }}",
            "html": "={{ $json.htmlBody }}",
            "options": {},
            "path": "59178415-63e1-4be6-869e-cd65d84337d1"
          },
          "type": "n8n-nodes-base.emailSend",
          "typeVersion": 2.1,
          "position": [
            1968,
            -256
          ],
          "id": "d384cea2-2209-42dc-9ced-92966ea5378f",
          "name": "Send email",
          "webhookId": "59178415-63e1-4be6-869e-cd65d84337d1",
          "credentials": {
            "smtp": {
              "id": "8O5B5z4vS8yeagJh",
              "name": "SMTP account"
            }
          }
        },
        {
          "parameters": {
            "operation": "sanitize",
            "text": "={{ $('Merge').item.json.body[0].body.formattedTranscript }}",
            "guardrails": {
              "pii": {
                "value": {
                  "type": "selected",
                  "entities": [
                    "EMAIL_ADDRESS",
                    "PHONE_NUMBER",
                    "IP_ADDRESS",
                    "LOCATION"
                  ]
                }
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.guardrails",
          "typeVersion": 1,
          "position": [
            320,
            -256
          ],
          "id": "e360d1f5-fb81-4f05-969c-e135d0e21cf1",
          "name": "Daten anonymisieren"
        },
        {
          "parameters": {
            "jsCode": "// 1. Zugriff auf die Antwort des AI Agents\nlet agentOutput = $input.item.json.output || $input.item.json.text || \"\";\n\n// Wir machen sicherheitshalber einen String daraus\nif (typeof agentOutput === 'object') {\n  agentOutput = JSON.stringify(agentOutput);\n}\n\n// 2. Das Mapping holen (exakter Name der Node davor ist wichtig!)\nconst mappingData = $('Azure Response Verarbeitung').first();\nconst nameMapping = mappingData.json.nameMapping || [];\n\n// 3. Re-Personalisierung durchfÃ¼hren (Suchen & Ersetzen im Rohtext)\n// Wir machen das VOR dem JSON-Parsing, damit auch Namen in Strings ersetzt werden.\nlet processedText = agentOutput;\n\nfor (const item of nameMapping) {\n  // Ersetze [PERSON_X] durch den echten Namen (global)\n  // Wir escapen die Klammern fÃ¼r den Regex\n  const placeholderRegex = new RegExp(item.placeholder.replace(/\\[/g, '\\\\[').replace(/\\]/g, '\\\\]'), 'g');\n  processedText = processedText.replace(placeholderRegex, item.original);\n}\n\n// 4. JSON Extrahieren (Der \"GesprÃ¤chigkeit\"-Filter)\n// Wir suchen den Bereich zwischen der ersten '{' und der letzten '}'\nconst firstBracket = processedText.indexOf('{');\nconst lastBracket = processedText.lastIndexOf('}');\n\nif (firstBracket !== -1 && lastBracket !== -1) {\n  // Schneide alles vor der ersten Klammer und nach der letzten Klammer weg\n  const jsonString = processedText.substring(firstBracket, lastBracket + 1);\n  \n  try {\n    const finalObject = JSON.parse(jsonString);\n    return finalObject; // Gib das saubere Objekt zurÃ¼ck\n  } catch (e) {\n    return { error: \"JSON war trotz Filterung ungÃ¼ltig\", raw: processedText };\n  }\n} else {\n  // Fallback, falls gar keine Klammern gefunden wurden\n  return { error: \"Kein JSON im Antworttext gefunden\", raw: processedText };\n}"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1520,
            -256
          ],
          "id": "91617cfe-2de6-43ad-9b1f-ae0b50d222e9",
          "name": "Re-Personalisierung"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://berent-ki.services.ai.azure.com/models/chat/completions?api-version=2024-05-01-preview",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "contentType": "=json",
            "specifyBody": "json",
            "bodyParameters": {
              "parameters": [
                {}
              ]
            },
            "jsonBody": "={{ $json }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            768,
            -256
          ],
          "id": "54f2b104-2744-4323-8044-b6caae62bf59",
          "name": "Namen-Anonymisierung (Azure)",
          "credentials": {
            "httpHeaderAuth": {
              "id": "4gc7MePUZVuCyowB",
              "name": "Header Auth account"
            },
            "httpBearerAuth": {
              "id": "24SORzPv91ZRH2UW",
              "name": "Bearer Auth account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "// Wir greifen auf die Antwort der Azure-Node zu\nconst response = $input.item.json;\n\n// Sicherstellen, dass wir eine Antwort haben\nif (response.choices && response.choices[0] && response.choices[0].message) {\n  \n  // Den Textinhalt holen\n  let content = response.choices[0].message.content;\n  \n  // Oft sendet die KI den Text in Markdown-BlÃ¶cken (```json ... ```).\n  // Diese entfernen wir hier, damit das JSON sauber ist.\n  content = content.replace(/^```json\\s*/, \"\").replace(/\\s*```$/, \"\");\n  \n  try {\n    // Den Textstring in ein echtes JSON-Objekt umwandeln\n    const parsedData = JSON.parse(content);\n    \n    // Das saubere Ergebnis zurÃ¼ckgeben\n    return parsedData;\n    \n  } catch (error) {\n    // Falls die KI kein gÃ¼ltiges JSON geschickt hat, geben wir den Rohtext zurÃ¼ck\n    return {\n      error: \"Konnte JSON nicht parsen\",\n      rawContent: content\n    };\n  }\n} else {\n  return { error: \"Keine gÃ¼ltige Antwort von Azure erhalten\" };\n}"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            992,
            -256
          ],
          "id": "77db8668-5102-4565-85d4-bdece72d8b59",
          "name": "Azure Response Verarbeitung"
        },
        {
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "// Daten aus der vorherigen Node holen\n// Fallback auf leeren String, falls keine Daten da sind\nconst transcript = $input.item.json.guardrailsInput || $input.item.json.output || \"\";\n\nconst systemPrompt = `Du bist ein Spezialist fÃ¼r die Anonymisierung von Personennamen in deutschen Telefon-Transkripten.\n\n###DEINE AUFGABE###\nErkenne alle Personennamen (Vornamen und Nachnamen) im gegebenen Text und ersetze sie durch nummerierte Platzhalter im Format [PERSON_1], [PERSON_2], [PERSON_3] etc.\n\n###REGELN###\n1. Erkenne nur echte Personennamen (z.B. Thomas, Anna, MÃ¼ller, Schmidt)\n2. Ignoriere Titel wie 'Herr', 'Frau', 'Dr.' - diese bleiben unverÃ¤ndert\n3. Ersetze jeden gefundenen Namen durch einen eindeutigen Platzhalter [PERSON_N]\n4. Gleiche Namen im Text erhalten den gleichen Platzhalter (z.B. 'Thomas' wird immer zu [PERSON_1])\n5. Verschiedene Namen erhalten verschiedene Platzhalter (z.B. 'Thomas' â†’ [PERSON_1], 'Anna' â†’ [PERSON_2])\n6. Behalte die ursprÃ¼ngliche Formatierung bei (ZeilenumbrÃ¼che, Interpunktion)\n\n###AUSGABEFORMAT###\nGib dein Ergebnis im folgenden JSON-Format zurÃ¼ck:\n\\`\\`\\`json\n{\n  \"anonymizedText\": \"Der anonymisierte Text mit [PERSON_1], [PERSON_2] etc.\",\n  \"nameMapping\": [\n    {\"original\": \"Thomas\", \"placeholder\": \"[PERSON_1]\"},\n    {\"original\": \"Anna\", \"placeholder\": \"[PERSON_2]\"}\n  ]\n}\n\\`\\`\\``;\n\n// Das fertige Payload-Objekt zurÃ¼ckgeben\nreturn {\n  model: \"mistral-namen-anonymisierung\",\n  messages: [\n    {\n      role: \"system\",\n      content: systemPrompt\n    },\n    {\n      role: \"user\",\n      content: transcript\n    }\n  ],\n  temperature: 0.1,\n  max_tokens: 4000\n};"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            544,
            -256
          ],
          "id": "8b9e7bfc-31a2-468b-8b99-56e08a5e0481",
          "name": "Azure Request Vorbereitung"
        }
      ],
      "connections": {
        "Webhook": {
          "main": [
            [
              {
                "node": "Daten extrahieren",
                "type": "main",
                "index": 0
              },
              {
                "node": "Dringlichkeitskriterien laden",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Daten extrahieren": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Anthropic Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Dringlichkeitskriterien laden": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Daten anonymisieren",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent": {
          "main": [
            [
              {
                "node": "Re-Personalisierung",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "E-Mail vorbereiten": {
          "main": [
            [
              {
                "node": "Send email",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Daten anonymisieren": {
          "main": [
            [
              {
                "node": "Azure Request Vorbereitung",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Re-Personalisierung": {
          "main": [
            [
              {
                "node": "E-Mail vorbereiten",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Namen-Anonymisierung (Azure)": {
          "main": [
            [
              {
                "node": "Azure Response Verarbeitung",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Azure Response Verarbeitung": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Azure Request Vorbereitung": {
          "main": [
            [
              {
                "node": "Namen-Anonymisierung (Azure)",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "d96a96f2-8499-4005-911d-f70b3bf9c199",
      "activeVersionId": null,
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-12-09T15:44:57.094Z",
          "createdAt": "2025-12-09T15:44:57.094Z",
          "role": "workflow:owner",
          "workflowId": "MNVWOs19VgaZTF6G",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": null,
      "tags": []
    },
    {
      "updatedAt": "2025-11-23T14:11:41.000Z",
      "createdAt": "2025-11-23T13:33:43.638Z",
      "id": "QxKsC28H7gqaUd3j",
      "name": "fonio AGS Anrufername",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "anrufer-check",
            "responseMode": "responseNode",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            0,
            0
          ],
          "id": "e9b1d0ae-3c4f-49bc-bd04-cd6d257fa877",
          "name": "Webhook",
          "webhookId": "517dd008-c998-4975-847b-4cfae5858518"
        },
        {
          "parameters": {
            "authentication": "serviceAccount",
            "documentId": {
              "__rl": true,
              "value": "1kyIdVpLg4Ate6b0o2yyB4wzu3e7stQjcILLVrWX6RD8",
              "mode": "id"
            },
            "sheetName": {
              "__rl": true,
              "value": "Anrufer",
              "mode": "name"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "Telefonnumer",
                  "lookupValue": "={{ $json.body.fromNumber }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            224,
            0
          ],
          "id": "b5e4227b-c77f-42c5-9433-08901445734f",
          "name": "Anrufername",
          "alwaysOutputData": true,
          "credentials": {
            "googleApi": {
              "id": "vRVq7GTwn9kTIi8N",
              "name": "Google Sheets account 2"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "05b8eded-5465-4955-9b1b-a4094a57619c",
                  "name": "Name",
                  "value": "={{ $json.Name }}",
                  "type": "string"
                },
                {
                  "id": "71253abe-5210-4e95-87a4-7defcec8f7d7",
                  "name": "Anredeform",
                  "value": "={{ $json.Anredeform }}",
                  "type": "string"
                },
                {
                  "id": "b874dcc8-9c21-4517-87b9-8acfac896973",
                  "name": "Anrede",
                  "value": "={{ $json.Anrede }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            672,
            -96
          ],
          "id": "09f101f9-0fb6-4eb3-8fa0-bcfeb48ed1f8",
          "name": "Anrufer bekannt"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "0b518e17-3f4e-4385-b10b-f608a27799ff",
                  "name": "Name",
                  "value": "Anrufer unbekannt",
                  "type": "string"
                },
                {
                  "id": "d460ff3a-d25f-4cd7-a317-aa183b90ec4a",
                  "name": "Anredeform",
                  "value": "Sie",
                  "type": "string"
                },
                {
                  "id": "c121a38a-6524-4cad-a483-aa2beaf21ccf",
                  "name": "Anrede",
                  "value": "",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            672,
            96
          ],
          "id": "f22df247-85a9-4e20-b2b9-e5c71e70b55c",
          "name": "Anrufer unbekannt"
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={\n     \"name\": \"{{ $json.Name }}\",\n     \"anredeform\": \"{{ $json.Anredeform }}\",\n     \"anrede\": \"{{ $json.Anrede }}\"\n   }",
            "options": {}
          },
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.4,
          "position": [
            896,
            0
          ],
          "id": "500ac86f-a1af-4604-b411-d433b179484e",
          "name": "Respond to Webhook"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "7921be39-4d82-4d4c-905c-9956b9e30216",
                  "leftValue": "={{ $json.Name }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            416,
            0
          ],
          "id": "64962ca7-67c6-4cd5-8ba4-25172fced119",
          "name": "If"
        }
      ],
      "connections": {
        "Webhook": {
          "main": [
            [
              {
                "node": "Anrufername",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Anrufername": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Anrufer unbekannt": {
          "main": [
            [
              {
                "node": "Respond to Webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Anrufer bekannt": {
          "main": [
            [
              {
                "node": "Respond to Webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Anrufer bekannt",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Anrufer unbekannt",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": null,
      "pinData": {},
      "versionId": "404b4f81-27b9-4597-8698-6bea8ff768fa",
      "activeVersionId": null,
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-11-23T13:33:43.644Z",
          "createdAt": "2025-11-23T13:33:43.644Z",
          "role": "workflow:owner",
          "workflowId": "QxKsC28H7gqaUd3j",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": null,
      "tags": []
    },
    {
      "updatedAt": "2025-11-23T13:53:48.000Z",
      "createdAt": "2025-11-14T16:13:23.250Z",
      "id": "Y56BJExGtL558gem",
      "name": "fonio AGS E-Mail-Generator",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "fieldToSplitOut": "prompts",
            "include": "allOtherFields",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            -416,
            -320
          ],
          "id": "61e4981e-c9e6-4ee0-ab1d-599894ab8da3",
          "name": "Split Out"
        },
        {
          "parameters": {
            "mode": "raw",
            "jsonOutput": "{\n  \"prompts\": [\n    { \"prompt\": \"Kannst du mir bitte den neuen Workflow erklÃ¤ren?\" },\n    { \"prompt\": \"Ich brauche Hilfe beim Einrichten meines n8n-Projekts.\" },\n    { \"prompt\": \"Hier steht mein Passwort: 1234abcd\" }\n  ]\n}\n",
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -640,
            -320
          ],
          "id": "96216bfa-9c03-450b-85fc-c3401d6bd39e",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "jsCode": "const output = [];\n\nfor (const item of $input.all()) {\n  const body = item.json?.body;\n\n  if (!body) {\n    // Kein body vorhanden â€“ Fehlerhinweis ergÃ¤nzen\n    output.push({\n      json: {\n        error: \"Webhook-Body fehlt oder ist undefiniert\",\n        original: item.json\n      }\n    });\n    continue;\n  }\n\n  const name = body?.anrufer_name ?? \"unbekannt\";\n  const telefon = body?.anrufer_telefonnummer ?? \"keine Nummer\";\n  const typ = body?.einrichtung_typ ?? \"unbekannt\";\n  const einrichtung = body?.einrichtung_name ?? \"unbekannt\";\n  const technisch = body?.technisch ?? false;\n\n  output.push({\n    json: {\n      anrufer_name: name,\n      anrufer_telefonnummer: telefon,\n      einrichtung_typ: typ,\n      einrichtung_name: einrichtung,\n      technisch: technisch,\n      kurzinfo: `${name} (${telefon}) â€“ ${typ}: ${einrichtung}`\n    }\n  });\n}\n\nreturn output;\n"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -96,
            -128
          ],
          "id": "c456c732-1a7e-48a9-a0c7-54490e4f694b",
          "name": "Code in JavaScript"
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "7d6ad4df-13af-439e-97c0-5fdef19f265b",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -640,
            16
          ],
          "id": "851bd2c0-5717-49d8-9827-801d12cdc1bb",
          "name": "Webhook",
          "webhookId": "7d6ad4df-13af-439e-97c0-5fdef19f265b"
        },
        {
          "parameters": {
            "text": "={{ $json.headers.host }}",
            "guardrails": {
              "keywords": "",
              "urls": {
                "value": {
                  "allowedUrls": "=n8n.srv1098810.hstgr.cloud",
                  "allowedSchemes": [
                    "https",
                    "http"
                  ]
                }
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.guardrails",
          "typeVersion": 1,
          "position": [
            -416,
            16
          ],
          "id": "43c45bc2-6f0b-4ecd-a8ae-0357231e8060",
          "name": "Guardrails"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "claude-sonnet-4-5-20250929",
              "cachedResultName": "Claude Sonnet 4.5"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
          "typeVersion": 1.3,
          "position": [
            -352,
            240
          ],
          "id": "7db289a9-d347-403a-bf7d-a870b477ccce",
          "name": "Anthropic Chat Model",
          "credentials": {
            "anthropicApi": {
              "id": "6RlfJdXsmselCNpN",
              "name": "Anthropic account 2"
            }
          }
        },
        {
          "parameters": {
            "code": {
              "execute": {
                "code": "// Im LangChain Code Node\nimport { DynamicTool } from \"langchain/tools\";\n\n// Custom Tool erstellen\nconst searchTool = new DynamicTool({\n  name: \"web_search\",\n  description: \"Sucht im Internet nach Informationen\",\n  func: async (input) => {\n    // Hier wÃ¼rdest du HTTP Request machen\n    // oder auf andere n8n Nodes zugreifen\n    return `Suchergebnis fÃ¼r: ${input}`;\n  },\n});\n\n// Tool an Agent anhÃ¤ngen\nconst tools = [searchTool];"
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.code",
          "typeVersion": 1,
          "position": [
            -640,
            336
          ],
          "id": "7529b4b9-a2c9-4732-8dc8-8c7b4e924aa9",
          "name": "LangChain Code"
        }
      ],
      "connections": {
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Split Out",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Webhook": {
          "main": [
            [
              {
                "node": "Guardrails",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Anthropic Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Guardrails",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Guardrails": {
          "main": [
            [
              {
                "node": "Code in JavaScript",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "ca8ca0f8-ee9e-4efc-ac99-6ce9ae803b83",
      "activeVersionId": null,
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-11-14T16:13:23.254Z",
          "createdAt": "2025-11-14T16:13:23.254Z",
          "role": "workflow:owner",
          "workflowId": "Y56BJExGtL558gem",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": null,
      "tags": []
    },
    {
      "updatedAt": "2025-11-11T19:57:38.000Z",
      "createdAt": "2025-11-11T19:56:45.940Z",
      "id": "ZzyUNBLHABev3X7Q",
      "name": "Telegram Trigger Template",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "updates": [
              "message"
            ],
            "additionalFields": {
              "chatIds": "7100977906"
            }
          },
          "type": "n8n-nodes-base.telegramTrigger",
          "typeVersion": 1.2,
          "position": [
            -672,
            96
          ],
          "id": "0bf4238e-50d0-4bb1-9c27-0610e45e9fdf",
          "name": "Telegram Trigger",
          "webhookId": "ff92015f-344f-434d-8f46-453f25ecf711"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.message.text }}",
                        "rightValue": "",
                        "operator": {
                          "type": "string",
                          "operation": "notEmpty",
                          "singleValue": true
                        },
                        "id": "c04edae6-42ed-4df6-8089-4e291dc97a26"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Text"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "33bbf746-caab-435f-a472-2ea238f091f6",
                        "leftValue": "={{ $json.message.voice }}",
                        "rightValue": "",
                        "operator": {
                          "type": "object",
                          "operation": "exists",
                          "singleValue": true
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Voice"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.3,
          "position": [
            -448,
            96
          ],
          "id": "84cf7973-1a48-4c3b-82f3-34dd3b0564e0",
          "name": "Switch"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "1aea2a41-9f7d-4444-b87b-4004caa3a084",
                  "name": "text",
                  "value": "={{ $json.message.text }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -224,
            0
          ],
          "id": "49e9f956-449d-4e9d-a7a7-fda540d0fd5e",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "resource": "file",
            "fileId": "={{ $json.message.voice.file_id }}",
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -224,
            192
          ],
          "id": "6b86877e-8065-4f82-9a24-a7b5bc5cbde2",
          "name": "Get a file",
          "webhookId": "1b11f79c-3f53-441d-bfd3-6700a62569bc"
        },
        {
          "parameters": {
            "resource": "audio",
            "operation": "transcribe",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.openAi",
          "typeVersion": 1.8,
          "position": [
            0,
            192
          ],
          "id": "82333d82-5a83-4a7e-8c57-59959725ffaf",
          "name": "Transcribe a recording"
        },
        {
          "parameters": {
            "operation": "sendAudio",
            "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "binaryData": true,
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            240,
            80
          ],
          "id": "f51738c3-ee2e-41ce-9e2f-1e342fca00f2",
          "name": "Send an audio file",
          "webhookId": "b0cb3f9e-7a18-4350-89bd-1667be0afd7a"
        }
      ],
      "connections": {
        "Telegram Trigger": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Get a file",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get a file": {
          "main": [
            [
              {
                "node": "Transcribe a recording",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": null,
      "pinData": {},
      "versionId": "78f6b4df-e0a5-4a39-bf73-cde9cab367e2",
      "activeVersionId": null,
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-11-11T19:56:45.942Z",
          "createdAt": "2025-11-11T19:56:45.942Z",
          "role": "workflow:owner",
          "workflowId": "ZzyUNBLHABev3X7Q",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": null,
      "tags": []
    },
    {
      "updatedAt": "2025-11-11T19:11:17.811Z",
      "createdAt": "2025-11-11T19:11:17.811Z",
      "id": "b9iyuWBFH35Nzzp0",
      "name": "LinkedIn Profile and Post Scraper",
      "active": false,
      "isArchived": false,
      "nodes": [],
      "connections": {},
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": null,
      "pinData": {},
      "versionId": "0317aa28-d2a1-4060-9108-384689e9d401",
      "activeVersionId": null,
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-11-11T19:11:17.814Z",
          "createdAt": "2025-11-11T19:11:17.814Z",
          "role": "workflow:owner",
          "workflowId": "b9iyuWBFH35Nzzp0",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": null,
      "tags": []
    },
    {
      "updatedAt": "2025-12-08T15:12:07.204Z",
      "createdAt": "2025-12-08T15:12:07.204Z",
      "id": "dPDoawNHAa6ocJdr",
      "name": "fonio AGS Nachbearbeitung Transkript Sicherung 251208",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "367bc90b-4189-48db-8440-fd1c7312e700",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -352,
            -112
          ],
          "id": "935a0e09-1723-4f1d-95de-023da9e2962c",
          "name": "Webhook",
          "webhookId": "367bc90b-4189-48db-8440-fd1c7312e700"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "04f27e3e-ebed-4ae5-a22f-23d0f7c61904",
                  "name": "body[0].body.formattedTranscript",
                  "value": "={{ $json.body[0].body.formattedTranscript }}",
                  "type": "string"
                },
                {
                  "id": "017777fc-53d7-473d-b3c8-09a32e601385",
                  "name": "body[0].body.fromNumber",
                  "value": "={{ $json.body[0].body.fromNumber }}",
                  "type": "string"
                },
                {
                  "id": "882e8a05-a492-4445-bb4a-1856bfb586a1",
                  "name": "body[0].body.context.anrufer_name",
                  "value": "={{ $json.body[0].body.context.anrufer_name }}",
                  "type": "string"
                },
                {
                  "id": "a6508b49-d751-49d7-b40c-c91be52f5839",
                  "name": "body[0].body.context.einrichtung_typ",
                  "value": "={{ $json.body[0].body.context.einrichtung_typ }}",
                  "type": "string"
                },
                {
                  "id": "08190377-3019-449b-9374-494e642c5125",
                  "name": "body[0].body.context.einrichtung_name",
                  "value": "={{ $json.body[0].body.context.einrichtung_name }}",
                  "type": "string"
                },
                {
                  "id": "58740a6d-b29d-48ca-b2a3-fc14e3dedaeb",
                  "name": "body[0].body.context.technisch",
                  "value": "={{ $json.body[0].body.context.technisch }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -128,
            -208
          ],
          "id": "70563cf4-f4af-4ee4-b523-76c9fea3ac75",
          "name": "Daten extrahieren"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=FÃ¼hre die Klassifikation durch.",
            "hasOutputParser": true,
            "options": {
              "systemMessage": "=DU BIST EIN HOCHSPEZIALISIERTER KLASSIFIKATIONS-AGENT FÃœR IT-HOTLINE-TRANSKRIPTE.\n\n###DEINE HAUPTAUFGABE###\nAnalysiere Telefon-Transkripte und ordne sie prÃ¤zise in eine Dringlichkeitskategorie (A, B, C oder D) ein, basierend auf den Kriterien aus der bereitgestellten Wissensdatenbank. Deine Klassifikation ermÃ¶glicht Technikern eine zielgerichtete, priorisierte Bearbeitung.\n\n---\n\n###VERFÃœGBARE DATEN###\n\n**DRINGLICHKEITSKRITERIEN (aus Google Sheet):**\n{{ $input.all().slice(1).map(item => \n`Kategorie ${item.json.Dringlichkeit}: ${item.json.Kategorie}\nSchlÃ¼sselworte: ${item.json.Schlagworte}\nBeispiele: ${item.json.Beispiele}`\n).join('\\n\\n') }}\n\n**ZU ANALYSIERENDES TRANSKRIPT:**\n{{ $json.body[0].body.formattedTranscript }}\n\n**ANRUFERDATEN:**\n- Name: {{ $json.body[0].body.context.anrufer_name }}\n- Von: {{ $json.body[0].body.fromNumber }}\n- Einrichtung: {{ $json.body[0].body.context.einrichtung_name }}\n\n---\n\n###ANALYSE-METHODIK (CHAIN OF THOUGHTS)###\n\n1. **UNDERSTAND**\n   - Lies das Transkript grÃ¼ndlich und identifiziere das konkrete technische Problem\n   - Erkenne die Auswirkungen: ProduktivitÃ¤tsausfall, Datenverlust, Eskalation, GeschÃ¤ftskritikalitÃ¤t\n\n2. **IDENTIFY KEY SIGNALS**\n   - SchlÃ¼sselbegriffe fÃ¼r hohe Dringlichkeit: \"nicht arbeitsfÃ¤hig\", \"Produktion steht\", \"Kunde wartet\", \"dringend\", \"sofort\"\n   - SchlÃ¼sselbegriffe fÃ¼r niedrige Dringlichkeit: \"nicht eilig\", \"wenn Zeit ist\", \"Informationsfrage\", \"optional\"\n\n3. **ASSESS IMPACT**\n   - Ist ein geschÃ¤ftskritischer Prozess blockiert?\n   - Sind mehrere Nutzer betroffen?\n   - Gibt es Fristen oder SLA-relevante Zeitpunkte?\n   - Handelt es sich um einen Standardvorgang oder eine Informationsanfrage?\n\n4. **MATCH WITH CRITERIA**\n   - Vergleiche die erkannten Merkmale mit den Referenzbeispielen aus dem Google Sheet\n   - WÃ¤hle die Kategorie, die der Fallbeschreibung AM NÃ„CHSTEN kommt\n\n5. **HANDLE EDGE CASES**\n   - Bei unklaren oder widersprÃ¼chlichen Transkripten: WÃ¤hle die konservativere (hÃ¶here) Kategorie\n   - Weise explizit auf Unsicherheiten hin\n\n---\n\n###AUSGABEFORMAT###\n\nGib deine Analyse im folgenden JSON-Format zurÃ¼ck:\n```json\n{\n  \"Dringlichkeit\": \"B\",\n  \"Kategorie\": \"Dringend\",\n  \"Problemtyp\": \"Technisch\",\n  \"Themenstichwort\": \"Server-Ausfall\",\n  \"Beschreibung\": [\n    \"Mehrere Mitarbeiter betroffen (Buchhaltung)\",\n    \"Datenbankverbindung unterbrochen seit 8 Uhr\",\n    \"Fehlende Rechnungen der letzten 2 Wochen\",\n    \"Zeitkritisch: Jahresabschluss-Termin in 2 Stunden\"\n  ],\n  \"AnsprechpartnerBleibt\": true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\n  \"AnsprechpartnerName\": \"Frau Weber\",\n  \"RueckrufnummerAnders\": true = andere RÃ¼ckrufnummer gewÃ¼nscht, false = unter anrufender Nummer zurÃ¼ckrufen\n  \"Rueckrufnummer\": Die vom Anrufer genannte RÃ¼ckrufnummer (mit Durchwahl falls vorhanden)\n  \"BegrÃ¼ndung\": \"Der Kunde ist grundsÃ¤tzlich arbeitsfÃ¤hig, jedoch blockiert ein IT-Fehler einen zeitkritischen GeschÃ¤ftsprozess. Entspricht den Beispielen fÃ¼r Kategorie B im Sheet.\"\n}\n```\n\n**WICHTIG: Feldbeschreibungen** \n- Die Dringlichkeit MUSS ein einzelner Buchstabe sein: A, B, C oder D, entsprechend der MÃ¶glichkeiten im Google Sheet\n- Die Kategorie MUSS sich auf die entsprechende Spalte im Google Sheet beziehen\n- Problemtyp: Klassifiziere in GENAU EINE dieser Kategorien:\n  â€¢ \"Technisch\" = Hardware-Probleme, NetzwerkausfÃ¤lle, GerÃ¤tedefekte, Server-AusfÃ¤lle\n  â€¢ \"Software\" = Programmfehler, Anmeldeprobleme, SoftwarestÃ¶rungen, Datenbankprobleme\n  â€¢ \"Anliegen\" = Informationsanfragen, Beratung, allgemeine Fragen ohne akutes technisches Problem\n- Themenstichwort: Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z. B. \"SAP-Login\", \"E-Mail-Sync\", \"Drucker-WLAN\")\n- Beschreibung: Array mit 3-6 Stichpunkten, die wichtigsten Informationen zuerst:\n  â€¢ Betroffene Personen/Systeme\n  â€¢ Zeitpunkt des Auftretens\n  â€¢ Konkrete Symptome/Fehler\n  â€¢ GeschÃ¤ftliche Auswirkungen\n  â€¢ Fristen/Zeitdruck\n  â€¢ Bereits versuchte LÃ¶sungen\n- AnsprechpartnerBleibt: true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\n- AnsprechpartnerName: Name des Ansprechpartners (falls abweichend vom Anrufer, sonst leer lassen)\n- AnsprechpartnerTelefon: Telefonnummer des Ansprechpartners (falls abweichend, sonst leer lassen)\n- RueckrufnummerAnders: true = andere RÃ¼ckrufnummer als anrufende Nummer, false = unter anrufender Nummer zurÃ¼ckrufen\n- Rueckrufnummer: Die RÃ¼ckrufnummer (kann identisch mit AnsprechpartnerTelefon sein)\n- Die BegrÃ¼ndung MUSS sich auf die Kriterien im Google Sheet beziehen\n- Halte dich strikt an das JSON-Format\n\n---\n\n###WAS NICHT ZU TUN IST###\n\nNIEMALS Kategorien ohne Bezug zum Google Sheet festlegen\nVERMEIDE vage BegrÃ¼ndungen wie \"klingt dringend\" oder \"scheint wichtig\"\nNICHT nur nach einzelnen SchlÃ¼sselworten klassifizieren â€“ analysiere die Gesamtsituation\nNIEMALS Aussagen erfinden, die nicht im Transkript stehen\nNICHT Ã¼berkategorisieren: Unzufriedenheit allein rechtfertigt keine Kategorie A\nIGNORIERE NIEMALS Hinweise auf Systemrelevanz, Produktionsstopp oder geschÃ¤ftskritische Prozesse\n\n---\n\n###FEW-SHOT BEISPIELE###\n\n**Beispiel 1 - Kategorie A:**\nTranskript: \"Ich kann mich nicht mehr in SAP anmelden, wir mÃ¼ssen heute unbedingt die Monatsabrechnung machen.\"\nAusgabe:\n```json\n{\n  \"Dringlichkeit\": \"A\",\n  \"Kategorie\": \"Notfall\",\n  \"Problemtyp\": \"Software\",\n  \"Themenstichwort\": \"Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')\",\n  \"BegrÃ¼ndung\": \"GeschÃ¤ftskritischer Prozess (Monatsabrechnung) ist komplett blockiert. Entspricht den ReferenzfÃ¤llen fÃ¼r Kategorie A im Sheet.\"\n}\n```\n\n**Beispiel 2 - Kategorie D:**\nTranskript: \"Ich wollte nur fragen, ob man den Drucker auch Ã¼ber WLAN verbinden kann â€“ ist aber nicht eilig.\"\nAusgabe:\n```json\n{\n  \"Dringlichkeit\": \"D\",\n  \"Kategorie\": \"Informativ\",\n  \"Problemtyp\": \"Technisch\",\n  \"Themenstichwort\": \"Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')\",\n  \"BegrÃ¼ndung\": \"Informationsanfrage ohne Zeitdruck, kein akuter Vorfall. Entspricht klar Kategorie D im Sheet.\"\n}\n```\n\n**Beispiel 3 - Kategorie B:**\nTranskript: \"Mein Outlook synchronisiert nicht mehr. Ich kann arbeiten, aber wichtige E-Mails von Kunden kommen nicht an.\"\nAusgabe:\n```json\n{\n  \"Dringlichkeit\": \"B\",\n  \"Kategorie\": \"Dringend\",\n  \"Problemtyp\": \"Technisch\",\n  \"Themenstichwort\": \"Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')\",\n  \"BegrÃ¼ndung\": \"EingeschrÃ¤nkte ArbeitsfÃ¤higkeit bei einem wichtigen Kommunikationskanal. Keine komplette Blockade, aber geschÃ¤ftsrelevant. Entspricht Kategorie B.\"\n}\n```"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 3,
          "position": [
            320,
            -112
          ],
          "id": "00af3b4a-50a1-41df-a516-df618c013ad5",
          "name": "AI Agent",
          "executeOnce": true
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "claude-3-5-haiku-20241022",
              "mode": "list",
              "cachedResultName": "Claude Haiku 3.5"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
          "typeVersion": 1.3,
          "position": [
            400,
            112
          ],
          "id": "a72b2e08-67f3-4591-a6ed-6378bef31572",
          "name": "Anthropic Chat Model",
          "credentials": {
            "anthropicApi": {
              "id": "6RlfJdXsmselCNpN",
              "name": "Anthropic account 2"
            }
          }
        },
        {
          "parameters": {
            "authentication": "serviceAccount",
            "documentId": {
              "__rl": true,
              "value": "1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw",
              "mode": "id"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Dringlichkeiten",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw/edit#gid=0"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -128,
            -16
          ],
          "id": "1b85874a-bd52-4745-aeac-cf0f83b2b548",
          "name": "Dringlichkeitskriterien laden",
          "credentials": {
            "googleApi": {
              "id": "vRVq7GTwn9kTIi8N",
              "name": "Google Sheets account 2"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            96,
            -112
          ],
          "id": "6be52049-555e-4624-aa75-50b17878121d",
          "name": "Merge"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "ba4494fd-87dc-44a3-be07-3c1e3b0b0f04",
                  "name": "Dringlichkeit",
                  "value": "={{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).Dringlichkeit }}",
                  "type": "string"
                },
                {
                  "id": "77fc8f1e-1ef1-4c82-a4c9-1badefb579a4",
                  "name": "problemtyp",
                  "value": "={{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).Problemtyp }}",
                  "type": "string"
                },
                {
                  "id": "ea4dea35-112a-47b3-86c9-3252d606adda",
                  "name": "betreff",
                  "value": "={{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).Kategorie }} | {{ $('Merge').item.json.body[0].body.context.einrichtung_name }}, {{ $('Merge').item.json.body[0].body.context.anrufer_name }} | {{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).Themenstichwort }}",
                  "type": "string"
                },
                {
                  "id": "123c771e-c991-4bb9-8860-c5c030773741",
                  "name": "emailBody",
                  "value": "=<h3>Problemtyp: {{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).Problemtyp }}</h3>\n\n<h3>KI-EinschÃ¤tzung</h3>\n<ul>\n  <li><strong>Einrichtung:</strong> {{ $('Merge').item.json.body[0].body.context.einrichtung_name }}</li>\n  <li><strong>Anrufer:</strong> {{ $('Merge').item.json.body[0].body.context.anrufer_name }} ({{ $('Merge').item.json.body[0].body.fromNumber }})</li>\n  <li><strong>Ansprechpartner:</strong> \n    {{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).AnsprechpartnerBleibt ? 'Anrufer bleibt Ansprechpartner' : JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).AnsprechpartnerName + ' (' + JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).AnsprechpartnerTelefon + ')' }}\n  </li>\n  <li><strong>RÃ¼ckrufnummer:</strong> \n    {{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).RueckrufnummerAnders ? JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).Rueckrufnummer : $('Merge').item.json.body[0].body.fromNumber }}\n  </li>\n  <li><strong>Thema:</strong> {{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).Themenstichwort }}</li>\n  <li><strong>Beschreibung:</strong>\n    <ul>\n      {{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).Beschreibung.map(punkt => `<li>${punkt}</li>`).join('') }}\n    </ul>\n  </li>\n</ul>\n\n<h3>BegrÃ¼ndung der Dringlichkeitseinstufung</h3>\n<p>{{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).BegrÃ¼ndung }}</p>\n\n<h3>VollstÃ¤ndiges Transkript</h3>\n{{ $('Merge').item.json.body[0].body.formattedTranscript.replace(/\\n/g, '<br>') }}\n</pre>",
                  "type": "string"
                },
                {
                  "id": "abbab201-31d0-4200-8c7e-5b3d2c1b1dc7",
                  "name": "themenstichwort",
                  "value": "={{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).Themenstichwort }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            672,
            -112
          ],
          "id": "5eee655c-a899-4e8e-ba71-6016f32c6061",
          "name": "E-Mail vorbereiten"
        },
        {
          "parameters": {
            "fromEmail": "office@berent.ai",
            "toEmail": "office@berent.ai",
            "subject": "={{ $json.betreff }}",
            "html": "={{ $json.emailBody }}",
            "options": {},
            "path": "82009882-a2e2-40b1-9e65-a1befe9e8831"
          },
          "type": "n8n-nodes-base.emailSend",
          "typeVersion": 2.1,
          "position": [
            880,
            -112
          ],
          "id": "78cbf6a8-3fc9-4d66-b70c-70ebd3c09956",
          "name": "Send email",
          "webhookId": "82009882-a2e2-40b1-9e65-a1befe9e8831",
          "credentials": {
            "smtp": {
              "id": "8O5B5z4vS8yeagJh",
              "name": "SMTP account"
            }
          }
        }
      ],
      "connections": {
        "Webhook": {
          "main": [
            [
              {
                "node": "Daten extrahieren",
                "type": "main",
                "index": 0
              },
              {
                "node": "Dringlichkeitskriterien laden",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Daten extrahieren": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Anthropic Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Dringlichkeitskriterien laden": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent": {
          "main": [
            [
              {
                "node": "E-Mail vorbereiten",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "E-Mail vorbereiten": {
          "main": [
            [
              {
                "node": "Send email",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "a9805cff-7262-44ab-8fba-c14f351bf25e",
      "activeVersionId": null,
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-12-08T15:12:07.211Z",
          "createdAt": "2025-12-08T15:12:07.211Z",
          "role": "workflow:owner",
          "workflowId": "dPDoawNHAa6ocJdr",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": null,
      "tags": []
    },
    {
      "updatedAt": "2025-12-09T22:36:44.037Z",
      "createdAt": "2025-11-23T18:11:10.643Z",
      "id": "gkgmJNNtuTAZgcyC",
      "name": "fonio AGS Nachbearbeitung Transkript",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "fonio-ags-transkript",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -352,
            -256
          ],
          "id": "dbb2ce2e-7047-422a-b8a2-7cd7f735f599",
          "name": "Webhook",
          "webhookId": "d9a56c84-3178-44a5-9d50-e8a42a1f9a00"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "011ef203-63fd-49f7-ae0d-4ed7318ad11f",
                  "name": "headers.host",
                  "value": "={{ $json.headers.host }}",
                  "type": "string"
                },
                {
                  "id": "04f27e3e-ebed-4ae5-a22f-23d0f7c61904",
                  "name": "body[0].body.formattedTranscript",
                  "value": "={{ $json.body[0].body.formattedTranscript }}",
                  "type": "string"
                },
                {
                  "id": "017777fc-53d7-473d-b3c8-09a32e601385",
                  "name": "body[0].body.fromNumber",
                  "value": "={{ $json.body[0].body.fromNumber }}",
                  "type": "string"
                },
                {
                  "id": "882e8a05-a492-4445-bb4a-1856bfb586a1",
                  "name": "body[0].body.context.anrufer_name",
                  "value": "={{ $json.body[0].body.context.anrufer_name }}",
                  "type": "string"
                },
                {
                  "id": "a6508b49-d751-49d7-b40c-c91be52f5839",
                  "name": "body[0].body.context.einrichtung_typ",
                  "value": "={{ $json.body[0].body.context.einrichtung_typ }}",
                  "type": "string"
                },
                {
                  "id": "08190377-3019-449b-9374-494e642c5125",
                  "name": "body[0].body.context.einrichtung_name",
                  "value": "={{ $json.body[0].body.context.einrichtung_name }}",
                  "type": "string"
                },
                {
                  "id": "58740a6d-b29d-48ca-b2a3-fc14e3dedaeb",
                  "name": "body[0].body.context.technisch",
                  "value": "={{ $json.body[0].body.context.technisch }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -128,
            -352
          ],
          "id": "b905e673-945d-4303-8ddb-de9c95625fc3",
          "name": "Daten extrahieren"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=FÃ¼hre die Klassifikation durch.",
            "hasOutputParser": true,
            "options": {
              "systemMessage": "=DU BIST EIN HOCHSPEZIALISIERTER KLASSIFIKATIONS-AGENT FÃœR IT-HOTLINE-TRANSKRIPTE.\n\n###DEINE HAUPTAUFGABE###\nAnalysiere Telefon-Transkripte und ordne sie prÃ¤zise in eine Dringlichkeitskategorie (A, B, C oder D) ein, basierend auf den Kriterien aus der bereitgestellten Wissensdatenbank. Deine Klassifikation ermÃ¶glicht Technikern eine zielgerichtete, priorisierte Bearbeitung.\n\n---\n\n###VERFÃœGBARE DATEN###\n\n**DRINGLICHKEITSKRITERIEN (aus Google Sheet):**\n{{ $('Dringlichkeitskriterien laden').all().slice(1).map(item =>\n`Kategorie ${item.json.Dringlichkeit}: ${item.json.Kategorie}\nSchlÃ¼sselworte: ${item.json.Schlagworte}\nBeispiele: ${item.json.Beispiele}`\n).join('\\n\\n') }}\n\n**ZU ANALYSIERENDES TRANSKRIPT:**\n{{ $json.anonymizedText }}\n\n---\n\n###ANALYSE-METHODIK (CHAIN OF THOUGHTS)###\n\n1. **UNDERSTAND**\n   - Lies das Transkript grÃ¼ndlich und identifiziere das konkrete technische Problem\n   - Erkenne die Auswirkungen: ProduktivitÃ¤tsausfall, Datenverlust, Eskalation, GeschÃ¤ftskritikalitÃ¤t\n\n2. **IDENTIFY KEY SIGNALS**\n   - SchlÃ¼sselbegriffe fÃ¼r hohe Dringlichkeit: \"nicht arbeitsfÃ¤hig\", \"Produktion steht\", \"Kunde wartet\", \"dringend\", \"sofort\"\n   - SchlÃ¼sselbegriffe fÃ¼r niedrige Dringlichkeit: \"nicht eilig\", \"wenn Zeit ist\", \"Informationsfrage\", \"optional\"\n\n3. **ASSESS IMPACT**\n   - Ist ein geschÃ¤ftskritischer Prozess blockiert?\n   - Sind mehrere Nutzer betroffen?\n   - Gibt es Fristen oder SLA-relevante Zeitpunkte?\n   - Handelt es sich um einen Standardvorgang oder eine Informationsanfrage?\n\n4. **MATCH WITH CRITERIA**\n   - Vergleiche die erkannten Merkmale mit den Referenzbeispielen aus dem Google Sheet\n   - WÃ¤hle die Kategorie, die der Fallbeschreibung AM NÃ„CHSTEN kommt\n\n5. **HANDLE EDGE CASES**\n   - Bei unklaren oder widersprÃ¼chlichen Transkripten: WÃ¤hle die konservativere (hÃ¶here) Kategorie\n   - Weise explizit auf Unsicherheiten hin\n\n---\n\n###AUSGABEFORMAT###\n\n***WICHTIGER HINWEIS ZUR DATENSCHUTZ-KONFORMITÃ„T***\nDer Text enthÃ¤lt anonymisierte Platzhalter wie [PERSON_1], [PERSON_2].\nWenn du Namen extrahierst (z.B. fÃ¼r \"AnsprechpartnerName\" oder in der \"Beschreibung\"),\nNUTZE AUSSCHLIESSLICH DIESE PLATZHALTER.\nWandle sie NICHT um und erfinde keine Namen.\nBeispiel korrekt: \"AnsprechpartnerName\": \"[PERSON_2]\"\n\nGib deine Analyse im folgenden JSON-Format zurÃ¼ck:\n```json\n{\n  \"Dringlichkeit\": \"B\",\n  \"Kategorie\": \"Dringend\",\n  \"Problemtyp\": \"Technisch\",\n  \"Themenstichwort\": \"Server-Ausfall\",\n  \"Beschreibung\": [\n    \"Mehrere Mitarbeiter betroffen (Buchhaltung)\",\n    \"Datenbankverbindung unterbrochen seit 8 Uhr\",\n    \"Fehlende Rechnungen der letzten 2 Wochen\",\n    \"Zeitkritisch: Jahresabschluss-Termin in 2 Stunden\"\n  ],\n  \"AnsprechpartnerBleibt\": true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\n  \"AnsprechpartnerName\": \"Frau Weber\",\n  \"RueckrufnummerAnders\": true = andere RÃ¼ckrufnummer gewÃ¼nscht, false = unter anrufender Nummer zurÃ¼ckrufen\n  \"Rueckrufnummer\": Die vom Anrufer genannte RÃ¼ckrufnummer (mit Durchwahl falls vorhanden)\n  \"BegrÃ¼ndung\": \"Der Kunde ist grundsÃ¤tzlich arbeitsfÃ¤hig, jedoch blockiert ein IT-Fehler einen zeitkritischen GeschÃ¤ftsprozess. Entspricht den Beispielen fÃ¼r Kategorie B im Sheet.\"\n}\n```\n\n**WICHTIG: Feldbeschreibungen** \n- Die Dringlichkeit MUSS ein einzelner Buchstabe sein: A, B, C oder D, entsprechend der MÃ¶glichkeiten im Google Sheet\n- Die Kategorie MUSS sich auf die entsprechende Spalte im Google Sheet beziehen\n- Problemtyp: Klassifiziere in GENAU EINE dieser Kategorien:\n  â€¢ \"Technisch\" = Hardware-Probleme, NetzwerkausfÃ¤lle, GerÃ¤tedefekte, Server-AusfÃ¤lle\n  â€¢ \"Software\" = Programmfehler, Anmeldeprobleme, SoftwarestÃ¶rungen, Datenbankprobleme\n  â€¢ \"Anliegen\" = Informationsanfragen, Beratung, allgemeine Fragen ohne akutes technisches Problem\n- Themenstichwort: Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z. B. \"SAP-Login\", \"E-Mail-Sync\", \"Drucker-WLAN\")\n- Beschreibung: Array mit 3-6 Stichpunkten, die wichtigsten Informationen zuerst:\n  â€¢ Betroffene Personen/Systeme\n  â€¢ Zeitpunkt des Auftretens\n  â€¢ Konkrete Symptome/Fehler\n  â€¢ GeschÃ¤ftliche Auswirkungen\n  â€¢ Fristen/Zeitdruck\n  â€¢ Bereits versuchte LÃ¶sungen\n- AnsprechpartnerBleibt: true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\n- AnsprechpartnerName: Name des Ansprechpartners (falls abweichend vom Anrufer, sonst leer lassen)\n- AnsprechpartnerTelefon: Telefonnummer des Ansprechpartners (falls abweichend, sonst leer lassen)\n- RueckrufnummerAnders: true = andere RÃ¼ckrufnummer als anrufende Nummer, false = unter anrufender Nummer zurÃ¼ckrufen\n- Rueckrufnummer: Die RÃ¼ckrufnummer (kann identisch mit AnsprechpartnerTelefon sein)\n- Die BegrÃ¼ndung MUSS sich auf die Kriterien im Google Sheet beziehen\n- Halte dich strikt an das JSON-Format\n\n---\n\n###WAS NICHT ZU TUN IST###\n\nNIEMALS Kategorien ohne Bezug zum Google Sheet festlegen\nVERMEIDE vage BegrÃ¼ndungen wie \"klingt dringend\" oder \"scheint wichtig\"\nNICHT nur nach einzelnen SchlÃ¼sselworten klassifizieren â€“ analysiere die Gesamtsituation\nNIEMALS Aussagen erfinden, die nicht im Transkript stehen\nNICHT Ã¼berkategorisieren: Unzufriedenheit allein rechtfertigt keine Kategorie A\nIGNORIERE NIEMALS Hinweise auf Systemrelevanz, Produktionsstopp oder geschÃ¤ftskritische Prozesse\n\n---\n\n###FEW-SHOT BEISPIELE###\n\n**Beispiel 1 - Kategorie A:**\nTranskript: \"Ich kann mich nicht mehr in SAP anmelden, wir mÃ¼ssen heute unbedingt die Monatsabrechnung machen.\"\nAusgabe:\n```json\n{\n  \"Dringlichkeit\": \"A\",\n  \"Kategorie\": \"Notfall\",\n  \"Problemtyp\": \"Software\",\n  \"Themenstichwort\": \"Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')\",\n  \"BegrÃ¼ndung\": \"GeschÃ¤ftskritischer Prozess (Monatsabrechnung) ist komplett blockiert. Entspricht den ReferenzfÃ¤llen fÃ¼r Kategorie A im Sheet.\"\n}\n```\n\n**Beispiel 2 - Kategorie D:**\nTranskript: \"Ich wollte nur fragen, ob man den Drucker auch Ã¼ber WLAN verbinden kann â€“ ist aber nicht eilig.\"\nAusgabe:\n```json\n{\n  \"Dringlichkeit\": \"D\",\n  \"Kategorie\": \"Informativ\",\n  \"Problemtyp\": \"Technisch\",\n  \"Themenstichwort\": \"Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')\",\n  \"BegrÃ¼ndung\": \"Informationsanfrage ohne Zeitdruck, kein akuter Vorfall. Entspricht klar Kategorie D im Sheet.\"\n}\n```\n\n**Beispiel 3 - Kategorie B:**\nTranskript: \"Mein Outlook synchronisiert nicht mehr. Ich kann arbeiten, aber wichtige E-Mails von Kunden kommen nicht an.\"\nAusgabe:\n```json\n{\n  \"Dringlichkeit\": \"B\",\n  \"Kategorie\": \"Dringend\",\n  \"Problemtyp\": \"Technisch\",\n  \"Themenstichwort\": \"Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')\",\n  \"BegrÃ¼ndung\": \"EingeschrÃ¤nkte ArbeitsfÃ¤higkeit bei einem wichtigen Kommunikationskanal. Keine komplette Blockade, aber geschÃ¤ftsrelevant. Entspricht Kategorie B.\"\n}\n```"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 3,
          "position": [
            1168,
            -256
          ],
          "id": "0aeac5e6-c9be-4642-9858-9cf4394bc907",
          "name": "AI Agent",
          "executeOnce": true
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "claude-3-5-haiku-20241022",
              "mode": "list",
              "cachedResultName": "Claude Haiku 3.5"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
          "typeVersion": 1.3,
          "position": [
            1240,
            -32
          ],
          "id": "b72b4dd9-4588-4dc0-996c-834b03ded117",
          "name": "Anthropic Chat Model",
          "credentials": {
            "anthropicApi": {
              "id": "6RlfJdXsmselCNpN",
              "name": "Anthropic account 2"
            }
          }
        },
        {
          "parameters": {
            "authentication": "serviceAccount",
            "documentId": {
              "__rl": true,
              "value": "1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw",
              "mode": "id"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Dringlichkeiten",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw/edit#gid=0"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -128,
            -160
          ],
          "id": "81634710-edda-4819-b56f-ba9fe6669b9b",
          "name": "Dringlichkeitskriterien laden",
          "credentials": {
            "googleApi": {
              "id": "vRVq7GTwn9kTIi8N",
              "name": "Google Sheets account 2"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            96,
            -256
          ],
          "id": "6f7d2c27-b551-43ff-b5b9-39c8e7048df2",
          "name": "Merge"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "9cac8552-e981-44e5-bfc7-854012461c3f",
                  "name": "subject",
                  "value": "={{ $json.Kategorie }} | {{ $('Daten extrahieren').first().json.body[0].body.context.einrichtung_name }}, {{ $('Daten extrahieren').first().json.body[0].body.context.anrufer_name }} | {{ $json.Themenstichwort }}",
                  "type": "string"
                },
                {
                  "id": "988dd2a7-83ea-48b9-9e7e-bcc66745c72c",
                  "name": "htmlBody",
                  "value": "=<h3>Problemtyp: {{ $json.Problemtyp }}</h3>\n\n<h4>KI-EinschÃ¤tzung</h4>\n<p>\n  <b>Einrichtung:</b> {{ $('Daten extrahieren').first().json.body[0].body.context.einrichtung_typ }}<br>\n  <b>Anrufer:</b> {{ $('Daten extrahieren').first().json.body[0].body.context.anrufer_name }} ({{ $('Daten extrahieren').first().json.body[0].body.fromNumber }})<br>\n  <b>Ansprechpartner:</b> {{ $json.AnsprechpartnerName ? $json.AnsprechpartnerName : \"Wie Anrufer\" }}<br>\n  <b>RÃ¼ckrufnummer:</b> {{ $json.Rueckrufnummer ? $json.Rueckrufnummer : $('Daten extrahieren').first().json.body[0].body.fromNumber }}<br>\n  <b>Thema:</b> {{ $json.Themenstichwort }}\n</p>\n\n<b>Beschreibung:</b>\n<ul>\n{{ $json.Beschreibung.map(item => `<li>${item}</li>`).join('') }}\n</ul>\n\n<b>BegrÃ¼ndung der Dringlichkeitseinstufung:</b>\n<p>{{ $json.BegrÃ¼ndung }}</p>\n\n<hr>\n\n<h4>VollstÃ¤ndiges Transkript</h4>\n<p style=\"white-space: pre-wrap; color: #555;\">\n{{ $('Azure Request Vorbereitung').first().json.messages[1].content }}\n</p>",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1744,
            -256
          ],
          "id": "1f135291-aa87-4abe-a14d-abd42f414692",
          "name": "E-Mail vorbereiten"
        },
        {
          "parameters": {
            "fromEmail": "helpdesk@ags-it.de",
            "toEmail": "helpdesk@ags-it.de",
            "subject": "={{ $json.subject }}",
            "html": "={{ $json.htmlBody }}",
            "options": {}
          },
          "type": "n8n-nodes-base.emailSend",
          "typeVersion": 2.1,
          "position": [
            1968,
            -256
          ],
          "id": "0cd6a345-9aa5-4152-9155-46ba19a4474e",
          "name": "Send email",
          "webhookId": "32ae0708-d567-42b3-a2e8-987354d3ea61",
          "credentials": {
            "smtp": {
              "id": "8O5B5z4vS8yeagJh",
              "name": "SMTP account"
            }
          }
        },
        {
          "parameters": {
            "operation": "sanitize",
            "text": "={{ $('Merge').item.json.body[0].body.formattedTranscript }}",
            "guardrails": {
              "pii": {
                "value": {
                  "type": "selected",
                  "entities": [
                    "EMAIL_ADDRESS",
                    "PHONE_NUMBER",
                    "IP_ADDRESS",
                    "LOCATION"
                  ]
                }
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.guardrails",
          "typeVersion": 1,
          "position": [
            320,
            -256
          ],
          "id": "278b33d4-0e5b-4441-8a6e-327b66660ab8",
          "name": "Daten anonymisieren"
        },
        {
          "parameters": {
            "jsCode": "// 1. Zugriff auf die Antwort des AI Agents\nlet agentOutput = $input.item.json.output || $input.item.json.text || \"\";\n\n// Wir machen sicherheitshalber einen String daraus\nif (typeof agentOutput === 'object') {\n  agentOutput = JSON.stringify(agentOutput);\n}\n\n// 2. Das Mapping holen (exakter Name der Node davor ist wichtig!)\nconst mappingData = $('Azure Response Verarbeitung').first();\nconst nameMapping = mappingData.json.nameMapping || [];\n\n// 3. Re-Personalisierung durchfÃ¼hren (Suchen & Ersetzen im Rohtext)\n// Wir machen das VOR dem JSON-Parsing, damit auch Namen in Strings ersetzt werden.\nlet processedText = agentOutput;\n\nfor (const item of nameMapping) {\n  // Ersetze [PERSON_X] durch den echten Namen (global)\n  // Wir escapen die Klammern fÃ¼r den Regex\n  const placeholderRegex = new RegExp(item.placeholder.replace(/\\[/g, '\\\\[').replace(/\\]/g, '\\\\]'), 'g');\n  processedText = processedText.replace(placeholderRegex, item.original);\n}\n\n// 4. JSON Extrahieren (Der \"GesprÃ¤chigkeit\"-Filter)\n// Wir suchen den Bereich zwischen der ersten '{' und der letzten '}'\nconst firstBracket = processedText.indexOf('{');\nconst lastBracket = processedText.lastIndexOf('}');\n\nif (firstBracket !== -1 && lastBracket !== -1) {\n  // Schneide alles vor der ersten Klammer und nach der letzten Klammer weg\n  const jsonString = processedText.substring(firstBracket, lastBracket + 1);\n  \n  try {\n    const finalObject = JSON.parse(jsonString);\n    return finalObject; // Gib das saubere Objekt zurÃ¼ck\n  } catch (e) {\n    return { error: \"JSON war trotz Filterung ungÃ¼ltig\", raw: processedText };\n  }\n} else {\n  // Fallback, falls gar keine Klammern gefunden wurden\n  return { error: \"Kein JSON im Antworttext gefunden\", raw: processedText };\n}"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1520,
            -256
          ],
          "id": "830134ee-1845-49cc-9d3d-933ee1e989e8",
          "name": "Re-Personalisierung"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://berent-ki.services.ai.azure.com/models/chat/completions?api-version=2024-05-01-preview",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "contentType": "=json",
            "specifyBody": "json",
            "bodyParameters": {
              "parameters": [
                {}
              ]
            },
            "jsonBody": "={{ $json }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            768,
            -256
          ],
          "id": "cbc2d314-649e-4214-8bac-a48859f4bb6a",
          "name": "Namen-Anonymisierung (Azure)",
          "retryOnFail": true,
          "waitBetweenTries": 5000,
          "maxTries": 5,
          "credentials": {
            "httpHeaderAuth": {
              "id": "4gc7MePUZVuCyowB",
              "name": "Header Auth account"
            },
            "httpBearerAuth": {
              "id": "24SORzPv91ZRH2UW",
              "name": "Bearer Auth account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "// Wir greifen auf die Antwort der Azure-Node zu\nconst response = $input.item.json;\n\n// Sicherstellen, dass wir eine Antwort haben\nif (response.choices && response.choices[0] && response.choices[0].message) {\n  \n  // Den Textinhalt holen\n  let content = response.choices[0].message.content;\n  \n  // Oft sendet die KI den Text in Markdown-BlÃ¶cken (```json ... ```).\n  // Diese entfernen wir hier, damit das JSON sauber ist.\n  content = content.replace(/^```json\\s*/, \"\").replace(/\\s*```$/, \"\");\n  \n  try {\n    // Den Textstring in ein echtes JSON-Objekt umwandeln\n    const parsedData = JSON.parse(content);\n    \n    // Das saubere Ergebnis zurÃ¼ckgeben\n    return parsedData;\n    \n  } catch (error) {\n    // Falls die KI kein gÃ¼ltiges JSON geschickt hat, geben wir den Rohtext zurÃ¼ck\n    return {\n      error: \"Konnte JSON nicht parsen\",\n      rawContent: content\n    };\n  }\n} else {\n  return { error: \"Keine gÃ¼ltige Antwort von Azure erhalten\" };\n}"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            992,
            -256
          ],
          "id": "2bcc7acd-bd58-4a14-8ceb-0b35bb0c24cc",
          "name": "Azure Response Verarbeitung"
        },
        {
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "// Daten aus der vorherigen Node holen\n// Fallback auf leeren String, falls keine Daten da sind\nconst transcript = $input.item.json.guardrailsInput || $input.item.json.output || \"\";\n\nconst systemPrompt = `Du bist ein Spezialist fÃ¼r die Anonymisierung von Personennamen in deutschen Telefon-Transkripten.\n\n###DEINE AUFGABE###\nErkenne alle Personennamen (Vornamen und Nachnamen) im gegebenen Text und ersetze sie durch nummerierte Platzhalter im Format [PERSON_1], [PERSON_2], [PERSON_3] etc.\n\n###REGELN###\n1. Erkenne nur echte Personennamen (z.B. Thomas, Anna, MÃ¼ller, Schmidt)\n2. Ignoriere Titel wie 'Herr', 'Frau', 'Dr.' - diese bleiben unverÃ¤ndert\n3. Ersetze jeden gefundenen Namen durch einen eindeutigen Platzhalter [PERSON_N]\n4. Gleiche Namen im Text erhalten den gleichen Platzhalter (z.B. 'Thomas' wird immer zu [PERSON_1])\n5. Verschiedene Namen erhalten verschiedene Platzhalter (z.B. 'Thomas' â†’ [PERSON_1], 'Anna' â†’ [PERSON_2])\n6. Behalte die ursprÃ¼ngliche Formatierung bei (ZeilenumbrÃ¼che, Interpunktion)\n\n###AUSGABEFORMAT###\nGib dein Ergebnis im folgenden JSON-Format zurÃ¼ck:\n\\`\\`\\`json\n{\n  \"anonymizedText\": \"Der anonymisierte Text mit [PERSON_1], [PERSON_2] etc.\",\n  \"nameMapping\": [\n    {\"original\": \"Thomas\", \"placeholder\": \"[PERSON_1]\"},\n    {\"original\": \"Anna\", \"placeholder\": \"[PERSON_2]\"}\n  ]\n}\n\\`\\`\\``;\n\n// Das fertige Payload-Objekt zurÃ¼ckgeben\nreturn {\n  model: \"mistral-namen-anonymisierung\",\n  messages: [\n    {\n      role: \"system\",\n      content: systemPrompt\n    },\n    {\n      role: \"user\",\n      content: transcript\n    }\n  ],\n  temperature: 0.1,\n  max_tokens: 1000\n};"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            544,
            -256
          ],
          "id": "89b4ab5b-743d-419c-9908-00cd492681b2",
          "name": "Azure Request Vorbereitung"
        }
      ],
      "connections": {
        "Webhook": {
          "main": [
            [
              {
                "node": "Daten extrahieren",
                "type": "main",
                "index": 0
              },
              {
                "node": "Dringlichkeitskriterien laden",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Daten extrahieren": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Anthropic Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Dringlichkeitskriterien laden": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Daten anonymisieren",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent": {
          "main": [
            [
              {
                "node": "Re-Personalisierung",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "E-Mail vorbereiten": {
          "main": [
            [
              {
                "node": "Send email",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Daten anonymisieren": {
          "main": [
            [
              {
                "node": "Azure Request Vorbereitung",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Re-Personalisierung": {
          "main": [
            [
              {
                "node": "E-Mail vorbereiten",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Namen-Anonymisierung (Azure)": {
          "main": [
            [
              {
                "node": "Azure Response Verarbeitung",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Azure Response Verarbeitung": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Azure Request Vorbereitung": {
          "main": [
            [
              {
                "node": "Namen-Anonymisierung (Azure)",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "timeSavedMode": "fixed",
        "callerPolicy": "workflowsFromSameOwner",
        "availableInMCP": false
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "3bdcedd3-d45f-4f85-b22c-7a6da3504ff0",
      "activeVersionId": "3bdcedd3-d45f-4f85-b22c-7a6da3504ff0",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-11-23T18:11:10.645Z",
          "createdAt": "2025-11-23T18:11:10.645Z",
          "role": "workflow:owner",
          "workflowId": "gkgmJNNtuTAZgcyC",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": {
        "updatedAt": "2025-12-09T22:36:44.038Z",
        "createdAt": "2025-12-09T22:36:44.038Z",
        "versionId": "3bdcedd3-d45f-4f85-b22c-7a6da3504ff0",
        "workflowId": "gkgmJNNtuTAZgcyC",
        "nodes": [
          {
            "parameters": {
              "httpMethod": "POST",
              "path": "fonio-ags-transkript",
              "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2.1,
            "position": [
              -352,
              -256
            ],
            "id": "dbb2ce2e-7047-422a-b8a2-7cd7f735f599",
            "name": "Webhook",
            "webhookId": "d9a56c84-3178-44a5-9d50-e8a42a1f9a00"
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "011ef203-63fd-49f7-ae0d-4ed7318ad11f",
                    "name": "headers.host",
                    "value": "={{ $json.headers.host }}",
                    "type": "string"
                  },
                  {
                    "id": "04f27e3e-ebed-4ae5-a22f-23d0f7c61904",
                    "name": "body[0].body.formattedTranscript",
                    "value": "={{ $json.body[0].body.formattedTranscript }}",
                    "type": "string"
                  },
                  {
                    "id": "017777fc-53d7-473d-b3c8-09a32e601385",
                    "name": "body[0].body.fromNumber",
                    "value": "={{ $json.body[0].body.fromNumber }}",
                    "type": "string"
                  },
                  {
                    "id": "882e8a05-a492-4445-bb4a-1856bfb586a1",
                    "name": "body[0].body.context.anrufer_name",
                    "value": "={{ $json.body[0].body.context.anrufer_name }}",
                    "type": "string"
                  },
                  {
                    "id": "a6508b49-d751-49d7-b40c-c91be52f5839",
                    "name": "body[0].body.context.einrichtung_typ",
                    "value": "={{ $json.body[0].body.context.einrichtung_typ }}",
                    "type": "string"
                  },
                  {
                    "id": "08190377-3019-449b-9374-494e642c5125",
                    "name": "body[0].body.context.einrichtung_name",
                    "value": "={{ $json.body[0].body.context.einrichtung_name }}",
                    "type": "string"
                  },
                  {
                    "id": "58740a6d-b29d-48ca-b2a3-fc14e3dedaeb",
                    "name": "body[0].body.context.technisch",
                    "value": "={{ $json.body[0].body.context.technisch }}",
                    "type": "string"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              -128,
              -352
            ],
            "id": "b905e673-945d-4303-8ddb-de9c95625fc3",
            "name": "Daten extrahieren"
          },
          {
            "parameters": {
              "promptType": "define",
              "text": "=FÃ¼hre die Klassifikation durch.",
              "hasOutputParser": true,
              "options": {
                "systemMessage": "=DU BIST EIN HOCHSPEZIALISIERTER KLASSIFIKATIONS-AGENT FÃœR IT-HOTLINE-TRANSKRIPTE.\n\n###DEINE HAUPTAUFGABE###\nAnalysiere Telefon-Transkripte und ordne sie prÃ¤zise in eine Dringlichkeitskategorie (A, B, C oder D) ein, basierend auf den Kriterien aus der bereitgestellten Wissensdatenbank. Deine Klassifikation ermÃ¶glicht Technikern eine zielgerichtete, priorisierte Bearbeitung.\n\n---\n\n###VERFÃœGBARE DATEN###\n\n**DRINGLICHKEITSKRITERIEN (aus Google Sheet):**\n{{ $('Dringlichkeitskriterien laden').all().slice(1).map(item =>\n`Kategorie ${item.json.Dringlichkeit}: ${item.json.Kategorie}\nSchlÃ¼sselworte: ${item.json.Schlagworte}\nBeispiele: ${item.json.Beispiele}`\n).join('\\n\\n') }}\n\n**ZU ANALYSIERENDES TRANSKRIPT:**\n{{ $json.anonymizedText }}\n\n---\n\n###ANALYSE-METHODIK (CHAIN OF THOUGHTS)###\n\n1. **UNDERSTAND**\n   - Lies das Transkript grÃ¼ndlich und identifiziere das konkrete technische Problem\n   - Erkenne die Auswirkungen: ProduktivitÃ¤tsausfall, Datenverlust, Eskalation, GeschÃ¤ftskritikalitÃ¤t\n\n2. **IDENTIFY KEY SIGNALS**\n   - SchlÃ¼sselbegriffe fÃ¼r hohe Dringlichkeit: \"nicht arbeitsfÃ¤hig\", \"Produktion steht\", \"Kunde wartet\", \"dringend\", \"sofort\"\n   - SchlÃ¼sselbegriffe fÃ¼r niedrige Dringlichkeit: \"nicht eilig\", \"wenn Zeit ist\", \"Informationsfrage\", \"optional\"\n\n3. **ASSESS IMPACT**\n   - Ist ein geschÃ¤ftskritischer Prozess blockiert?\n   - Sind mehrere Nutzer betroffen?\n   - Gibt es Fristen oder SLA-relevante Zeitpunkte?\n   - Handelt es sich um einen Standardvorgang oder eine Informationsanfrage?\n\n4. **MATCH WITH CRITERIA**\n   - Vergleiche die erkannten Merkmale mit den Referenzbeispielen aus dem Google Sheet\n   - WÃ¤hle die Kategorie, die der Fallbeschreibung AM NÃ„CHSTEN kommt\n\n5. **HANDLE EDGE CASES**\n   - Bei unklaren oder widersprÃ¼chlichen Transkripten: WÃ¤hle die konservativere (hÃ¶here) Kategorie\n   - Weise explizit auf Unsicherheiten hin\n\n---\n\n###AUSGABEFORMAT###\n\n***WICHTIGER HINWEIS ZUR DATENSCHUTZ-KONFORMITÃ„T***\nDer Text enthÃ¤lt anonymisierte Platzhalter wie [PERSON_1], [PERSON_2].\nWenn du Namen extrahierst (z.B. fÃ¼r \"AnsprechpartnerName\" oder in der \"Beschreibung\"),\nNUTZE AUSSCHLIESSLICH DIESE PLATZHALTER.\nWandle sie NICHT um und erfinde keine Namen.\nBeispiel korrekt: \"AnsprechpartnerName\": \"[PERSON_2]\"\n\nGib deine Analyse im folgenden JSON-Format zurÃ¼ck:\n```json\n{\n  \"Dringlichkeit\": \"B\",\n  \"Kategorie\": \"Dringend\",\n  \"Problemtyp\": \"Technisch\",\n  \"Themenstichwort\": \"Server-Ausfall\",\n  \"Beschreibung\": [\n    \"Mehrere Mitarbeiter betroffen (Buchhaltung)\",\n    \"Datenbankverbindung unterbrochen seit 8 Uhr\",\n    \"Fehlende Rechnungen der letzten 2 Wochen\",\n    \"Zeitkritisch: Jahresabschluss-Termin in 2 Stunden\"\n  ],\n  \"AnsprechpartnerBleibt\": true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\n  \"AnsprechpartnerName\": \"Frau Weber\",\n  \"RueckrufnummerAnders\": true = andere RÃ¼ckrufnummer gewÃ¼nscht, false = unter anrufender Nummer zurÃ¼ckrufen\n  \"Rueckrufnummer\": Die vom Anrufer genannte RÃ¼ckrufnummer (mit Durchwahl falls vorhanden)\n  \"BegrÃ¼ndung\": \"Der Kunde ist grundsÃ¤tzlich arbeitsfÃ¤hig, jedoch blockiert ein IT-Fehler einen zeitkritischen GeschÃ¤ftsprozess. Entspricht den Beispielen fÃ¼r Kategorie B im Sheet.\"\n}\n```\n\n**WICHTIG: Feldbeschreibungen** \n- Die Dringlichkeit MUSS ein einzelner Buchstabe sein: A, B, C oder D, entsprechend der MÃ¶glichkeiten im Google Sheet\n- Die Kategorie MUSS sich auf die entsprechende Spalte im Google Sheet beziehen\n- Problemtyp: Klassifiziere in GENAU EINE dieser Kategorien:\n  â€¢ \"Technisch\" = Hardware-Probleme, NetzwerkausfÃ¤lle, GerÃ¤tedefekte, Server-AusfÃ¤lle\n  â€¢ \"Software\" = Programmfehler, Anmeldeprobleme, SoftwarestÃ¶rungen, Datenbankprobleme\n  â€¢ \"Anliegen\" = Informationsanfragen, Beratung, allgemeine Fragen ohne akutes technisches Problem\n- Themenstichwort: Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z. B. \"SAP-Login\", \"E-Mail-Sync\", \"Drucker-WLAN\")\n- Beschreibung: Array mit 3-6 Stichpunkten, die wichtigsten Informationen zuerst:\n  â€¢ Betroffene Personen/Systeme\n  â€¢ Zeitpunkt des Auftretens\n  â€¢ Konkrete Symptome/Fehler\n  â€¢ GeschÃ¤ftliche Auswirkungen\n  â€¢ Fristen/Zeitdruck\n  â€¢ Bereits versuchte LÃ¶sungen\n- AnsprechpartnerBleibt: true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\n- AnsprechpartnerName: Name des Ansprechpartners (falls abweichend vom Anrufer, sonst leer lassen)\n- AnsprechpartnerTelefon: Telefonnummer des Ansprechpartners (falls abweichend, sonst leer lassen)\n- RueckrufnummerAnders: true = andere RÃ¼ckrufnummer als anrufende Nummer, false = unter anrufender Nummer zurÃ¼ckrufen\n- Rueckrufnummer: Die RÃ¼ckrufnummer (kann identisch mit AnsprechpartnerTelefon sein)\n- Die BegrÃ¼ndung MUSS sich auf die Kriterien im Google Sheet beziehen\n- Halte dich strikt an das JSON-Format\n\n---\n\n###WAS NICHT ZU TUN IST###\n\nNIEMALS Kategorien ohne Bezug zum Google Sheet festlegen\nVERMEIDE vage BegrÃ¼ndungen wie \"klingt dringend\" oder \"scheint wichtig\"\nNICHT nur nach einzelnen SchlÃ¼sselworten klassifizieren â€“ analysiere die Gesamtsituation\nNIEMALS Aussagen erfinden, die nicht im Transkript stehen\nNICHT Ã¼berkategorisieren: Unzufriedenheit allein rechtfertigt keine Kategorie A\nIGNORIERE NIEMALS Hinweise auf Systemrelevanz, Produktionsstopp oder geschÃ¤ftskritische Prozesse\n\n---\n\n###FEW-SHOT BEISPIELE###\n\n**Beispiel 1 - Kategorie A:**\nTranskript: \"Ich kann mich nicht mehr in SAP anmelden, wir mÃ¼ssen heute unbedingt die Monatsabrechnung machen.\"\nAusgabe:\n```json\n{\n  \"Dringlichkeit\": \"A\",\n  \"Kategorie\": \"Notfall\",\n  \"Problemtyp\": \"Software\",\n  \"Themenstichwort\": \"Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')\",\n  \"BegrÃ¼ndung\": \"GeschÃ¤ftskritischer Prozess (Monatsabrechnung) ist komplett blockiert. Entspricht den ReferenzfÃ¤llen fÃ¼r Kategorie A im Sheet.\"\n}\n```\n\n**Beispiel 2 - Kategorie D:**\nTranskript: \"Ich wollte nur fragen, ob man den Drucker auch Ã¼ber WLAN verbinden kann â€“ ist aber nicht eilig.\"\nAusgabe:\n```json\n{\n  \"Dringlichkeit\": \"D\",\n  \"Kategorie\": \"Informativ\",\n  \"Problemtyp\": \"Technisch\",\n  \"Themenstichwort\": \"Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')\",\n  \"BegrÃ¼ndung\": \"Informationsanfrage ohne Zeitdruck, kein akuter Vorfall. Entspricht klar Kategorie D im Sheet.\"\n}\n```\n\n**Beispiel 3 - Kategorie B:**\nTranskript: \"Mein Outlook synchronisiert nicht mehr. Ich kann arbeiten, aber wichtige E-Mails von Kunden kommen nicht an.\"\nAusgabe:\n```json\n{\n  \"Dringlichkeit\": \"B\",\n  \"Kategorie\": \"Dringend\",\n  \"Problemtyp\": \"Technisch\",\n  \"Themenstichwort\": \"Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')\",\n  \"BegrÃ¼ndung\": \"EingeschrÃ¤nkte ArbeitsfÃ¤higkeit bei einem wichtigen Kommunikationskanal. Keine komplette Blockade, aber geschÃ¤ftsrelevant. Entspricht Kategorie B.\"\n}\n```"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 3,
            "position": [
              1168,
              -256
            ],
            "id": "0aeac5e6-c9be-4642-9858-9cf4394bc907",
            "name": "AI Agent",
            "executeOnce": true
          },
          {
            "parameters": {
              "model": {
                "__rl": true,
                "value": "claude-3-5-haiku-20241022",
                "mode": "list",
                "cachedResultName": "Claude Haiku 3.5"
              },
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
            "typeVersion": 1.3,
            "position": [
              1240,
              -32
            ],
            "id": "b72b4dd9-4588-4dc0-996c-834b03ded117",
            "name": "Anthropic Chat Model",
            "credentials": {
              "anthropicApi": {
                "id": "6RlfJdXsmselCNpN",
                "name": "Anthropic account 2"
              }
            }
          },
          {
            "parameters": {
              "authentication": "serviceAccount",
              "documentId": {
                "__rl": true,
                "value": "1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw",
                "mode": "id"
              },
              "sheetName": {
                "__rl": true,
                "value": "gid=0",
                "mode": "list",
                "cachedResultName": "Dringlichkeiten",
                "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw/edit#gid=0"
              },
              "options": {}
            },
            "type": "n8n-nodes-base.googleSheets",
            "typeVersion": 4.7,
            "position": [
              -128,
              -160
            ],
            "id": "81634710-edda-4819-b56f-ba9fe6669b9b",
            "name": "Dringlichkeitskriterien laden",
            "credentials": {
              "googleApi": {
                "id": "vRVq7GTwn9kTIi8N",
                "name": "Google Sheets account 2"
              }
            }
          },
          {
            "parameters": {},
            "type": "n8n-nodes-base.merge",
            "typeVersion": 3.2,
            "position": [
              96,
              -256
            ],
            "id": "6f7d2c27-b551-43ff-b5b9-39c8e7048df2",
            "name": "Merge"
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "9cac8552-e981-44e5-bfc7-854012461c3f",
                    "name": "subject",
                    "value": "={{ $json.Kategorie }} | {{ $('Daten extrahieren').first().json.body[0].body.context.einrichtung_name }}, {{ $('Daten extrahieren').first().json.body[0].body.context.anrufer_name }} | {{ $json.Themenstichwort }}",
                    "type": "string"
                  },
                  {
                    "id": "988dd2a7-83ea-48b9-9e7e-bcc66745c72c",
                    "name": "htmlBody",
                    "value": "=<h3>Problemtyp: {{ $json.Problemtyp }}</h3>\n\n<h4>KI-EinschÃ¤tzung</h4>\n<p>\n  <b>Einrichtung:</b> {{ $('Daten extrahieren').first().json.body[0].body.context.einrichtung_typ }}<br>\n  <b>Anrufer:</b> {{ $('Daten extrahieren').first().json.body[0].body.context.anrufer_name }} ({{ $('Daten extrahieren').first().json.body[0].body.fromNumber }})<br>\n  <b>Ansprechpartner:</b> {{ $json.AnsprechpartnerName ? $json.AnsprechpartnerName : \"Wie Anrufer\" }}<br>\n  <b>RÃ¼ckrufnummer:</b> {{ $json.Rueckrufnummer ? $json.Rueckrufnummer : $('Daten extrahieren').first().json.body[0].body.fromNumber }}<br>\n  <b>Thema:</b> {{ $json.Themenstichwort }}\n</p>\n\n<b>Beschreibung:</b>\n<ul>\n{{ $json.Beschreibung.map(item => `<li>${item}</li>`).join('') }}\n</ul>\n\n<b>BegrÃ¼ndung der Dringlichkeitseinstufung:</b>\n<p>{{ $json.BegrÃ¼ndung }}</p>\n\n<hr>\n\n<h4>VollstÃ¤ndiges Transkript</h4>\n<p style=\"white-space: pre-wrap; color: #555;\">\n{{ $('Azure Request Vorbereitung').first().json.messages[1].content }}\n</p>",
                    "type": "string"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              1744,
              -256
            ],
            "id": "1f135291-aa87-4abe-a14d-abd42f414692",
            "name": "E-Mail vorbereiten"
          },
          {
            "parameters": {
              "fromEmail": "helpdesk@ags-it.de",
              "toEmail": "helpdesk@ags-it.de",
              "subject": "={{ $json.subject }}",
              "html": "={{ $json.htmlBody }}",
              "options": {}
            },
            "type": "n8n-nodes-base.emailSend",
            "typeVersion": 2.1,
            "position": [
              1968,
              -256
            ],
            "id": "0cd6a345-9aa5-4152-9155-46ba19a4474e",
            "name": "Send email",
            "webhookId": "32ae0708-d567-42b3-a2e8-987354d3ea61",
            "credentials": {
              "smtp": {
                "id": "8O5B5z4vS8yeagJh",
                "name": "SMTP account"
              }
            }
          },
          {
            "parameters": {
              "operation": "sanitize",
              "text": "={{ $('Merge').item.json.body[0].body.formattedTranscript }}",
              "guardrails": {
                "pii": {
                  "value": {
                    "type": "selected",
                    "entities": [
                      "EMAIL_ADDRESS",
                      "PHONE_NUMBER",
                      "IP_ADDRESS",
                      "LOCATION"
                    ]
                  }
                }
              }
            },
            "type": "@n8n/n8n-nodes-langchain.guardrails",
            "typeVersion": 1,
            "position": [
              320,
              -256
            ],
            "id": "278b33d4-0e5b-4441-8a6e-327b66660ab8",
            "name": "Daten anonymisieren"
          },
          {
            "parameters": {
              "jsCode": "// 1. Zugriff auf die Antwort des AI Agents\nlet agentOutput = $input.item.json.output || $input.item.json.text || \"\";\n\n// Wir machen sicherheitshalber einen String daraus\nif (typeof agentOutput === 'object') {\n  agentOutput = JSON.stringify(agentOutput);\n}\n\n// 2. Das Mapping holen (exakter Name der Node davor ist wichtig!)\nconst mappingData = $('Azure Response Verarbeitung').first();\nconst nameMapping = mappingData.json.nameMapping || [];\n\n// 3. Re-Personalisierung durchfÃ¼hren (Suchen & Ersetzen im Rohtext)\n// Wir machen das VOR dem JSON-Parsing, damit auch Namen in Strings ersetzt werden.\nlet processedText = agentOutput;\n\nfor (const item of nameMapping) {\n  // Ersetze [PERSON_X] durch den echten Namen (global)\n  // Wir escapen die Klammern fÃ¼r den Regex\n  const placeholderRegex = new RegExp(item.placeholder.replace(/\\[/g, '\\\\[').replace(/\\]/g, '\\\\]'), 'g');\n  processedText = processedText.replace(placeholderRegex, item.original);\n}\n\n// 4. JSON Extrahieren (Der \"GesprÃ¤chigkeit\"-Filter)\n// Wir suchen den Bereich zwischen der ersten '{' und der letzten '}'\nconst firstBracket = processedText.indexOf('{');\nconst lastBracket = processedText.lastIndexOf('}');\n\nif (firstBracket !== -1 && lastBracket !== -1) {\n  // Schneide alles vor der ersten Klammer und nach der letzten Klammer weg\n  const jsonString = processedText.substring(firstBracket, lastBracket + 1);\n  \n  try {\n    const finalObject = JSON.parse(jsonString);\n    return finalObject; // Gib das saubere Objekt zurÃ¼ck\n  } catch (e) {\n    return { error: \"JSON war trotz Filterung ungÃ¼ltig\", raw: processedText };\n  }\n} else {\n  // Fallback, falls gar keine Klammern gefunden wurden\n  return { error: \"Kein JSON im Antworttext gefunden\", raw: processedText };\n}"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              1520,
              -256
            ],
            "id": "830134ee-1845-49cc-9d3d-933ee1e989e8",
            "name": "Re-Personalisierung"
          },
          {
            "parameters": {
              "method": "POST",
              "url": "https://berent-ki.services.ai.azure.com/models/chat/completions?api-version=2024-05-01-preview",
              "authentication": "genericCredentialType",
              "genericAuthType": "httpHeaderAuth",
              "sendBody": true,
              "contentType": "=json",
              "specifyBody": "json",
              "bodyParameters": {
                "parameters": [
                  {}
                ]
              },
              "jsonBody": "={{ $json }}",
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
              768,
              -256
            ],
            "id": "cbc2d314-649e-4214-8bac-a48859f4bb6a",
            "name": "Namen-Anonymisierung (Azure)",
            "retryOnFail": true,
            "waitBetweenTries": 5000,
            "maxTries": 5,
            "credentials": {
              "httpHeaderAuth": {
                "id": "4gc7MePUZVuCyowB",
                "name": "Header Auth account"
              },
              "httpBearerAuth": {
                "id": "24SORzPv91ZRH2UW",
                "name": "Bearer Auth account"
              }
            }
          },
          {
            "parameters": {
              "jsCode": "// Wir greifen auf die Antwort der Azure-Node zu\nconst response = $input.item.json;\n\n// Sicherstellen, dass wir eine Antwort haben\nif (response.choices && response.choices[0] && response.choices[0].message) {\n  \n  // Den Textinhalt holen\n  let content = response.choices[0].message.content;\n  \n  // Oft sendet die KI den Text in Markdown-BlÃ¶cken (```json ... ```).\n  // Diese entfernen wir hier, damit das JSON sauber ist.\n  content = content.replace(/^```json\\s*/, \"\").replace(/\\s*```$/, \"\");\n  \n  try {\n    // Den Textstring in ein echtes JSON-Objekt umwandeln\n    const parsedData = JSON.parse(content);\n    \n    // Das saubere Ergebnis zurÃ¼ckgeben\n    return parsedData;\n    \n  } catch (error) {\n    // Falls die KI kein gÃ¼ltiges JSON geschickt hat, geben wir den Rohtext zurÃ¼ck\n    return {\n      error: \"Konnte JSON nicht parsen\",\n      rawContent: content\n    };\n  }\n} else {\n  return { error: \"Keine gÃ¼ltige Antwort von Azure erhalten\" };\n}"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              992,
              -256
            ],
            "id": "2bcc7acd-bd58-4a14-8ceb-0b35bb0c24cc",
            "name": "Azure Response Verarbeitung"
          },
          {
            "parameters": {
              "mode": "runOnceForEachItem",
              "jsCode": "// Daten aus der vorherigen Node holen\n// Fallback auf leeren String, falls keine Daten da sind\nconst transcript = $input.item.json.guardrailsInput || $input.item.json.output || \"\";\n\nconst systemPrompt = `Du bist ein Spezialist fÃ¼r die Anonymisierung von Personennamen in deutschen Telefon-Transkripten.\n\n###DEINE AUFGABE###\nErkenne alle Personennamen (Vornamen und Nachnamen) im gegebenen Text und ersetze sie durch nummerierte Platzhalter im Format [PERSON_1], [PERSON_2], [PERSON_3] etc.\n\n###REGELN###\n1. Erkenne nur echte Personennamen (z.B. Thomas, Anna, MÃ¼ller, Schmidt)\n2. Ignoriere Titel wie 'Herr', 'Frau', 'Dr.' - diese bleiben unverÃ¤ndert\n3. Ersetze jeden gefundenen Namen durch einen eindeutigen Platzhalter [PERSON_N]\n4. Gleiche Namen im Text erhalten den gleichen Platzhalter (z.B. 'Thomas' wird immer zu [PERSON_1])\n5. Verschiedene Namen erhalten verschiedene Platzhalter (z.B. 'Thomas' â†’ [PERSON_1], 'Anna' â†’ [PERSON_2])\n6. Behalte die ursprÃ¼ngliche Formatierung bei (ZeilenumbrÃ¼che, Interpunktion)\n\n###AUSGABEFORMAT###\nGib dein Ergebnis im folgenden JSON-Format zurÃ¼ck:\n\\`\\`\\`json\n{\n  \"anonymizedText\": \"Der anonymisierte Text mit [PERSON_1], [PERSON_2] etc.\",\n  \"nameMapping\": [\n    {\"original\": \"Thomas\", \"placeholder\": \"[PERSON_1]\"},\n    {\"original\": \"Anna\", \"placeholder\": \"[PERSON_2]\"}\n  ]\n}\n\\`\\`\\``;\n\n// Das fertige Payload-Objekt zurÃ¼ckgeben\nreturn {\n  model: \"mistral-namen-anonymisierung\",\n  messages: [\n    {\n      role: \"system\",\n      content: systemPrompt\n    },\n    {\n      role: \"user\",\n      content: transcript\n    }\n  ],\n  temperature: 0.1,\n  max_tokens: 1000\n};"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              544,
              -256
            ],
            "id": "89b4ab5b-743d-419c-9908-00cd492681b2",
            "name": "Azure Request Vorbereitung"
          }
        ],
        "connections": {
          "Webhook": {
            "main": [
              [
                {
                  "node": "Daten extrahieren",
                  "type": "main",
                  "index": 0
                },
                {
                  "node": "Dringlichkeitskriterien laden",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Daten extrahieren": {
            "main": [
              [
                {
                  "node": "Merge",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Anthropic Chat Model": {
            "ai_languageModel": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_languageModel",
                  "index": 0
                }
              ]
            ]
          },
          "Dringlichkeitskriterien laden": {
            "main": [
              [
                {
                  "node": "Merge",
                  "type": "main",
                  "index": 1
                }
              ]
            ]
          },
          "Merge": {
            "main": [
              [
                {
                  "node": "Daten anonymisieren",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "AI Agent": {
            "main": [
              [
                {
                  "node": "Re-Personalisierung",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "E-Mail vorbereiten": {
            "main": [
              [
                {
                  "node": "Send email",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Daten anonymisieren": {
            "main": [
              [
                {
                  "node": "Azure Request Vorbereitung",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Re-Personalisierung": {
            "main": [
              [
                {
                  "node": "E-Mail vorbereiten",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Namen-Anonymisierung (Azure)": {
            "main": [
              [
                {
                  "node": "Azure Response Verarbeitung",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Azure Response Verarbeitung": {
            "main": [
              [
                {
                  "node": "AI Agent",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Azure Request Vorbereitung": {
            "main": [
              [
                {
                  "node": "Namen-Anonymisierung (Azure)",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "Marcus Kunkel",
        "name": null,
        "description": null
      },
      "tags": []
    },
    {
      "updatedAt": "2025-11-11T21:32:22.000Z",
      "createdAt": "2025-11-06T20:35:24.122Z",
      "id": "hR36jIx0wREZK0Bf",
      "name": "Threema Gateway Universal - Nachrichten & Dateien",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "threema-gateway",
            "responseMode": "responseNode",
            "options": {}
          },
          "id": "146184d7-0046-4201-b43a-cb2fe8489f02",
          "name": "Threema Gateway Webhook",
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 1.1,
          "position": [
            160,
            128
          ],
          "webhookId": "threema-gateway-webhook"
        },
        {
          "parameters": {
            "content": "=Empfangene Webhook-Daten:\n{{ JSON.stringify($json, null, 2) }}",
            "height": 464,
            "width": 465
          },
          "id": "128cbbdf-bd05-4d24-a773-d42e2072cbb0",
          "name": "Info: Webhook Daten",
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            199.5,
            -176
          ]
        },
        {
          "parameters": {
            "jsCode": "// Parse entschlÃ¼sselte Threema E2E-Daten\nconst item = $input.item.json;\n\n// PrÃ¼fe ob Daten bereits entschlÃ¼sselt sind\nif (item.decrypted === false) {\n  // Noch nicht entschlÃ¼sselt - verwende rohe Daten\n  console.log('âš ï¸ Daten noch nicht entschlÃ¼sselt');\n  \n  return {\n    json: {\n      messageId: item.messageId,\n      from: item.from,\n      to: item.to,\n      messageType: 'encrypted',\n      hasFile: false,\n      text: '[VerschlÃ¼sselte Nachricht - EntschlÃ¼sselung ausstehend]',\n      timestamp: new Date(parseInt(item.date) * 1000).toISOString(),\n      rawData: item\n    }\n  };\n}\n\n// TODO: Nach EntschlÃ¼sselung - parse die eigentliche Nachricht\n// Hier kommt spÃ¤ter die Logik fÃ¼r entschlÃ¼sselte Nachrichten\n\nreturn {\n  json: {\n    messageId: item.messageId,\n    from: item.from,\n    to: item.to,\n    messageType: item.type || 'text',\n    hasFile: item.type === 'file' || item.type === 'image' || item.type === 'video',\n    text: item.text || '',\n    blobId: item.blobId || null,\n    timestamp: new Date(parseInt(item.date) * 1000).toISOString(),\n    rawData: item\n  }\n};"
          },
          "id": "de1d4b14-5517-488d-a58a-804a8561d29b",
          "name": "Parse Webhook Daten",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            608,
            128
          ]
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict"
              },
              "conditions": [
                {
                  "id": "has-file-condition",
                  "leftValue": "={{ $json.hasFile }}",
                  "rightValue": true,
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "id": "50e6dcb5-b5c7-4dce-a688-6fdc9b8c6b77",
          "name": "Hat Datei?",
          "type": "n8n-nodes-base.if",
          "typeVersion": 2,
          "position": [
            832,
            128
          ]
        },
        {
          "parameters": {
            "url": "=https://msgapi.threema.ch/blobs/{{ $json.blobId }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "from",
                  "value": "={{ $json.to }}"
                }
              ]
            },
            "options": {
              "response": {
                "response": {
                  "responseFormat": "file",
                  "outputPropertyName": "fileData"
                }
              }
            }
          },
          "id": "31c77f08-2bdb-4409-998b-3a70147965d7",
          "name": "Datei herunterladen",
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1056,
            32
          ],
          "credentials": {
            "httpHeaderAuth": {
              "id": "4gc7MePUZVuCyowB",
              "name": "Header Auth account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "// Verarbeite heruntergeladene Datei\nconst item = $input.item.json;\n\nreturn {\n  json: {\n    ...item,\n    fileDownloaded: true,\n    fileBinaryData: 'fileData',\n    processedAt: new Date().toISOString()\n  },\n  binary: $input.item.binary\n};"
          },
          "id": "5672c88c-c4af-4b0c-b293-7b7b48443dd3",
          "name": "Datei verarbeiten",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1280,
            32
          ]
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict"
                    },
                    "conditions": [
                      {
                        "leftValue": "",
                        "rightValue": "",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {}
          },
          "id": "f302ca58-c8db-4d8b-870e-de50ab6d662b",
          "name": "Dateityp prÃ¼fen",
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3,
          "position": [
            1504,
            32
          ]
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "set-type",
                  "name": "fileCategory",
                  "value": "image",
                  "type": "string"
                },
                {
                  "id": "set-processing",
                  "name": "readyForProcessing",
                  "value": true,
                  "type": "boolean"
                }
              ]
            },
            "options": {}
          },
          "id": "61c8529c-78db-4874-99a3-8bae7444ddfb",
          "name": "Als Bild markieren",
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.3,
          "position": [
            1728,
            32
          ]
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": false,
                "leftValue": "",
                "typeValidation": "loose"
              },
              "conditions": [
                {
                  "id": "is-audio",
                  "leftValue": "={{ $json.mimeType }}",
                  "rightValue": "audio",
                  "operator": {
                    "type": "string",
                    "operation": "contains"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "id": "8c994433-c512-4ac2-82eb-0e1efe9c2b96",
          "name": "Audio prÃ¼fen",
          "type": "n8n-nodes-base.if",
          "typeVersion": 2,
          "position": [
            1504,
            512
          ]
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "set-audio-type",
                  "name": "fileCategory",
                  "value": "audio",
                  "type": "string"
                },
                {
                  "id": "set-audio-processing",
                  "name": "readyForProcessing",
                  "value": true,
                  "type": "boolean"
                }
              ]
            },
            "options": {}
          },
          "id": "f8555d50-6049-43be-bf42-e71de92ea56b",
          "name": "Als Audio markieren",
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.3,
          "position": [
            1728,
            416
          ]
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "set-other-type",
                  "name": "fileCategory",
                  "value": "document",
                  "type": "string"
                },
                {
                  "id": "set-other-processing",
                  "name": "readyForProcessing",
                  "value": true,
                  "type": "boolean"
                }
              ]
            },
            "options": {}
          },
          "id": "1431379b-bde1-4503-8910-7537d0c175ed",
          "name": "Als Dokument markieren",
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.3,
          "position": [
            1728,
            608
          ]
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "set-text-type",
                  "name": "messageCategory",
                  "value": "text",
                  "type": "string"
                },
                {
                  "id": "set-text-processing",
                  "name": "readyForProcessing",
                  "value": true,
                  "type": "boolean"
                }
              ]
            },
            "options": {}
          },
          "id": "bfb33d94-a743-4bcb-81fc-3d68c363dd87",
          "name": "Als Text markieren",
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.3,
          "position": [
            1728,
            224
          ]
        },
        {
          "parameters": {
            "mode": "combine",
            "options": {}
          },
          "id": "09c1e391-3020-4d56-ad56-bb9115f5cd36",
          "name": "Daten zusammenfÃ¼hren",
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3,
          "position": [
            1952,
            320
          ]
        },
        {
          "parameters": {
            "content": "=ðŸŽ¯ VERARBEITUNGSPUNKT\n\nHier kÃ¶nnen Sie eigene Logik einfÃ¼gen:\n- Nachrichten an andere APIs senden\n- Dateien speichern (Google Drive, Dropbox, etc.)\n- KI-Verarbeitung (OpenAI, Claude, etc.)\n- Datenbank-Operationen\n- E-Mail-Benachrichtigungen\n\nVerfÃ¼gbare Daten:\n- $json.messageCategory / $json.fileCategory\n- $json.text (fÃ¼r Textnachrichten)\n- $json.fileData (Binary-Daten fÃ¼r Dateien)\n- $json.from, $json.to, $json.messageId\n- $json.fileName, $json.mimeType",
            "height": 539,
            "width": 393
          },
          "id": "7031963c-c30d-401b-8993-3da5d280cdec",
          "name": "Info: Verarbeitungspunkt",
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            1915.5,
            -59
          ]
        },
        {
          "parameters": {
            "jsCode": "// Beispiel: Nachrichtenverarbeitung\n// Hier kÃ¶nnen Sie eigene Logik implementieren\n\nconst item = $input.item.json;\n\n// Log fÃ¼r Debugging\nconsole.log('Verarbeite Nachricht:', {\n  type: item.messageCategory || item.fileCategory,\n  from: item.from,\n  hasFile: item.hasFile\n});\n\n// Beispiel-Verarbeitung\nlet processing_result = {\n  status: 'processed',\n  processedAt: new Date().toISOString(),\n  summary: ''\n};\n\nif (item.text) {\n  processing_result.summary = `Textnachricht empfangen: ${item.text.substring(0, 50)}...`;\n} else if (item.hasFile) {\n  processing_result.summary = `Datei empfangen: ${item.fileName} (${item.mimeType})`;\n}\n\nreturn {\n  json: {\n    ...item,\n    processing: processing_result\n  },\n  binary: $input.item.binary\n};"
          },
          "id": "038186a9-de04-4f92-91cc-bf8b86bfa984",
          "name": "Nachricht verarbeiten",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            2176,
            320
          ]
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://msgapi.threema.ch/send_simple",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "from",
                  "value": "={{ $json.to }}"
                },
                {
                  "name": "to",
                  "value": "={{ $json.from }}"
                },
                {
                  "name": "text",
                  "value": "=âœ… Ihre Nachricht wurde erfolgreich empfangen und verarbeitet.\\n\\nZusammenfassung: {{ $json.processing.summary }}"
                }
              ]
            },
            "options": {}
          },
          "id": "3742a5b2-8646-4984-915f-edbc837e0ef4",
          "name": "BestÃ¤tigung senden",
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            2400,
            320
          ],
          "credentials": {
            "httpHeaderAuth": {
              "id": "4gc7MePUZVuCyowB",
              "name": "Header Auth account"
            }
          }
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={ \"status\": \"success\", \"message\": \"Nachricht verarbeitet\", \"messageId\": \"{{ $json.messageId }}\" }",
            "options": {}
          },
          "id": "7fa04e2c-4a08-45c3-bbfa-db7c9c8363da",
          "name": "Webhook Response",
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.1,
          "position": [
            2624,
            320
          ]
        },
        {
          "parameters": {
            "content": "=ðŸ“‹ WORKFLOW ÃœBERSICHT\n\nDieser Workflow verarbeitet alle Threema Gateway Nachrichten:\n\nâœ… UnterstÃ¼tzte Nachrichtentypen:\n- Text\n- Bilder\n- Audio-Dateien\n- Video-Dateien\n- Dokumente/Dateien\n\nðŸ”§ Workflow-Schritte:\n1. Webhook empfÃ¤ngt Nachricht\n2. Daten werden geparst\n3. Dateien werden heruntergeladen (falls vorhanden)\n4. Dateityp wird erkannt\n5. Verarbeitung erfolgt\n6. BestÃ¤tigung an Sender\n7. HTTP Response an Threema\n\nâš™ï¸ Konfiguration erforderlich:\n- Threema Gateway API Credentials\n- Webhook-URL in Threema konfigurieren",
            "height": 654,
            "width": 361,
            "color": 5
          },
          "id": "79915eb8-4426-469d-8a83-cea10faa5036",
          "name": "Info: Workflow Ãœbersicht",
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -176,
            0
          ]
        },
        {
          "parameters": {
            "content": "=âš ï¸ FEHLERBEHANDLUNG\n\nBei Fehlern:\n- Workflow fÃ¤hrt fort (continueOnFail)\n- Fehler werden geloggt\n- Alternativer Pfad wird ausgefÃ¼hrt\n\nOptional:\n- E-Mail-Benachrichtigung bei Fehler\n- Logging in externe Systeme\n- Retry-Mechanismen",
            "height": 331,
            "width": 289,
            "color": 6
          },
          "id": "efbc8818-593c-4200-a712-061e3ab804d1",
          "name": "Info: Fehlerbehandlung",
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            2288,
            -128
          ]
        },
        {
          "parameters": {
            "jsCode": "// E2E-EntschlÃ¼sselung fÃ¼r Threema Gateway\n// WICHTIG: Hier Deine Credentials eintragen!\n\nconst GATEWAY_ID = '*BERENT2';\nconst GATEWAY_SECRET = 'DEIN_SECRET_HIER_EINTRAGEN'; // Kommt nach Freigabe\nconst PRIVATE_KEY = 'DEIN_64_ZEICHEN_PRIVATE_KEY_HIER'; // Aus dem Generator-Tool\n\n// Importiere crypto fÃ¼r EntschlÃ¼sselung\nconst crypto = require('crypto');\nconst nacl = require('tweetnacl');\n\n// Hole Webhook-Daten\nconst webhookData = $input.item.json;\n\n// Extrahiere verschlÃ¼sselte Box und Nonce\nconst from = webhookData.from;\nconst to = webhookData.to;\nconst messageId = webhookData.messageId;\nconst date = webhookData.date;\nconst nonce = webhookData.nonce; // 24 Bytes, hex-encoded\nconst box = webhookData.box; // VerschlÃ¼sselte Nachricht, hex-encoded\n\n// Konvertiere Hex zu Uint8Array\nfunction hexToUint8Array(hex) {\n  const bytes = new Uint8Array(hex.length / 2);\n  for (let i = 0; i < hex.length; i += 2) {\n    bytes[i / 2] = parseInt(hex.substr(i, 2), 16);\n  }\n  return bytes;\n}\n\n// Hole Public Key des Absenders von Threema\n// TODO: Muss von Threema API geholt werden\n// const senderPublicKey = await getSenderPublicKey(from);\n\n// FÃ¼r jetzt: Platzhalter (muss spÃ¤ter implementiert werden)\nconsole.log('E2E EntschlÃ¼sselung - noch nicht vollstÃ¤ndig implementiert');\nconsole.log('From:', from, 'To:', to, 'MessageId:', messageId);\n\n// Gebe erstmal die rohen Daten weiter\nreturn {\n  json: {\n    from: from,\n    to: to,\n    messageId: messageId,\n    date: date,\n    nonce: nonce,\n    box: box,\n    decrypted: false, // Flag: noch nicht entschlÃ¼sselt\n    rawData: webhookData\n  }\n};"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            384,
            128
          ],
          "id": "b84200df-d024-4793-bd54-ca7a143d2339",
          "name": "E2E EntschlÃ¼sseln"
        },
        {
          "parameters": {
            "content": "âš ï¸ E2E-MODUS - TODO\n\nNoch zu erledigen:\n1. Nach Freigabe: SECRET eintragen\n2. Private Key im Code eintragen\n3. Public Key Lookup implementieren\n4. VollstÃ¤ndige EntschlÃ¼sselung aktivieren\n5. Nachricht senden mit E2E verschlÃ¼sseln\n\nStatus: Vorbereitet, wartet auf *BERENT2 Freigabe",
            "height": 384,
            "width": 416,
            "color": 3
          },
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            336,
            -96
          ],
          "typeVersion": 1,
          "id": "6a4827d9-8a7e-45fa-86d7-d7298c0504e9",
          "name": "Sticky Note"
        }
      ],
      "connections": {
        "Threema Gateway Webhook": {
          "main": [
            [
              {
                "node": "E2E EntschlÃ¼sseln",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Parse Webhook Daten": {
          "main": [
            [
              {
                "node": "Hat Datei?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Hat Datei?": {
          "main": [
            [
              {
                "node": "Datei herunterladen",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Als Text markieren",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Datei herunterladen": {
          "main": [
            [
              {
                "node": "Datei verarbeiten",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Datei verarbeiten": {
          "main": [
            [
              {
                "node": "Dateityp prÃ¼fen",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Dateityp prÃ¼fen": {
          "main": [
            [
              {
                "node": "Als Bild markieren",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Als Bild markieren": {
          "main": [
            [
              {
                "node": "Daten zusammenfÃ¼hren",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Audio prÃ¼fen": {
          "main": [
            [
              {
                "node": "Als Audio markieren",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Als Dokument markieren",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Als Audio markieren": {
          "main": [
            [
              {
                "node": "Daten zusammenfÃ¼hren",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Als Dokument markieren": {
          "main": [
            [
              {
                "node": "Daten zusammenfÃ¼hren",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Als Text markieren": {
          "main": [
            [
              {
                "node": "Daten zusammenfÃ¼hren",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Daten zusammenfÃ¼hren": {
          "main": [
            [
              {
                "node": "Nachricht verarbeiten",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Nachricht verarbeiten": {
          "main": [
            [
              {
                "node": "BestÃ¤tigung senden",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "BestÃ¤tigung senden": {
          "main": [
            [
              {
                "node": "Webhook Response",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "E2E EntschlÃ¼sseln": {
          "main": [
            [
              {
                "node": "Parse Webhook Daten",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": null,
      "pinData": {},
      "versionId": "0ef0eedb-f8df-423f-ac4b-4a0401ffbeb2",
      "activeVersionId": null,
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-11-06T20:35:24.128Z",
          "createdAt": "2025-11-06T20:35:24.128Z",
          "role": "workflow:owner",
          "workflowId": "hR36jIx0wREZK0Bf",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": null,
      "tags": [
        {
          "updatedAt": "2025-11-06T20:35:10.952Z",
          "createdAt": "2025-11-06T20:35:10.952Z",
          "id": "1XDySxVCWynR8Twd",
          "name": "threema"
        },
        {
          "updatedAt": "2025-11-06T20:35:10.956Z",
          "createdAt": "2025-11-06T20:35:10.956Z",
          "id": "nKGGZ6FxgEmmFhE2",
          "name": "gateway"
        }
      ]
    },
    {
      "updatedAt": "2025-12-09T06:09:21.164Z",
      "createdAt": "2025-12-09T06:09:21.164Z",
      "id": "kgTzmuCqtvJrv16s",
      "name": "fonio AGS Nachbearbeitung Transkript 20251209",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "b0b43139-5430-4d07-81e9-f0dbbf11aea7",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -352,
            -256
          ],
          "id": "1d611d6c-3010-4803-a34d-2d38ee70ab77",
          "name": "Webhook",
          "webhookId": "b0b43139-5430-4d07-81e9-f0dbbf11aea7"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "011ef203-63fd-49f7-ae0d-4ed7318ad11f",
                  "name": "headers.host",
                  "value": "={{ $json.headers.host }}",
                  "type": "string"
                },
                {
                  "id": "04f27e3e-ebed-4ae5-a22f-23d0f7c61904",
                  "name": "body[0].body.formattedTranscript",
                  "value": "={{ $json.body[0].body.formattedTranscript }}",
                  "type": "string"
                },
                {
                  "id": "017777fc-53d7-473d-b3c8-09a32e601385",
                  "name": "body[0].body.fromNumber",
                  "value": "={{ $json.body[0].body.fromNumber }}",
                  "type": "string"
                },
                {
                  "id": "882e8a05-a492-4445-bb4a-1856bfb586a1",
                  "name": "body[0].body.context.anrufer_name",
                  "value": "={{ $json.body[0].body.context.anrufer_name }}",
                  "type": "string"
                },
                {
                  "id": "a6508b49-d751-49d7-b40c-c91be52f5839",
                  "name": "body[0].body.context.einrichtung_typ",
                  "value": "={{ $json.body[0].body.context.einrichtung_typ }}",
                  "type": "string"
                },
                {
                  "id": "08190377-3019-449b-9374-494e642c5125",
                  "name": "body[0].body.context.einrichtung_name",
                  "value": "={{ $json.body[0].body.context.einrichtung_name }}",
                  "type": "string"
                },
                {
                  "id": "58740a6d-b29d-48ca-b2a3-fc14e3dedaeb",
                  "name": "body[0].body.context.technisch",
                  "value": "={{ $json.body[0].body.context.technisch }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -128,
            -352
          ],
          "id": "630b558f-aba7-44e2-b570-182c9b18a269",
          "name": "Daten extrahieren"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=FÃ¼hre die Klassifikation durch.",
            "hasOutputParser": true,
            "options": {
              "systemMessage": "=DU BIST EIN HOCHSPEZIALISIERTER KLASSIFIKATIONS-AGENT FÃœR IT-HOTLINE-TRANSKRIPTE.\n\n###DEINE HAUPTAUFGABE###\nAnalysiere Telefon-Transkripte und ordne sie prÃ¤zise in eine Dringlichkeitskategorie (A, B, C oder D) ein, basierend auf den Kriterien aus der bereitgestellten Wissensdatenbank. Deine Klassifikation ermÃ¶glicht Technikern eine zielgerichtete, priorisierte Bearbeitung.\n\n---\n\n###VERFÃœGBARE DATEN###\n\n**DRINGLICHKEITSKRITERIEN (aus Google Sheet):**\n{{ $input.all().slice(1).map(item => \n`Kategorie ${item.json.Dringlichkeit}: ${item.json.Kategorie}\nSchlÃ¼sselworte: ${item.json.Schlagworte}\nBeispiele: ${item.json.Beispiele}`\n).join('\\n\\n') }}\n\n**ZU ANALYSIERENDES TRANSKRIPT:**\n{{ $json.body[0].body.formattedTranscript }}\n\n**ANRUFERDATEN:**\n- Name: {{ $json.body[0].body.context.anrufer_name }}\n- Von: {{ $json.body[0].body.fromNumber }}\n- Einrichtung: {{ $json.body[0].body.context.einrichtung_name }}\n\n---\n\n###ANALYSE-METHODIK (CHAIN OF THOUGHTS)###\n\n1. **UNDERSTAND**\n   - Lies das Transkript grÃ¼ndlich und identifiziere das konkrete technische Problem\n   - Erkenne die Auswirkungen: ProduktivitÃ¤tsausfall, Datenverlust, Eskalation, GeschÃ¤ftskritikalitÃ¤t\n\n2. **IDENTIFY KEY SIGNALS**\n   - SchlÃ¼sselbegriffe fÃ¼r hohe Dringlichkeit: \"nicht arbeitsfÃ¤hig\", \"Produktion steht\", \"Kunde wartet\", \"dringend\", \"sofort\"\n   - SchlÃ¼sselbegriffe fÃ¼r niedrige Dringlichkeit: \"nicht eilig\", \"wenn Zeit ist\", \"Informationsfrage\", \"optional\"\n\n3. **ASSESS IMPACT**\n   - Ist ein geschÃ¤ftskritischer Prozess blockiert?\n   - Sind mehrere Nutzer betroffen?\n   - Gibt es Fristen oder SLA-relevante Zeitpunkte?\n   - Handelt es sich um einen Standardvorgang oder eine Informationsanfrage?\n\n4. **MATCH WITH CRITERIA**\n   - Vergleiche die erkannten Merkmale mit den Referenzbeispielen aus dem Google Sheet\n   - WÃ¤hle die Kategorie, die der Fallbeschreibung AM NÃ„CHSTEN kommt\n\n5. **HANDLE EDGE CASES**\n   - Bei unklaren oder widersprÃ¼chlichen Transkripten: WÃ¤hle die konservativere (hÃ¶here) Kategorie\n   - Weise explizit auf Unsicherheiten hin\n\n---\n\n###AUSGABEFORMAT###\n\nGib deine Analyse im folgenden JSON-Format zurÃ¼ck:\n```json\n{\n  \"Dringlichkeit\": \"B\",\n  \"Kategorie\": \"Dringend\",\n  \"Problemtyp\": \"Technisch\",\n  \"Themenstichwort\": \"Server-Ausfall\",\n  \"Beschreibung\": [\n    \"Mehrere Mitarbeiter betroffen (Buchhaltung)\",\n    \"Datenbankverbindung unterbrochen seit 8 Uhr\",\n    \"Fehlende Rechnungen der letzten 2 Wochen\",\n    \"Zeitkritisch: Jahresabschluss-Termin in 2 Stunden\"\n  ],\n  \"AnsprechpartnerBleibt\": true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\n  \"AnsprechpartnerName\": \"Frau Weber\",\n  \"RueckrufnummerAnders\": true = andere RÃ¼ckrufnummer gewÃ¼nscht, false = unter anrufender Nummer zurÃ¼ckrufen\n  \"Rueckrufnummer\": Die vom Anrufer genannte RÃ¼ckrufnummer (mit Durchwahl falls vorhanden)\n  \"BegrÃ¼ndung\": \"Der Kunde ist grundsÃ¤tzlich arbeitsfÃ¤hig, jedoch blockiert ein IT-Fehler einen zeitkritischen GeschÃ¤ftsprozess. Entspricht den Beispielen fÃ¼r Kategorie B im Sheet.\"\n}\n```\n\n**WICHTIG: Feldbeschreibungen** \n- Die Dringlichkeit MUSS ein einzelner Buchstabe sein: A, B, C oder D, entsprechend der MÃ¶glichkeiten im Google Sheet\n- Die Kategorie MUSS sich auf die entsprechende Spalte im Google Sheet beziehen\n- Problemtyp: Klassifiziere in GENAU EINE dieser Kategorien:\n  â€¢ \"Technisch\" = Hardware-Probleme, NetzwerkausfÃ¤lle, GerÃ¤tedefekte, Server-AusfÃ¤lle\n  â€¢ \"Software\" = Programmfehler, Anmeldeprobleme, SoftwarestÃ¶rungen, Datenbankprobleme\n  â€¢ \"Anliegen\" = Informationsanfragen, Beratung, allgemeine Fragen ohne akutes technisches Problem\n- Themenstichwort: Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z. B. \"SAP-Login\", \"E-Mail-Sync\", \"Drucker-WLAN\")\n- Beschreibung: Array mit 3-6 Stichpunkten, die wichtigsten Informationen zuerst:\n  â€¢ Betroffene Personen/Systeme\n  â€¢ Zeitpunkt des Auftretens\n  â€¢ Konkrete Symptome/Fehler\n  â€¢ GeschÃ¤ftliche Auswirkungen\n  â€¢ Fristen/Zeitdruck\n  â€¢ Bereits versuchte LÃ¶sungen\n- AnsprechpartnerBleibt: true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\n- AnsprechpartnerName: Name des Ansprechpartners (falls abweichend vom Anrufer, sonst leer lassen)\n- AnsprechpartnerTelefon: Telefonnummer des Ansprechpartners (falls abweichend, sonst leer lassen)\n- RueckrufnummerAnders: true = andere RÃ¼ckrufnummer als anrufende Nummer, false = unter anrufender Nummer zurÃ¼ckrufen\n- Rueckrufnummer: Die RÃ¼ckrufnummer (kann identisch mit AnsprechpartnerTelefon sein)\n- Die BegrÃ¼ndung MUSS sich auf die Kriterien im Google Sheet beziehen\n- Halte dich strikt an das JSON-Format\n\n---\n\n###WAS NICHT ZU TUN IST###\n\nNIEMALS Kategorien ohne Bezug zum Google Sheet festlegen\nVERMEIDE vage BegrÃ¼ndungen wie \"klingt dringend\" oder \"scheint wichtig\"\nNICHT nur nach einzelnen SchlÃ¼sselworten klassifizieren â€“ analysiere die Gesamtsituation\nNIEMALS Aussagen erfinden, die nicht im Transkript stehen\nNICHT Ã¼berkategorisieren: Unzufriedenheit allein rechtfertigt keine Kategorie A\nIGNORIERE NIEMALS Hinweise auf Systemrelevanz, Produktionsstopp oder geschÃ¤ftskritische Prozesse\n\n---\n\n###FEW-SHOT BEISPIELE###\n\n**Beispiel 1 - Kategorie A:**\nTranskript: \"Ich kann mich nicht mehr in SAP anmelden, wir mÃ¼ssen heute unbedingt die Monatsabrechnung machen.\"\nAusgabe:\n```json\n{\n  \"Dringlichkeit\": \"A\",\n  \"Kategorie\": \"Notfall\",\n  \"Problemtyp\": \"Software\",\n  \"Themenstichwort\": \"Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')\",\n  \"BegrÃ¼ndung\": \"GeschÃ¤ftskritischer Prozess (Monatsabrechnung) ist komplett blockiert. Entspricht den ReferenzfÃ¤llen fÃ¼r Kategorie A im Sheet.\"\n}\n```\n\n**Beispiel 2 - Kategorie D:**\nTranskript: \"Ich wollte nur fragen, ob man den Drucker auch Ã¼ber WLAN verbinden kann â€“ ist aber nicht eilig.\"\nAusgabe:\n```json\n{\n  \"Dringlichkeit\": \"D\",\n  \"Kategorie\": \"Informativ\",\n  \"Problemtyp\": \"Technisch\",\n  \"Themenstichwort\": \"Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')\",\n  \"BegrÃ¼ndung\": \"Informationsanfrage ohne Zeitdruck, kein akuter Vorfall. Entspricht klar Kategorie D im Sheet.\"\n}\n```\n\n**Beispiel 3 - Kategorie B:**\nTranskript: \"Mein Outlook synchronisiert nicht mehr. Ich kann arbeiten, aber wichtige E-Mails von Kunden kommen nicht an.\"\nAusgabe:\n```json\n{\n  \"Dringlichkeit\": \"B\",\n  \"Kategorie\": \"Dringend\",\n  \"Problemtyp\": \"Technisch\",\n  \"Themenstichwort\": \"Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')\",\n  \"BegrÃ¼ndung\": \"EingeschrÃ¤nkte ArbeitsfÃ¤higkeit bei einem wichtigen Kommunikationskanal. Keine komplette Blockade, aber geschÃ¤ftsrelevant. Entspricht Kategorie B.\"\n}\n```"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 3,
          "position": [
            1120,
            -256
          ],
          "id": "fbf04100-561c-4a05-aec9-f0004af32a15",
          "name": "AI Agent",
          "executeOnce": true
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "claude-3-5-haiku-20241022",
              "mode": "list",
              "cachedResultName": "Claude Haiku 3.5"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
          "typeVersion": 1.3,
          "position": [
            1192,
            -32
          ],
          "id": "17332de4-274c-498b-9319-babb6caa3b71",
          "name": "Anthropic Chat Model",
          "credentials": {}
        },
        {
          "parameters": {
            "authentication": "serviceAccount",
            "documentId": {
              "__rl": true,
              "value": "1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw",
              "mode": "id"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Dringlichkeiten",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw/edit#gid=0"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -128,
            -160
          ],
          "id": "3595da5a-31be-4f07-b4f0-bfa3e8c20bfa",
          "name": "Dringlichkeitskriterien laden",
          "credentials": {}
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            96,
            -256
          ],
          "id": "5c0c2b31-f530-4c21-931b-3f39b9fa0182",
          "name": "Merge"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "ba4494fd-87dc-44a3-be07-3c1e3b0b0f04",
                  "name": "Dringlichkeit",
                  "value": "={{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).Dringlichkeit }}",
                  "type": "string"
                },
                {
                  "id": "77fc8f1e-1ef1-4c82-a4c9-1badefb579a4",
                  "name": "problemtyp",
                  "value": "={{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).Problemtyp }}",
                  "type": "string"
                },
                {
                  "id": "ea4dea35-112a-47b3-86c9-3252d606adda",
                  "name": "betreff",
                  "value": "={{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).Kategorie }} | {{ $('Merge').item.json.body[0].body.context.einrichtung_name }}, {{ $('Merge').item.json.body[0].body.context.anrufer_name }} | {{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).Themenstichwort }}",
                  "type": "string"
                },
                {
                  "id": "123c771e-c991-4bb9-8860-c5c030773741",
                  "name": "emailBody",
                  "value": "=<h3>Problemtyp: {{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).Problemtyp }}</h3>\n\n<h3>KI-EinschÃ¤tzung</h3>\n<ul>\n  <li><strong>Einrichtung:</strong> {{ $('Merge').item.json.body[0].body.context.einrichtung_name }}</li>\n  <li><strong>Anrufer:</strong> {{ $('Merge').item.json.body[0].body.context.anrufer_name }} ({{ $('Merge').item.json.body[0].body.fromNumber }})</li>\n  <li><strong>Ansprechpartner:</strong> \n    {{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).AnsprechpartnerBleibt ? 'Anrufer bleibt Ansprechpartner' : JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).AnsprechpartnerName + ' (' + JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).AnsprechpartnerTelefon + ')' }}\n  </li>\n  <li><strong>RÃ¼ckrufnummer:</strong> \n    {{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).RueckrufnummerAnders ? JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).Rueckrufnummer : $('Merge').item.json.body[0].body.fromNumber }}\n  </li>\n  <li><strong>Thema:</strong> {{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).Themenstichwort }}</li>\n  <li><strong>Beschreibung:</strong>\n    <ul>\n      {{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).Beschreibung.map(punkt => `<li>${punkt}</li>`).join('') }}\n    </ul>\n  </li>\n</ul>\n\n<h3>BegrÃ¼ndung der Dringlichkeitseinstufung</h3>\n<p>{{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).BegrÃ¼ndung }}</p>\n\n<h3>VollstÃ¤ndiges Transkript</h3>\n{{ $('Merge').item.json.body[0].body.formattedTranscript.replace(/\\n/g, '<br>') }}\n</pre>",
                  "type": "string"
                },
                {
                  "id": "abbab201-31d0-4200-8c7e-5b3d2c1b1dc7",
                  "name": "themenstichwort",
                  "value": "={{ JSON.parse($json.output.match(/\\{[\\s\\S]*\\}/)[0]).Themenstichwort }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1472,
            -256
          ],
          "id": "af898f46-2fdd-4db5-b40b-73cec7035f04",
          "name": "E-Mail vorbereiten"
        },
        {
          "parameters": {
            "fromEmail": "office@berent.ai",
            "toEmail": "office@berent.ai",
            "subject": "={{ $json.betreff }}",
            "html": "={{ $json.emailBody }}",
            "options": {},
            "path": "42244bb9-541a-4ed2-9583-1ee2f6c4a7bc"
          },
          "type": "n8n-nodes-base.emailSend",
          "typeVersion": 2.1,
          "position": [
            1696,
            -256
          ],
          "id": "733b372a-527e-4041-a5c0-20ac986e0811",
          "name": "Send email",
          "webhookId": "42244bb9-541a-4ed2-9583-1ee2f6c4a7bc",
          "credentials": {}
        },
        {
          "parameters": {
            "model": "mistral-small-latest",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatMistralCloud",
          "typeVersion": 1,
          "position": [
            392,
            -32
          ],
          "id": "8ab55f10-46d8-44ed-a791-b794167a4a50",
          "name": "Mistral Cloud Chat Model",
          "credentials": {}
        },
        {
          "parameters": {
            "operation": "sanitize",
            "text": "={{ $json.headers.host }}",
            "guardrails": {
              "urls": {
                "value": {
                  "allowedUrls": "n8n.srv1098810.hstgr.cloud",
                  "allowedSchemes": [
                    "https",
                    "http"
                  ],
                  "blockUserinfo": false,
                  "allowSubdomains": "={{ true }}"
                }
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.guardrails",
          "typeVersion": 1,
          "position": [
            320,
            -256
          ],
          "id": "9b8ba408-c334-4ab2-985c-dad1beb17ada",
          "name": "URI-PrÃ¼fung",
          "executeOnce": true,
          "alwaysOutputData": false
        },
        {
          "parameters": {
            "operation": "sanitize",
            "text": "={{ $('Merge').item.json.body[0].body.formattedTranscript }}",
            "guardrails": {
              "pii": {
                "value": {
                  "type": "all"
                }
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.guardrails",
          "typeVersion": 1,
          "position": [
            896,
            -256
          ],
          "id": "6107392f-2e12-4332-a538-0e29df48b5d9",
          "name": "Daten anonymisieren"
        },
        {
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "// PII-Anonymisierung - KORREKTER Pfad zu den Daten\nconst item = $input.item;\n\n// Extrahiere Transkript aus der INPUT-Struktur\nlet text = item.json.body?.[0]?.body?.formattedTranscript || '';\n\n// Fallback falls kein Text\nif (!text || text.trim() === '') {\n  return item; // Gib Original unverÃ¤ndert zurÃ¼ck\n}\n\n// Speichere Original\nconst originalText = text;\n\n// === ANONYMISIERUNG ===\n\n// 1. NAMEN\ntext = text\n  .replace(/\\b(Guten\\s+Tag|Hallo|Hi|Servus)\\s+([A-ZÃ„Ã–Ãœ][a-zÃ¤Ã¶Ã¼ÃŸ]+)\\b/gi, '$1 [NAME]')\n  .replace(/\\b([A-ZÃ„Ã–Ãœ][a-zÃ¤Ã¶Ã¼ÃŸ]+)\\s+([A-ZÃ„Ã–Ãœ][a-zÃ¤Ã¶Ã¼ÃŸ]+)\\b/g, '[NAME]')\n  .replace(/\\b([A-ZÃ„Ã–Ãœ][a-zÃ¤Ã¶Ã¼ÃŸ]{2,})\\b/g, (match) => {\n    const skip = ['Problem', 'Rechnung', 'Daten', 'Morgen', 'Willkommen', \n                  'Vielen', 'Dank', 'Deutschland', 'Verstehe', 'Bitte', \n                  'Dieser', 'Anruf', 'MÃ¶chten', 'Detail', 'Einrichtung'];\n    return skip.includes(match) ? match : '[NAME]';\n  });\n\n// 2. EMAIL\ntext = text.replace(/\\b[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}\\b/g, '[EMAIL]');\n\n// 3. TELEFON\ntext = text\n  .replace(/\\+49\\s?\\d{2,5}\\s?\\d{3,10}/g, '[TELEFON]')\n  .replace(/\\b0\\d{2,5}[\\s\\/-]?\\d{3,10}\\b/g, '[TELEFON]');\n\n// 4. FIRMEN (AGS etc.)\ntext = text.replace(/\\b(AGS|[A-Z]{2,5})\\b/g, '[FIRMA]');\n\n// === OUTPUT ===\nreturn {\n  json: {\n    ...item.json,\n    body: [{\n      ...item.json.body[0],\n      body: {\n        ...item.json.body[0].body,\n        formattedTranscript: text,\n        originalTranscript: originalText,\n        anonymizationApplied: true,\n        anonymizationTimestamp: new Date().toISOString()\n      }\n    }]\n  }\n};"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            672,
            -256
          ],
          "id": "fb2f8c36-1644-44b9-8af1-923cc103ee64",
          "name": "PII Anonymisierung (Regex)"
        }
      ],
      "connections": {
        "Webhook": {
          "main": [
            [
              {
                "node": "Daten extrahieren",
                "type": "main",
                "index": 0
              },
              {
                "node": "Dringlichkeitskriterien laden",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Daten extrahieren": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Anthropic Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Dringlichkeitskriterien laden": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "URI-PrÃ¼fung",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent": {
          "main": [
            [
              {
                "node": "E-Mail vorbereiten",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "E-Mail vorbereiten": {
          "main": [
            [
              {
                "node": "Send email",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Mistral Cloud Chat Model": {
          "ai_languageModel": [
            []
          ]
        },
        "URI-PrÃ¼fung": {
          "main": [
            [
              {
                "node": "PII Anonymisierung (Regex)",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Daten anonymisieren": {
          "main": [
            []
          ]
        },
        "PII Anonymisierung (Regex)": {
          "main": [
            [
              {
                "node": "Daten anonymisieren",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "0648bf03-5119-4568-ab4c-6deaf8cd1858",
      "activeVersionId": null,
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-12-09T06:09:21.173Z",
          "createdAt": "2025-12-09T06:09:21.173Z",
          "role": "workflow:owner",
          "workflowId": "kgTzmuCqtvJrv16s",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": null,
      "tags": []
    },
    {
      "updatedAt": "2025-11-12T18:31:04.000Z",
      "createdAt": "2025-11-10T13:45:58.896Z",
      "id": "l4uGmA0Wwq72wtts",
      "name": "Fieckscher Feger",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "batchSize": 1,
            "options": {}
          },
          "name": "2. Split In Batches (Prototyp)",
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 1,
          "position": [
            -800,
            80
          ],
          "id": "80c9486a-9931-4c16-89ab-5bd455af3c38"
        },
        {
          "parameters": {
            "jsCode": "// Konfiguration: Preise fÃ¼r Claude Sonnet 4\nconst COST_INPUT_PER_M = 0.003;\nconst COST_OUTPUT_PER_M = 0.015;\n\n// 1. Daten holen\nconst llmRawOutput = $json.output;\nconst splitBatchesData = $('2. Split In Batches (Prototyp)').first().json;\nconst investorId = splitBatchesData.row_number || 1;\nconst investorName = splitBatchesData['Investor Name'] || splitBatchesData.Investor || 'unknown';\n\n// Token-SchÃ¤tzung (falls usage fehlt)\nconst llmOutput = $json.output || '';\nconst inputData = JSON.stringify(splitBatchesData);\nconst estimatedInputTokens = Math.ceil(inputData.length / 4);\nconst estimatedOutputTokens = Math.ceil(llmOutput.length / 4);\n\nconst inputTokens = $json.usage?.input_tokens || estimatedInputTokens;\nconst outputTokens = $json.usage?.output_tokens || estimatedOutputTokens;\n\n// 2. Kosten berechnen\nconst costPerRun = (\n    (inputTokens / 1000000) * COST_INPUT_PER_M) +\n    ((outputTokens / 1000000) * COST_OUTPUT_PER_M\n);\n\nconst costUsd = parseFloat(costPerRun.toFixed(6));\n\n// 3. Markdown-Tabelle parsen\nconst lines = llmRawOutput.split('\\n').filter(line => line.trim().length > 0);\n\nlet tableStartIndex = -1;\nfor (let i = 0; i < lines.length; i++) {\n    if (lines[i].includes('|') && lines[i].includes('Investor')) {\n        tableStartIndex = i;\n        break;\n    }\n}\n\nif (tableStartIndex === -1 || lines.length < tableStartIndex + 3) {\n    return [{ \n        error: 'LLM Output enthÃ¤lt keine gÃ¼ltige Tabelle', \n        raw_output: llmRawOutput,\n        investor_id: investorId,\n        investor_name: investorName\n    }];\n}\n\nconst dataLines = lines.slice(tableStartIndex + 2); \nconst parsedResults = [];\n\nfor (const line of dataLines) {\n    if (!line.includes('|')) continue;\n    \n    const columns = line.split('|').slice(1, -1).map(col => col.trim()); \n\n    if (columns.length === 7) {\n        let score_numeric = null;\n        let source_factor_numeric = null;\n\n        if (columns[2].length > 0) {\n            score_numeric = parseFloat(columns[2].replace(',', '.'));\n        }\n        if (columns[5].length > 0) {\n            source_factor_numeric = parseFloat(columns[5].replace(',', '.'));\n        }\n        \n        parsedResults.push({\n            investor_id: investorId,\n            investor_name: investorName,\n            llm_cost_usd: costUsd,\n            raw_markdown_output: llmRawOutput,\n            criterion_name: columns[1],\n            score: score_numeric,\n            source_type: columns[3],\n            source_year: parseInt(columns[4], 10) || null,\n            source_factor: source_factor_numeric,\n            notes: columns[6]\n        });\n    }\n}\n\nreturn parsedResults;"
          },
          "name": "4. Code Node: Validierung & Kostenberechnung",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            224,
            80
          ],
          "id": "c07d5019-475b-4c19-95c9-4dfe721204bd"
        },
        {
          "parameters": {
            "tableId": "fieckscher_feger",
            "dataToSend": "autoMapInputData"
          },
          "name": "5. Supabase: Zwischenspeicher (Log)",
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            448,
            80
          ],
          "id": "e20f1953-c4b7-4556-a872-8a36a35967b7",
          "credentials": {
            "supabaseApi": {
              "id": "JoURD13xiv3CaQyw",
              "name": "Supabase account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "// Node 6: Daten fÃ¼r Excel vorbereiten (mit EUR-Konvertierung)\n\n// EUR/USD Wechselkurs (aktuell ca. 1.10, regelmÃ¤ÃŸig aktualisieren!)\nconst EUR_USD_RATE = 1.10; // 1 USD = 0.91 EUR bei Rate 1.10\n\nconst items = $input.all();\n\n// PrÃ¼fe ob Daten vorhanden sind\nif (!items || items.length === 0) {\n  return [];\n}\n\n// Gruppiere nach Investor\nconst investorGroups = {};\n\nfor (const item of items) {\n  const investorId = item.json.investor_id;\n  const investorName = item.json.investor_name;\n  \n  if (!investorGroups[investorId]) {\n    investorGroups[investorId] = {\n      investor_id: investorId,\n      investor_name: investorName,\n      batch_id: $execution.id, // Execution ID als Batch ID\n      batch_number: 1, // TODO: Dynamisch aus Split In Batches holen\n      llm_cost_usd: item.json.llm_cost_usd || 0,\n      criteria: [],\n      total_score: 0,\n      count_scores: 0\n    };\n  }\n  \n  // Sammle Kriterien\n  investorGroups[investorId].criteria.push({\n    name: item.json.criterion_name,\n    score: item.json.score,\n    source_type: item.json.source_type,\n    source_year: item.json.source_year,\n    source_factor: item.json.source_factor,\n    notes: item.json.notes\n  });\n  \n  // Summiere Scores (nur wenn nicht null)\n  if (item.json.score !== null && item.json.score !== undefined) {\n    investorGroups[investorId].total_score += item.json.score;\n    investorGroups[investorId].count_scores += 1;\n  }\n}\n\n// Erstelle Output fÃ¼r Google Sheet\nconst output = [];\n\nObject.values(investorGroups).forEach(group => {\n  // Berechne Durchschnitts-Score (FIX: als Dezimalzahl!)\n  const avgScore = group.count_scores > 0 \n    ? parseFloat((group.total_score / group.count_scores).toFixed(3))\n    : null;\n  \n  // Kosten in EUR umrechnen\n  const costEUR = group.llm_cost_usd > 0 \n    ? parseFloat((group.llm_cost_usd / EUR_USD_RATE).toFixed(6))\n    : 0;\n  \n  // Erstelle eine Zeile pro Kriterium (fÃ¼r detailliertes Sheet)\n  group.criteria.forEach(criterion => {\n    output.push({\n      'Batch ID': group.batch_id,\n      'Batch Number': group.batch_number,\n      'Investor ID': group.investor_id,\n      'Investor Name': group.investor_name,\n      'Criterion': criterion.name,\n      'Score_0_to_1': criterion.score !== null ? criterion.score : '',\n      'Source_Type': criterion.source_type || '',\n      'Source_Year': criterion.source_year || '',\n      'Source_Factor': criterion.source_factor || '',      \n      'Notes': criterion.notes || '',\n      'Average Score': avgScore, // FIX: Jetzt korrekt als 0.6 statt 600\n      'Cost USD': parseFloat(group.llm_cost_usd.toFixed(6)),\n      'Cost EUR': costEUR, // NEU: Kosten in EUR\n      'Timestamp': new Date().toISOString()\n    });\n  });\n});\n\nreturn output;"
          },
          "name": "6. Code Node: Daten fÃ¼r Excel vorbereiten",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            672,
            80
          ],
          "id": "6c8d20ae-cc76-4cc5-a3ea-0cca1a3ef143"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.manualTrigger",
          "typeVersion": 1,
          "position": [
            -1248,
            80
          ],
          "id": "4bc1d55c-764d-4d2a-9921-60a1eadf53fa",
          "name": "When clicking â€˜Execute workflowâ€™"
        },
        {
          "parameters": {
            "authentication": "serviceAccount",
            "documentId": {
              "__rl": true,
              "value": "1qzXEn21ltsuPGyJ7FAK1q8RGZkCOzpY-QTedDrdy9KA",
              "mode": "id"
            },
            "sheetName": {
              "__rl": true,
              "value": 1558341942,
              "mode": "list",
              "cachedResultName": "Investor_Base",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qzXEn21ltsuPGyJ7FAK1q8RGZkCOzpY-QTedDrdy9KA/edit#gid=1558341942"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -1024,
            80
          ],
          "id": "eee20f3d-af79-4e90-b63e-3312f45979d3",
          "name": "Get row(s) in sheet",
          "credentials": {
            "googleApi": {
              "id": "QfuLctHhI3o7mKAL",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=Bewerte folgenden Investor:\n\nINVESTOR: {{ $json['Investor Name'] }}\n\nRECHERCHE-ERGEBNISSE:\n{{ $json.formatted_research }}\n\nErstelle die Bewertungstabelle (9 Kriterien) mit diesen Informationen.",
            "options": {
              "systemMessage": "<system_prompt>\nDU BIST EIN HOCHSPEZIALISIERTER, AGENTISCHER RESEARCH-BROWSER, TRAINIERT AUF DIE BEWERTUNG VON INVESTOREN FÃœR EIN KLIMATECH-START-UP.\n\n### DEINE MISSION:\nIDENTIFIZIERE UND BEWERTETE POTENTIELLE INVESTOREN FÃœR DIE PLANETEERS GMBH ENTLANG NEUN FEST DEFINIERTER KRITERIEN. GIB AUSSCHLIESSLICH EINE SAUBER FORMATIERTE, MASCHINENLESBARE MARKDOWN-TABELLE AUS â€“ KEINEN BEGLEITTEXT.\n\n---\n\n### HINTERGRUND:\n- **START-UP**: Planeteers GmbH  \n- **TECHNOLOGIE**: Wandelt COâ‚‚ durch beschleunigte Verwitterung mit Kalkstein, Wasser und Luft in Hydrogencarbonat um (Enhanced Weathering / Ocean Alkalinity Enhancement).\n- **STRATEGISCHE FRAGE JEDE BEWERTUNG**: Wie gut passt dieser Investor zu einem Climate-/CDR-/mCDR-orientierten Start-up wie Planeteers?\n\n---\n\n### CHAIN OF THOUGHT\n\n1. **VERSTEHE DEN BEWERTUNGSKONTEXT**: Fokus auf strategischen Fit mit CDR-/Climatetech-/mCDR-Unternehmen im Hardware- und Deep-Tech-Bereich.\n2. **KENNE DIE BEWERTUNGSKRITERIEN**: Bearbeite fÃ¼r jeden Investor **exakt diese 9 Kriterien**:\n   - Climetech / Impact  \n   - Hardware  \n   - Deep Tech  \n   - A-Serie / A-Funding / Growth Stage  \n   - Ocean / Water / CDR / mCDR / CCS / CCUS / OAE / Enhanced Weathering / Point Source COâ‚‚  \n   - Ticket 0,5â€“10 Mio  \n   - Lead / Co-Lead / Follow  \n   - Type Investor (VC, CVC, Family Office, Private, Strategen)  \n   - Portfolio Companies (von Website)\n3. **RECHERCHIERE AKTIV MIT DEN VERFÃœGBAREN TOOLS**:\n   - **SCHRITT 1**: NUTZE ZUERST die Recherche-Tools, um Informationen zu sammeln\n   - **PFLICHT**: FÃ¼hre mindestens 3-5 gezielte Suchen durch:\n     * Suche nach: \"[Investor Name] climate tech investments\"\n     * Suche nach: \"[Investor Name] portfolio companies\"\n     * Suche nach: \"[Investor Name] CDR carbon removal\"\n     * Suche nach der Website des Investors\n     * Suche nach spezifischen Kriterien bei Bedarf\n   - **ZULÃ„SSIGE QUELLEN**: Offizielle Websites, Pressemitteilungen, Newsartikel, Studien, Datenbanken\n   - **TRANSPARENZPFLICHT**: Nur verÃ¶ffentlichte, verifizierte Informationen nutzen\n   - **SCHRITT 2**: Erst NACH der Recherche die Bewertungstabelle erstellen\n\n4. **TRAGE BEWERTUNG FÃœR JEDES KRITERIUM EIN**:\n   - SCORE_0_TO_1:  \n     - `1,0` = stark erfÃ¼llt  \n     - `0,5` = teilweise erfÃ¼llt  \n     - `0` = klar nicht erfÃ¼llt  \n     - leer = keine Info gefunden  \n   - SOURCE_TYPE: Website, Press release, News article, Study, Database, Blog / Interview\n   - SOURCE_YEAR: Jahr der Quelle (z. B. `2023`)\n   - SOURCE_FACTOR:  \n     - `1,0` = PrimÃ¤rquelle, aktuell  \n     - `0,8` = Reputierte SekundÃ¤rquelle < 2 Jahre  \n     - `0,6` = Ã„ltere oder indirekte Quelle  \n     - `0,4` = Schwache Quelle / unklar  \n   - NOTES: 1â€“2 SÃ¤tze inkl. URL der Quelle\n\n---\n\n### AUSGABEPFLICHT:\n\nDU GIBST AUSSCHLIESSLICH FOLGENDE MARKDOWN-TABELLE AUS:\n\n| Investor | Criterion_Name | Score_0_to_1 | Source_Type | Source_Year | Source_Factor | Notes |\n|:---|:---|:---|:---|:---|:---|:---|\n| ... | Climetech / Impact | 1,0 | Website | 2024 | 1,0 | Beispiel-URL mit kurzer BegrÃ¼ndung |\n| ... | Hardware | 0,5 | News article | 2023 | 0,8 | Beispiel-URL mit kurzer BegrÃ¼ndung |\n| ... | ... | ... | ... | ... | ... | ... |\n\nâ†’ DIE TABELLE ENTHÃ„LT PRO INVESTOR **GENAU 9 ZEILEN** (eine pro Kriterium), UND **KEINEN TEXT DARÃœBER ODER DARUNTER**.\n\n---\n\n### WAS DU UNTERLASSEN MUSST\n\n- **KEINE ERKLÃ„RUNGEN**, **KEIN FLIESSTEXT** AUSSERHALB DER TABELLE  \n- **KEINE VERMUTUNGEN** ODER HYPOTHETISCHEN ANNNAHMEN â€” NUR VERIFIZIERTE QUELLEN  \n- **KEINE NICHT-MASCHINENLESBARE FORMATE** (z. B. HTML, CSV, Freitext)  \n- **KEINE ZUSÃ„TZLICHEN SPALTEN** ODER ABWEICHUNGEN IM SPALTENAUFBAU  \n- **KEINE EIGENEN INTERPRETATIONEN** AUSSERHALB DES DEKLARIERTEN RASTERS  \n- **KEIN ZUSAMMENGEFASSTES INVESTOREN-FAZIT ODER SCORE**\n\n</system_prompt>"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 3,
          "position": [
            -128,
            80
          ],
          "id": "0345c7d2-11ad-4198-82f5-e91a1d19f6aa",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "claude-sonnet-4-20250514",
              "mode": "list",
              "cachedResultName": "Claude Sonnet 4"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
          "typeVersion": 1.3,
          "position": [
            -64,
            304
          ],
          "id": "1281ef99-20d5-4922-804f-3daef216d03c",
          "name": "Anthropic Chat Model",
          "credentials": {
            "anthropicApi": {
              "id": "6RlfJdXsmselCNpN",
              "name": "Anthropic account 2"
            }
          }
        },
        {
          "parameters": {
            "authentication": "serviceAccount",
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "1qzXEn21ltsuPGyJ7FAK1q8RGZkCOzpY-QTedDrdy9KA",
              "mode": "id"
            },
            "sheetName": {
              "__rl": true,
              "value": 1944311408,
              "mode": "list",
              "cachedResultName": "Ratings Input",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qzXEn21ltsuPGyJ7FAK1q8RGZkCOzpY-QTedDrdy9KA/edit#gid=1944311408"
            },
            "columns": {
              "mappingMode": "autoMapInputData",
              "value": {},
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Investor",
                  "displayName": "Investor",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Criterion_Name",
                  "displayName": "Criterion_Name",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Score_0_to_1",
                  "displayName": "Score_0_to_1",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Source_Type",
                  "displayName": "Source_Type",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Source_Year",
                  "displayName": "Source_Year",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Source_Factor",
                  "displayName": "Source_Factor",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Notes",
                  "displayName": "Notes",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Batch ID",
                  "displayName": "Batch ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Batch Number",
                  "displayName": "Batch Number",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Investor ID",
                  "displayName": "Investor ID",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Investor Name",
                  "displayName": "Investor Name",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Criterion",
                  "displayName": "Criterion",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Score",
                  "displayName": "Score",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Source Type",
                  "displayName": "Source Type",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Source Year",
                  "displayName": "Source Year",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Source Factor",
                  "displayName": "Source Factor",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Average Score",
                  "displayName": "Average Score",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Cost USD",
                  "displayName": "Cost USD",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Timestamp",
                  "displayName": "Timestamp",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            896,
            80
          ],
          "id": "d03d75a6-011b-480d-a668-dadd2754ef29",
          "name": "Append row in sheet",
          "credentials": {
            "googleApi": {
              "id": "QfuLctHhI3o7mKAL",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "// Multi-Search Tavily Research\nconst TAVILY_API_KEY = \"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\"; // Ersetze mit deinem Key!\n\nconst investorName = $json['Investor Name'];\n\nconst searches = [\n  investorName + ' climate tech investments',\n  investorName + ' CDR carbon removal',\n  investorName + ' portfolio companies',\n  investorName + ' funding series A',\n  investorName + ' investment thesis'\n];\n\nconst searchResults = [];\n\nfor (let i = 0; i < searches.length; i++) {\n  try {\n    const result = await this.helpers.httpRequest({\n      method: 'POST',\n      url: 'https://api.tavily.com/search',\n      body: {\n        api_key: TAVILY_API_KEY,\n        query: searches[i],\n        search_depth: 'advanced',\n        max_results: 3\n      },\n      json: true\n    });\n    \n    searchResults.push({\n      query: searches[i],\n      answer: result.answer || '',\n      results: result.results || []\n    });\n    \n  } catch (error) {\n    searchResults.push({\n      query: searches[i],\n      answer: 'Fehler',\n      results: []\n    });\n  }\n}\n\nreturn {\n  'Investor Name': investorName,\n  'URL': $json.URL,\n  'Investor Type': $json['Investor Type'],\n  'research_data': {\n    searches_performed: searchResults.length,\n    search_results: searchResults\n  }\n};"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -576,
            80
          ],
          "id": "d523c4f7-5c5a-4464-9ab8-fcba29df53f0",
          "name": "3. Multi-Search Tavily Research"
        },
        {
          "parameters": {
            "jsCode": "const researchData = $json.research_data;\nconst searchResults = researchData.search_results;\n\n// Sammle die wichtigsten Insights aus allen Suchen\nlet formattedResearch = '';\n\nfor (let i = 0; i < searchResults.length; i++) {\n  const search = searchResults[i];\n  \n  formattedResearch += '\\n\\n### Suche ' + (i + 1) + ': ' + search.query + '\\n';\n  \n  if (search.answer && search.answer.length > 0) {\n    formattedResearch += 'Antwort: ' + search.answer + '\\n\\n';\n  }\n  \n  // Top 3 Ergebnisse\n  const results = search.results.slice(0, 3);\n  for (let j = 0; j < results.length; j++) {\n    const result = results[j];\n    formattedResearch += (j + 1) + '. ' + result.title + '\\n';\n    formattedResearch += '   URL: ' + result.url + '\\n';\n    formattedResearch += '   ' + result.content.substring(0, 300) + '...\\n\\n';\n  }\n}\n\n// Gebe alle Daten zurÃ¼ck plus formatted research\nreturn {\n  'Investor Name': $json['Investor Name'],\n  'URL': $json.URL,\n  'Investor Type': $json['Investor Type'],\n  'research_data': researchData,\n  'formatted_research': formattedResearch\n};"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -352,
            80
          ],
          "id": "8657df36-496e-4005-a712-575f3a3e895c",
          "name": "3b. Format Research for AI"
        }
      ],
      "connections": {
        "When clicking â€˜Execute workflowâ€™": {
          "main": [
            [
              {
                "node": "Get row(s) in sheet",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "5. Supabase: Zwischenspeicher (Log)": {
          "main": [
            [
              {
                "node": "6. Code Node: Daten fÃ¼r Excel vorbereiten",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Anthropic Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "2. Split In Batches (Prototyp)": {
          "main": [
            [
              {
                "node": "3. Multi-Search Tavily Research",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get row(s) in sheet": {
          "main": [
            [
              {
                "node": "2. Split In Batches (Prototyp)",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent": {
          "main": [
            [
              {
                "node": "4. Code Node: Validierung & Kostenberechnung",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "4. Code Node: Validierung & Kostenberechnung": {
          "main": [
            [
              {
                "node": "5. Supabase: Zwischenspeicher (Log)",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "6. Code Node: Daten fÃ¼r Excel vorbereiten": {
          "main": [
            [
              {
                "node": "Append row in sheet",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "3. Multi-Search Tavily Research": {
          "main": [
            [
              {
                "node": "3b. Format Research for AI",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "3b. Format Research for AI": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "a35a464d-0183-4775-b76b-de7ef1a511ee",
      "activeVersionId": null,
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-11-10T13:45:58.900Z",
          "createdAt": "2025-11-10T13:45:58.900Z",
          "role": "workflow:owner",
          "workflowId": "l4uGmA0Wwq72wtts",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": null,
      "tags": []
    },
    {
      "updatedAt": "2025-12-09T17:10:51.893Z",
      "createdAt": "2025-12-09T17:10:51.893Z",
      "id": "lQCvszSC2kiedNIp",
      "name": "fonio AGS Nachbearbeitung Transkript Version 0.9 20251209 18:10",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "f6174cf8-935f-4d7b-80ea-81bb853856c6",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -352,
            -256
          ],
          "id": "04d5e464-efd5-4d0f-bf0a-e9206e7c2727",
          "name": "Webhook",
          "webhookId": "f6174cf8-935f-4d7b-80ea-81bb853856c6"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "011ef203-63fd-49f7-ae0d-4ed7318ad11f",
                  "name": "headers.host",
                  "value": "={{ $json.headers.host }}",
                  "type": "string"
                },
                {
                  "id": "04f27e3e-ebed-4ae5-a22f-23d0f7c61904",
                  "name": "body[0].body.formattedTranscript",
                  "value": "={{ $json.body[0].body.formattedTranscript }}",
                  "type": "string"
                },
                {
                  "id": "017777fc-53d7-473d-b3c8-09a32e601385",
                  "name": "body[0].body.fromNumber",
                  "value": "={{ $json.body[0].body.fromNumber }}",
                  "type": "string"
                },
                {
                  "id": "882e8a05-a492-4445-bb4a-1856bfb586a1",
                  "name": "body[0].body.context.anrufer_name",
                  "value": "={{ $json.body[0].body.context.anrufer_name }}",
                  "type": "string"
                },
                {
                  "id": "a6508b49-d751-49d7-b40c-c91be52f5839",
                  "name": "body[0].body.context.einrichtung_typ",
                  "value": "={{ $json.body[0].body.context.einrichtung_typ }}",
                  "type": "string"
                },
                {
                  "id": "08190377-3019-449b-9374-494e642c5125",
                  "name": "body[0].body.context.einrichtung_name",
                  "value": "={{ $json.body[0].body.context.einrichtung_name }}",
                  "type": "string"
                },
                {
                  "id": "58740a6d-b29d-48ca-b2a3-fc14e3dedaeb",
                  "name": "body[0].body.context.technisch",
                  "value": "={{ $json.body[0].body.context.technisch }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -128,
            -352
          ],
          "id": "dbb93dd3-6004-4d9d-a8d2-7f2a67a4d9d3",
          "name": "Daten extrahieren"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=FÃ¼hre die Klassifikation durch.",
            "hasOutputParser": true,
            "options": {
              "systemMessage": "=DU BIST EIN HOCHSPEZIALISIERTER KLASSIFIKATIONS-AGENT FÃœR IT-HOTLINE-TRANSKRIPTE.\n\n###DEINE HAUPTAUFGABE###\nAnalysiere Telefon-Transkripte und ordne sie prÃ¤zise in eine Dringlichkeitskategorie (A, B, C oder D) ein, basierend auf den Kriterien aus der bereitgestellten Wissensdatenbank. Deine Klassifikation ermÃ¶glicht Technikern eine zielgerichtete, priorisierte Bearbeitung.\n\n---\n\n###VERFÃœGBARE DATEN###\n\n**DRINGLICHKEITSKRITERIEN (aus Google Sheet):**\n{{ $('Dringlichkeitskriterien laden').all().slice(1).map(item =>\n`Kategorie ${item.json.Dringlichkeit}: ${item.json.Kategorie}\nSchlÃ¼sselworte: ${item.json.Schlagworte}\nBeispiele: ${item.json.Beispiele}`\n).join('\\n\\n') }}\n\n**ZU ANALYSIERENDES TRANSKRIPT:**\n{{ $json.anonymizedText }}\n\n---\n\n###ANALYSE-METHODIK (CHAIN OF THOUGHTS)###\n\n1. **UNDERSTAND**\n   - Lies das Transkript grÃ¼ndlich und identifiziere das konkrete technische Problem\n   - Erkenne die Auswirkungen: ProduktivitÃ¤tsausfall, Datenverlust, Eskalation, GeschÃ¤ftskritikalitÃ¤t\n\n2. **IDENTIFY KEY SIGNALS**\n   - SchlÃ¼sselbegriffe fÃ¼r hohe Dringlichkeit: \"nicht arbeitsfÃ¤hig\", \"Produktion steht\", \"Kunde wartet\", \"dringend\", \"sofort\"\n   - SchlÃ¼sselbegriffe fÃ¼r niedrige Dringlichkeit: \"nicht eilig\", \"wenn Zeit ist\", \"Informationsfrage\", \"optional\"\n\n3. **ASSESS IMPACT**\n   - Ist ein geschÃ¤ftskritischer Prozess blockiert?\n   - Sind mehrere Nutzer betroffen?\n   - Gibt es Fristen oder SLA-relevante Zeitpunkte?\n   - Handelt es sich um einen Standardvorgang oder eine Informationsanfrage?\n\n4. **MATCH WITH CRITERIA**\n   - Vergleiche die erkannten Merkmale mit den Referenzbeispielen aus dem Google Sheet\n   - WÃ¤hle die Kategorie, die der Fallbeschreibung AM NÃ„CHSTEN kommt\n\n5. **HANDLE EDGE CASES**\n   - Bei unklaren oder widersprÃ¼chlichen Transkripten: WÃ¤hle die konservativere (hÃ¶here) Kategorie\n   - Weise explizit auf Unsicherheiten hin\n\n---\n\n###AUSGABEFORMAT###\n\n***WICHTIGER HINWEIS ZUR DATENSCHUTZ-KONFORMITÃ„T***\nDer Text enthÃ¤lt anonymisierte Platzhalter wie [PERSON_1], [PERSON_2].\nWenn du Namen extrahierst (z.B. fÃ¼r \"AnsprechpartnerName\" oder in der \"Beschreibung\"),\nNUTZE AUSSCHLIESSLICH DIESE PLATZHALTER.\nWandle sie NICHT um und erfinde keine Namen.\nBeispiel korrekt: \"AnsprechpartnerName\": \"[PERSON_2]\"\n\nGib deine Analyse im folgenden JSON-Format zurÃ¼ck:\n```json\n{\n  \"Dringlichkeit\": \"B\",\n  \"Kategorie\": \"Dringend\",\n  \"Problemtyp\": \"Technisch\",\n  \"Themenstichwort\": \"Server-Ausfall\",\n  \"Beschreibung\": [\n    \"Mehrere Mitarbeiter betroffen (Buchhaltung)\",\n    \"Datenbankverbindung unterbrochen seit 8 Uhr\",\n    \"Fehlende Rechnungen der letzten 2 Wochen\",\n    \"Zeitkritisch: Jahresabschluss-Termin in 2 Stunden\"\n  ],\n  \"AnsprechpartnerBleibt\": true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\n  \"AnsprechpartnerName\": \"Frau Weber\",\n  \"RueckrufnummerAnders\": true = andere RÃ¼ckrufnummer gewÃ¼nscht, false = unter anrufender Nummer zurÃ¼ckrufen\n  \"Rueckrufnummer\": Die vom Anrufer genannte RÃ¼ckrufnummer (mit Durchwahl falls vorhanden)\n  \"BegrÃ¼ndung\": \"Der Kunde ist grundsÃ¤tzlich arbeitsfÃ¤hig, jedoch blockiert ein IT-Fehler einen zeitkritischen GeschÃ¤ftsprozess. Entspricht den Beispielen fÃ¼r Kategorie B im Sheet.\"\n}\n```\n\n**WICHTIG: Feldbeschreibungen** \n- Die Dringlichkeit MUSS ein einzelner Buchstabe sein: A, B, C oder D, entsprechend der MÃ¶glichkeiten im Google Sheet\n- Die Kategorie MUSS sich auf die entsprechende Spalte im Google Sheet beziehen\n- Problemtyp: Klassifiziere in GENAU EINE dieser Kategorien:\n  â€¢ \"Technisch\" = Hardware-Probleme, NetzwerkausfÃ¤lle, GerÃ¤tedefekte, Server-AusfÃ¤lle\n  â€¢ \"Software\" = Programmfehler, Anmeldeprobleme, SoftwarestÃ¶rungen, Datenbankprobleme\n  â€¢ \"Anliegen\" = Informationsanfragen, Beratung, allgemeine Fragen ohne akutes technisches Problem\n- Themenstichwort: Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z. B. \"SAP-Login\", \"E-Mail-Sync\", \"Drucker-WLAN\")\n- Beschreibung: Array mit 3-6 Stichpunkten, die wichtigsten Informationen zuerst:\n  â€¢ Betroffene Personen/Systeme\n  â€¢ Zeitpunkt des Auftretens\n  â€¢ Konkrete Symptome/Fehler\n  â€¢ GeschÃ¤ftliche Auswirkungen\n  â€¢ Fristen/Zeitdruck\n  â€¢ Bereits versuchte LÃ¶sungen\n- AnsprechpartnerBleibt: true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\n- AnsprechpartnerName: Name des Ansprechpartners (falls abweichend vom Anrufer, sonst leer lassen)\n- AnsprechpartnerTelefon: Telefonnummer des Ansprechpartners (falls abweichend, sonst leer lassen)\n- RueckrufnummerAnders: true = andere RÃ¼ckrufnummer als anrufende Nummer, false = unter anrufender Nummer zurÃ¼ckrufen\n- Rueckrufnummer: Die RÃ¼ckrufnummer (kann identisch mit AnsprechpartnerTelefon sein)\n- Die BegrÃ¼ndung MUSS sich auf die Kriterien im Google Sheet beziehen\n- Halte dich strikt an das JSON-Format\n\n---\n\n###WAS NICHT ZU TUN IST###\n\nNIEMALS Kategorien ohne Bezug zum Google Sheet festlegen\nVERMEIDE vage BegrÃ¼ndungen wie \"klingt dringend\" oder \"scheint wichtig\"\nNICHT nur nach einzelnen SchlÃ¼sselworten klassifizieren â€“ analysiere die Gesamtsituation\nNIEMALS Aussagen erfinden, die nicht im Transkript stehen\nNICHT Ã¼berkategorisieren: Unzufriedenheit allein rechtfertigt keine Kategorie A\nIGNORIERE NIEMALS Hinweise auf Systemrelevanz, Produktionsstopp oder geschÃ¤ftskritische Prozesse\n\n---\n\n###FEW-SHOT BEISPIELE###\n\n**Beispiel 1 - Kategorie A:**\nTranskript: \"Ich kann mich nicht mehr in SAP anmelden, wir mÃ¼ssen heute unbedingt die Monatsabrechnung machen.\"\nAusgabe:\n```json\n{\n  \"Dringlichkeit\": \"A\",\n  \"Kategorie\": \"Notfall\",\n  \"Problemtyp\": \"Software\",\n  \"Themenstichwort\": \"Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')\",\n  \"BegrÃ¼ndung\": \"GeschÃ¤ftskritischer Prozess (Monatsabrechnung) ist komplett blockiert. Entspricht den ReferenzfÃ¤llen fÃ¼r Kategorie A im Sheet.\"\n}\n```\n\n**Beispiel 2 - Kategorie D:**\nTranskript: \"Ich wollte nur fragen, ob man den Drucker auch Ã¼ber WLAN verbinden kann â€“ ist aber nicht eilig.\"\nAusgabe:\n```json\n{\n  \"Dringlichkeit\": \"D\",\n  \"Kategorie\": \"Informativ\",\n  \"Problemtyp\": \"Technisch\",\n  \"Themenstichwort\": \"Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')\",\n  \"BegrÃ¼ndung\": \"Informationsanfrage ohne Zeitdruck, kein akuter Vorfall. Entspricht klar Kategorie D im Sheet.\"\n}\n```\n\n**Beispiel 3 - Kategorie B:**\nTranskript: \"Mein Outlook synchronisiert nicht mehr. Ich kann arbeiten, aber wichtige E-Mails von Kunden kommen nicht an.\"\nAusgabe:\n```json\n{\n  \"Dringlichkeit\": \"B\",\n  \"Kategorie\": \"Dringend\",\n  \"Problemtyp\": \"Technisch\",\n  \"Themenstichwort\": \"Kurze, prÃ¤gnante Beschreibung des Hauptproblems (2-4 WÃ¶rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')\",\n  \"BegrÃ¼ndung\": \"EingeschrÃ¤nkte ArbeitsfÃ¤higkeit bei einem wichtigen Kommunikationskanal. Keine komplette Blockade, aber geschÃ¤ftsrelevant. Entspricht Kategorie B.\"\n}\n```"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 3,
          "position": [
            1168,
            -256
          ],
          "id": "98fe189d-4e23-46a3-bfab-b3149ceb4baa",
          "name": "AI Agent",
          "executeOnce": true
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "claude-3-5-haiku-20241022",
              "mode": "list",
              "cachedResultName": "Claude Haiku 3.5"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
          "typeVersion": 1.3,
          "position": [
            1240,
            -32
          ],
          "id": "41d27bdf-5edc-46ff-8917-3ecaddb89419",
          "name": "Anthropic Chat Model",
          "credentials": {
            "anthropicApi": {
              "id": "6RlfJdXsmselCNpN",
              "name": "Anthropic account 2"
            }
          }
        },
        {
          "parameters": {
            "authentication": "serviceAccount",
            "documentId": {
              "__rl": true,
              "value": "1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw",
              "mode": "id"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Dringlichkeiten",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw/edit#gid=0"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.7,
          "position": [
            -128,
            -160
          ],
          "id": "a6c31ae2-ebd7-4b86-a478-dcf2bfc53bab",
          "name": "Dringlichkeitskriterien laden",
          "credentials": {
            "googleApi": {
              "id": "vRVq7GTwn9kTIi8N",
              "name": "Google Sheets account 2"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            96,
            -256
          ],
          "id": "a10e58d0-0c20-4b1d-ba2f-0063c93d95af",
          "name": "Merge"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "9cac8552-e981-44e5-bfc7-854012461c3f",
                  "name": "subject",
                  "value": "={{ $json.Kategorie }} | {{ $('Daten extrahieren').first().json.body[0].body.context.einrichtung_name }}, {{ $('Daten extrahieren').first().json.body[0].body.context.anrufer_name }} | {{ $json.Themenstichwort }}",
                  "type": "string"
                },
                {
                  "id": "988dd2a7-83ea-48b9-9e7e-bcc66745c72c",
                  "name": "htmlBody",
                  "value": "=<h3>Problemtyp: {{ $json.Problemtyp }}</h3>\n\n<h4>KI-EinschÃ¤tzung</h4>\n<p>\n  <b>Einrichtung:</b> {{ $('Daten extrahieren').first().json.body[0].body.context.einrichtung_typ }}<br>\n  <b>Anrufer:</b> {{ $('Daten extrahieren').first().json.body[0].body.context.anrufer_name }} ({{ $('Daten extrahieren').first().json.body[0].body.fromNumber }})<br>\n  <b>Ansprechpartner:</b> {{ $json.AnsprechpartnerName ? $json.AnsprechpartnerName : \"Wie Anrufer\" }}<br>\n  <b>RÃ¼ckrufnummer:</b> {{ $json.Rueckrufnummer ? $json.Rueckrufnummer : $('Daten extrahieren').first().json.body[0].body.fromNumber }}<br>\n  <b>Thema:</b> {{ $json.Themenstichwort }}\n</p>\n\n<b>Beschreibung:</b>\n<ul>\n{{ $json.Beschreibung.map(item => `<li>${item}</li>`).join('') }}\n</ul>\n\n<b>BegrÃ¼ndung der Dringlichkeitseinstufung:</b>\n<p>{{ $json.BegrÃ¼ndung }}</p>\n\n<hr>\n\n<h4>VollstÃ¤ndiges Transkript</h4>\n<p style=\"white-space: pre-wrap; color: #555;\">\n{{ $('Azure Request Vorbereitung').first().json.messages[1].content }}\n</p>",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1744,
            -256
          ],
          "id": "7107ac65-dc9e-45e2-8076-eefd41bbb0f6",
          "name": "E-Mail vorbereiten"
        },
        {
          "parameters": {
            "fromEmail": "office@berent.ai",
            "toEmail": "office@berent.ai",
            "subject": "={{ $json.subject }}",
            "html": "={{ $json.htmlBody }}",
            "options": {},
            "path": "fe097452-a8a6-4630-b5f3-88b0208b0a64"
          },
          "type": "n8n-nodes-base.emailSend",
          "typeVersion": 2.1,
          "position": [
            1968,
            -256
          ],
          "id": "5c063f17-c7e6-4ccc-afb5-641ef2e937f0",
          "name": "Send email",
          "webhookId": "fe097452-a8a6-4630-b5f3-88b0208b0a64",
          "credentials": {
            "smtp": {
              "id": "8O5B5z4vS8yeagJh",
              "name": "SMTP account"
            }
          }
        },
        {
          "parameters": {
            "operation": "sanitize",
            "text": "={{ $('Merge').item.json.body[0].body.formattedTranscript }}",
            "guardrails": {
              "pii": {
                "value": {
                  "type": "selected",
                  "entities": [
                    "EMAIL_ADDRESS",
                    "PHONE_NUMBER",
                    "IP_ADDRESS",
                    "LOCATION"
                  ]
                }
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.guardrails",
          "typeVersion": 1,
          "position": [
            320,
            -256
          ],
          "id": "fac51186-cf43-4c80-bc2d-7b1390fddc43",
          "name": "Daten anonymisieren"
        },
        {
          "parameters": {
            "jsCode": "// 1. Zugriff auf die Antwort des AI Agents\nlet agentOutput = $input.item.json.output || $input.item.json.text || \"\";\n\n// Wir machen sicherheitshalber einen String daraus\nif (typeof agentOutput === 'object') {\n  agentOutput = JSON.stringify(agentOutput);\n}\n\n// 2. Das Mapping holen (exakter Name der Node davor ist wichtig!)\nconst mappingData = $('Azure Response Verarbeitung').first();\nconst nameMapping = mappingData.json.nameMapping || [];\n\n// 3. Re-Personalisierung durchfÃ¼hren (Suchen & Ersetzen im Rohtext)\n// Wir machen das VOR dem JSON-Parsing, damit auch Namen in Strings ersetzt werden.\nlet processedText = agentOutput;\n\nfor (const item of nameMapping) {\n  // Ersetze [PERSON_X] durch den echten Namen (global)\n  // Wir escapen die Klammern fÃ¼r den Regex\n  const placeholderRegex = new RegExp(item.placeholder.replace(/\\[/g, '\\\\[').replace(/\\]/g, '\\\\]'), 'g');\n  processedText = processedText.replace(placeholderRegex, item.original);\n}\n\n// 4. JSON Extrahieren (Der \"GesprÃ¤chigkeit\"-Filter)\n// Wir suchen den Bereich zwischen der ersten '{' und der letzten '}'\nconst firstBracket = processedText.indexOf('{');\nconst lastBracket = processedText.lastIndexOf('}');\n\nif (firstBracket !== -1 && lastBracket !== -1) {\n  // Schneide alles vor der ersten Klammer und nach der letzten Klammer weg\n  const jsonString = processedText.substring(firstBracket, lastBracket + 1);\n  \n  try {\n    const finalObject = JSON.parse(jsonString);\n    return finalObject; // Gib das saubere Objekt zurÃ¼ck\n  } catch (e) {\n    return { error: \"JSON war trotz Filterung ungÃ¼ltig\", raw: processedText };\n  }\n} else {\n  // Fallback, falls gar keine Klammern gefunden wurden\n  return { error: \"Kein JSON im Antworttext gefunden\", raw: processedText };\n}"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1520,
            -256
          ],
          "id": "f56c3653-a9d6-4221-bd93-46b9816e4e44",
          "name": "Re-Personalisierung"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://berent-ki.services.ai.azure.com/models/chat/completions?api-version=2024-05-01-preview",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "contentType": "=json",
            "specifyBody": "json",
            "bodyParameters": {
              "parameters": [
                {}
              ]
            },
            "jsonBody": "={{ $json }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            768,
            -256
          ],
          "id": "52c4ea34-c0a9-47f2-aaa7-a6d66b74e3c3",
          "name": "Namen-Anonymisierung (Azure)",
          "retryOnFail": true,
          "waitBetweenTries": 5000,
          "maxTries": 5,
          "credentials": {
            "httpHeaderAuth": {
              "id": "4gc7MePUZVuCyowB",
              "name": "Header Auth account"
            },
            "httpBearerAuth": {
              "id": "24SORzPv91ZRH2UW",
              "name": "Bearer Auth account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "// Wir greifen auf die Antwort der Azure-Node zu\nconst response = $input.item.json;\n\n// Sicherstellen, dass wir eine Antwort haben\nif (response.choices && response.choices[0] && response.choices[0].message) {\n  \n  // Den Textinhalt holen\n  let content = response.choices[0].message.content;\n  \n  // Oft sendet die KI den Text in Markdown-BlÃ¶cken (```json ... ```).\n  // Diese entfernen wir hier, damit das JSON sauber ist.\n  content = content.replace(/^```json\\s*/, \"\").replace(/\\s*```$/, \"\");\n  \n  try {\n    // Den Textstring in ein echtes JSON-Objekt umwandeln\n    const parsedData = JSON.parse(content);\n    \n    // Das saubere Ergebnis zurÃ¼ckgeben\n    return parsedData;\n    \n  } catch (error) {\n    // Falls die KI kein gÃ¼ltiges JSON geschickt hat, geben wir den Rohtext zurÃ¼ck\n    return {\n      error: \"Konnte JSON nicht parsen\",\n      rawContent: content\n    };\n  }\n} else {\n  return { error: \"Keine gÃ¼ltige Antwort von Azure erhalten\" };\n}"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            992,
            -256
          ],
          "id": "c5e92ee9-c3c0-4dab-9647-c5ef188f56f3",
          "name": "Azure Response Verarbeitung"
        },
        {
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "// Daten aus der vorherigen Node holen\n// Fallback auf leeren String, falls keine Daten da sind\nconst transcript = $input.item.json.guardrailsInput || $input.item.json.output || \"\";\n\nconst systemPrompt = `Du bist ein Spezialist fÃ¼r die Anonymisierung von Personennamen in deutschen Telefon-Transkripten.\n\n###DEINE AUFGABE###\nErkenne alle Personennamen (Vornamen und Nachnamen) im gegebenen Text und ersetze sie durch nummerierte Platzhalter im Format [PERSON_1], [PERSON_2], [PERSON_3] etc.\n\n###REGELN###\n1. Erkenne nur echte Personennamen (z.B. Thomas, Anna, MÃ¼ller, Schmidt)\n2. Ignoriere Titel wie 'Herr', 'Frau', 'Dr.' - diese bleiben unverÃ¤ndert\n3. Ersetze jeden gefundenen Namen durch einen eindeutigen Platzhalter [PERSON_N]\n4. Gleiche Namen im Text erhalten den gleichen Platzhalter (z.B. 'Thomas' wird immer zu [PERSON_1])\n5. Verschiedene Namen erhalten verschiedene Platzhalter (z.B. 'Thomas' â†’ [PERSON_1], 'Anna' â†’ [PERSON_2])\n6. Behalte die ursprÃ¼ngliche Formatierung bei (ZeilenumbrÃ¼che, Interpunktion)\n\n###AUSGABEFORMAT###\nGib dein Ergebnis im folgenden JSON-Format zurÃ¼ck:\n\\`\\`\\`json\n{\n  \"anonymizedText\": \"Der anonymisierte Text mit [PERSON_1], [PERSON_2] etc.\",\n  \"nameMapping\": [\n    {\"original\": \"Thomas\", \"placeholder\": \"[PERSON_1]\"},\n    {\"original\": \"Anna\", \"placeholder\": \"[PERSON_2]\"}\n  ]\n}\n\\`\\`\\``;\n\n// Das fertige Payload-Objekt zurÃ¼ckgeben\nreturn {\n  model: \"mistral-namen-anonymisierung\",\n  messages: [\n    {\n      role: \"system\",\n      content: systemPrompt\n    },\n    {\n      role: \"user\",\n      content: transcript\n    }\n  ],\n  temperature: 0.1,\n  max_tokens: 1000\n};"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            544,
            -256
          ],
          "id": "71a225d6-c63f-4406-9b8e-ebd0d6583983",
          "name": "Azure Request Vorbereitung"
        }
      ],
      "connections": {
        "Webhook": {
          "main": [
            [
              {
                "node": "Daten extrahieren",
                "type": "main",
                "index": 0
              },
              {
                "node": "Dringlichkeitskriterien laden",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Daten extrahieren": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Anthropic Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Dringlichkeitskriterien laden": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Daten anonymisieren",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent": {
          "main": [
            [
              {
                "node": "Re-Personalisierung",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "E-Mail vorbereiten": {
          "main": [
            [
              {
                "node": "Send email",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Daten anonymisieren": {
          "main": [
            [
              {
                "node": "Azure Request Vorbereitung",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Re-Personalisierung": {
          "main": [
            [
              {
                "node": "E-Mail vorbereiten",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Namen-Anonymisierung (Azure)": {
          "main": [
            [
              {
                "node": "Azure Response Verarbeitung",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Azure Response Verarbeitung": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Azure Request Vorbereitung": {
          "main": [
            [
              {
                "node": "Namen-Anonymisierung (Azure)",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "ff80dabd-1fed-4040-80cc-57cb072f03a9",
      "activeVersionId": null,
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-12-09T17:10:51.897Z",
          "createdAt": "2025-12-09T17:10:51.897Z",
          "role": "workflow:owner",
          "workflowId": "lQCvszSC2kiedNIp",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": null,
      "tags": []
    },
    {
      "updatedAt": "2025-12-16T17:06:42.867Z",
      "createdAt": "2025-11-24T19:30:01.014Z",
      "id": "p4WBXmtWQqToEtLw",
      "name": "Hedy to Webhook to Notion 0.9",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "Hedy-Todos",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            0,
            0
          ],
          "id": "6ee2556f-14fa-491a-a23f-fc8232698e60",
          "name": "Hedy API",
          "webhookId": "b9081b42-f39a-4933-9964-4dcfa7aa227e"
        },
        {
          "parameters": {
            "resource": "databasePage",
            "databaseId": {
              "__rl": true,
              "value": "2ca31cc6-fd56-8079-8a58-d74ec1097a36",
              "mode": "list",
              "cachedResultName": "Hedy Transkripte 0.9",
              "cachedResultUrl": "https://www.notion.so/2ca31cc6fd5680798a58d74ec1097a36"
            },
            "title": "Hedy Transkript",
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "Titel|title",
                  "title": "={{ $json.body.event }}"
                },
                {
                  "key": "Transkript|rich_text",
                  "textContent": "={{ $json.body.data.message }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            208,
            0
          ],
          "id": "a82bbbce-23bd-4926-8852-a525f1f28791",
          "name": "Hedy Transkript 0.9",
          "credentials": {
            "notionApi": {
              "id": "KpKj51GJ0big0oYv",
              "name": "Notion account"
            }
          }
        }
      ],
      "connections": {
        "Hedy API": {
          "main": [
            [
              {
                "node": "Hedy Transkript 0.9",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "64b68a4b-7ee9-430f-8ab1-bdf343f828ee",
      "activeVersionId": "64b68a4b-7ee9-430f-8ab1-bdf343f828ee",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-11-24T19:30:01.018Z",
          "createdAt": "2025-11-24T19:30:01.018Z",
          "role": "workflow:owner",
          "workflowId": "p4WBXmtWQqToEtLw",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": {
        "updatedAt": "2025-12-15T18:47:29.894Z",
        "createdAt": "2025-12-15T18:47:29.894Z",
        "versionId": "64b68a4b-7ee9-430f-8ab1-bdf343f828ee",
        "workflowId": "p4WBXmtWQqToEtLw",
        "nodes": [
          {
            "parameters": {
              "httpMethod": "POST",
              "path": "Hedy-Todos",
              "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2.1,
            "position": [
              0,
              0
            ],
            "id": "6ee2556f-14fa-491a-a23f-fc8232698e60",
            "name": "Hedy API",
            "webhookId": "b9081b42-f39a-4933-9964-4dcfa7aa227e"
          },
          {
            "parameters": {
              "resource": "databasePage",
              "databaseId": {
                "__rl": true,
                "value": "2ca31cc6-fd56-8079-8a58-d74ec1097a36",
                "mode": "list",
                "cachedResultName": "Hedy Transkripte 0.9",
                "cachedResultUrl": "https://www.notion.so/2ca31cc6fd5680798a58d74ec1097a36"
              },
              "title": "Hedy Transkript",
              "propertiesUi": {
                "propertyValues": [
                  {
                    "key": "Titel|title",
                    "title": "={{ $json.body.event }}"
                  },
                  {
                    "key": "Transkript|rich_text",
                    "textContent": "={{ $json.body.data.message }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              208,
              0
            ],
            "id": "a82bbbce-23bd-4926-8852-a525f1f28791",
            "name": "Hedy Transkript 0.9",
            "credentials": {
              "notionApi": {
                "id": "KpKj51GJ0big0oYv",
                "name": "Notion account"
              }
            }
          }
        ],
        "connections": {
          "Hedy API": {
            "main": [
              [
                {
                  "node": "Hedy Transkript 0.9",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "Marcus Kunkel",
        "name": null,
        "description": null
      },
      "tags": []
    },
    {
      "updatedAt": "2025-11-11T19:56:36.000Z",
      "createdAt": "2025-11-11T19:55:46.546Z",
      "id": "qKt4bbsURorhPjBI",
      "name": "Brainstorming Assistent Sprachesteuerung",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $json.text }}",
            "options": {
              "systemMessage": "=<system_prompt>\nDU BIST EIN HOCHSPEZIALISIERTER BRAINSTORMING-ASSISTENT FÃœR LARS FIÃ‹CK â€“ FREELANCE STRATEGY DIRECTOR UND ZERTIFIZIERTER AI CONSULTANT MIT ÃœBER 20 JAHREN ERFAHRUNG IN MARKENFÃœHRUNG, KREATIVSTRATEGIE UND KI-INNOVATION.\n\n### DEINE MISSION ###\n\nDU UNTERSTÃœTZT LARS IN INTELLIGENTEN, PRAXISNAHEN UND STRATEGISCH WERTVOLLEN BRAINSTORMING-SESSIONS ZU THEMEN RUND UM:\n\n- MARKENSTRATEGIE IN ZEITEN VON KI\n- ANWENDUNG VON GENERATIVER KI IN KREATIVEN UND KOMMUNIKATIVEN PROZESSEN\n- ENTWICKLUNG VON WORKSHOP-FORMATEN, USE CASES UND STRATEGIEN FÃœR AGENTUREN UND MARKETINGTEAMS\n- DEEP RESEARCH UND IMPULSGEBUNG ZU AI-TOOLS, ETHIK, EU AI ACT, TRENDS, BEST PRACTICES\n\n---\n\n### TOOL-ZUGRIFFE ###\n\nDU HAST ZUGRIFF AUF DIE FOLGENDEN TOOLS UND VERWENDEST SIE NACH BEDARF STRATEGISCH:\n\n- `Wikipedia`: FÃœR SCHNELLE ERKLÃ„RUNG UND KONTEXTUALISIERUNG VON BEGRIFFEN UND KONZEPTEN  \n- `Google Suche`: FÃœR AKTUELLE TRENDS, CASE STUDIES, NEUE TOOLS, REGULATORISCHE ENTWICKLUNGEN  \n- `Think`: UM DEIN ERGEBNIS VOR DER AUSGABE KRITISCH ZU REFLEKTIEREN, FEHLER ZU IDENTIFIZIEREN UND DEINE IDEEN ZU VERFEINERN  \n- `Ergebnisse per Mail schicken`: BEI DER ANWEISUNG â€žSCHICKE MIR DAS ERGEBNISâ€œ ERSTELLST DU EINE STRUKTURIERTE, STRATEGISCH WERTVOLLE ZUSAMMENFASSUNG DES BRAINSTORMINGS UND VERSENDEST SIE PER E-MAIL AN LARS FIÃ‹CK\n\n#### E-MAIL-LOGIK:\n\n- **Subject**: KLAR, KURZ, STRATEGISCH â€“ Z.â€¯B. â€žWorkshopideen fÃ¼r generative KI in Agenturenâ€œ oder â€žUse-Cases: Midjourney in Markenprozessenâ€œ  \n- **Message Body**:  \n  - **Kontext (1 Satz)**  \n  - **Zentrale Erkenntnisse in 3â€“5 Bullet Points**  \n  - **Optionale Impulsfragen fÃ¼r Weiterarbeit**  \n  - **Schluss-Satz mit klarem Call-to-Action oder Reminder fÃ¼r Lars**  \n- NUTZE PROFESSIONELLE, KLARE UND STRATEGISCH ANGEMESSENE SPRACHE\n\n---\n\n### DEINE METHODIK: CHAIN OF THOUGHTS ###\n\n<chain_of_thoughts_rules>\n// 1. VERSTEHEN: ANALYSIERE DAS BRIEFING ODER DIE FRAGE VON LARS GENAU  \n// 2. KERN IDENTIFIZIEREN: BESTIMME DIE STRATEGISCH RELEVANTEN UND KREATIV WIRKUNGSVOLLEN KERNPUNKTE  \n// 3. AUFTEILEN: STRUKTURIERE DAS THEMA IN TEILASPEKTE (Z.â€¯B. CHANCEN, RISIKEN, ANWENDUNGSFELDER, FORMATIDEEN)  \n// 4. ANALYSIEREN: UNTERSTÃœTZE JEDE IDEE MIT RATIONALEM, PRAXISBEZOGENEM DENKEN â€“ STETS MIT MARKEN- UND KOMMUNIKATIONSKOMPETENZ  \n// 5. VERKNÃœPFEN: STELLE BEZÃœGE HER ZWISCHEN STRATEGIE, KREATIVITÃ„T UND TECHNOLOGIE  \n// 6. EDGE CASES: ÃœBERPRÃœFE GEDANKEN AUF REALITÃ„TSBEZUG UND RELEVANZ FÃœR UNTERSCHIEDLICHE TEAMSTRUKTUREN ODER KUNDENTYPEN  \n// 7. IMPULS: GIB KONKRETE, UMSETZBARE IDEEN, WORKSHOP-BLOCKS ODER PROVOKATIVE FRAGEN FÃœR DIE WEITERE ARBEIT  \n// 8. REFLEKTION (THINK): WENDE DAS TOOL `Think` AN, UM DEINE ANTWORT ZU ÃœBERDENKEN, ZU PRÃœFEN UND GEZIELT ZU VERBESSERN  \n</chain_of_thoughts_rules>\n\n---\n\n### WAS DU NICHT TUN DARFST ###\n\n**WAS DU UNTER KEINEN UMSTÃ„NDEN TUN DARFST:**\n\n- **VERMEIDE UNREFLEKTIERTE ANTWORTEN OHNE DAS TOOL `Think`, WENN STRATEGISCHE KOMPLEXITÃ„T VORLIEGT**\n- **SCHICKE KEINE MAILS OHNE STRUKT**\n"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2.2,
          "position": [
            664,
            96
          ],
          "id": "87997fe9-0c65-414e-a2d9-1ae3a092a23f",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-4.1",
              "mode": "list",
              "cachedResultName": "gpt-4.1"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            416,
            320
          ],
          "id": "aea5bd5f-b263-4260-9d57-6feddd8e6fbe",
          "name": "OpenAI Chat Model"
        },
        {
          "parameters": {
            "sessionIdType": "customKey",
            "sessionKey": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "contextWindowLength": 20
          },
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            544,
            320
          ],
          "id": "e85bba54-34cf-4346-bdcf-feac9894cb2e",
          "name": "Simple Memory"
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.toolWikipedia",
          "typeVersion": 1,
          "position": [
            672,
            320
          ],
          "id": "0b449d85-dae7-4a01-b690-ef4467e6bb34",
          "name": "Wikipedia"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.toolSerpApi",
          "typeVersion": 1,
          "position": [
            800,
            320
          ],
          "id": "e16f91f8-5201-4dbe-8a49-4c34ff94850a",
          "name": "Google Suche"
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.toolThink",
          "typeVersion": 1.1,
          "position": [
            928,
            320
          ],
          "id": "617d9bdc-4374-48a7-90d0-494696c64fbe",
          "name": "Think"
        },
        {
          "parameters": {
            "sendTo": "fieck.lars@gmail.com",
            "subject": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', `Titel unseres Brainstormings`, 'string') }}",
            "emailType": "text",
            "message": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', `Strukturierte Zusammenfassung unseres Brainstormings`, 'string') }}",
            "options": {}
          },
          "type": "n8n-nodes-base.gmailTool",
          "typeVersion": 2.1,
          "position": [
            1056,
            320
          ],
          "id": "459ea34d-bf8b-466a-a1ce-92dca60fd8c1",
          "name": "Ergebnisse per Mail schicken",
          "webhookId": "b04ae50a-7471-42a7-a7b1-fbb20a87f2e3"
        },
        {
          "parameters": {
            "updates": [
              "message"
            ],
            "additionalFields": {
              "chatIds": "7100977906"
            }
          },
          "type": "n8n-nodes-base.telegramTrigger",
          "typeVersion": 1.2,
          "position": [
            -480,
            96
          ],
          "id": "256d0a7f-c31c-4501-b874-b28602ddac80",
          "name": "Telegram Trigger",
          "webhookId": "ff92015f-344f-434d-8f46-453f25ecf711"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.message.text }}",
                        "rightValue": "",
                        "operator": {
                          "type": "string",
                          "operation": "notEmpty",
                          "singleValue": true
                        },
                        "id": "c04edae6-42ed-4df6-8089-4e291dc97a26"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Text"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "33bbf746-caab-435f-a472-2ea238f091f6",
                        "leftValue": "={{ $json.message.voice }}",
                        "rightValue": "",
                        "operator": {
                          "type": "object",
                          "operation": "exists",
                          "singleValue": true
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Voice"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.3,
          "position": [
            -256,
            96
          ],
          "id": "11c43c57-e3d3-44d1-a267-faf7d91d04be",
          "name": "Switch"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "1aea2a41-9f7d-4444-b87b-4004caa3a084",
                  "name": "text",
                  "value": "={{ $json.message.text }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            192,
            0
          ],
          "id": "fdf41a46-acd3-402c-a98a-c8a22757696a",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "resource": "file",
            "fileId": "={{ $json.message.voice.file_id }}",
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            -32,
            192
          ],
          "id": "3dcd1c28-e942-49e2-9ce9-beb8f2a4a3d0",
          "name": "Get a file",
          "webhookId": "1b11f79c-3f53-441d-bfd3-6700a62569bc"
        },
        {
          "parameters": {
            "resource": "audio",
            "operation": "transcribe",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.openAi",
          "typeVersion": 1.8,
          "position": [
            192,
            192
          ],
          "id": "2ee141e0-42d0-461f-81ce-89ebf32d8cd2",
          "name": "Transcribe a recording"
        },
        {
          "parameters": {
            "resource": "audio",
            "input": "={{ $json.output }}",
            "voice": "fable",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.openAi",
          "typeVersion": 1.8,
          "position": [
            1264,
            96
          ],
          "id": "d4b314d1-d0f7-40f5-8ea0-1863c5a1d4f7",
          "name": "Generate audio"
        },
        {
          "parameters": {
            "operation": "sendAudio",
            "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "binaryData": true,
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.telegram",
          "typeVersion": 1.2,
          "position": [
            1488,
            96
          ],
          "id": "1234f602-a570-4a36-b765-cff407a1cf13",
          "name": "Send an audio file",
          "webhookId": "b0cb3f9e-7a18-4350-89bd-1667be0afd7a"
        }
      ],
      "connections": {
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Wikipedia": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Google Suche": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Think": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Ergebnisse per Mail schicken": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Telegram Trigger": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Get a file",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get a file": {
          "main": [
            [
              {
                "node": "Transcribe a recording",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Transcribe a recording": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent": {
          "main": [
            [
              {
                "node": "Generate audio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Generate audio": {
          "main": [
            [
              {
                "node": "Send an audio file",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": null,
      "pinData": {},
      "versionId": "86d9b4bb-0134-4b90-99c0-ee61598ce94c",
      "activeVersionId": null,
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-11-11T19:55:46.549Z",
          "createdAt": "2025-11-11T19:55:46.549Z",
          "role": "workflow:owner",
          "workflowId": "qKt4bbsURorhPjBI",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": null,
      "tags": []
    },
    {
      "updatedAt": "2025-11-11T23:16:54.000Z",
      "createdAt": "2025-11-11T23:08:14.064Z",
      "id": "qV8SHVJFOeoAv0FC",
      "name": "YouTube-Transkript fÃ¼r Notion 3",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "youtube-transcript",
            "responseMode": "responseNode",
            "options": {
              "rawBody": true
            }
          },
          "id": "ced11828-a47e-485b-8202-2415d393b8d2",
          "name": "Webhook Trigger",
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 1.1,
          "position": [
            -864,
            176
          ],
          "webhookId": "youtube-transcript-webhook"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "youtube-url",
                  "name": "youtubeUrl",
                  "value": "={{ $json.body.url || $json.query.url || $json.url }}",
                  "type": "string"
                },
                {
                  "id": "video-id",
                  "name": "videoId",
                  "value": "={{ $json.body.url ? $json.body.url.match(/(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/)([^&]+)/)?.[1] : '' }}",
                  "type": "string"
                },
                {
                  "id": "author-name",
                  "name": "authorName",
                  "value": "={{ $json.body.author || 'Unbekannt' }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "id": "85131524-8fa8-4a4e-b6d6-936f6af0b59b",
          "name": "Webhook Daten extrahieren",
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.3,
          "position": [
            -640,
            176
          ]
        },
        {
          "parameters": {
            "operation": "get",
            "part": "snippet,contentDetails,statistics"
          },
          "id": "72cf1970-a5ed-43e2-a219-3a519f449eee",
          "name": "YouTube Video Details",
          "type": "n8n-nodes-base.youTube",
          "typeVersion": 1,
          "position": [
            -416,
            176
          ]
        },
        {
          "parameters": {
            "url": "=https://api.youtubetranscript.com/?video_id={{ $json.videoId }}",
            "options": {
              "timeout": 30000
            }
          },
          "id": "8120b877-d43f-44a7-a3a4-23fc6a0ece23",
          "name": "Transkript extrahieren",
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -192,
            176
          ]
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict"
              },
              "conditions": [
                {
                  "id": "has-transcript",
                  "leftValue": "={{ $json.transcript || $json.text || '' }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty"
                  }
                },
                {
                  "id": "min-length",
                  "leftValue": "={{ ($json.transcript || $json.text || '').length }}",
                  "rightValue": "100",
                  "operator": {
                    "type": "number",
                    "operation": "gt"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "id": "05f7d659-bf13-4c1b-8b85-4c49a5a3006b",
          "name": "Transkript validieren",
          "type": "n8n-nodes-base.if",
          "typeVersion": 2,
          "position": [
            32,
            176
          ]
        },
        {
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "// Alle Daten aus vorherigen Nodes sammeln\nconst config = $('Webhook Daten extrahieren').item.json;\nconst videoDetails = $('YouTube Video Details').item.json;\nconst transcriptData = $('Transkript extrahieren').item.json;\n\n// Transkript extrahieren und bereinigen\nlet rawTranscript = transcriptData.transcript || transcriptData.text || '';\nif (Array.isArray(transcriptData)) {\n  rawTranscript = transcriptData.map(item => item.text || item.content || '').join(' ');\n}\n\n// Text bereinigen und formatieren\nconst cleanTranscript = rawTranscript\n  .replace(/\\[.*?\\]/g, '')           // [Musik], [Applaus] etc.\n  .replace(/\\(.*?\\)/g, '')           // (inaudible) etc.\n  .replace(/\\s+/g, ' ')              // Mehrfache Leerzeichen\n  .replace(/\\n+/g, '\\n\\n')           // AbsÃ¤tze formatieren\n  .trim();\n\n// Video-Dauer aus ISO 8601 Format parsen (PT4M13S -> 4:13)\nfunction parseDuration(duration) {\n  if (!duration) return 'Unknown';\n  const match = duration.match(/PT(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+)S)?/);\n  if (!match) return duration;\n  \n  const hours = parseInt(match[1] || 0);\n  const minutes = parseInt(match[2] || 0);\n  const seconds = parseInt(match[3] || 0);\n  \n  if (hours > 0) {\n    return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n  } else {\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n  }\n}\n\n// Tags aus Video-Titel und Beschreibung extrahieren\nfunction extractTags(title, description) {\n  const tags = [];\n  const text = (title + ' ' + description).toLowerCase();\n  \n  // AI/KI-bezogene Keywords\n  if (text.match(/(ai|artificial intelligence|chatgpt|gpt|claude|llm|machine learning|automation)/)) {\n    tags.push('AI');\n  }\n  \n  // Marketing Keywords\n  if (text.match(/(marketing|sales|business|growth|strategy|revenue)/)) {\n    tags.push('Marketing');\n  }\n  \n  // Tutorial Keywords\n  if (text.match(/(tutorial|how to|guide|step by step|walkthrough|setup)/)) {\n    tags.push('Tutorial');\n  }\n  \n  // Tool Keywords\n  if (text.match(/(tool|software|app|platform|api|integration)/)) {\n    tags.push('Tools');\n  }\n  \n  return tags.length > 0 ? tags : ['AI']; // Default fallback\n}\n\nreturn {\n  // Video Grunddaten\n  videoId: config.videoId,\n  title: videoDetails.snippet?.title || 'Unbekannt',\n  channelTitle: videoDetails.snippet?.channelTitle || 'Unbekannt',\n  authorName: config.authorName || 'Unbekannt',\n  publishedAt: videoDetails.snippet?.publishedAt || new Date().toISOString(),\n  description: videoDetails.snippet?.description || '',\n  \n  // Statistiken\n  viewCount: parseInt(videoDetails.statistics?.viewCount || 0),\n  likeCount: parseInt(videoDetails.statistics?.likeCount || 0),\n  duration: parseDuration(videoDetails.contentDetails?.duration),\n  \n  // URLs\n  videoUrl: `https://youtube.com/watch?v=${config.videoId}`,\n  thumbnailUrl: videoDetails.snippet?.thumbnails?.high?.url || '',\n  \n  // Transkript\n  cleanTranscript: cleanTranscript,\n  transcriptLength: cleanTranscript.length,\n  wordCount: cleanTranscript.split(' ').length,\n  estimatedReadingTime: Math.ceil(cleanTranscript.split(' ').length / 200),\n  \n  // Auto-Tags\n  autoTags: extractTags(videoDetails.snippet?.title || '', videoDetails.snippet?.description || '')\n};"
          },
          "id": "27908794-92e5-4887-a2f3-6a80dab9a7b2",
          "name": "Daten zusammenfÃ¼hren",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            256,
            176
          ]
        },
        {
          "parameters": {
            "text": "={{ $json.cleanTranscript }}",
            "translateTo": "DE",
            "additionalFields": {}
          },
          "id": "5240e51e-f453-4b4a-9af2-b4472b2c9706",
          "name": "DeepL Ãœbersetzen",
          "type": "n8n-nodes-base.deepL",
          "typeVersion": 1,
          "position": [
            480,
            176
          ]
        },
        {
          "parameters": {
            "resource": "databasePage",
            "databaseId": "22f31cc6fd5680f89a68da6f99f3dade",
            "title": "={{ $json.title }}",
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "Autor|select",
                  "selectValue": "={{ [$json.authorName] }}"
                },
                {
                  "key": "Video URL|url",
                  "urlValue": "={{ $json.videoUrl }}"
                },
                {
                  "key": "Kanal|rich_text"
                },
                {
                  "key": "VerÃ¶ffentlicht|date",
                  "includeTime": false
                },
                {
                  "key": "Tags|multi_select",
                  "multiSelectValue": "={{ $json.autoTags }}"
                },
                {
                  "key": "Status|select",
                  "selectValue": "=Neu"
                }
              ]
            },
            "options": {}
          },
          "id": "61bdd1db-aa27-4a43-9cb8-d2a0bf225c81",
          "name": "Notion Eintrag erstellen",
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2,
          "position": [
            704,
            176
          ],
          "notesInFlow": true,
          "credentials": {
            "notionApi": {
              "id": "KpKj51GJ0big0oYv",
              "name": "Notion account"
            }
          },
          "notes": "Datenbank-ID als ENV-Variable: NOTION_DATABASE_ID"
        },
        {
          "parameters": {
            "authentication": "generic",
            "options": {}
          },
          "id": "7d6ccc18-4955-4ef3-b040-f221e9d80429",
          "name": "Threema Work Benachrichtigung",
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            928,
            176
          ],
          "notesInFlow": true,
          "notes": "Threema Work API - EmpfÃ¤nger-ID noch anzupassen"
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={{ {\n  \"success\": true,\n  \"message\": \"Video erfolgreich verarbeitet\",\n  \"videoId\": $('Webhook Daten extrahieren').item.json.videoId,\n  \"title\": $('Daten zusammenfÃ¼hren').item.json.title,\n  \"notionUrl\": $('Notion Eintrag erstellen').item.json.url || 'Erstellt'\n} }}",
            "options": {}
          },
          "id": "bc30b928-3366-40e5-89f4-aaa0711285a0",
          "name": "Webhook Response",
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1,
          "position": [
            1152,
            176
          ]
        }
      ],
      "connections": {
        "Webhook Trigger": {
          "main": [
            [
              {
                "node": "Webhook Daten extrahieren",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Webhook Daten extrahieren": {
          "main": [
            [
              {
                "node": "YouTube Video Details",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "YouTube Video Details": {
          "main": [
            [
              {
                "node": "Transkript extrahieren",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Transkript extrahieren": {
          "main": [
            [
              {
                "node": "Transkript validieren",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Transkript validieren": {
          "main": [
            [
              {
                "node": "Daten zusammenfÃ¼hren",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Daten zusammenfÃ¼hren": {
          "main": [
            [
              {
                "node": "DeepL Ãœbersetzen",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "DeepL Ãœbersetzen": {
          "main": [
            [
              {
                "node": "Notion Eintrag erstellen",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Notion Eintrag erstellen": {
          "main": [
            [
              {
                "node": "Threema Work Benachrichtigung",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Threema Work Benachrichtigung": {
          "main": [
            [
              {
                "node": "Webhook Response",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": null,
      "pinData": {},
      "versionId": "087d2bfc-db58-43e3-aef3-9b83dafbf81b",
      "activeVersionId": null,
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-11-11T23:08:14.066Z",
          "createdAt": "2025-11-11T23:08:14.066Z",
          "role": "workflow:owner",
          "workflowId": "qV8SHVJFOeoAv0FC",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": null,
      "tags": []
    },
    {
      "updatedAt": "2025-11-09T21:11:10.000Z",
      "createdAt": "2025-11-08T18:17:37.239Z",
      "id": "wtVL3a6B2x2Xintd",
      "name": "fonio Training Persona Generator",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "fonio-training-trigger",
            "responseMode": "responseNode",
            "options": {}
          },
          "id": "819e706c-9507-440c-bcf9-b3f0209aefd0",
          "name": "Fonio Webhook Trigger",
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 1,
          "position": [
            368,
            1664
          ],
          "webhookId": "ca536c70-f01b-464d-ad81-1ca7e40696f2"
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={{ $json }}",
            "options": {}
          },
          "id": "359dbf06-aeaf-4f82-99b6-ce3ccb91382e",
          "name": "Antwort an Fonio",
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1,
          "position": [
            2512,
            1520
          ]
        },
        {
          "parameters": {
            "modelId": {
              "__rl": true,
              "value": "claude-sonnet-4-20250514",
              "mode": "list",
              "cachedResultName": "claude-sonnet-4-20250514"
            },
            "messages": {
              "values": [
                {
                  "content": "==Erstelle eine Trainingspersona fÃ¼r den Bereich \"{{ $json.trainingsbereich }}\".\n\nSituationsbeschreibung:\n{{ $json.beschreibung }}\n\nEntwickle eine vollstÃ¤ndige Persona, die reprÃ¤sentativ fÃ¼r Kunden in diesem Trainingsbereich ist."
                }
              ]
            },
            "options": {
              "system": "Du bist ein Experte fÃ¼r Kundenservice-Training und spezialisiert auf die Entwicklung realistischer Trainingspersonas. Deine Aufgabe ist es, detaillierte, glaubwÃ¼rdige Kundencharaktere zu erstellen, die Mitarbeiter in spezifischen Situationen trainieren kÃ¶nnen.\n\nErstelle immer Personas mit: Name, Alter, Beruf, PersÃ¶nlichkeitstyp, Kommunikationsstil, emotionalem Zustand, spezifischen BedÃ¼rfnissen und typischen Problemen. Die Personas sollen fÃ¼r Rollenspiele geeignet und psychologisch stimmig sein."
            }
          },
          "type": "@n8n/n8n-nodes-langchain.anthropic",
          "typeVersion": 1,
          "position": [
            1936,
            1328
          ],
          "id": "769c1c24-b995-4b8c-9133-e8a28b70d19c",
          "name": "Message a model",
          "credentials": {
            "anthropicApi": {
              "id": "6RlfJdXsmselCNpN",
              "name": "Anthropic account 2"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "// Function-Node fÃ¼r 'random'\n\n// Hole die trainingsDaten von \"Auswahl verarbeiten\"\nconst trainingsDaten = $('Auswahl verarbeiten').first().json.trainingsDaten;\n\nif (!trainingsDaten || trainingsDaten.length === 0) {\n    return [{ json: { action: 'error', message: 'Keine Trainingsdaten verfÃ¼gbar' }}];\n}\n\n// WÃ¤hle zufÃ¤lligen Trainingsbereich\nconst randomIndex = Math.floor(Math.random() * trainingsDaten.length);\nconst selectedRow = trainingsDaten[randomIndex];\n\nreturn [{ \n    json: { \n        action: 'random', \n        trainingsbereich: selectedRow.Trainingsbereich, \n        beschreibung: selectedRow.Beschreibung \n    } \n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1488,
            1664
          ],
          "id": "e13053f0-263b-4cdc-86a3-ea93e77c42b1",
          "name": "Situation 'random'"
        },
        {
          "parameters": {
            "jsCode": "// Function-Node fÃ¼r case 'check'\n\nconst inputItem = $input.first().json; \nconst checkBereich = inputItem.bereich;\n\n// Hole die Trainingsdaten\nlet dataRows = inputItem.trainingsDaten || []; \n\n// Der eigentliche Vergleich\nconst exists = dataRows.some(row => \n    typeof row.Trainingsbereich === 'string' && \n    row.Trainingsbereich.toLowerCase() === checkBereich.toLowerCase()\n);\n\nreturn [{ \n    json: { \n        action: 'check', \n        exists: exists,  // <- geÃ¤ndert von checkPassed zu exists\n        bereich: checkBereich, \n        message: exists ? 'Trainingsbereich gefunden.' : 'Trainingsbereich nicht verfÃ¼gbar.' \n    } \n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1264,
            1424
          ],
          "id": "167edf0c-d5e6-4c8f-8f5a-850b98d89f50",
          "name": "Situation 'check'"
        },
        {
          "parameters": {
            "jsCode": "// Function-Node fÃ¼r case 'list'\n\n// Hole die trainingsDaten von \"Auswahl verarbeiten\"\nconst trainingsDaten = $input.first().json.trainingsDaten;\n\nif (!trainingsDaten || trainingsDaten.length === 0) {\n    return [{ json: { action: 'error', message: 'Keine Trainingsdaten verfÃ¼gbar' }}];\n}\n\n// Extrahiere alle Trainingsbereiche\nconst bereiche = trainingsDaten.map(row => row.Trainingsbereich);\n\nreturn [{ \n    json: { \n        action: 'list', \n        trainingsbereiche: bereiche, \n        totalCount: bereiche.length \n    } \n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            2000,
            1808
          ],
          "id": "57ad9863-66bf-406a-8163-c6708e5d3886",
          "name": "Situation 'list'"
        },
        {
          "parameters": {
            "jsCode": "// Function: Webhook-Body korrekt extrahieren + Google Sheets Daten mitgeben\n\n// 1. Hole den Body des Webhook-Requests, wo 'action' und 'bereich' liegen.\nconst webhookBody = $('Fonio Webhook Trigger').first().json.body;\n\n// 2. Hole die Google Sheets Trainingsdaten\nconst trainingsDaten = $input.all()\n  .filter(item => item.json.Trainingsbereich)\n  .map(item => item.json);\n\n// 3. Sicherheits-Check, ob die Action definiert ist\nif (!webhookBody || !webhookBody.action) {\n    return [{ json: { action: 'random', message: 'Action fehlt im Webhook Body.' } }];\n}\n\n// 4. Output erstellen mit allen Daten\nreturn [{\n    json: {\n        action: webhookBody.action, \n        bereich: webhookBody.bereich || '', \n        rufnummer: webhookBody.rufnummer || '',\n        trainingsDaten: trainingsDaten\n    }\n}];"
          },
          "id": "f319e59d-3582-4eab-a172-216ca150a1e7",
          "name": "Auswahl verarbeiten",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            816,
            1664
          ]
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "3eab51b1-ddfc-430f-bc1c-cfccc9602310",
                  "leftValue": "={{ $json.exists }}",
                  "rightValue": "true",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1488,
            1424
          ],
          "id": "422e0200-574b-476b-b789-147c389294ce",
          "name": "Existiert Trainingsbereich?"
        },
        {
          "parameters": {
            "jsCode": "// Hole die action von der richtigen Stelle\nlet action;\nlet trainingsbereich;\n\n// Versuche von \"Beschreibung des Trainingsbereichs holen\"\nconst beschreibungNode = $('Beschreibung des Trainingsbereichs holen').first();\nif (beschreibungNode && beschreibungNode.json) {\n  action = beschreibungNode.json.action;\n  trainingsbereich = beschreibungNode.json.trainingsbereich;\n} else {\n  // Fallback auf aktuellen Input\n  action = $input.first().json.action;\n  trainingsbereich = $input.first().json.trainingsbereich;\n}\n\n// Timestamp\nconst timestamp = new Date().toISOString();\n\nswitch (action) {\n  \n  case 'list':\n    const listInput = $('Situation \\'list\\'').first().json;\n    const bereichsListe = listInput.trainingsbereiche.join(', ');\n    return [{\n      json: {\n        success: true,\n        action: 'list',\n        message: `VerfÃ¼gbare Trainingsbereiche: ${bereichsListe}`,\n        trainingsbereiche: listInput.trainingsbereiche,\n        totalCount: listInput.totalCount,\n        timestamp: timestamp\n      }\n    }];\n    \n  case 'check':\n    // PrÃ¼fe ob Persona generiert wurde\n    if (trainingsbereich) {\n      // Persona wurde generiert\n      const claudeOutput = $('Message a model').first().json;\n      return [{\n        json: {\n          success: true,\n          action: 'check',\n          trainingsbereich: trainingsbereich,\n          persona: claudeOutput.content[0].text,\n          timestamp: timestamp\n        }\n      }];\n    } else {\n      // Bereich existiert nicht\n      const checkInput = $('Situation \\'check\\'').first().json;\n      return [{\n        json: {\n          success: false,\n          action: 'check',\n          bereich: checkInput.bereich,\n          exists: checkInput.exists,\n          message: checkInput.message,\n          timestamp: timestamp\n        }\n      }];\n    }\n    \n  case 'random':\n    // Persona wurde generiert\n    const claudeOutput = $('Message a model').first().json;\n    const randomNode = $('Beschreibung des Trainingsbereichs holen').first().json;\n    return [{\n      json: {\n        success: true,\n        action: 'random',\n        trainingsbereich: randomNode.trainingsbereich,\n        persona: claudeOutput.content[0].text,\n        timestamp: timestamp\n      }\n    }];\n    \n  default:\n    return [{\n      json: {\n        success: false,\n        error: \"Unbekannte Aktion\",\n        receivedAction: action,\n        timestamp: timestamp\n      }\n    }];\n}"
          },
          "id": "f40da13f-9ce0-48dd-b61e-91f6117a7d2a",
          "name": "Antwort formatieren",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            2288,
            1328
          ]
        },
        {
          "parameters": {
            "authentication": "serviceAccount",
            "documentId": {
              "__rl": true,
              "value": "1KCGCBwtzQ82m8xQB47K7vGR6BXaZY21TNSiqAOh_ROk",
              "mode": "id"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "E-Commerce",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1KCGCBwtzQ82m8xQB47K7vGR6BXaZY21TNSiqAOh_ROk/edit#gid=0"
            },
            "options": {}
          },
          "id": "8be0a4d1-563e-4a1c-99c7-0b694afe6b2a",
          "name": "Google Sheets lesen",
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4,
          "position": [
            592,
            1664
          ],
          "credentials": {
            "googleApi": {
              "id": "QfuLctHhI3o7mKAL",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('Auswahl verarbeiten').item.json.action }}",
                        "rightValue": "=check",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "0e4eaed1-ab8c-4181-8dac-1728b2237925"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Modus Check"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "f33fa37a-fe46-4435-bc81-e7aee75ffebc",
                        "leftValue": "={{ $('Auswahl verarbeiten').item.json.action }}",
                        "rightValue": "random",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Modus Random"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "1a1a1574-4d2b-44ce-b5ea-c50773cec633",
                        "leftValue": "={{ $('Auswahl verarbeiten').item.json.action }}",
                        "rightValue": "list",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Modus List"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.3,
          "position": [
            1040,
            1648
          ],
          "id": "6c0eceaa-fee0-4449-95b6-b0d290f24b4e",
          "name": "Modus prÃ¼fen"
        },
        {
          "parameters": {
            "jsCode": "// Hole die Input-Action (kann 'check' oder 'random' sein)\nconst inputData = $input.first().json;\nconst action = inputData.action;\nconst bereich = inputData.bereich || null;\n\n// Hole die trainingsDaten\nconst trainingsDaten = $('Auswahl verarbeiten').first().json.trainingsDaten;\n\nlet trainingsRow;\n\nif (bereich) {\n  // Bei 'check': Spezifischen Bereich finden\n  trainingsRow = trainingsDaten.find(row => \n      row.Trainingsbereich && \n      row.Trainingsbereich.toLowerCase() === bereich.toLowerCase()\n  );\n} else {\n  // Bei 'random': ZufÃ¤lligen Bereich wÃ¤hlen\n  const randomIndex = Math.floor(Math.random() * trainingsDaten.length);\n  trainingsRow = trainingsDaten[randomIndex];\n}\n\n// Beschreibung parsen und eine Situation zufÃ¤llig auswÃ¤hlen\nconst beschreibung = trainingsRow.Beschreibung || 'Keine Beschreibung verfÃ¼gbar';\n\n// Extrahiere alle Situationen (Zeilen die mit \"- \" beginnen)\nconst situationen = beschreibung\n  .split('\\n')\n  .filter(line => line.trim().startsWith('- '))\n  .map(line => line.trim().substring(2)); // Entferne \"- \" Prefix\n\nlet selectedSituation;\n\nif (situationen.length > 0) {\n  // WÃ¤hle eine zufÃ¤llige Situation\n  const randomIndex = Math.floor(Math.random() * situationen.length);\n  selectedSituation = situationen[randomIndex];\n} else {\n  // Falls keine Situationen mit \"- \" gefunden, nutze die komplette Beschreibung\n  selectedSituation = beschreibung;\n}\n\n// Output - mit nur EINER Situation\nreturn [{\n    json: {\n        action: action,\n        trainingsbereich: trainingsRow.Trainingsbereich,\n        beschreibung: selectedSituation  // <- Nur eine zufÃ¤llige Situation!\n    }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1712,
            1328
          ],
          "id": "98a08fb0-1b3a-4e4f-a061-f1dda2c21b23",
          "name": "Beschreibung des Trainingsbereichs holen"
        },
        {
          "parameters": {
            "jsCode": "const checkInput = $input.first().json;\n\nreturn [{\n  json: {\n    success: false,\n    action: 'check',\n    trainingsbereich: checkInput.trainingsbereich,  // <- geÃ¤ndert\n    answer: `Der Trainingsbereich \"${checkInput.trainingsbereich}\" existiert leider nicht. MÃ¶chtest du die verfÃ¼gbare Liste hÃ¶ren?`,\n    timestamp: new Date().toISOString()\n  }\n}];"
          },
          "id": "6889b3f5-d24c-4818-a890-1ee0ab4a3440",
          "name": "Trainingsbereich existiert nicht",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            2288,
            1520
          ]
        },
        {
          "parameters": {
            "jsCode": "// Formatiere die Liste fÃ¼r Fonio\nconst listInput = $input.first().json;\nconst bereichsListe = listInput.trainingsbereiche.join(', ');\n\nreturn [{\n  json: {\n    success: true,\n    action: 'list',\n    message: `VerfÃ¼gbare Trainingsbereiche: ${bereichsListe}`,\n    trainingsbereiche: listInput.trainingsbereiche,\n    totalCount: listInput.totalCount,\n    timestamp: new Date().toISOString()\n  }\n}];"
          },
          "id": "4c0d159b-df37-4a91-b46e-b28606b6af2c",
          "name": "Liste der Trainingsbereiche",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            2288,
            1808
          ]
        }
      ],
      "connections": {
        "Fonio Webhook Trigger": {
          "main": [
            [
              {
                "node": "Google Sheets lesen",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Message a model": {
          "main": [
            [
              {
                "node": "Antwort formatieren",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Situation 'check'": {
          "main": [
            [
              {
                "node": "Existiert Trainingsbereich?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Situation 'list'": {
          "main": [
            [
              {
                "node": "Liste der Trainingsbereiche",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Situation 'random'": {
          "main": [
            [
              {
                "node": "Beschreibung des Trainingsbereichs holen",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Auswahl verarbeiten": {
          "main": [
            [
              {
                "node": "Modus prÃ¼fen",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Antwort formatieren": {
          "main": [
            [
              {
                "node": "Antwort an Fonio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Sheets lesen": {
          "main": [
            [
              {
                "node": "Auswahl verarbeiten",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Modus prÃ¼fen": {
          "main": [
            [
              {
                "node": "Situation 'check'",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Situation 'random'",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Situation 'list'",
                "type": "main",
                "index": 0
              }
            ],
            [],
            []
          ]
        },
        "Existiert Trainingsbereich?": {
          "main": [
            [
              {
                "node": "Beschreibung des Trainingsbereichs holen",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Trainingsbereich existiert nicht",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Beschreibung des Trainingsbereichs holen": {
          "main": [
            [
              {
                "node": "Message a model",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Trainingsbereich existiert nicht": {
          "main": [
            [
              {
                "node": "Antwort an Fonio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Liste der Trainingsbereiche": {
          "main": [
            [
              {
                "node": "Antwort an Fonio",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "40b61e99-298b-46b3-b9e3-eaa3fc805ac3",
      "activeVersionId": "40b61e99-298b-46b3-b9e3-eaa3fc805ac3",
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-11-08T18:17:37.246Z",
          "createdAt": "2025-11-08T18:17:37.246Z",
          "role": "workflow:owner",
          "workflowId": "wtVL3a6B2x2Xintd",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": {
        "updatedAt": "2025-12-08T16:14:36.269Z",
        "createdAt": "2025-12-08T16:14:36.269Z",
        "versionId": "40b61e99-298b-46b3-b9e3-eaa3fc805ac3",
        "workflowId": "wtVL3a6B2x2Xintd",
        "nodes": [
          {
            "parameters": {
              "httpMethod": "POST",
              "path": "fonio-training-trigger",
              "responseMode": "responseNode",
              "options": {}
            },
            "id": "819e706c-9507-440c-bcf9-b3f0209aefd0",
            "name": "Fonio Webhook Trigger",
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 1,
            "position": [
              368,
              1664
            ],
            "webhookId": "ca536c70-f01b-464d-ad81-1ca7e40696f2"
          },
          {
            "parameters": {
              "respondWith": "json",
              "responseBody": "={{ $json }}",
              "options": {}
            },
            "id": "359dbf06-aeaf-4f82-99b6-ce3ccb91382e",
            "name": "Antwort an Fonio",
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1,
            "position": [
              2512,
              1520
            ]
          },
          {
            "parameters": {
              "modelId": {
                "__rl": true,
                "value": "claude-sonnet-4-20250514",
                "mode": "list",
                "cachedResultName": "claude-sonnet-4-20250514"
              },
              "messages": {
                "values": [
                  {
                    "content": "==Erstelle eine Trainingspersona fÃ¼r den Bereich \"{{ $json.trainingsbereich }}\".\n\nSituationsbeschreibung:\n{{ $json.beschreibung }}\n\nEntwickle eine vollstÃ¤ndige Persona, die reprÃ¤sentativ fÃ¼r Kunden in diesem Trainingsbereich ist."
                  }
                ]
              },
              "options": {
                "system": "Du bist ein Experte fÃ¼r Kundenservice-Training und spezialisiert auf die Entwicklung realistischer Trainingspersonas. Deine Aufgabe ist es, detaillierte, glaubwÃ¼rdige Kundencharaktere zu erstellen, die Mitarbeiter in spezifischen Situationen trainieren kÃ¶nnen.\n\nErstelle immer Personas mit: Name, Alter, Beruf, PersÃ¶nlichkeitstyp, Kommunikationsstil, emotionalem Zustand, spezifischen BedÃ¼rfnissen und typischen Problemen. Die Personas sollen fÃ¼r Rollenspiele geeignet und psychologisch stimmig sein."
              }
            },
            "type": "@n8n/n8n-nodes-langchain.anthropic",
            "typeVersion": 1,
            "position": [
              1936,
              1328
            ],
            "id": "769c1c24-b995-4b8c-9133-e8a28b70d19c",
            "name": "Message a model",
            "credentials": {
              "anthropicApi": {
                "id": "6RlfJdXsmselCNpN",
                "name": "Anthropic account 2"
              }
            }
          },
          {
            "parameters": {
              "jsCode": "// Function-Node fÃ¼r 'random'\n\n// Hole die trainingsDaten von \"Auswahl verarbeiten\"\nconst trainingsDaten = $('Auswahl verarbeiten').first().json.trainingsDaten;\n\nif (!trainingsDaten || trainingsDaten.length === 0) {\n    return [{ json: { action: 'error', message: 'Keine Trainingsdaten verfÃ¼gbar' }}];\n}\n\n// WÃ¤hle zufÃ¤lligen Trainingsbereich\nconst randomIndex = Math.floor(Math.random() * trainingsDaten.length);\nconst selectedRow = trainingsDaten[randomIndex];\n\nreturn [{ \n    json: { \n        action: 'random', \n        trainingsbereich: selectedRow.Trainingsbereich, \n        beschreibung: selectedRow.Beschreibung \n    } \n}];"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              1488,
              1664
            ],
            "id": "e13053f0-263b-4cdc-86a3-ea93e77c42b1",
            "name": "Situation 'random'"
          },
          {
            "parameters": {
              "jsCode": "// Function-Node fÃ¼r case 'check'\n\nconst inputItem = $input.first().json; \nconst checkBereich = inputItem.bereich;\n\n// Hole die Trainingsdaten\nlet dataRows = inputItem.trainingsDaten || []; \n\n// Der eigentliche Vergleich\nconst exists = dataRows.some(row => \n    typeof row.Trainingsbereich === 'string' && \n    row.Trainingsbereich.toLowerCase() === checkBereich.toLowerCase()\n);\n\nreturn [{ \n    json: { \n        action: 'check', \n        exists: exists,  // <- geÃ¤ndert von checkPassed zu exists\n        bereich: checkBereich, \n        message: exists ? 'Trainingsbereich gefunden.' : 'Trainingsbereich nicht verfÃ¼gbar.' \n    } \n}];"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              1264,
              1424
            ],
            "id": "167edf0c-d5e6-4c8f-8f5a-850b98d89f50",
            "name": "Situation 'check'"
          },
          {
            "parameters": {
              "jsCode": "// Function-Node fÃ¼r case 'list'\n\n// Hole die trainingsDaten von \"Auswahl verarbeiten\"\nconst trainingsDaten = $input.first().json.trainingsDaten;\n\nif (!trainingsDaten || trainingsDaten.length === 0) {\n    return [{ json: { action: 'error', message: 'Keine Trainingsdaten verfÃ¼gbar' }}];\n}\n\n// Extrahiere alle Trainingsbereiche\nconst bereiche = trainingsDaten.map(row => row.Trainingsbereich);\n\nreturn [{ \n    json: { \n        action: 'list', \n        trainingsbereiche: bereiche, \n        totalCount: bereiche.length \n    } \n}];"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              2000,
              1808
            ],
            "id": "57ad9863-66bf-406a-8163-c6708e5d3886",
            "name": "Situation 'list'"
          },
          {
            "parameters": {
              "jsCode": "// Function: Webhook-Body korrekt extrahieren + Google Sheets Daten mitgeben\n\n// 1. Hole den Body des Webhook-Requests, wo 'action' und 'bereich' liegen.\nconst webhookBody = $('Fonio Webhook Trigger').first().json.body;\n\n// 2. Hole die Google Sheets Trainingsdaten\nconst trainingsDaten = $input.all()\n  .filter(item => item.json.Trainingsbereich)\n  .map(item => item.json);\n\n// 3. Sicherheits-Check, ob die Action definiert ist\nif (!webhookBody || !webhookBody.action) {\n    return [{ json: { action: 'random', message: 'Action fehlt im Webhook Body.' } }];\n}\n\n// 4. Output erstellen mit allen Daten\nreturn [{\n    json: {\n        action: webhookBody.action, \n        bereich: webhookBody.bereich || '', \n        rufnummer: webhookBody.rufnummer || '',\n        trainingsDaten: trainingsDaten\n    }\n}];"
            },
            "id": "f319e59d-3582-4eab-a172-216ca150a1e7",
            "name": "Auswahl verarbeiten",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              816,
              1664
            ]
          },
          {
            "parameters": {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3eab51b1-ddfc-430f-bc1c-cfccc9602310",
                    "leftValue": "={{ $json.exists }}",
                    "rightValue": "true",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "options": {}
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 2.2,
            "position": [
              1488,
              1424
            ],
            "id": "422e0200-574b-476b-b789-147c389294ce",
            "name": "Existiert Trainingsbereich?"
          },
          {
            "parameters": {
              "jsCode": "// Hole die action von der richtigen Stelle\nlet action;\nlet trainingsbereich;\n\n// Versuche von \"Beschreibung des Trainingsbereichs holen\"\nconst beschreibungNode = $('Beschreibung des Trainingsbereichs holen').first();\nif (beschreibungNode && beschreibungNode.json) {\n  action = beschreibungNode.json.action;\n  trainingsbereich = beschreibungNode.json.trainingsbereich;\n} else {\n  // Fallback auf aktuellen Input\n  action = $input.first().json.action;\n  trainingsbereich = $input.first().json.trainingsbereich;\n}\n\n// Timestamp\nconst timestamp = new Date().toISOString();\n\nswitch (action) {\n  \n  case 'list':\n    const listInput = $('Situation \\'list\\'').first().json;\n    const bereichsListe = listInput.trainingsbereiche.join(', ');\n    return [{\n      json: {\n        success: true,\n        action: 'list',\n        message: `VerfÃ¼gbare Trainingsbereiche: ${bereichsListe}`,\n        trainingsbereiche: listInput.trainingsbereiche,\n        totalCount: listInput.totalCount,\n        timestamp: timestamp\n      }\n    }];\n    \n  case 'check':\n    // PrÃ¼fe ob Persona generiert wurde\n    if (trainingsbereich) {\n      // Persona wurde generiert\n      const claudeOutput = $('Message a model').first().json;\n      return [{\n        json: {\n          success: true,\n          action: 'check',\n          trainingsbereich: trainingsbereich,\n          persona: claudeOutput.content[0].text,\n          timestamp: timestamp\n        }\n      }];\n    } else {\n      // Bereich existiert nicht\n      const checkInput = $('Situation \\'check\\'').first().json;\n      return [{\n        json: {\n          success: false,\n          action: 'check',\n          bereich: checkInput.bereich,\n          exists: checkInput.exists,\n          message: checkInput.message,\n          timestamp: timestamp\n        }\n      }];\n    }\n    \n  case 'random':\n    // Persona wurde generiert\n    const claudeOutput = $('Message a model').first().json;\n    const randomNode = $('Beschreibung des Trainingsbereichs holen').first().json;\n    return [{\n      json: {\n        success: true,\n        action: 'random',\n        trainingsbereich: randomNode.trainingsbereich,\n        persona: claudeOutput.content[0].text,\n        timestamp: timestamp\n      }\n    }];\n    \n  default:\n    return [{\n      json: {\n        success: false,\n        error: \"Unbekannte Aktion\",\n        receivedAction: action,\n        timestamp: timestamp\n      }\n    }];\n}"
            },
            "id": "f40da13f-9ce0-48dd-b61e-91f6117a7d2a",
            "name": "Antwort formatieren",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              2288,
              1328
            ]
          },
          {
            "parameters": {
              "authentication": "serviceAccount",
              "documentId": {
                "__rl": true,
                "value": "1KCGCBwtzQ82m8xQB47K7vGR6BXaZY21TNSiqAOh_ROk",
                "mode": "id"
              },
              "sheetName": {
                "__rl": true,
                "value": "gid=0",
                "mode": "list",
                "cachedResultName": "E-Commerce",
                "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1KCGCBwtzQ82m8xQB47K7vGR6BXaZY21TNSiqAOh_ROk/edit#gid=0"
              },
              "options": {}
            },
            "id": "8be0a4d1-563e-4a1c-99c7-0b694afe6b2a",
            "name": "Google Sheets lesen",
            "type": "n8n-nodes-base.googleSheets",
            "typeVersion": 4,
            "position": [
              592,
              1664
            ],
            "credentials": {
              "googleApi": {
                "id": "QfuLctHhI3o7mKAL",
                "name": "Google Sheets account"
              }
            }
          },
          {
            "parameters": {
              "rules": {
                "values": [
                  {
                    "conditions": {
                      "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 2
                      },
                      "conditions": [
                        {
                          "leftValue": "={{ $('Auswahl verarbeiten').item.json.action }}",
                          "rightValue": "=check",
                          "operator": {
                            "type": "string",
                            "operation": "equals"
                          },
                          "id": "0e4eaed1-ab8c-4181-8dac-1728b2237925"
                        }
                      ],
                      "combinator": "and"
                    },
                    "renameOutput": true,
                    "outputKey": "Modus Check"
                  },
                  {
                    "conditions": {
                      "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 2
                      },
                      "conditions": [
                        {
                          "id": "f33fa37a-fe46-4435-bc81-e7aee75ffebc",
                          "leftValue": "={{ $('Auswahl verarbeiten').item.json.action }}",
                          "rightValue": "random",
                          "operator": {
                            "type": "string",
                            "operation": "equals",
                            "name": "filter.operator.equals"
                          }
                        }
                      ],
                      "combinator": "and"
                    },
                    "renameOutput": true,
                    "outputKey": "Modus Random"
                  },
                  {
                    "conditions": {
                      "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 2
                      },
                      "conditions": [
                        {
                          "id": "1a1a1574-4d2b-44ce-b5ea-c50773cec633",
                          "leftValue": "={{ $('Auswahl verarbeiten').item.json.action }}",
                          "rightValue": "list",
                          "operator": {
                            "type": "string",
                            "operation": "equals",
                            "name": "filter.operator.equals"
                          }
                        }
                      ],
                      "combinator": "and"
                    },
                    "renameOutput": true,
                    "outputKey": "Modus List"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.switch",
            "typeVersion": 3.3,
            "position": [
              1040,
              1648
            ],
            "id": "6c0eceaa-fee0-4449-95b6-b0d290f24b4e",
            "name": "Modus prÃ¼fen"
          },
          {
            "parameters": {
              "jsCode": "// Hole die Input-Action (kann 'check' oder 'random' sein)\nconst inputData = $input.first().json;\nconst action = inputData.action;\nconst bereich = inputData.bereich || null;\n\n// Hole die trainingsDaten\nconst trainingsDaten = $('Auswahl verarbeiten').first().json.trainingsDaten;\n\nlet trainingsRow;\n\nif (bereich) {\n  // Bei 'check': Spezifischen Bereich finden\n  trainingsRow = trainingsDaten.find(row => \n      row.Trainingsbereich && \n      row.Trainingsbereich.toLowerCase() === bereich.toLowerCase()\n  );\n} else {\n  // Bei 'random': ZufÃ¤lligen Bereich wÃ¤hlen\n  const randomIndex = Math.floor(Math.random() * trainingsDaten.length);\n  trainingsRow = trainingsDaten[randomIndex];\n}\n\n// Beschreibung parsen und eine Situation zufÃ¤llig auswÃ¤hlen\nconst beschreibung = trainingsRow.Beschreibung || 'Keine Beschreibung verfÃ¼gbar';\n\n// Extrahiere alle Situationen (Zeilen die mit \"- \" beginnen)\nconst situationen = beschreibung\n  .split('\\n')\n  .filter(line => line.trim().startsWith('- '))\n  .map(line => line.trim().substring(2)); // Entferne \"- \" Prefix\n\nlet selectedSituation;\n\nif (situationen.length > 0) {\n  // WÃ¤hle eine zufÃ¤llige Situation\n  const randomIndex = Math.floor(Math.random() * situationen.length);\n  selectedSituation = situationen[randomIndex];\n} else {\n  // Falls keine Situationen mit \"- \" gefunden, nutze die komplette Beschreibung\n  selectedSituation = beschreibung;\n}\n\n// Output - mit nur EINER Situation\nreturn [{\n    json: {\n        action: action,\n        trainingsbereich: trainingsRow.Trainingsbereich,\n        beschreibung: selectedSituation  // <- Nur eine zufÃ¤llige Situation!\n    }\n}];"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              1712,
              1328
            ],
            "id": "98a08fb0-1b3a-4e4f-a061-f1dda2c21b23",
            "name": "Beschreibung des Trainingsbereichs holen"
          },
          {
            "parameters": {
              "jsCode": "const checkInput = $input.first().json;\n\nreturn [{\n  json: {\n    success: false,\n    action: 'check',\n    trainingsbereich: checkInput.trainingsbereich,  // <- geÃ¤ndert\n    answer: `Der Trainingsbereich \"${checkInput.trainingsbereich}\" existiert leider nicht. MÃ¶chtest du die verfÃ¼gbare Liste hÃ¶ren?`,\n    timestamp: new Date().toISOString()\n  }\n}];"
            },
            "id": "6889b3f5-d24c-4818-a890-1ee0ab4a3440",
            "name": "Trainingsbereich existiert nicht",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              2288,
              1520
            ]
          },
          {
            "parameters": {
              "jsCode": "// Formatiere die Liste fÃ¼r Fonio\nconst listInput = $input.first().json;\nconst bereichsListe = listInput.trainingsbereiche.join(', ');\n\nreturn [{\n  json: {\n    success: true,\n    action: 'list',\n    message: `VerfÃ¼gbare Trainingsbereiche: ${bereichsListe}`,\n    trainingsbereiche: listInput.trainingsbereiche,\n    totalCount: listInput.totalCount,\n    timestamp: new Date().toISOString()\n  }\n}];"
            },
            "id": "4c0d159b-df37-4a91-b46e-b28606b6af2c",
            "name": "Liste der Trainingsbereiche",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              2288,
              1808
            ]
          }
        ],
        "connections": {
          "Fonio Webhook Trigger": {
            "main": [
              [
                {
                  "node": "Google Sheets lesen",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Message a model": {
            "main": [
              [
                {
                  "node": "Antwort formatieren",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Situation 'check'": {
            "main": [
              [
                {
                  "node": "Existiert Trainingsbereich?",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Situation 'list'": {
            "main": [
              [
                {
                  "node": "Liste der Trainingsbereiche",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Situation 'random'": {
            "main": [
              [
                {
                  "node": "Beschreibung des Trainingsbereichs holen",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Auswahl verarbeiten": {
            "main": [
              [
                {
                  "node": "Modus prÃ¼fen",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Antwort formatieren": {
            "main": [
              [
                {
                  "node": "Antwort an Fonio",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Google Sheets lesen": {
            "main": [
              [
                {
                  "node": "Auswahl verarbeiten",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Modus prÃ¼fen": {
            "main": [
              [
                {
                  "node": "Situation 'check'",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "Situation 'random'",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "Situation 'list'",
                  "type": "main",
                  "index": 0
                }
              ],
              [],
              []
            ]
          },
          "Existiert Trainingsbereich?": {
            "main": [
              [
                {
                  "node": "Beschreibung des Trainingsbereichs holen",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "Trainingsbereich existiert nicht",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Beschreibung des Trainingsbereichs holen": {
            "main": [
              [
                {
                  "node": "Message a model",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Trainingsbereich existiert nicht": {
            "main": [
              [
                {
                  "node": "Antwort an Fonio",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Liste der Trainingsbereiche": {
            "main": [
              [
                {
                  "node": "Antwort an Fonio",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "system migration",
        "name": null,
        "description": null
      },
      "tags": []
    },
    {
      "updatedAt": "2025-12-12T11:19:30.865Z",
      "createdAt": "2025-12-10T13:39:41.038Z",
      "id": "xLbZnYQSKv2X7LYn",
      "name": "KIS 17 fonio-Outbound Trigger",
      "active": false,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "kis17_anruf_trigger",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -64,
            -96
          ],
          "id": "401000e3-7331-4ad1-8c15-f2a161b119e7",
          "name": "Webhook",
          "webhookId": "c57d0fdb-cb7a-4dc5-95b3-5102a559f160"
        },
        {
          "parameters": {
            "jsCode": "// *** PARAMETER: Zeitfenster in Minuten ***\nconst ZEITFENSTER_MINUTEN = 20;\n\n// Berechne Zeitfenster in Millisekunden\nconst zeitfensterMs = ZEITFENSTER_MINUTEN * 60000;\n\n// Hole die records aus dem body\nconst records = $input.first().json.body.records;\n\n// Aktuelle Zeit\nconst now = new Date();\n\n// Zeitfenster\nconst windowStart = now.getTime() - zeitfensterMs;\nconst windowEnd = now.getTime() + zeitfensterMs;\n\n// Filtere records nach Zeitfenster\nconst results = records.filter(record => {\n  const buchungstermin = record.buchungstermin;\n  \n  if (!buchungstermin) return false;\n  \n  try {\n    const bookingTime = new Date(buchungstermin);\n    if (isNaN(bookingTime.getTime())) return false;\n    \n    const bookingTimestamp = bookingTime.getTime();\n    return bookingTimestamp >= windowStart && bookingTimestamp <= windowEnd;\n  } catch (error) {\n    return false;\n  }\n});\n\n// RÃ¼ckgabe im richtigen Format fÃ¼r n8n\nreturn results.map(record => ({ json: record }));"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            160,
            -96
          ],
          "id": "d132f754-45b4-4b32-af45-37585773cbad",
          "name": "Check Call Time"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            384,
            -96
          ],
          "id": "d665c763-5437-4bba-ab45-aa9d9499daa0",
          "name": "Loop Over Items"
        },
        {
          "parameters": {
            "url": "https://app.fonio.ai/api/public/v1/outbound_call",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            1280,
            -240
          ],
          "id": "82d12ed7-e4fc-4d4b-bf79-859cfd3b7db6",
          "name": "HTTP Request"
        },
        {
          "parameters": {
            "dataTableId": {
              "__rl": true,
              "value": "AWHMZa5eXE6aZY7g",
              "mode": "list",
              "cachedResultName": "fonio outbound",
              "cachedResultUrl": "/projects/yr4Hj71ou1NOsi2p/datatables/AWHMZa5eXE6aZY7g"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {},
              "matchingColumns": [
                "phone"
              ],
              "schema": [
                {
                  "id": "phone",
                  "displayName": "phone",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.dataTable",
          "typeVersion": 1,
          "position": [
            1056,
            -240
          ],
          "id": "8d464d5f-56d5-403a-9bbf-960cc67e679f",
          "name": "Insert row"
        },
        {
          "parameters": {
            "operation": "deleteRows",
            "dataTableId": {
              "__rl": true,
              "value": "AWHMZa5eXE6aZY7g",
              "mode": "list",
              "cachedResultName": "fonio outbound",
              "cachedResultUrl": "/projects/yr4Hj71ou1NOsi2p/datatables/AWHMZa5eXE6aZY7g"
            },
            "matchType": "allConditions",
            "filters": {
              "conditions": [
                {
                  "keyName": "phone"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.dataTable",
          "typeVersion": 1,
          "position": [
            1504,
            -168
          ],
          "id": "9dee4d49-d5c5-4e84-bda6-8d0ef961894c",
          "name": "Delete row(s)"
        },
        {
          "parameters": {
            "operation": "get",
            "dataTableId": {
              "__rl": true,
              "value": "AWHMZa5eXE6aZY7g",
              "mode": "list",
              "cachedResultName": "fonio outbound",
              "cachedResultUrl": "/projects/yr4Hj71ou1NOsi2p/datatables/AWHMZa5eXE6aZY7g"
            },
            "matchType": "allConditions",
            "filters": {
              "conditions": [
                {
                  "keyName": "phone",
                  "keyValue": "={{ $json.telefon }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.dataTable",
          "typeVersion": 1,
          "position": [
            608,
            -240
          ],
          "id": "ad82549f-41c7-4d70-8e91-096b0b898df0",
          "name": "Get row(s)",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "b107b0f5-df10-4e23-88aa-b5693a58e7ed",
                  "leftValue": "={{ !$json.telefon || $json.telefon === '' }}",
                  "rightValue": "={{ $json.length === 0 }}",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            832,
            -240
          ],
          "id": "0cb25fbf-0079-4636-b6c1-9fcc7a872988",
          "name": "If"
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "field": "minutes",
                  "minutesInterval": 30
                }
              ]
            }
          },
          "name": "Schedule Trigger",
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.2,
          "position": [
            -64,
            272
          ],
          "id": "d29e0c6d-7793-464b-b1a0-b055abbad7f1"
        },
        {
          "parameters": {
            "operation": "get",
            "dataTableId": {
              "__rl": true,
              "value": "AWHMZa5eXE6aZY7g",
              "mode": "list",
              "cachedResultName": "fonio outbound",
              "cachedResultUrl": "/projects/yr4Hj71ou1NOsi2p/datatables/AWHMZa5eXE6aZY7g"
            }
          },
          "name": "Get All Rows",
          "type": "n8n-nodes-base.dataTable",
          "typeVersion": 1,
          "position": [
            160,
            272
          ],
          "id": "671ab281-de73-45e5-8034-2d9283446f6e"
        },
        {
          "parameters": {
            "operation": "deleteRows",
            "dataTableId": {
              "__rl": true,
              "value": "AWHMZa5eXE6aZY7g",
              "mode": "list",
              "cachedResultName": "fonio outbound",
              "cachedResultUrl": "/projects/yr4Hj71ou1NOsi2p/datatables/AWHMZa5eXE6aZY7g"
            },
            "matchType": "allConditions",
            "filters": {
              "conditions": [
                {
                  "keyName": "phone",
                  "keyValue": "={{ $json.phone }}"
                }
              ]
            },
            "options": {}
          },
          "name": "Delete Row",
          "type": "n8n-nodes-base.dataTable",
          "typeVersion": 1,
          "position": [
            832,
            200
          ],
          "id": "93fc9646-d48d-4ab5-bed4-02c296f4d622"
        },
        {
          "parameters": {
            "options": {
              "reset": false
            }
          },
          "name": "Loop Over Items1",
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            384,
            272
          ],
          "id": "718abfb8-45fa-4aee-9fde-2294d072f801"
        },
        {
          "parameters": {
            "content": "**Hauptworkflow**\nâ€“ Trigger: Zeitschalter jede Minute\nâ€“ Aufgabe: fonio-Outbound starten",
            "height": 240,
            "width": 272,
            "color": 2
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -152,
            -176
          ],
          "id": "66f55688-43ab-4b51-ad0f-2eee74ddf8bb",
          "name": "Sticky Note"
        },
        {
          "parameters": {
            "content": "**Workflow Bereinigung**\nâ€“ Trigger: Zeitschalter alle 30 Minuten\nâ€“ Aufgabe: Datenbank mit gesperrten Telefonnummern bereinigen, die Ã¤lter als 2 h sind.",
            "height": 240,
            "width": 448,
            "color": 2
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -128,
            176
          ],
          "id": "4d67f48f-db79-48b1-bb2b-84f88be3a8f2",
          "name": "Sticky Note1"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 1
              },
              "conditions": [
                {
                  "id": "1",
                  "leftValue": "=const createdAt = new Date($json.createdAt);\nconst now = new Date();\nconst diffHours = (now - createdAt) / (1000 * 60 * 60);\ndiffHours > 2",
                  "rightValue": true,
                  "operator": {
                    "type": "boolean",
                    "operation": "equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {
              "looseTypeValidation": true
            }
          },
          "name": "ðŸ“± Ã¤lter als 2h",
          "type": "n8n-nodes-base.if",
          "typeVersion": 2,
          "position": [
            608,
            128
          ],
          "id": "b1113eb8-3e68-4146-ae77-7b518ee0a604"
        }
      ],
      "connections": {
        "Webhook": {
          "main": [
            [
              {
                "node": "Check Call Time",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Check Call Time": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items": {
          "main": [
            [],
            [
              {
                "node": "Get row(s)",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTTP Request": {
          "main": [
            [
              {
                "node": "Delete row(s)",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Insert row": {
          "main": [
            [
              {
                "node": "HTTP Request",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Delete row(s)": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get row(s)": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Insert row",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger": {
          "main": [
            [
              {
                "node": "Get All Rows",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get All Rows": {
          "main": [
            [
              {
                "node": "Loop Over Items1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Delete Row": {
          "main": [
            [
              {
                "node": "Loop Over Items1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items1": {
          "main": [
            [],
            [
              {
                "node": "ðŸ“± Ã¤lter als 2h",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ðŸ“± Ã¤lter als 2h": {
          "main": [
            [
              {
                "node": "Delete Row",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Loop Over Items1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "6fc19e5c-38c4-4efa-aeae-32117da064e6",
      "activeVersionId": null,
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-12-10T13:39:41.042Z",
          "createdAt": "2025-12-10T13:39:41.042Z",
          "role": "workflow:owner",
          "workflowId": "xLbZnYQSKv2X7LYn",
          "projectId": "yr4Hj71ou1NOsi2p"
        }
      ],
      "activeVersion": null,
      "tags": []
    }
  ],
  "nextCursor": null
}