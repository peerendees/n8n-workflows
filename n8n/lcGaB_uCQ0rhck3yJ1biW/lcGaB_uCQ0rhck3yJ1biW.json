{"active":true,"connections":{"Bereinige Titel":{"main":[[{"index":0,"node":"Erstelle Google Doc","type":"main"}]]},"Chunk Minutes":{"main":[[{"index":0,"node":"Loop Minutes","type":"main"}]]},"Chunk Recap":{"main":[[{"index":0,"node":"Loop Recap","type":"main"}]]},"Chunk Transcript":{"main":[[{"index":0,"node":"Loop Transcript","type":"main"}]]},"Config":{"main":[[{"index":0,"node":"Switch","type":"main"}]]},"Dok ID holen":{"main":[[{"index":0,"node":"Google Dok l√∂schen","type":"main"}]]},"Dok ID speichern":{"main":[[{"index":0,"node":"Prepare Data","type":"main"}]]},"Erstelle Google Doc":{"main":[[{"index":0,"node":"Felder f√ºr Notion","type":"main"}]]},"Felder f√ºr Notion":{"main":[[{"index":0,"node":"Notion Seite erstellen","type":"main"}]]},"Google Dok l√∂schen":{"main":[[{"index":0,"node":"Threema: Datei gel√∂scht","type":"main"}]]},"Header Minutes":{"main":[[{"index":0,"node":"Chunk Minutes","type":"main"}]]},"Header Recap":{"main":[[{"index":0,"node":"Chunk Recap","type":"main"}]]},"Header Transcript":{"main":[[{"index":0,"node":"Chunk Transcript","type":"main"}]]},"Loop Minutes":{"main":[[{"index":0,"node":"Write Minutes","type":"main"}],[{"index":0,"node":"Header Recap","type":"main"}]]},"Loop Recap":{"main":[[{"index":0,"node":"Write Recap","type":"main"}],[{"index":0,"node":"Header Transcript","type":"main"}]]},"Loop Transcript":{"main":[[{"index":0,"node":"Write Transcript","type":"main"}],[{"index":0,"node":"Dok ID speichern","type":"main"}]]},"Nachricht entschl√ºsseln via Vercel":{"main":[[{"index":0,"node":"Text bereinigen","type":"main"}]]},"Notion Seite erstellen":{"main":[[{"index":0,"node":"Header Minutes","type":"main"}]]},"Prepare Data":{"main":[[{"index":0,"node":"Threema L√∂schanforderung senden","type":"main"}]]},"Switch":{"main":[[{"index":0,"node":"Nachricht entschl√ºsseln via Vercel","type":"main"}],[{"index":0,"node":"Threema L√∂schanforderung senden","type":"main"}]]},"Tempor√§res Dok l√∂schen?":{"main":[[{"index":0,"node":"Dok ID holen","type":"main"}],[{"index":0,"node":"Threema: Datei nicht gel√∂scht","type":"main"}]]},"Text bereinigen":{"main":[[{"index":0,"node":"Tempor√§res Dok l√∂schen?","type":"main"}]]},"Webhook Threema Work Gateway empfangen":{"main":[[{"index":0,"node":"Config","type":"main"}]]},"Webhook1":{"main":[[{"index":0,"node":"Bereinige Titel","type":"main"}]]},"Write Minutes":{"main":[[{"index":0,"node":"Loop Minutes","type":"main"}]]},"Write Recap":{"main":[[{"index":0,"node":"Loop Recap","type":"main"}]]},"Write Transcript":{"main":[[{"index":0,"node":"Loop Transcript","type":"main"}]]}},"name":"Hedy Transkripte zu Notion v2","nodes":[{"name":"Webhook1","parameters":{"httpMethod":"POST","options":{},"path":"hedy-transkripte-nach-notion-ddd6468b-6d6e-4160-afa8-c5733d265335"},"position":[3824,2032],"type":"n8n-nodes-base.webhook","typeVersion":2,"webhookId":"0f7c7c4a-fc39-40c4-8b2b-80466fa3118a"},{"name":"Webhook Threema Work Gateway empfangen","parameters":{"httpMethod":"POST","options":{},"path":"threema-work-gateway-5cdcca9c-5fa8-44ef-b3bc-668fae5a46a6"},"position":[6736,2416],"type":"n8n-nodes-base.webhook","typeVersion":2.1,"webhookId":"5cdcca9c-5fa8-44ef-b3bc-668fae5a46a6"},{"name":"Config","parameters":{"assignments":{"assignments":[{"name":"CHUNK_SIZE","type":"number","value":1900},{"name":"threemaFrom","type":"string","value":"*BERENT1"},{"name":"threemaE2E","type":"string","value":"*BERENT2"},{"name":"threemaTo","type":"string","value":"BUMFMZ39"},{"name":"secret*1","type":"string","value":"18DOvPKBV7ize3Nh"},{"name":"secret*2","type":"string","value":"2pLgi4h6RWJWr6AD"},{"name":"private","type":"string","value":"bd9264814eb3cf8657533d57dd8e0d8629eb9bf348f317ecbe5672e4032ed534"},{"name":"box","type":"string","value":"={{ $json.body?.box ?? $json.box ?? '' }}"},{"name":"nonce","type":"string","value":"={{ $json.body?.nonce ?? $json.nonce ?? '' }}"},{"name":"from","type":"string","value":"={{ $json.body?.from ?? $json.from ?? '' }}"}]},"options":{}},"position":[6960,2416],"type":"n8n-nodes-base.set","typeVersion":3.4},{"name":"Switch","parameters":{"options":{},"rules":{"values":[{"conditions":{"combinator":"and","conditions":[{"leftValue":"={{ $json.box }}","operator":{"operation":"notEmpty","singleValue":true,"type":"string"},"rightValue":""}],"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3}},"outputKey":"Eingehend","renameOutput":true},{"conditions":{"combinator":"and","conditions":[{"leftValue":"","operator":{"name":"filter.operator.equals","operation":"equals","type":"string"},"rightValue":""}],"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3}},"outputKey":"Ausgehend","renameOutput":true}]}},"position":[7184,2416],"type":"n8n-nodes-base.switch","typeVersion":3.4},{"name":"Nachricht entschl√ºsseln via Vercel","parameters":{"jsonBody":"={\n  \"action\": \"decrypt\",\n  \"box\": \"{{ $json.box }}\",\n  \"nonce\": \"{{ $json.nonce }}\",\n  \"from\": \"{{ $json.from }}\",\n  \"gatewayPrivateKey\": \"{{ $json.private }}\",\n  \"senderPublicKey\": \"7c2138caab9f8da92b0141593e634435e5e5b920667d3e2c9610f1b4a1e3497b\"\n}","method":"POST","options":{},"sendBody":true,"specifyBody":"json","url":"https://threema-decrypt.vercel.app/api/decrypt"},"position":[7408,2416],"type":"n8n-nodes-base.httpRequest","typeVersion":4.4},{"name":"Text bereinigen","parameters":{"jsCode":"const decryptedText = $json.text || '';\n\n// Alle non-ASCII entfernen, trimmen, dann nur erstes Wort nehmen\nconst cleanText = decryptedText\n  .replace(/[^\\x20-\\x7E]/g, '')  // Nicht-ASCII entfernen\n  .trim()\n  .toLowerCase()\n  .split(/[^a-z]/)[0];            // Nur Buchstaben des ersten Wortes\n\nconsole.log('Bereinigter Text:', cleanText);\n\nconst isApproval = ['ja', 'jaa', 'yes'].includes(cleanText);\nconst isRejection = ['nein', 'nee', 'no'].includes(cleanText);\n\nreturn [{\n  json: {\n    originalText: decryptedText,\n    cleanText: cleanText,\n    isApproval: isApproval,\n    isRejection: isRejection,\n    from: $json.from\n  }\n}];"},"position":[7632,2416],"type":"n8n-nodes-base.code","typeVersion":2},{"name":"Tempor√§res Dok l√∂schen?","parameters":{"conditions":{"combinator":"and","conditions":[{"leftValue":"={{ $json.isApproval }}","operator":{"operation":"true","singleValue":true,"type":"boolean"},"rightValue":""}],"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3}},"options":{}},"position":[7856,2416],"type":"n8n-nodes-base.if","typeVersion":2.3},{"name":"Threema: Datei gel√∂scht","parameters":{"jsonBody":"={\n  \"action\": \"send\",\n  \"to\": \"{{ $('Config').first().json.threemaTo }}\",\n  \"text\": \"üóëÔ∏è Das tempor√§re Google-Dokument wurde gel√∂scht.\",\n  \"gatewayId\": \"{{ $('Config').first().json.threemaE2E }}\",\n  \"gatewaySecret\": \"{{ $('Config').first().json['secret*2'] }}\",\n  \"gatewayPrivateKey\": \"{{ $('Config').first().json.private }}\",\n  \"recipientPublicKey\": \"7c2138caab9f8da92b0141593e634435e5e5b920667d3e2c9610f1b4a1e3497b\"\n}","method":"POST","options":{},"sendBody":true,"specifyBody":"json","url":"https://threema-decrypt.vercel.app/api/decrypt"},"position":[8528,2320],"type":"n8n-nodes-base.httpRequest","typeVersion":4.2},{"name":"Threema: Datei nicht gel√∂scht","parameters":{"jsonBody":"={\n  \"action\": \"send\",\n  \"to\": \"{{ $('Config').first().json.threemaTo }}\",\n  \"text\": \"üìÑ Das tempor√§re Google-Dokument wurde behalten.\",\n  \"gatewayId\": \"{{ $('Config').first().json.threemaE2E }}\",\n  \"gatewaySecret\": \"{{ $('Config').first().json['secret*2'] }}\",\n  \"gatewayPrivateKey\": \"{{ $('Config').first().json.private }}\",\n  \"recipientPublicKey\": \"7c2138caab9f8da92b0141593e634435e5e5b920667d3e2c9610f1b4a1e3497b\"\n}","method":"POST","options":{},"sendBody":true,"specifyBody":"json","url":"https://threema-decrypt.vercel.app/api/decrypt"},"position":[8080,2512],"type":"n8n-nodes-base.httpRequest","typeVersion":4.2},{"name":"Bereinige Titel","parameters":{"jsCode":"const webhookBody = $('Webhook1').first().json.body;\n\nif (!webhookBody) {\n  throw new Error(\"Konnte keine Webhook-Daten finden. Pr√ºfe den Namen des Webhook-Nodes!\");\n}\n\nlet title = webhookBody.title || webhookBody.event || \"Unbenanntes_Meeting\";\nlet firstPart = title.split('-')[0].trim();\nfirstPart = firstPart.replace(/\\s+/g, '_');\n\nreturn [\n  {\n    json: {\n      ...webhookBody,\n      originalTitle: title,\n      splittedTitle: firstPart\n    }\n  }\n];"},"position":[4048,2032],"type":"n8n-nodes-base.code","typeVersion":2},{"credentials":{"googleApi":{"name":"n8n Sheets Service"}},"name":"Erstelle Google Doc","parameters":{"authentication":"serviceAccount","operation":"create"},"position":[4272,2032],"type":"n8n-nodes-base.googleDrive","typeVersion":3},{"name":"Felder f√ºr Notion","parameters":{"assignments":{"assignments":[{"name":"Name","type":"string","value":"={{ $('Webhook1').item.json.body.title || $('Bereinige Titel').item.json.originalTitle || 'Test-Sitzung' }}"},{"name":"Start","type":"string","value":"={{ $('Webhook1').item.json.body.startTime || $('Webhook1').item.json.body.data.timestamp }}"},{"name":"Ende","type":"string","value":"={{ $('Webhook1').item.json.body.endTime || $('Webhook1').item.json.body.data.timestamp }}"},{"name":"Protokoll","type":"string","value":"=https://docs.google.com/document/d/{{ $('Erstelle Google Doc').item.json.id }}/edit"},{"name":"GoogleDocId","type":"string","value":"={{ $('Erstelle Google Doc').item.json.id }}"}]},"options":{}},"position":[4496,2032],"type":"n8n-nodes-base.set","typeVersion":3.4},{"credentials":{"notionApi":{"name":"API Notion"}},"name":"Notion Seite erstellen","parameters":{"databaseId":{"__rl":true,"cachedResultName":"Hedy Transkripte 0.9 Realtime Meeting Assistenz","mode":"list","value":"2ca31cc6-fd56-8079-8a58-d74ec1097a36"},"options":{"icon":"üëì","iconType":"emoji"},"propertiesUi":{"propertyValues":[{"key":"Titel|title","title":"={{ $('Bereinige Titel').item.json.splittedTitle }}"},{"key":"Zusammenfassung|rich_text","textContent":"={{ $('Webhook1').item.json.body.recap.slice(0, 2000) }}"}]},"resource":"databasePage","simple":false,"title":"={{ $('Bereinige Titel').item.json.originalTitle }}"},"position":[4720,2032],"type":"n8n-nodes-base.notion","typeVersion":2.2},{"credentials":{"notionApi":{"name":"API Notion"}},"name":"Header Minutes","parameters":{"blockId":{"__rl":true,"mode":"id","value":"={{ $json.id }}"},"blockUi":{"blockValues":[{"textContent":"Zusammenfassung (Minutes)","type":"heading_1"}]},"resource":"block"},"position":[4944,2032],"type":"n8n-nodes-base.notion","typeVersion":2.2},{"name":"Chunk Minutes","parameters":{"jsCode":"const CHUNK_SIZE = 1900;\nconst webhookData = $('Webhook1').first().json.body;\nconst text = webhookData.meeting_minutes || '';\nconst notionPageId = $('Notion Seite erstellen').first().json.id;\nconsole.log('Minutes L√§nge:', text.length);\nconst chunks = [];\nfor (let i = 0; i < text.length; i += CHUNK_SIZE) {\n  chunks.push(text.slice(i, i + CHUNK_SIZE));\n}\nreturn chunks.map(chunk => ({ json: { chunk, notionPageId } }));"},"position":[5168,2032],"type":"n8n-nodes-base.code","typeVersion":2},{"name":"Loop Minutes","parameters":{"options":{}},"position":[5392,2032],"type":"n8n-nodes-base.splitInBatches","typeVersion":3},{"credentials":{"notionApi":{"name":"API Notion"}},"name":"Write Minutes","parameters":{"blockId":{"__rl":true,"mode":"id","value":"={{ $json.notionPageId }}"},"blockUi":{"blockValues":[{"textContent":"={{ $json.chunk }}"}]},"resource":"block"},"position":[5616,1936],"type":"n8n-nodes-base.notion","typeVersion":2.2},{"credentials":{"notionApi":{"name":"API Notion"}},"name":"Header Recap","parameters":{"blockId":{"__rl":true,"mode":"id","value":"={{ $('Notion Seite erstellen').first().json.id }}"},"blockUi":{"blockValues":[{"textContent":"Recap","type":"heading_1"}]},"resource":"block"},"position":[5616,2128],"type":"n8n-nodes-base.notion","typeVersion":2.2},{"name":"Chunk Recap","parameters":{"jsCode":"const CHUNK_SIZE = 1900;\nconst webhookData = $('Webhook1').first().json.body;\nconst text = webhookData.recap || '';\nconst notionPageId = $('Notion Seite erstellen').first().json.id;\nconst chunks = [];\nfor (let i = 0; i < text.length; i += CHUNK_SIZE) {\n  chunks.push(text.slice(i, i + CHUNK_SIZE));\n}\nreturn chunks.map(chunk => ({ json: { chunk, notionPageId } }));"},"position":[5840,2128],"type":"n8n-nodes-base.code","typeVersion":2},{"name":"Loop Recap","parameters":{"options":{}},"position":[6064,2128],"type":"n8n-nodes-base.splitInBatches","typeVersion":3},{"credentials":{"notionApi":{"name":"API Notion"}},"name":"Write Recap","parameters":{"blockId":{"__rl":true,"mode":"id","value":"={{ $json.notionPageId }}"},"blockUi":{"blockValues":[{"textContent":"={{ $json.chunk }}"}]},"resource":"block"},"position":[6288,1984],"type":"n8n-nodes-base.notion","typeVersion":2.2},{"credentials":{"notionApi":{"name":"API Notion"}},"name":"Header Transcript","parameters":{"blockId":{"__rl":true,"mode":"id","value":"={{ $('Notion Seite erstellen').first().json.id }}"},"blockUi":{"blockValues":[{"textContent":"Transcript","type":"heading_1"}]},"resource":"block"},"position":[6288,2176],"type":"n8n-nodes-base.notion","typeVersion":2.2},{"name":"Chunk Transcript","parameters":{"jsCode":"const CHUNK_SIZE = 1900;\nconst webhookData = $('Webhook1').first().json.body;\nconst text = webhookData.transcript || '';\nconst notionPageId = $('Notion Seite erstellen').first().json.id;\nconst chunks = [];\nfor (let i = 0; i < text.length; i += CHUNK_SIZE) {\n  chunks.push(text.slice(i, i + CHUNK_SIZE));\n}\nreturn chunks.map(chunk => ({ json: { chunk, notionPageId } }));"},"position":[6512,2176],"type":"n8n-nodes-base.code","typeVersion":2},{"name":"Loop Transcript","parameters":{"options":{}},"position":[6736,2176],"type":"n8n-nodes-base.splitInBatches","typeVersion":3},{"credentials":{"notionApi":{"name":"API Notion"}},"name":"Write Transcript","parameters":{"blockId":{"__rl":true,"mode":"id","value":"={{ $json.notionPageId }}"},"blockUi":{"blockValues":[{"textContent":"={{ $json.chunk }}"}]},"resource":"block"},"position":[6960,1936],"type":"n8n-nodes-base.notion","typeVersion":2.2},{"name":"Prepare Data","parameters":{"assignments":{"assignments":[{"name":"googleDocId","type":"string","value":"={{ $('Felder f√ºr Notion').item.json.GoogleDocId }}"},{"name":"notionPageUrl","type":"string","value":"=https://www.notion.so/{{ $('Notion Seite erstellen').first().json.id.replace(/-/g, '') }}"},{"name":"meetingTitle","type":"string","value":"={{ $('Bereinige Titel').item.json.splittedTitle }}"}]},"options":{}},"position":[7184,2128],"type":"n8n-nodes-base.set","typeVersion":3.4},{"name":"Threema L√∂schanforderung senden","parameters":{"jsonBody":"={\n  \"action\": \"send\",\n  \"to\": \"{{ $('Config').first().json.threemaTo }}\",\n  \"text\": \"‚úÖ Meeting-Transkript erstellt!\\n\\nüìù {{ $json.meetingTitle }}\\nüîó Notion: {{ $json.notionPageUrl }}\\n\\n‚ùì Soll das tempor√§re Google Doc gel√∂scht werden?\\n\\nAntworte mit:\\n‚úÖ JA - zum L√∂schen\\n‚ùå NEIN - zum Behalten\",\n  \"gatewayId\": \"{{ $('Config').first().json.threemaE2E }}\",\n  \"gatewaySecret\": \"{{ $('Config').first().json['secret*2'] }}\",\n  \"gatewayPrivateKey\": \"{{ $('Config').first().json.private }}\",\n  \"recipientPublicKey\": \"7c2138caab9f8da92b0141593e634435e5e5b920667d3e2c9610f1b4a1e3497b\"\n}","method":"POST","options":{},"sendBody":true,"specifyBody":"json","url":"https://threema-decrypt.vercel.app/api/decrypt"},"position":[7408,2224],"type":"n8n-nodes-base.httpRequest","typeVersion":4.2},{"credentials":{"googleApi":{"name":"n8n Sheets Service"}},"name":"Google Dok l√∂schen","parameters":{"authentication":"serviceAccount","fileId":{"__rl":true,"mode":"id","value":"={{ $json.googleDocId }}"},"operation":"deleteFile","options":{}},"position":[8304,2320],"type":"n8n-nodes-base.googleDrive","typeVersion":3},{"name":"Dok ID speichern","parameters":{"jsCode":"const staticData = $getWorkflowStaticData('global');\n\n// Speichern mit Timestamp als Key\nstaticData.pendingDeletion = {\n  googleDocId: $json.googleDocId,\n  meetingTitle: $json.meetingTitle,\n  timestamp: Date.now()\n};\n\nreturn [$input.item];"},"position":[6960,2128],"type":"n8n-nodes-base.code","typeVersion":2},{"name":"Dok ID holen","parameters":{"jsCode":"const staticData = $getWorkflowStaticData('global');\n\nconst pending = staticData.pendingDeletion;\n\nif (!pending || !pending.googleDocId) {\n  throw new Error('Keine ausstehende L√∂schanforderung gefunden');\n}\n\ndelete staticData.pendingDeletion;\n\nreturn [{\n  json: {\n    ...$input.item.json,\n    googleDocId: pending.googleDocId,\n    meetingTitle: pending.meetingTitle\n  }\n}];"},"position":[8080,2320],"type":"n8n-nodes-base.code","typeVersion":2}],"settings":{"availableInMCP":true,"callerPolicy":"workflowsFromSameOwner","executionOrder":"v1","timeSavedMode":"fixed"}}