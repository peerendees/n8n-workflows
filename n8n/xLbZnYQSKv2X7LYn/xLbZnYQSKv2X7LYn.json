{"active":false,"connections":{"Alle Angaben holen":{"main":[[{"index":0,"node":"Anschluss frei?","type":"main"}]]},"Alle Eintr√§ge pr√ºfen":{"main":[[],[{"index":0,"node":"üì± √§lter als 2h","type":"main"}]]},"Anruferzeit pr√ºfen":{"main":[[{"index":0,"node":"Eintr√§ge pr√ºfen","type":"main"}]]},"Anschluss frei?":{"main":[[{"index":0,"node":"Anschluss f√ºr Gespr√§ch belegt","type":"main"}],[{"index":0,"node":"Eintr√§ge pr√ºfen","type":"main"}]]},"Anschluss f√ºr Gespr√§ch belegt":{"main":[[{"index":0,"node":"fonio Outbound","type":"main"}]]},"Anschluss nach Gespr√§ch freigeben":{"main":[[{"index":0,"node":"Eintr√§ge pr√ºfen","type":"main"}]]},"Eintrag l√∂schen":{"main":[[{"index":0,"node":"Alle Eintr√§ge pr√ºfen","type":"main"}]]},"Eintr√§ge pr√ºfen":{"main":[[],[{"index":0,"node":"Alle Angaben holen","type":"main"}]]},"Lies alle Anschl√ºsse":{"main":[[{"index":0,"node":"Alle Eintr√§ge pr√ºfen","type":"main"}]]},"Zeitplan Bereinigung":{"main":[[{"index":0,"node":"Lies alle Anschl√ºsse","type":"main"}]]},"fonio Outbound":{"main":[[{"index":0,"node":"Anschluss nach Gespr√§ch freigeben","type":"main"}]]},"fonio-Outbound starten":{"main":[[{"index":0,"node":"Anruferzeit pr√ºfen","type":"main"}]]},"üì± √§lter als 2h":{"main":[[{"index":0,"node":"Eintrag l√∂schen","type":"main"}],[{"index":0,"node":"Alle Eintr√§ge pr√ºfen","type":"main"}]]}},"name":"KIS 17 fonio-Outbound Trigger","nodes":[{"name":"Sticky Note","parameters":{"color":2,"content":"**Hauptworkflow**\n‚Äì Trigger: Zeitschalter jede Minute\n‚Äì Aufgabe: fonio-Outbound starten","height":240,"width":272},"position":[-152,-176],"type":"n8n-nodes-base.stickyNote","typeVersion":1},{"name":"Sticky Note1","parameters":{"color":2,"content":"**Workflow Bereinigung**\n‚Äì Trigger: Zeitschalter alle 30 Minuten\n‚Äì Aufgabe: Datenbank mit gesperrten Telefonnummern bereinigen, die √§lter als 2 h sind.","height":256,"width":448},"position":[-128,80],"type":"n8n-nodes-base.stickyNote","typeVersion":1},{"name":"üì± √§lter als 2h","parameters":{"conditions":{"combinator":"and","conditions":[{"leftValue":"=const createdAt = new Date($json.createdAt);\nconst now = new Date();\nconst diffHours = (now - createdAt) / (1000 * 60 * 60);\ndiffHours > 2","operator":{"operation":"equals","type":"boolean"},"rightValue":true}],"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":1}},"options":{"looseTypeValidation":true}},"position":[608,128],"type":"n8n-nodes-base.if","typeVersion":2},{"name":"fonio-Outbound starten","parameters":{"httpMethod":"POST","options":{},"path":"kis17_anruf_trigger"},"position":[-64,-96],"type":"n8n-nodes-base.webhook","typeVersion":2.1,"webhookId":"c57d0fdb-cb7a-4dc5-95b3-5102a559f160"},{"name":"Anruferzeit pr√ºfen","parameters":{"jsCode":"// *** PARAMETER: Zeitfenster in Minuten ***\nconst ZEITFENSTER_MINUTEN = 20;\n\n// Berechne Zeitfenster in Millisekunden\nconst zeitfensterMs = ZEITFENSTER_MINUTEN * 60000;\n\n// Hole die records aus dem body\nconst records = $input.first().json.body.records;\n\n// Aktuelle Zeit\nconst now = new Date();\n\n// Zeitfenster\nconst windowStart = now.getTime() - zeitfensterMs;\nconst windowEnd = now.getTime() + zeitfensterMs;\n\n// Filtere records nach Zeitfenster\nconst results = records.filter(record => {\n  const buchungstermin = record.buchungstermin;\n  \n  if (!buchungstermin) return false;\n  \n  try {\n    const bookingTime = new Date(buchungstermin);\n    if (isNaN(bookingTime.getTime())) return false;\n    \n    const bookingTimestamp = bookingTime.getTime();\n    return bookingTimestamp >= windowStart && bookingTimestamp <= windowEnd;\n  } catch (error) {\n    return false;\n  }\n});\n\n// R√ºckgabe im richtigen Format f√ºr n8n\nreturn results.map(record => ({ json: record }));"},"position":[160,-96],"type":"n8n-nodes-base.code","typeVersion":2},{"name":"Eintr√§ge pr√ºfen","parameters":{"options":{}},"position":[384,-96],"type":"n8n-nodes-base.splitInBatches","typeVersion":3},{"name":"Alle Eintr√§ge pr√ºfen","parameters":{"options":{"reset":false}},"position":[384,176],"type":"n8n-nodes-base.splitInBatches","typeVersion":3},{"name":"Eintrag l√∂schen","parameters":{"dataTableId":{"__rl":true,"cachedResultName":"fonio outbound","cachedResultUrl":"/projects/yr4Hj71ou1NOsi2p/datatables/AWHMZa5eXE6aZY7g","mode":"list","value":"AWHMZa5eXE6aZY7g"},"filters":{"conditions":[{"keyName":"phone","keyValue":"={{ $json.phone }}"}]},"matchType":"allConditions","operation":"deleteRows","options":{}},"position":[832,200],"type":"n8n-nodes-base.dataTable","typeVersion":1},{"alwaysOutputData":true,"name":"Alle Angaben holen","parameters":{"dataTableId":{"__rl":true,"cachedResultName":"fonio outbound","cachedResultUrl":"/projects/yr4Hj71ou1NOsi2p/datatables/AWHMZa5eXE6aZY7g","mode":"list","value":"AWHMZa5eXE6aZY7g"},"filters":{"conditions":[{"keyName":"phone","keyValue":"={{ $json.telefon }}"}]},"matchType":"allConditions","operation":"get"},"position":[608,-240],"type":"n8n-nodes-base.dataTable","typeVersion":1},{"name":"Anschluss frei?","parameters":{"conditions":{"combinator":"and","conditions":[{"leftValue":"={{ !$json.telefon || $json.telefon === '' }}","operator":{"operation":"true","singleValue":true,"type":"boolean"},"rightValue":"={{ $json.length === 0 }}"}],"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3}},"options":{}},"position":[832,-240],"type":"n8n-nodes-base.if","typeVersion":2.3},{"name":"fonio Outbound","parameters":{"options":{},"url":"https://app.fonio.ai/api/public/v1/outbound_call"},"position":[1280,-240],"type":"n8n-nodes-base.httpRequest","typeVersion":4.3},{"name":"Anschluss f√ºr Gespr√§ch belegt","parameters":{"columns":{"attemptToConvertTypes":false,"convertFieldsToString":false,"mappingMode":"defineBelow","matchingColumns":["phone"],"schema":[{"defaultMatch":false,"display":true,"displayName":"phone","readOnly":false,"removed":false,"required":false,"type":"string"}],"value":{}},"dataTableId":{"__rl":true,"cachedResultName":"fonio outbound","cachedResultUrl":"/projects/yr4Hj71ou1NOsi2p/datatables/AWHMZa5eXE6aZY7g","mode":"list","value":"AWHMZa5eXE6aZY7g"},"options":{}},"position":[1056,-240],"type":"n8n-nodes-base.dataTable","typeVersion":1},{"name":"Anschluss nach Gespr√§ch freigeben","parameters":{"dataTableId":{"__rl":true,"cachedResultName":"fonio outbound","cachedResultUrl":"/projects/yr4Hj71ou1NOsi2p/datatables/AWHMZa5eXE6aZY7g","mode":"list","value":"AWHMZa5eXE6aZY7g"},"filters":{"conditions":[{"keyName":"phone"}]},"matchType":"allConditions","operation":"deleteRows","options":{}},"position":[1504,-168],"type":"n8n-nodes-base.dataTable","typeVersion":1},{"name":"Lies alle Anschl√ºsse","parameters":{"dataTableId":{"__rl":true,"cachedResultName":"fonio outbound","cachedResultUrl":"/projects/yr4Hj71ou1NOsi2p/datatables/AWHMZa5eXE6aZY7g","mode":"list","value":"AWHMZa5eXE6aZY7g"},"operation":"get"},"position":[160,176],"type":"n8n-nodes-base.dataTable","typeVersion":1},{"name":"Zeitplan Bereinigung","parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":30}]}},"position":[-64,176],"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2}],"settings":{"availableInMCP":false,"callerPolicy":"workflowsFromSameOwner","executionOrder":"v1"}}