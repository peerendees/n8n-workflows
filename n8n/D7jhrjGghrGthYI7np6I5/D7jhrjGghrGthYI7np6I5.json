{"active":true,"connections":{"Code in JavaScript":{"main":[[{"index":0,"node":"PrioritÃ¤ts-Router","type":"main"}]]},"Email Trigger (IMAP)":{"main":[[{"index":0,"node":"Code in JavaScript","type":"main"}]]}},"name":"BERENT E-Mail Wizard IONOS","nodes":[{"credentials":{"imap":{"name":"IONOS IMAP"}},"name":"Email Trigger (IMAP)","parameters":{"options":{},"postProcessAction":"nothing"},"position":[0,0],"type":"n8n-nodes-base.emailReadImap","typeVersion":2.1},{"name":"Code in JavaScript","parameters":{"jsCode":"// ðŸŽ¯ IONOS E-Mail-Klassifizierung\n// Analysiert eingehende Mails und vergibt PrioritÃ¤t + Kategorie\n\nconst email = $input.item.json;\n\n// ðŸ“§ Email-Daten extrahieren\nconst from = (email.from?.text || email.from || '').toLowerCase();\nconst subject = (email.subject || '').toLowerCase();\nconst textBody = (email.textPlain || email.text || '').toLowerCase();\n\n// ðŸŽ¯ Scoring-System\nlet priority = 'NORMAL';\nlet category = 'GENERAL';\nlet targetFolder = 'INBOX';\nlet notifyThreema = false;\nlet markAsRead = false;\n\n// ============================================\n// ðŸ”´ CRITICAL - Server-Alerts, System-Fehler\n// ============================================\nconst criticalKeywords = [\n  'server down',\n  'error',\n  'fehler',\n  'critical',\n  'kritisch',\n  'ausfall',\n  'notfall',\n  'emergency'\n];\n\nconst criticalSenders = [\n  'server@',\n  'noreply@server',\n  'monitoring@',\n  'alerts@'\n];\n\nif (\n  criticalKeywords.some(keyword => subject.includes(keyword) || textBody.includes(keyword)) ||\n  criticalSenders.some(sender => from.includes(sender))\n) {\n  priority = 'CRITICAL';\n  category = 'SERVER_ALERT';\n  targetFolder = 'ðŸš¨ Critical';\n  notifyThreema = true;\n}\n\n// ============================================\n// ðŸŸ  URGENT - Wichtige Kunden, Dringend\n// ============================================\nconst urgentKeywords = [\n  'dringend',\n  'urgent',\n  'asap',\n  'sofort',\n  'wichtig',\n  'deadline',\n  'frist'\n];\n\nconst vipSenders = [\n  // HIER DEINE WICHTIGEN ABSENDER EINTRAGEN:\n  // 'wichtiger-kunde@example.com',\n  // 'chef@firma.de',\n];\n\nif (\n  urgentKeywords.some(keyword => subject.includes(keyword)) ||\n  vipSenders.some(vip => from.includes(vip))\n) {\n  priority = 'URGENT';\n  category = 'VIP';\n  targetFolder = 'âš¡ Urgent';\n  notifyThreema = true;\n}\n\n// ============================================\n// ðŸŸ¡ HIGH - Projekte, Termine, Rechnungen\n// ============================================\nconst projectKeywords = [\n  'projekt',\n  'project',\n  'meeting',\n  'termin',\n  'rechnung',\n  'invoice',\n  'vertrag',\n  'contract',\n  'angebot',\n  'offer'\n];\n\nif (projectKeywords.some(keyword => subject.includes(keyword))) {\n  priority = 'HIGH';\n  category = 'PROJECT';\n  targetFolder = 'ðŸ“Œ High Priority';\n  notifyThreema = false; // Kommt in Daily Digest\n}\n\n// ============================================\n// ðŸ”µ LOW - Newsletter, Marketing\n// ============================================\nconst newsletterIndicators = [\n  'newsletter',\n  'noreply@',\n  'no-reply@',\n  'marketing@',\n  'info@',\n  'unsubscribe',\n  'abmelden'\n];\n\nif (newsletterIndicators.some(indicator => from.includes(indicator) || textBody.includes(indicator))) {\n  priority = 'LOW';\n  category = 'NEWSLETTER';\n  targetFolder = 'ðŸ“š Archive/Newsletter';\n  markAsRead = true;  // Newsletter direkt als gelesen\n  notifyThreema = false;\n}\n\n// ============================================\n// ðŸ“Š RÃ¼ckgabe-Objekt\n// ============================================\nreturn {\n  json: {\n    // Original Email-Daten\n    messageId: email.messageId,\n    from: email.from?.text || email.from,\n    to: email.to?.text || email.to,\n    subject: email.subject,\n    date: email.date,\n    textPlain: (email.textPlain || '').substring(0, 500), // Erste 500 Zeichen\n    \n    // Klassifizierung\n    classification: {\n      priority,\n      category,\n      targetFolder,\n      notifyThreema,\n      markAsRead,\n      processedAt: new Date().toISOString()\n    },\n    \n    // FÃ¼r Threema-Notification\n    notification: {\n      title: `${priority}: ${email.subject}`,\n      preview: (email.textPlain || '').substring(0, 200)\n    }\n  }\n};"},"position":[208,0],"type":"n8n-nodes-base.code","typeVersion":2},{"name":"PrioritÃ¤ts-Router","parameters":{"options":{},"rules":{"values":[{"conditions":{"combinator":"and","conditions":[{"leftValue":"","operator":{"operation":"equals","type":"string"},"rightValue":""}],"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3}}}]}},"position":[416,0],"type":"n8n-nodes-base.switch","typeVersion":3.4}],"settings":{"availableInMCP":false,"callerPolicy":"workflowsFromSameOwner","executionOrder":"v1","timeSavedMode":"fixed"}}