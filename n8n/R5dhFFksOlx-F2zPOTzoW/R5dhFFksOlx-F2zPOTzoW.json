{"active":true,"connections":{"Code in JavaScript":{"main":[[{"index":0,"node":"If","type":"main"}]]},"Config":{"main":[[{"index":0,"node":"Nachricht entschl√ºsseln via Vercel","type":"main"},{"index":0,"node":"Threema Send E2E","type":"main"}]]},"If":{"main":[[{"index":0,"node":"Threema: Datei gel√∂scht","type":"main"}],[{"index":0,"node":"Threema: Datei nicht gel√∂scht","type":"main"}]]},"Nachricht entschl√ºsseln via Vercel":{"main":[[{"index":0,"node":"Code in JavaScript","type":"main"}]]},"Webhook Threema Work Gateway":{"main":[[{"index":0,"node":"Config","type":"main"}]]},"When clicking ‚ÄòExecute workflow‚Äô":{"main":[[{"index":0,"node":"Config","type":"main"}]]}},"name":"Threema Work Kommunikation Prototyp","nodes":[{"name":"Config","parameters":{"assignments":{"assignments":[{"name":"threemaFrom","type":"string","value":"*BERENT1"},{"name":"threemaTo","type":"string","value":"BUMFMZ39"},{"name":"secret","type":"string","value":"18DOvPKBV7ize3Nh"},{"name":"threemaE2E","type":"string","value":"*BERENT2"},{"name":"private","type":"string","value":"bd9264814eb3cf8657533d57dd8e0d8629eb9bf348f317ecbe5672e4032ed534"}]},"options":{}},"position":[-256,-480],"type":"n8n-nodes-base.set","typeVersion":3.4},{"name":"Webhook Threema Work Gateway","parameters":{"httpMethod":"POST","options":{},"path":"threema-work-gateway-5cdcca9c-5fa8-44ef-b3bc-668fae5a46a6"},"position":[-480,-384],"type":"n8n-nodes-base.webhook","typeVersion":2.1,"webhookId":"5cdcca9c-5fa8-44ef-b3bc-668fae5a46a6"},{"name":"Code in JavaScript","parameters":{"jsCode":"const decryptedText = $json.text || '';\n\n// Bereinige: Nur normale ASCII-Zeichen behalten, dann trimmen\nconst cleanText = decryptedText\n  .replace(/[^\\x20-\\x7E]/g, '')  // Alle Nicht-ASCII Zeichen entfernen\n  .trim()\n  .toLowerCase();\n\nconsole.log('Bereinigter Text:', cleanText);\n\n// Pr√ºfen ob JA oder NEIN (alles bereits lowercase)\nconst isApproval = ['ja', 'jaa', 'yes'].includes(cleanText);\nconst isRejection = ['nein', 'nee', 'no'].includes(cleanText);\n\nreturn [{\n  json: {\n    originalText: decryptedText,\n    cleanText: cleanText,\n    isApproval: isApproval,\n    isRejection: isRejection,\n    from: $json.from\n  }\n}];"},"position":[192,-384],"type":"n8n-nodes-base.code","typeVersion":2},{"name":"If","parameters":{"conditions":{"combinator":"and","conditions":[{"leftValue":"={{ $json.isApproval }}","operator":{"operation":"true","singleValue":true,"type":"boolean"},"rightValue":""}],"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3}},"options":{}},"position":[416,-384],"type":"n8n-nodes-base.if","typeVersion":2.3},{"name":"Nachricht entschl√ºsseln via Vercel","parameters":{"jsonBody":"={\n  \"box\": \"{{ $('Webhook Threema Work Gateway').item.json.body.box }}\",\n  \"nonce\": \"{{ $('Webhook Threema Work Gateway').item.json.body.nonce }}\",\n  \"from\": \"{{ $('Webhook Threema Work Gateway').item.json.body.from }}\",\n  \"gatewayPrivateKey\": \"{{ $json.private }}\",\n  \"senderPublicKey\": \"7c2138caab9f8da92b0141593e634435e5e5b920667d3e2c9610f1b4a1e3497b\"\n}","method":"POST","options":{},"sendBody":true,"specifyBody":"json","url":"https://threema-decrypt.vercel.app/api/decrypt"},"position":[-32,-384],"type":"n8n-nodes-base.httpRequest","typeVersion":4.4},{"name":"Threema: Datei gel√∂scht","parameters":{"method":"POST","options":{},"queryParameters":{"parameters":[{"name":"secret","value":"={{ $('Config').first().json.secret }}"},{"name":"from","value":"={{ $('Config').first().json.threemaFrom }}"},{"name":"to","value":"={{ $('Config').first().json.threemaTo }}"},{"name":"text","value":"=‚úÖ Das tempor√§re Google-Dokument wurde gel√∂scht."}]},"sendQuery":true,"url":"https://msgapi.threema.ch/send_simple"},"position":[640,-480],"type":"n8n-nodes-base.httpRequest","typeVersion":4.2},{"name":"Threema: Datei nicht gel√∂scht","parameters":{"method":"POST","options":{},"queryParameters":{"parameters":[{"name":"secret","value":"={{ $('Config').first().json.secret }}"},{"name":"from","value":"={{ $('Config').first().json.threemaFrom }}"},{"name":"to","value":"={{ $('Config').first().json.threemaTo }}"},{"name":"text","value":"=üö´ Das tempor√§re Google-Dokument wurde nicht gel√∂scht."}]},"sendQuery":true,"url":"https://msgapi.threema.ch/send_simple"},"position":[640,-288],"type":"n8n-nodes-base.httpRequest","typeVersion":4.2},{"name":"When clicking ‚ÄòExecute workflow‚Äô","parameters":{},"position":[-480,-576],"type":"n8n-nodes-base.manualTrigger","typeVersion":1},{"name":"Threema Send E2E","parameters":{"bodyParameters":{"parameters":[{"name":"from","value":"={{ $('Config').item.json.threemaFrom }}"},{"name":"to","value":"={{ $('Config').item.json.threemaTo }}"},{"name":"secret","value":"={{ $('Config').first().json.secret }}"},{"name":"text","value":"=‚úÖ Meeting-Transkript erstellt!\n\nüìù {{ $json.meetingTitle }}\nüîó Notion: {{ $json.notionPageUrl }}\n\n‚ùì Soll das tempor√§re Google Doc gel√∂scht werden?\n\nAntworte mit:\n‚úÖ JA - zum L√∂schen\n‚ùå NEIN - zum Behalten"}]},"contentType":"form-urlencoded","method":"POST","options":{},"sendBody":true,"url":"https://msgapi.threema.ch/send_e2e"},"position":[-32,-576],"type":"n8n-nodes-base.httpRequest","typeVersion":4.2}],"settings":{"availableInMCP":true,"binaryMode":"separate","callerPolicy":"workflowsFromSameOwner","executionOrder":"v1","timeSavedMode":"fixed"}}