{"name":"n8n GitHub Backup","nodes":[{"parameters":{"assignments":{"assignments":[{"id":"threema-from","name":"threemaFrom","value":"*BERENT1","type":"string"},{"id":"threema-to","name":"threemaTo","value":"BUMFMZ39","type":"string"},{"id":"threema-secret","name":"secret","value":"18DOvPKBV7ize3Nh","type":"string"}]},"options":{}},"name":"Config","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1568,176],"id":"06ee2269-a63d-4ef4-931a-10d0bf3b2d9f"},{"parameters":{"jsCode":"\nconst config = $('Config').first().json;\nconst rawWorkflows = $input.first().json.data || [];\n\n// Wir filtern die Liste: Nur Workflows mit Name und ID\nconst workflows = rawWorkflows.filter(w => w.id && w.name);\n\nreturn {\n  json: {\n    workflows: workflows,\n    anzahl: workflows.length, // Das sollte jetzt 31 sein\n    index: 0,\n    stats: { success: 0, skipped: 0, errors: 0 },\n    threemaSecret: $('Config').first().json.secret,\n    threemaFrom: $('Config').first().json.threemaFrom,\n    threemaTo: $('Config').first().json.threemaTo\n  }\n};"},"name":"Initialisierung","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1120,176],"id":"1ac7e770-3c64-4429-90ea-72f91c339ac8"},{"parameters":{"jsCode":"const data = $input.first().json;\nconst wf = data.workflows[data.index];\n\n// 1. Absolut stabiles Objekt ohne jegliche IDs oder Zeitstempel\nconst wfClean = {\n  name: wf.name,\n  nodes: wf.nodes,\n  connections: wf.connections,\n  settings: wf.settings || {},\n  staticData: wf.staticData || null,\n  meta: wf.meta || {}\n};\n\n// 2. Stabiler Dateiname (Umlaute erlaubt, Leerzeichen -> Bindestrich)\nconst cleanName = wf.name\n  .replace(/[^a-zA-Z0-9-_√§√∂√º√Ñ√ñ√ú√ü ]/g, '')\n  .replace(/\\s+/g, '-')\n  .toLowerCase();\n\n// 3. Kompakter Base64-String (WICHTIG: Kein Formatierung/Spaces f√ºr den Vergleich!)\nconst content = btoa(unescape(encodeURIComponent(JSON.stringify(wfClean))));\n\nreturn {\n  json: {\n    ...data,\n    currentWorkflow: {\n      id: wf.id,\n      name: wf.name,\n      filepath: `n8n/${wf.id}/${cleanName}.json`,\n      content: content,\n      message: `ü§ñ Auto-Backup: ${wf.name}`\n    }\n  }\n};"},"name":"Extrahiere Workflow","type":"n8n-nodes-base.code","typeVersion":2,"position":[-896,176],"id":"abae59ad-b5d7-4a12-bb79-f400f074c771"},{"parameters":{"url":"https://n8n.srv1098810.hstgr.cloud/api/v1/workflows","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","options":{}},"name":"Alle Workflows holen","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1344,176],"id":"7b125df3-6daa-4bef-a16c-6e1f3fedc45c","credentials":{"httpHeaderAuth":{"id":"oaJkHRuARNWjW2UA","name":"API n8n f√ºr n8n"}}},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":15}]}},"name":"Zeitplan: alle 15 Min","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-1792,80],"id":"1521e8bf-853f-4cab-a2c1-c7f5eecc0b84"},{"parameters":{},"name":"Bei Klick ausf√ºhren","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-1792,272],"id":"850a258d-5474-4a7d-9dc9-07bbaf916d3f"},{"parameters":{"resource":"file","operation":"get","owner":{"__rl":true,"value":"peerendees","mode":"name"},"repository":{"__rl":true,"value":"n8n-workflows","mode":"name"},"filePath":"={{ $json.currentWorkflow.filepath }}","asBinaryProperty":false,"additionalParameters":{}},"name":"GitHub pr√ºfen","type":"n8n-nodes-base.github","typeVersion":1.1,"position":[-672,96],"id":"2dda8f29-da5a-43ee-9e17-e2793a820f33","webhookId":"3883c216-b507-43d2-88f5-2c463c838b99","credentials":{"githubApi":{"id":"uE78TkEY6lWLV4oP","name":"API GitHub"}},"onError":"continueRegularOutput"},{"parameters":{"conditions":{"conditions":[{"id":"check-action","leftValue":"={{ $json.currentWorkflow.action }}","rightValue":"skip","operator":{"type":"string","operation":"notEqual"}}]},"options":{}},"name":"Gibt es √Ñnderungen?","type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-224,96],"id":"81a95e48-599c-4f86-80f5-7ea185df8552"},{"parameters":{"method":"PUT","url":"=https://api.github.com/repos/peerendees/n8n-workflows/contents/{{ $json.currentWorkflow.filepath }}","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"json","jsonBody":"={{\n{\n  \"message\": $json.currentWorkflow.message,\n  \"content\": $json.currentWorkflow.content,\n  \"branch\": \"main\",\n  \"sha\": $json.currentWorkflow.sha || undefined\n}\n}}","options":{}},"name":"Nach GitHub schieben","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[0,0],"id":"8ad5faa3-d267-41e1-99f5-909cfd5df91b","credentials":{"httpHeaderAuth":{"id":"aZMd0okvVFkvyGnj","name":"GitHub Token"}}},{"parameters":{"jsCode":"const data = $node[\"Handlung bestimmen\"].json;\nconst newStats = { ...data.stats };\n\n// Hier NUR success erh√∂hen\nnewStats.success += 1;\n\nreturn {\n  json: { \n    ...data, \n    stats: newStats, \n    index: data.index + 1 \n  }\n};"},"name":"Statistik aktualisieren","type":"n8n-nodes-base.code","typeVersion":2,"position":[224,0],"id":"1b005dff-b4e0-448d-9c70-e7276defde1c"},{"parameters":{"jsCode":"const data = $node[\"Handlung bestimmen\"].json;\nconst newStats = { ...data.stats };\n\n// Sicherstellen, dass hier SKIPPED erh√∂ht wird, nicht success!\nnewStats.skipped += 1; \n\nreturn {\n  json: { \n    ...data, \n    stats: newStats, \n    index: data.index + 1 \n  }\n};"},"name":"Statistiken √ºberspringen","type":"n8n-nodes-base.code","typeVersion":2,"position":[224,192],"id":"a6101195-3c60-4cc6-a20d-2e7e8b55325c"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"check-loop","leftValue":"={{ $json.index }}","rightValue":"={{ $json.anzahl }}","operator":{"type":"number","operation":"lt"}}],"combinator":"and"},"options":{}},"name":"Schleife pr√ºfen","type":"n8n-nodes-base.if","typeVersion":2.3,"position":[448,192],"id":"db725df4-6d8b-412e-a6c4-c8f5c55b6c36"},{"parameters":{"jsCode":"\nconst data = $input.first().json;\nreturn {\n  json: {\n    total: data.anzahl,\n    success: data.stats.success,\n    errors: data.stats.errors,\n    skipped: data.stats.skipped,\n    timestamp: new Date().toLocaleString('de-DE', { timeZone: 'Europe/Berlin' }),\n    threemaSecret: data.threemaSecret,\n    threemaFrom: data.threemaFrom,\n    threemaTo: data.threemaTo\n  }\n};\n"},"name":"Statistik abschlie√üen","type":"n8n-nodes-base.code","typeVersion":2,"position":[672,192],"id":"5b148c05-0e3e-44a2-a24f-ab499c2ce411"},{"parameters":{"method":"POST","url":"https://msgapi.threema.ch/send_simple","sendQuery":true,"queryParameters":{"parameters":[{"name":"secret","value":"={{ $('Config').first().json.secret }}"},{"name":"from","value":"={{ $json.threemaFrom }}"},{"name":"to","value":"={{ $json.threemaTo }}"},{"name":"text","value":"=üíæ n8n GitHub Backup\n\n‚ö°Ô∏è Statistik:\nüóÑÔ∏è Erfolgreich: {{ $json.success }}\n‚è≠Ô∏è √úbersprungen: {{ $json.skipped }}\n‚ô®Ô∏è Fehler: {{ $json.errors }}\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nŒ£ Gesamt: {{ $json.total }}\n\nüïê {{ $json.timestamp }}"}]},"options":{}},"name":"Info per Threema","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[896,192],"id":"1e56fc4f-c65b-45eb-91fe-ae780b4fde25"},{"parameters":{"jsCode":"const local = $node[\"Extrahiere Workflow\"].json.currentWorkflow;\nconst github = $node[\"GitHub pr√ºfen\"].json;\nconst fullContext = $node[\"Extrahiere Workflow\"].json;\n\nlet action = 'skip';\nlet sha = (github && github.sha) ? github.sha : null;\n\nif (sha) {\n  // WICHTIG: GitHub formatiert Base64 oft mit Zeilenumbr√ºchen. Wir l√∂schen alle Whitespaces!\n  const remoteContent = (github.content || '').replace(/\\s/g, '');\n  const localContent = local.content.replace(/\\s/g, '');\n  \n  if (remoteContent !== localContent) {\n    action = 'update';\n  } else {\n    action = 'skip';\n  }\n} else {\n  action = 'create';\n}\n\nreturn {\n  json: { ...fullContext, currentWorkflow: { ...local, action: action, sha: sha } }\n};"},"name":"Handlung bestimmen","type":"n8n-nodes-base.code","typeVersion":2,"position":[-448,96],"id":"a0ca82ae-270e-4aa5-a974-dae01ac84d8b"}],"connections":{"Config":{"main":[[{"node":"Alle Workflows holen","type":"main","index":0}]]},"Initialisierung":{"main":[[{"node":"Extrahiere Workflow","type":"main","index":0}]]},"Extrahiere Workflow":{"main":[[{"node":"GitHub pr√ºfen","type":"main","index":0}]]},"Alle Workflows holen":{"main":[[{"node":"Initialisierung","type":"main","index":0}]]},"Zeitplan: alle 15 Min":{"main":[[{"node":"Config","type":"main","index":0}]]},"Bei Klick ausf√ºhren":{"main":[[{"node":"Config","type":"main","index":0}]]},"GitHub pr√ºfen":{"main":[[{"node":"Handlung bestimmen","type":"main","index":0}]]},"Gibt es √Ñnderungen?":{"main":[[{"node":"Nach GitHub schieben","type":"main","index":0}],[{"node":"Statistiken √ºberspringen","type":"main","index":0}]]},"Nach GitHub schieben":{"main":[[{"node":"Statistik aktualisieren","type":"main","index":0}]]},"Statistik aktualisieren":{"main":[[{"node":"Schleife pr√ºfen","type":"main","index":0}]]},"Statistiken √ºberspringen":{"main":[[{"node":"Schleife pr√ºfen","type":"main","index":0}]]},"Schleife pr√ºfen":{"main":[[{"node":"Extrahiere Workflow","type":"main","index":0}],[{"node":"Statistik abschlie√üen","type":"main","index":0}]]},"Statistik abschlie√üen":{"main":[[{"node":"Info per Threema","type":"main","index":0}]]},"Handlung bestimmen":{"main":[[{"node":"Gibt es √Ñnderungen?","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":true,"timeSavedMode":"fixed","callerPolicy":"workflowsFromSameOwner"},"staticData":null,"meta":{}}