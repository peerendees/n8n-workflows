{\rtf1\ansi\ansicpg1252\cocoartf2822
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0\fs24 \cf0 0\
updatedAt:2025-12-23T15:41:18.000Z\
createdAt:2025-11-22T15:05:15.611Z\
id:7BdKngA6qCAySGXs\
name:Prototype Gemini 3\
active:false\
isArchived:true\
nodes\
0\
parameters:\{empty object\}\
type:n8n-nodes-base.manualTrigger\
typeVersion:1\
position\
0:-400\
1:0\
id:bdb8a018-e32d-415d-a3a1-dd729779f8cb\
name:When clicking \'91Execute workflow\'92\
1\
parameters\
authentication:predefinedCredentialType\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.3\
position\
0:-192\
1:0\
id:eb6878db-9641-4096-b79b-61399547b911\
name:HTTP Request\
2\
parameters\
options:\{empty object\}\
type:@n8n/n8n-nodes-langchain.chatTrigger\
typeVersion:1.4\
position\
0:16\
1:0\
id:d3a34b06-e8db-4f60-89f5-37cf9a76482a\
name:When chat message received\
webhookId:ee094aa7-72ca-46b4-ad64-3c42c7cf0225\
connections\
When clicking \'91Execute workflow\'92\
main\
0\
0\
node:HTTP Request\
type:main\
index:0\
When chat message received\
main\
0:[empty array]\
settings\
executionOrder:v1\
staticData:null\
meta\
templateCredsSetupCompleted:true\
pinData:\{empty object\}\
versionId:4b0dac47-99ee-4002-abe4-29fc978701f2\
activeVersionId:null\
triggerCount:0\
shared\
0\
updatedAt:2025-11-22T15:05:15.618Z\
createdAt:2025-11-22T15:05:15.618Z\
role:workflow:owner\
workflowId:7BdKngA6qCAySGXs\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
1\
updatedAt:2025-12-31T20:26:38.184Z\
createdAt:2025-12-31T20:26:38.184Z\
id:85YcrXOnfCuBIP4l\
name:n8n \uc0\u8594  GitHub Sicherung\
active:false\
isArchived:false\
nodes\
0\
parameters\
rule\
interval\
0\
field:cronExpression\
expression:0 */15 * * *\
id:schedule-trigger\
name:Zeitplan: alle 15 Minuten\
type:n8n-nodes-base.scheduleTrigger\
typeVersion:1.2\
position\
0:-720\
1:-656\
1\
parameters\
method:GET\
url:=https://n8n.srv1098810.hstgr.cloud/api/v1/workflows\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
options\
response\
response\
responseFormat:json\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-496\
1:-656\
id:hole-alle-workflows\
name:Hole alle Workflows\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:API n8n\
2\
parameters\
jsCode:const workflows = $json.data || [];\\nreturn \{\\n  workflows: workflows,\\n  index: 0,\\n  anzahl: workflows.length,\\n  neu: 0,\\n  updates: 0,\\n  skip: 0,\\n  tabelle: []\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-272\
1:-656\
id:initialisierung\
name:Initialisierung\
3\
parameters\
mode:runOnceForEachItem\
jsCode:const r = $json; // Rucksack\\nconst wf = r.workflows[r.index];\\n\\n// \'dcberspringe archivierte Workflows\\nif (wf.isArchived === true) \{\\n  return null;\\n\}\\n\\nconst workflowId = wf.id || '';\\nconst workflowName = wf.name || 'Unnamed Workflow';\\nconst cleanName = String(workflowName).replace(/[^a-zA-Z0-9-_\'e4\'f6\'fc\'c4\'d6\'dc\'df ]/g, '').replace(/\\s+/g, '-').toLowerCase();\\n\\n// Neue Struktur: n8n/\{workflowId\}/\{workflowName\}.json\\nconst dateipfad = `n8n/$\{workflowId\}/$\{cleanName\}.json`;\\nconst workflowContent = Buffer.from(JSON.stringify(wf, null, 2)).toString('base64');\\n\\nreturn \{\\n  ...r,\\n  workflowId: workflowId,\\n  workflowName: workflowName,\\n  workflowData: wf,\\n  dateipfad: dateipfad,\\n  workflowContent: workflowContent,\\n  updatedAt: wf.updatedAt || wf.createdAt || new Date().toISOString()\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-48\
1:-656\
id:extrahiere-workflow\
name:Extrahiere Workflow\
4\
parameters\
resource:file\
operation:get\
owner\
__rl:true\
value:peerendees\
mode:name\
repository\
__rl:true\
value:n8n-workflows\
mode:list\
cachedResultName:n8n-workflows\
cachedResultUrl:https://github.com/peerendees/n8n-workflows\
filePath:=\{\{ $json.dateipfad \}\}\
asBinaryProperty:false\
additionalParameters\
reference:main\
type:n8n-nodes-base.github\
typeVersion:1.1\
position\
0:176\
1:-656\
id:pruefe-github-datei\
name:Pr\'fcfe GitHub Datei\
webhookId:694567e2-c3e8-4bfc-91af-aae5697aca36\
credentials\
githubApi\
id:uE78TkEY6lWLV4oP\
name:API GitHub\
onError:continueRegularOutput\
5\
parameters\
jsCode:const r = $json; // Rucksack\\nconst githubFile = $node["Pr\'fcfe GitHub Datei"].json;\\n\\nlet action = 'skip';\\nlet sha = null;\\nlet alteDateiZuLoeschen = null;\\n\\n// Pr\'fcfe ob Datei auf GitHub existiert\\nif (githubFile && !githubFile.error && githubFile.sha) \{\\n  sha = githubFile.sha;\\n  \\n  // Vergleich: Inhalt ge\'e4ndert?\\n  const remoteContent = (githubFile.content || '').replace(/\\s/g, '');\\n  const localContent = (r.workflowContent || '').replace(/\\s/g, '');\\n  \\n  if (remoteContent !== localContent) \{\\n    action = 'update';\\n  \}\\n\} else \{\\n  // Datei existiert nicht - k\'f6nnte umbenannt worden sein\\n  // Pr\'fcfe ob Ordner existiert und andere Dateien enth\'e4lt\\n  action = 'create';\\n\}\\n\\nreturn \{\\n  ...r,\\n  action: action,\\n  sha: sha,\\n  alteDateiZuLoeschen: alteDateiZuLoeschen\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:400\
1:-656\
id:bestimme-handlung\
name:Bestimme Handlung\
6\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-action\
leftValue:=\{\{ $json.action \}\}\
rightValue:skip\
operator\
type:string\
operation:notEquals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:624\
1:-656\
id:pruefe-ob-sichern\
name:Pr\'fcfe ob Sichern\
7\
parameters\
method:PUT\
url:=https://api.github.com/repos/peerendees/n8n-workflows/contents/\{\{ $json.dateipfad \}\}\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
bodyParameters\
parameters\
0\
name:message\
value:=\uc0\u55358 \u56598  Auto-Backup: \{\{ $json.workflowName \}\} (\{\{ $json.action \}\})\
1\
name:content\
value:=\{\{ $json.workflowContent \}\}\
2\
name:branch\
value:main\
3\
name:sha\
value:=\{\{ $json.sha || undefined \}\}\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:848\
1:-656\
id:sichere-auf-github\
name:Sichere auf GitHub\
credentials\
httpHeaderAuth\
id:aZMd0okvVFkvyGnj\
name:GitHub Token\
onError:continueRegularOutput\
8\
parameters\
mode:runOnceForEachItem\
jsCode:// Aktualisiere Statistiken\\n// Hole Rucksack von Bestimme Handlung\\nconst r = $node["Bestimme Handlung"].json;\\nconst githubResponse = $json;\\n\\nif (r.action === 'create') \{\\n  r.neu++;\\n\} else if (r.action === 'update') \{\\n  r.updates++;\\n\} else \{\\n  r.skip++;\\n\}\\n\\n// F\'fcge zur Tabelle hinzu\\nif (r.action !== 'skip') \{\\n  const status = githubResponse.error ? '\uc0\u10060  Fehler' : '\u9989  Erfolg';\\n  r.tabelle.push(`$\{status\} $\{r.action === 'create' ? 'NEU' : 'UPDATE'\}: $\{r.workflowName\}`);\\n\}\\n\\n// Z\'e4hler erh\'f6hen\\nr.index++;\\n\\nreturn r;\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1072\
1:-656\
id:aktualisiere-statistik\
name:Aktualisiere Statistik\
9\
parameters\
mode:runOnceForEachItem\
jsCode:// Wenn skip: Aktualisiere Statistik direkt\\nconst r = $json;\\n\\nr.skip++;\\nr.index++;\\n\\nreturn r;\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:624\
1:-720\
id:skip-statistik\
name:Skip Statistik\
10\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-loop\
leftValue:=\{\{ $json.index \}\}\
rightValue:=\{\{ $json.anzahl \}\}\
operator\
type:number\
operation:lt\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:1296\
1:-656\
id:schleife-pruefen\
name:Schleife pr\'fcfen\
11\
parameters\
jsCode:const r = $json;\\nconst wort = r.anzahl === 1 ? 'Workflow' : 'Workflows';\\n\\nreturn \{\\n  hasChanges: (r.neu + r.updates) > 0,\\n  text: `\uc0\u9989  Backup beendet: $\{r.anzahl\} $\{wort\} gepr\'fcft.\\n` +\\n        `Ergebnis: $\{r.neu\} neu, $\{r.updates\} aktualisiert, $\{r.skip\} unver\'e4ndert.\\n\\n` +\\n        `$\{r.tabelle.join('\\n') || 'Keine \'c4nderungen'\}`\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1520\
1:-656\
id:backup-statistik\
name:Backup-Statistik\
12\
parameters\
assignments\
assignments\
0\
id:threema-secret\
name:secret\
value:18DOvPKBV7ize3Nh\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:-720\
1:-592\
id:config\
name:Config\
13\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-has-changes\
leftValue:=\{\{ $json.hasChanges \}\}\
rightValue:true\
operator\
type:boolean\
operation:equals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:1744\
1:-656\
id:pruefe-aenderungen\
name:Pr\'fcfe \'c4nderungen\
14\
parameters\
method:POST\
url:https://msgapi.threema.ch/send_simple\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
contentType:form-urlencoded\
bodyParameters\
parameters\
0\
name:from\
value:*BERENT1\
1\
name:to\
value:BUMFMZ39\
2\
name:secret\
value:=\{\{ $('Config').first().json.secret \}\}\
3\
name:text\
value:=\{\{ $json.text \}\}\\n\\n\uc0\u55357 \u56599  https://github.com/peerendees/n8n-workflows/n8n\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:1968\
1:-656\
id:threema-benachrichtigung\
name:Threema Benachrichtigung\
credentials\
httpHeaderAuth\
id:nSNvIRCSAnKXrLyH\
name:API Threema Work BERENT1\
connections\
Zeitplan: alle 15 Minuten\
main\
0\
0\
node:Config\
type:main\
index:0\
Config\
main\
0\
0\
node:Hole alle Workflows\
type:main\
index:0\
Hole alle Workflows\
main\
0\
0\
node:Initialisierung\
type:main\
index:0\
Initialisierung\
main\
0\
0\
node:Extrahiere Workflow\
type:main\
index:0\
Extrahiere Workflow\
main\
0\
0\
node:Pr\'fcfe GitHub Datei\
type:main\
index:0\
Pr\'fcfe GitHub Datei\
main\
0\
0\
node:Bestimme Handlung\
type:main\
index:0\
Bestimme Handlung\
main\
0\
0\
node:Pr\'fcfe ob Sichern\
type:main\
index:0\
Pr\'fcfe ob Sichern\
main\
0\
0\
node:Sichere auf GitHub\
type:main\
index:0\
1\
0\
node:Skip Statistik\
type:main\
index:0\
Skip Statistik\
main\
0\
0\
node:Schleife pr\'fcfen\
type:main\
index:0\
Sichere auf GitHub\
main\
0\
0\
node:Aktualisiere Statistik\
type:main\
index:0\
Aktualisiere Statistik\
main\
0\
0\
node:Schleife pr\'fcfen\
type:main\
index:0\
Schleife pr\'fcfen\
main\
0\
0\
node:Extrahiere Workflow\
type:main\
index:0\
1\
0\
node:Backup-Statistik\
type:main\
index:0\
Backup-Statistik\
main\
0\
0\
node:Pr\'fcfe \'c4nderungen\
type:main\
index:0\
Pr\'fcfe \'c4nderungen\
main\
0\
0\
node:Threema Benachrichtigung\
type:main\
index:0\
1:[empty array]\
Threema Benachrichtigung\
main\
0:[empty array]\
settings\
executionOrder:v1\
callerPolicy:workflowsFromSameOwner\
availableInMCP:false\
staticData:null\
meta:null\
pinData:null\
versionId:cf5df872-e890-4a73-b857-22479c30681d\
activeVersionId:null\
triggerCount:0\
shared\
0\
updatedAt:2025-12-31T20:26:38.187Z\
createdAt:2025-12-31T20:26:38.187Z\
role:workflow:owner\
workflowId:85YcrXOnfCuBIP4l\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
2\
updatedAt:2025-12-23T21:44:37.712Z\
createdAt:2025-12-23T09:35:02.747Z\
id:9zrdcroz4Dxqp3Cl\
name:fonio BERENT/G\'f6hrum Nachbearbeitung Transkript\
active:true\
isArchived:false\
nodes\
0\
parameters\
httpMethod:POST\
path:berent_goehrum_nachbearbeitung\
options:\{empty object\}\
type:n8n-nodes-base.webhook\
typeVersion:2.1\
position\
0:-352\
1:-256\
id:93864959-7fbb-4c9b-8c39-f36aea885817\
name:Webhook\
webhookId:91027d69-8d90-4cc6-893e-9165d86c96d0\
1\
parameters\
assignments\
assignments\
0\
id:011ef203-63fd-49f7-ae0d-4ed7318ad11f\
name:headers.host\
value:=\{\{ $json.headers.host \}\}\
type:string\
1\
id:04f27e3e-ebed-4ae5-a22f-23d0f7c61904\
name:body[0].body.formattedTranscript\
value:=\{\{ $json.body[0].body.formattedTranscript \}\}\
type:string\
2\
id:017777fc-53d7-473d-b3c8-09a32e601385\
name:body[0].body.fromNumber\
value:=\{\{ $json.body[0].body.fromNumber \}\}\
type:string\
3\
id:882e8a05-a492-4445-bb4a-1856bfb586a1\
name:body[0].body.context.anrufer_name\
value:=\{\{ $json.body[0].body.context.anrufer_name \}\}\
type:string\
4\
id:a6508b49-d751-49d7-b40c-c91be52f5839\
name:body[0].body.context.einrichtung_typ\
value:=\{\{ $json.body[0].body.context.einrichtung_typ \}\}\
type:string\
5\
id:08190377-3019-449b-9374-494e642c5125\
name:body[0].body.context.einrichtung_name\
value:=\{\{ $json.body[0].body.context.einrichtung_name \}\}\
type:string\
6\
id:58740a6d-b29d-48ca-b2a3-fc14e3dedaeb\
name:body[0].body.context.technisch\
value:=\{\{ $json.body[0].body.context.technisch \}\}\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:-128\
1:-352\
id:23917905-1e91-4849-95e6-6d233a6cb41f\
name:Daten extrahieren\
2\
parameters\
promptType:define\
text:=F\'fchre die Klassifikation durch.\
hasOutputParser:true\
options\
systemMessage:=DU BIST EIN HOCHSPEZIALISIERTER KLASSIFIKATIONS-AGENT F\'dcR IT-HOTLINE-TRANSKRIPTE.\\n\\n###DEINE HAUPTAUFGABE###\\nAnalysiere Telefon-Transkripte und ordne sie pr\'e4zise in eine Dringlichkeitskategorie (A, B, C oder D) ein, basierend auf den Kriterien aus der bereitgestellten Wissensdatenbank. Deine Klassifikation erm\'f6glicht Technikern eine zielgerichtete, priorisierte Bearbeitung.\\n\\n---\\n\\n###VERF\'dcGBARE DATEN###\\n\\n**DRINGLICHKEITSKRITERIEN (aus Google Sheet):**\\n\{\{ $('Dringlichkeitskriterien laden').all().slice(1).map(item =>\\n`Kategorie $\{item.json.Dringlichkeit\}: $\{item.json.Kategorie\}\\nSchl\'fcsselworte: $\{item.json.Schlagworte\}\\nBeispiele: $\{item.json.Beispiele\}`\\n).join('\\n\\n') \}\}\\n\\n**ZU ANALYSIERENDES TRANSKRIPT:**\\n\{\{ $json.anonymizedText \}\}\\n\\n---\\n\\n###ANALYSE-METHODIK (CHAIN OF THOUGHTS)###\\n\\n1. **UNDERSTAND**\\n   - Lies das Transkript gr\'fcndlich und identifiziere das konkrete technische Problem\\n   - Erkenne die Auswirkungen: Produktivit\'e4tsausfall, Datenverlust, Eskalation, Gesch\'e4ftskritikalit\'e4t\\n\\n2. **IDENTIFY KEY SIGNALS**\\n   - Schl\'fcsselbegriffe f\'fcr hohe Dringlichkeit: "nicht arbeitsf\'e4hig", "Produktion steht", "Kunde wartet", "dringend", "sofort"\\n   - Schl\'fcsselbegriffe f\'fcr niedrige Dringlichkeit: "nicht eilig", "wenn Zeit ist", "Informationsfrage", "optional"\\n\\n3. **ASSESS IMPACT**\\n   - Ist ein gesch\'e4ftskritischer Prozess blockiert?\\n   - Sind mehrere Nutzer betroffen?\\n   - Gibt es Fristen oder SLA-relevante Zeitpunkte?\\n   - Handelt es sich um einen Standardvorgang oder eine Informationsanfrage?\\n\\n4. **MATCH WITH CRITERIA**\\n   - Vergleiche die erkannten Merkmale mit den Referenzbeispielen aus dem Google Sheet\\n   - W\'e4hle die Kategorie, die der Fallbeschreibung AM N\'c4CHSTEN kommt\\n\\n5. **HANDLE EDGE CASES**\\n   - Bei unklaren oder widerspr\'fcchlichen Transkripten: W\'e4hle die konservativere (h\'f6here) Kategorie\\n   - Weise explizit auf Unsicherheiten hin\\n\\n---\\n\\n###AUSGABEFORMAT###\\n\\n***WICHTIGER HINWEIS ZUR DATENSCHUTZ-KONFORMIT\'c4T***\\nDer Text enth\'e4lt anonymisierte Platzhalter wie [PERSON_1], [PERSON_2].\\nWenn du Namen extrahierst (z.B. f\'fcr "AnsprechpartnerName" oder in der "Beschreibung"),\\nNUTZE AUSSCHLIESSLICH DIESE PLATZHALTER.\\nWandle sie NICHT um und erfinde keine Namen.\\nBeispiel korrekt: "AnsprechpartnerName": "[PERSON_2]"\\n\\nGib deine Analyse im folgenden JSON-Format zur\'fcck:\\n```json\\n\{\\n  "Dringlichkeit": "B",\\n  "Kategorie": "Dringend",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Server-Ausfall",\\n  "Beschreibung": [\\n    "Mehrere Mitarbeiter betroffen (Buchhaltung)",\\n    "Datenbankverbindung unterbrochen seit 8 Uhr",\\n    "Fehlende Rechnungen der letzten 2 Wochen",\\n    "Zeitkritisch: Jahresabschluss-Termin in 2 Stunden"\\n  ],\\n  "AnsprechpartnerBleibt": true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\\n  "AnsprechpartnerName": "Frau Weber",\\n  "RueckrufnummerAnders": true = andere R\'fcckrufnummer gew\'fcnscht, false = unter anrufender Nummer zur\'fcckrufen\\n  "Rueckrufnummer": Die vom Anrufer genannte R\'fcckrufnummer (mit Durchwahl falls vorhanden)\\n  "Begr\'fcndung": "Der Kunde ist grunds\'e4tzlich arbeitsf\'e4hig, jedoch blockiert ein IT-Fehler einen zeitkritischen Gesch\'e4ftsprozess. Entspricht den Beispielen f\'fcr Kategorie B im Sheet."\\n\}\\n```\\n\\n**WICHTIG: Feldbeschreibungen** \\n- Die Dringlichkeit MUSS ein einzelner Buchstabe sein: A, B, C oder D, entsprechend der M\'f6glichkeiten im Google Sheet\\n- Die Kategorie MUSS sich auf die entsprechende Spalte im Google Sheet beziehen\\n- Problemtyp: Klassifiziere in GENAU EINE dieser Kategorien:\\n  \'95 "Technisch" = Hardware-Probleme, Netzwerkausf\'e4lle, Ger\'e4tedefekte, Server-Ausf\'e4lle\\n  \'95 "Software" = Programmfehler, Anmeldeprobleme, Softwarest\'f6rungen, Datenbankprobleme\\n  \'95 "Anliegen" = Informationsanfragen, Beratung, allgemeine Fragen ohne akutes technisches Problem\\n- Themenstichwort: Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z. B. "SAP-Login", "E-Mail-Sync", "Drucker-WLAN")\\n- Beschreibung: Array mit 3-6 Stichpunkten, die wichtigsten Informationen zuerst:\\n  \'95 Betroffene Personen/Systeme\\n  \'95 Zeitpunkt des Auftretens\\n  \'95 Konkrete Symptome/Fehler\\n  \'95 Gesch\'e4ftliche Auswirkungen\\n  \'95 Fristen/Zeitdruck\\n  \'95 Bereits versuchte L\'f6sungen\\n- AnsprechpartnerBleibt: true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\\n- AnsprechpartnerName: Name des Ansprechpartners (falls abweichend vom Anrufer, sonst leer lassen)\\n- AnsprechpartnerTelefon: Telefonnummer des Ansprechpartners (falls abweichend, sonst leer lassen)\\n- RueckrufnummerAnders: true = andere R\'fcckrufnummer als anrufende Nummer, false = unter anrufender Nummer zur\'fcckrufen\\n- Rueckrufnummer: Die R\'fcckrufnummer (kann identisch mit AnsprechpartnerTelefon sein)\\n- Die Begr\'fcndung MUSS sich auf die Kriterien im Google Sheet beziehen\\n- Halte dich strikt an das JSON-Format\\n\\n---\\n\\n###WAS NICHT ZU TUN IST###\\n\\nNIEMALS Kategorien ohne Bezug zum Google Sheet festlegen\\nVERMEIDE vage Begr\'fcndungen wie "klingt dringend" oder "scheint wichtig"\\nNICHT nur nach einzelnen Schl\'fcsselworten klassifizieren \'96 analysiere die Gesamtsituation\\nNIEMALS Aussagen erfinden, die nicht im Transkript stehen\\nNICHT \'fcberkategorisieren: Unzufriedenheit allein rechtfertigt keine Kategorie A\\nIGNORIERE NIEMALS Hinweise auf Systemrelevanz, Produktionsstopp oder gesch\'e4ftskritische Prozesse\\n\\n---\\n\\n###FEW-SHOT BEISPIELE###\\n\\n**Beispiel 1 - Kategorie A:**\\nTranskript: "Ich kann mich nicht mehr in SAP anmelden, wir m\'fcssen heute unbedingt die Monatsabrechnung machen."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "A",\\n  "Kategorie": "Notfall",\\n  "Problemtyp": "Software",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Gesch\'e4ftskritischer Prozess (Monatsabrechnung) ist komplett blockiert. Entspricht den Referenzf\'e4llen f\'fcr Kategorie A im Sheet."\\n\}\\n```\\n\\n**Beispiel 2 - Kategorie D:**\\nTranskript: "Ich wollte nur fragen, ob man den Drucker auch \'fcber WLAN verbinden kann \'96 ist aber nicht eilig."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "D",\\n  "Kategorie": "Informativ",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Informationsanfrage ohne Zeitdruck, kein akuter Vorfall. Entspricht klar Kategorie D im Sheet."\\n\}\\n```\\n\\n**Beispiel 3 - Kategorie B:**\\nTranskript: "Mein Outlook synchronisiert nicht mehr. Ich kann arbeiten, aber wichtige E-Mails von Kunden kommen nicht an."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "B",\\n  "Kategorie": "Dringend",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Eingeschr\'e4nkte Arbeitsf\'e4higkeit bei einem wichtigen Kommunikationskanal. Keine komplette Blockade, aber gesch\'e4ftsrelevant. Entspricht Kategorie B."\\n\}\\n```\
type:@n8n/n8n-nodes-langchain.agent\
typeVersion:3\
position\
0:1216\
1:-256\
id:8cf7091d-42df-4c77-ad1c-eaa6c9f0543f\
name:AI Agent\
executeOnce:true\
3\
parameters\
model\
__rl:true\
value:claude-3-5-haiku-20241022\
mode:list\
cachedResultName:Claude Haiku 3.5\
options:\{empty object\}\
type:@n8n/n8n-nodes-langchain.lmChatAnthropic\
typeVersion:1.3\
position\
0:1296\
1:-32\
id:459423e2-c5da-4413-9da7-677c5508266d\
name:Anthropic Chat Model\
credentials\
anthropicApi\
id:z2co8mXBEBKkyhYu\
name:API Anthropic\
4\
parameters\
authentication:serviceAccount\
documentId\
__rl:true\
value:1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw\
mode:id\
sheetName\
__rl:true\
value:gid=0\
mode:list\
cachedResultName:Dringlichkeiten\
cachedResultUrl:https://docs.google.com/spreadsheets/d/1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw/edit#gid=0\
options:\{empty object\}\
type:n8n-nodes-base.googleSheets\
typeVersion:4.7\
position\
0:-128\
1:-160\
id:29f5b923-f1cf-40fa-bcb2-57e80ec6c53c\
name:Dringlichkeitskriterien laden\
credentials\
googleApi\
id:vRVq7GTwn9kTIi8N\
name:n8n Sheets Service\
5\
parameters:\{empty object\}\
type:n8n-nodes-base.merge\
typeVersion:3.2\
position\
0:96\
1:-256\
id:25fc7223-88fd-422f-a068-c834cb4ce914\
name:Merge\
6\
parameters\
operation:sanitize\
text:=\{\{ $('Merge').item.json.body[0].body.formattedTranscript \}\}\
guardrails\
pii\
value\
type:selected\
entities\
0:EMAIL_ADDRESS\
1:PHONE_NUMBER\
2:IP_ADDRESS\
3:LOCATION\
type:@n8n/n8n-nodes-langchain.guardrails\
typeVersion:1\
position\
0:320\
1:-256\
id:c6b7d983-e3eb-49ac-a78b-a51a0dae7820\
name:Daten anonymisieren\
7\
parameters\
jsCode:// 1. Zugriff auf die Antwort des AI Agents\\nlet agentOutput = $input.item.json.output || $input.item.json.text || "";\\n\\n// Wir machen sicherheitshalber einen String daraus\\nif (typeof agentOutput === 'object') \{\\n  agentOutput = JSON.stringify(agentOutput);\\n\}\\n\\n// 2. Das Mapping holen (exakter Name der Node davor ist wichtig!)\\nconst mappingData = $('Azure Response Verarbeitung').first();\\nconst nameMapping = mappingData.json.nameMapping || [];\\n\\n// 3. Re-Personalisierung durchf\'fchren (Suchen & Ersetzen im Rohtext)\\n// Wir machen das VOR dem JSON-Parsing, damit auch Namen in Strings ersetzt werden.\\nlet processedText = agentOutput;\\n\\nfor (const item of nameMapping) \{\\n  // Ersetze [PERSON_X] durch den echten Namen (global)\\n  // Wir escapen die Klammern f\'fcr den Regex\\n  const placeholderRegex = new RegExp(item.placeholder.replace(/\\[/g, '\\\\[').replace(/\\]/g, '\\\\]'), 'g');\\n  processedText = processedText.replace(placeholderRegex, item.original);\\n\}\\n\\n// 4. JSON Extrahieren (Der "Gespr\'e4chigkeit"-Filter)\\n// Wir suchen den Bereich zwischen der ersten '\{' und der letzten '\}'\\nconst firstBracket = processedText.indexOf('\{');\\nconst lastBracket = processedText.lastIndexOf('\}');\\n\\nif (firstBracket !== -1 && lastBracket !== -1) \{\\n  // Schneide alles vor der ersten Klammer und nach der letzten Klammer weg\\n  const jsonString = processedText.substring(firstBracket, lastBracket + 1);\\n  \\n  try \{\\n    const finalObject = JSON.parse(jsonString);\\n    return finalObject; // Gib das saubere Objekt zur\'fcck\\n  \} catch (e) \{\\n    return \{ error: "JSON war trotz Filterung ung\'fcltig", raw: processedText \};\\n  \}\\n\} else \{\\n  // Fallback, falls gar keine Klammern gefunden wurden\\n  return \{ error: "Kein JSON im Antworttext gefunden", raw: processedText \};\\n\}\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1568\
1:-256\
id:dc903612-dc03-4d32-9a3a-888ce846202e\
name:Re-Personalisierung\
8\
parameters\
method:POST\
url:https://berent-ki.services.ai.azure.com/models/chat/completions?api-version=2024-05-01-preview\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
contentType:=json\
specifyBody:json\
bodyParameters\
parameters\
0:\{empty object\}\
jsonBody:=\{\{ $json \}\}\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.3\
position\
0:768\
1:-256\
id:14b1d91c-ef2b-4658-822b-198e191a4ff7\
name:Namen-Anonymisierung (Azure)\
retryOnFail:true\
waitBetweenTries:5000\
maxTries:5\
credentials\
httpHeaderAuth\
id:x5y4aJ1X9shkkOZh\
name:API Threema Work Secret\
9\
parameters\
jsCode:// Wir greifen auf die Antwort der Azure-Node zu\\nconst response = $input.item.json;\\n\\n// Sicherstellen, dass wir eine Antwort haben\\nif (response.choices && response.choices[0] && response.choices[0].message) \{\\n  \\n  // Den Textinhalt holen\\n  let content = response.choices[0].message.content;\\n  \\n  // Oft sendet die KI den Text in Markdown-Bl\'f6cken (```json ... ```).\\n  // Diese entfernen wir hier, damit das JSON sauber ist.\\n  content = content.replace(/^```json\\s*/, "").replace(/\\s*```$/, "");\\n  \\n  try \{\\n    // Den Textstring in ein echtes JSON-Objekt umwandeln\\n    const parsedData = JSON.parse(content);\\n    \\n    // Das saubere Ergebnis zur\'fcckgeben\\n    return parsedData;\\n    \\n  \} catch (error) \{\\n    // Falls die KI kein g\'fcltiges JSON geschickt hat, geben wir den Rohtext zur\'fcck\\n    return \{\\n      error: "Konnte JSON nicht parsen",\\n      rawContent: content\\n    \};\\n  \}\\n\} else \{\\n  return \{ error: "Keine g\'fcltige Antwort von Azure erhalten" \};\\n\}\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:992\
1:-256\
id:cc46e049-8203-49f2-8feb-2b833caa4035\
name:Azure Response Verarbeitung\
10\
parameters\
mode:runOnceForEachItem\
jsCode:// Daten aus der vorherigen Node holen\\n// Fallback auf leeren String, falls keine Daten da sind\\nconst transcript = $input.item.json.guardrailsInput || $input.item.json.output || "";\\n\\nconst systemPrompt = `Du bist ein Spezialist f\'fcr die Anonymisierung von Personennamen in deutschen Telefon-Transkripten.\\n\\n###DEINE AUFGABE###\\nErkenne alle Personennamen (Vornamen und Nachnamen) im gegebenen Text und ersetze sie durch nummerierte Platzhalter im Format [PERSON_1], [PERSON_2], [PERSON_3] etc.\\n\\n###REGELN###\\n1. Erkenne nur echte Personennamen (z.B. Thomas, Anna, M\'fcller, Schmidt)\\n2. Ignoriere Titel wie 'Herr', 'Frau', 'Dr.' - diese bleiben unver\'e4ndert\\n3. Ersetze jeden gefundenen Namen durch einen eindeutigen Platzhalter [PERSON_N]\\n4. Gleiche Namen im Text erhalten den gleichen Platzhalter (z.B. 'Thomas' wird immer zu [PERSON_1])\\n5. Verschiedene Namen erhalten verschiedene Platzhalter (z.B. 'Thomas' \uc0\u8594  [PERSON_1], 'Anna' \u8594  [PERSON_2])\\n6. Behalte die urspr\'fcngliche Formatierung bei (Zeilenumbr\'fcche, Interpunktion)\\n\\n###AUSGABEFORMAT###\\nGib dein Ergebnis im folgenden JSON-Format zur\'fcck:\\n\\`\\`\\`json\\n\{\\n  "anonymizedText": "Der anonymisierte Text mit [PERSON_1], [PERSON_2] etc.",\\n  "nameMapping": [\\n    \{"original": "Thomas", "placeholder": "[PERSON_1]"\},\\n    \{"original": "Anna", "placeholder": "[PERSON_2]"\}\\n  ]\\n\}\\n\\`\\`\\``;\\n\\n// Das fertige Payload-Objekt zur\'fcckgeben\\nreturn \{\\n  model: "mistral-namen-anonymisierung",\\n  messages: [\\n    \{\\n      role: "system",\\n      content: systemPrompt\\n    \},\\n    \{\\n      role: "user",\\n      content: transcript\\n    \}\\n  ],\\n  temperature: 0.1,\\n  max_tokens: 1000\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:544\
1:-256\
id:e79ea409-47a0-4a3a-916d-f14b107c9ff2\
name:Azure Request Vorbereitung\
11\
parameters\
method:POST\
url:https://msgapi.threema.ch/send_simple\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
contentType:form-urlencoded\
bodyParameters\
parameters\
0\
name:from\
value:*BERENT1\
1\
name:to\
value:BUMFMZ39\
2\
name:secret\
value:=\{\{ $('Config').item.json.secret \}\}\
3\
name:text\
value:=\uc0\u55357 \u56580  Verarbeitung erfolgreich  \{\{ $json.summary \}\}  Details: \{\{ $json.changedList \}\}  \u55357 \u56599  https://github.com/peerendees/n8n-workflows\
options:\{empty object\}\
id:346eacc7-2fe2-4646-9d8a-34127f127d62\
name:Send Threema Notification\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:2016\
1:-256\
credentials\
httpHeaderAuth\
id:nSNvIRCSAnKXrLyH\
name:API Threema Work BERENT1\
12\
parameters\
assignments\
assignments\
0\
id:9cac8552-e981-44e5-bfc7-854012461c3f\
name:subject\
value:=\{\{ $json.Kategorie \}\} | \{\{ $('Daten extrahieren').first().json.body[0].body.context.einrichtung_name \}\}, \{\{ $('Daten extrahieren').first().json.body[0].body.context.anrufer_name \}\} | \{\{ $json.Themenstichwort \}\}\
type:string\
1\
id:988dd2a7-83ea-48b9-9e7e-bcc66745c72c\
name:htmlBody\
value:=<h3>Problemtyp: \{\{ $json.Problemtyp \}\}</h3>\\n\\n<h4>KI-Einsch\'e4tzung</h4>\\n<p>\\n  <b>Einrichtung:</b> \{\{ $('Daten extrahieren').first().json.body[0].body.context.einrichtung_typ \}\}<br>\\n  <b>Anrufer:</b> \{\{ $('Daten extrahieren').first().json.body[0].body.context.anrufer_name \}\} (\{\{ $('Daten extrahieren').first().json.body[0].body.fromNumber \}\})<br>\\n  <b>Ansprechpartner:</b> \{\{ $json.AnsprechpartnerName ? $json.AnsprechpartnerName : "Wie Anrufer" \}\}<br>\\n  <b>R\'fcckrufnummer:</b> \{\{ $json.Rueckrufnummer ? $json.Rueckrufnummer : $('Daten extrahieren').first().json.body[0].body.fromNumber \}\}<br>\\n  <b>Thema:</b> \{\{ $json.Themenstichwort \}\}\\n</p>\\n\\n<b>Beschreibung:</b>\\n<ul>\\n\{\{ $json.Beschreibung.map(item => `<li>$\{item\}</li>`).join('') \}\}\\n</ul>\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:1792\
1:-256\
id:78bd0002-231d-4cb3-8368-fded30482f57\
name:Nachricht an Threema Work vorbereiten\
connections\
Webhook\
main\
0\
0\
node:Daten extrahieren\
type:main\
index:0\
1\
node:Dringlichkeitskriterien laden\
type:main\
index:0\
Daten extrahieren\
main\
0\
0\
node:Merge\
type:main\
index:0\
Anthropic Chat Model\
ai_languageModel\
0\
0\
node:AI Agent\
type:ai_languageModel\
index:0\
Dringlichkeitskriterien laden\
main\
0\
0\
node:Merge\
type:main\
index:1\
Merge\
main\
0\
0\
node:Daten anonymisieren\
type:main\
index:0\
AI Agent\
main\
0\
0\
node:Re-Personalisierung\
type:main\
index:0\
Daten anonymisieren\
main\
0\
0\
node:Azure Request Vorbereitung\
type:main\
index:0\
Re-Personalisierung\
main\
0\
0\
node:Nachricht an Threema Work vorbereiten\
type:main\
index:0\
Namen-Anonymisierung (Azure)\
main\
0\
0\
node:Azure Response Verarbeitung\
type:main\
index:0\
Azure Response Verarbeitung\
main\
0\
0\
node:AI Agent\
type:main\
index:0\
Azure Request Vorbereitung\
main\
0\
0\
node:Namen-Anonymisierung (Azure)\
type:main\
index:0\
Nachricht an Threema Work vorbereiten\
main\
0\
0\
node:Send Threema Notification\
type:main\
index:0\
settings\
executionOrder:v1\
timeSavedMode:fixed\
callerPolicy:workflowsFromSameOwner\
availableInMCP:false\
staticData:null\
meta\
templateCredsSetupCompleted:true\
pinData:\{empty object\}\
versionId:3c36e20c-6a88-4a60-be1a-45a52efd8916\
activeVersionId:3c36e20c-6a88-4a60-be1a-45a52efd8916\
triggerCount:1\
shared\
0\
updatedAt:2025-12-23T09:35:02.756Z\
createdAt:2025-12-23T09:35:02.756Z\
role:workflow:owner\
workflowId:9zrdcroz4Dxqp3Cl\
projectId:yr4Hj71ou1NOsi2p\
activeVersion\
updatedAt:2025-12-23T21:44:52.000Z\
createdAt:2025-12-23T21:44:37.714Z\
versionId:3c36e20c-6a88-4a60-be1a-45a52efd8916\
workflowId:9zrdcroz4Dxqp3Cl\
nodes\
0\
parameters\
httpMethod:POST\
path:berent_goehrum_nachbearbeitung\
options:\{empty object\}\
type:n8n-nodes-base.webhook\
typeVersion:2.1\
position\
0:-352\
1:-256\
id:93864959-7fbb-4c9b-8c39-f36aea885817\
name:Webhook\
webhookId:91027d69-8d90-4cc6-893e-9165d86c96d0\
1\
parameters\
assignments\
assignments\
0\
id:011ef203-63fd-49f7-ae0d-4ed7318ad11f\
name:headers.host\
value:=\{\{ $json.headers.host \}\}\
type:string\
1\
id:04f27e3e-ebed-4ae5-a22f-23d0f7c61904\
name:body[0].body.formattedTranscript\
value:=\{\{ $json.body[0].body.formattedTranscript \}\}\
type:string\
2\
id:017777fc-53d7-473d-b3c8-09a32e601385\
name:body[0].body.fromNumber\
value:=\{\{ $json.body[0].body.fromNumber \}\}\
type:string\
3\
id:882e8a05-a492-4445-bb4a-1856bfb586a1\
name:body[0].body.context.anrufer_name\
value:=\{\{ $json.body[0].body.context.anrufer_name \}\}\
type:string\
4\
id:a6508b49-d751-49d7-b40c-c91be52f5839\
name:body[0].body.context.einrichtung_typ\
value:=\{\{ $json.body[0].body.context.einrichtung_typ \}\}\
type:string\
5\
id:08190377-3019-449b-9374-494e642c5125\
name:body[0].body.context.einrichtung_name\
value:=\{\{ $json.body[0].body.context.einrichtung_name \}\}\
type:string\
6\
id:58740a6d-b29d-48ca-b2a3-fc14e3dedaeb\
name:body[0].body.context.technisch\
value:=\{\{ $json.body[0].body.context.technisch \}\}\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:-128\
1:-352\
id:23917905-1e91-4849-95e6-6d233a6cb41f\
name:Daten extrahieren\
2\
parameters\
promptType:define\
text:=F\'fchre die Klassifikation durch.\
hasOutputParser:true\
options\
systemMessage:=DU BIST EIN HOCHSPEZIALISIERTER KLASSIFIKATIONS-AGENT F\'dcR IT-HOTLINE-TRANSKRIPTE.\\n\\n###DEINE HAUPTAUFGABE###\\nAnalysiere Telefon-Transkripte und ordne sie pr\'e4zise in eine Dringlichkeitskategorie (A, B, C oder D) ein, basierend auf den Kriterien aus der bereitgestellten Wissensdatenbank. Deine Klassifikation erm\'f6glicht Technikern eine zielgerichtete, priorisierte Bearbeitung.\\n\\n---\\n\\n###VERF\'dcGBARE DATEN###\\n\\n**DRINGLICHKEITSKRITERIEN (aus Google Sheet):**\\n\{\{ $('Dringlichkeitskriterien laden').all().slice(1).map(item =>\\n`Kategorie $\{item.json.Dringlichkeit\}: $\{item.json.Kategorie\}\\nSchl\'fcsselworte: $\{item.json.Schlagworte\}\\nBeispiele: $\{item.json.Beispiele\}`\\n).join('\\n\\n') \}\}\\n\\n**ZU ANALYSIERENDES TRANSKRIPT:**\\n\{\{ $json.anonymizedText \}\}\\n\\n---\\n\\n###ANALYSE-METHODIK (CHAIN OF THOUGHTS)###\\n\\n1. **UNDERSTAND**\\n   - Lies das Transkript gr\'fcndlich und identifiziere das konkrete technische Problem\\n   - Erkenne die Auswirkungen: Produktivit\'e4tsausfall, Datenverlust, Eskalation, Gesch\'e4ftskritikalit\'e4t\\n\\n2. **IDENTIFY KEY SIGNALS**\\n   - Schl\'fcsselbegriffe f\'fcr hohe Dringlichkeit: "nicht arbeitsf\'e4hig", "Produktion steht", "Kunde wartet", "dringend", "sofort"\\n   - Schl\'fcsselbegriffe f\'fcr niedrige Dringlichkeit: "nicht eilig", "wenn Zeit ist", "Informationsfrage", "optional"\\n\\n3. **ASSESS IMPACT**\\n   - Ist ein gesch\'e4ftskritischer Prozess blockiert?\\n   - Sind mehrere Nutzer betroffen?\\n   - Gibt es Fristen oder SLA-relevante Zeitpunkte?\\n   - Handelt es sich um einen Standardvorgang oder eine Informationsanfrage?\\n\\n4. **MATCH WITH CRITERIA**\\n   - Vergleiche die erkannten Merkmale mit den Referenzbeispielen aus dem Google Sheet\\n   - W\'e4hle die Kategorie, die der Fallbeschreibung AM N\'c4CHSTEN kommt\\n\\n5. **HANDLE EDGE CASES**\\n   - Bei unklaren oder widerspr\'fcchlichen Transkripten: W\'e4hle die konservativere (h\'f6here) Kategorie\\n   - Weise explizit auf Unsicherheiten hin\\n\\n---\\n\\n###AUSGABEFORMAT###\\n\\n***WICHTIGER HINWEIS ZUR DATENSCHUTZ-KONFORMIT\'c4T***\\nDer Text enth\'e4lt anonymisierte Platzhalter wie [PERSON_1], [PERSON_2].\\nWenn du Namen extrahierst (z.B. f\'fcr "AnsprechpartnerName" oder in der "Beschreibung"),\\nNUTZE AUSSCHLIESSLICH DIESE PLATZHALTER.\\nWandle sie NICHT um und erfinde keine Namen.\\nBeispiel korrekt: "AnsprechpartnerName": "[PERSON_2]"\\n\\nGib deine Analyse im folgenden JSON-Format zur\'fcck:\\n```json\\n\{\\n  "Dringlichkeit": "B",\\n  "Kategorie": "Dringend",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Server-Ausfall",\\n  "Beschreibung": [\\n    "Mehrere Mitarbeiter betroffen (Buchhaltung)",\\n    "Datenbankverbindung unterbrochen seit 8 Uhr",\\n    "Fehlende Rechnungen der letzten 2 Wochen",\\n    "Zeitkritisch: Jahresabschluss-Termin in 2 Stunden"\\n  ],\\n  "AnsprechpartnerBleibt": true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\\n  "AnsprechpartnerName": "Frau Weber",\\n  "RueckrufnummerAnders": true = andere R\'fcckrufnummer gew\'fcnscht, false = unter anrufender Nummer zur\'fcckrufen\\n  "Rueckrufnummer": Die vom Anrufer genannte R\'fcckrufnummer (mit Durchwahl falls vorhanden)\\n  "Begr\'fcndung": "Der Kunde ist grunds\'e4tzlich arbeitsf\'e4hig, jedoch blockiert ein IT-Fehler einen zeitkritischen Gesch\'e4ftsprozess. Entspricht den Beispielen f\'fcr Kategorie B im Sheet."\\n\}\\n```\\n\\n**WICHTIG: Feldbeschreibungen** \\n- Die Dringlichkeit MUSS ein einzelner Buchstabe sein: A, B, C oder D, entsprechend der M\'f6glichkeiten im Google Sheet\\n- Die Kategorie MUSS sich auf die entsprechende Spalte im Google Sheet beziehen\\n- Problemtyp: Klassifiziere in GENAU EINE dieser Kategorien:\\n  \'95 "Technisch" = Hardware-Probleme, Netzwerkausf\'e4lle, Ger\'e4tedefekte, Server-Ausf\'e4lle\\n  \'95 "Software" = Programmfehler, Anmeldeprobleme, Softwarest\'f6rungen, Datenbankprobleme\\n  \'95 "Anliegen" = Informationsanfragen, Beratung, allgemeine Fragen ohne akutes technisches Problem\\n- Themenstichwort: Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z. B. "SAP-Login", "E-Mail-Sync", "Drucker-WLAN")\\n- Beschreibung: Array mit 3-6 Stichpunkten, die wichtigsten Informationen zuerst:\\n  \'95 Betroffene Personen/Systeme\\n  \'95 Zeitpunkt des Auftretens\\n  \'95 Konkrete Symptome/Fehler\\n  \'95 Gesch\'e4ftliche Auswirkungen\\n  \'95 Fristen/Zeitdruck\\n  \'95 Bereits versuchte L\'f6sungen\\n- AnsprechpartnerBleibt: true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\\n- AnsprechpartnerName: Name des Ansprechpartners (falls abweichend vom Anrufer, sonst leer lassen)\\n- AnsprechpartnerTelefon: Telefonnummer des Ansprechpartners (falls abweichend, sonst leer lassen)\\n- RueckrufnummerAnders: true = andere R\'fcckrufnummer als anrufende Nummer, false = unter anrufender Nummer zur\'fcckrufen\\n- Rueckrufnummer: Die R\'fcckrufnummer (kann identisch mit AnsprechpartnerTelefon sein)\\n- Die Begr\'fcndung MUSS sich auf die Kriterien im Google Sheet beziehen\\n- Halte dich strikt an das JSON-Format\\n\\n---\\n\\n###WAS NICHT ZU TUN IST###\\n\\nNIEMALS Kategorien ohne Bezug zum Google Sheet festlegen\\nVERMEIDE vage Begr\'fcndungen wie "klingt dringend" oder "scheint wichtig"\\nNICHT nur nach einzelnen Schl\'fcsselworten klassifizieren \'96 analysiere die Gesamtsituation\\nNIEMALS Aussagen erfinden, die nicht im Transkript stehen\\nNICHT \'fcberkategorisieren: Unzufriedenheit allein rechtfertigt keine Kategorie A\\nIGNORIERE NIEMALS Hinweise auf Systemrelevanz, Produktionsstopp oder gesch\'e4ftskritische Prozesse\\n\\n---\\n\\n###FEW-SHOT BEISPIELE###\\n\\n**Beispiel 1 - Kategorie A:**\\nTranskript: "Ich kann mich nicht mehr in SAP anmelden, wir m\'fcssen heute unbedingt die Monatsabrechnung machen."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "A",\\n  "Kategorie": "Notfall",\\n  "Problemtyp": "Software",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Gesch\'e4ftskritischer Prozess (Monatsabrechnung) ist komplett blockiert. Entspricht den Referenzf\'e4llen f\'fcr Kategorie A im Sheet."\\n\}\\n```\\n\\n**Beispiel 2 - Kategorie D:**\\nTranskript: "Ich wollte nur fragen, ob man den Drucker auch \'fcber WLAN verbinden kann \'96 ist aber nicht eilig."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "D",\\n  "Kategorie": "Informativ",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Informationsanfrage ohne Zeitdruck, kein akuter Vorfall. Entspricht klar Kategorie D im Sheet."\\n\}\\n```\\n\\n**Beispiel 3 - Kategorie B:**\\nTranskript: "Mein Outlook synchronisiert nicht mehr. Ich kann arbeiten, aber wichtige E-Mails von Kunden kommen nicht an."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "B",\\n  "Kategorie": "Dringend",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Eingeschr\'e4nkte Arbeitsf\'e4higkeit bei einem wichtigen Kommunikationskanal. Keine komplette Blockade, aber gesch\'e4ftsrelevant. Entspricht Kategorie B."\\n\}\\n```\
type:@n8n/n8n-nodes-langchain.agent\
typeVersion:3\
position\
0:1216\
1:-256\
id:8cf7091d-42df-4c77-ad1c-eaa6c9f0543f\
name:AI Agent\
executeOnce:true\
3\
parameters\
model\
__rl:true\
value:claude-3-5-haiku-20241022\
mode:list\
cachedResultName:Claude Haiku 3.5\
options:\{empty object\}\
type:@n8n/n8n-nodes-langchain.lmChatAnthropic\
typeVersion:1.3\
position\
0:1296\
1:-32\
id:459423e2-c5da-4413-9da7-677c5508266d\
name:Anthropic Chat Model\
credentials\
anthropicApi\
id:z2co8mXBEBKkyhYu\
name:API Anthropic\
4\
parameters\
authentication:serviceAccount\
documentId\
__rl:true\
value:1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw\
mode:id\
sheetName\
__rl:true\
value:gid=0\
mode:list\
cachedResultName:Dringlichkeiten\
cachedResultUrl:https://docs.google.com/spreadsheets/d/1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw/edit#gid=0\
options:\{empty object\}\
type:n8n-nodes-base.googleSheets\
typeVersion:4.7\
position\
0:-128\
1:-160\
id:29f5b923-f1cf-40fa-bcb2-57e80ec6c53c\
name:Dringlichkeitskriterien laden\
credentials\
googleApi\
id:vRVq7GTwn9kTIi8N\
name:n8n Sheets Service\
5\
parameters:\{empty object\}\
type:n8n-nodes-base.merge\
typeVersion:3.2\
position\
0:96\
1:-256\
id:25fc7223-88fd-422f-a068-c834cb4ce914\
name:Merge\
6\
parameters\
operation:sanitize\
text:=\{\{ $('Merge').item.json.body[0].body.formattedTranscript \}\}\
guardrails\
pii\
value\
type:selected\
entities\
0:EMAIL_ADDRESS\
1:PHONE_NUMBER\
2:IP_ADDRESS\
3:LOCATION\
type:@n8n/n8n-nodes-langchain.guardrails\
typeVersion:1\
position\
0:320\
1:-256\
id:c6b7d983-e3eb-49ac-a78b-a51a0dae7820\
name:Daten anonymisieren\
7\
parameters\
jsCode:// 1. Zugriff auf die Antwort des AI Agents\\nlet agentOutput = $input.item.json.output || $input.item.json.text || "";\\n\\n// Wir machen sicherheitshalber einen String daraus\\nif (typeof agentOutput === 'object') \{\\n  agentOutput = JSON.stringify(agentOutput);\\n\}\\n\\n// 2. Das Mapping holen (exakter Name der Node davor ist wichtig!)\\nconst mappingData = $('Azure Response Verarbeitung').first();\\nconst nameMapping = mappingData.json.nameMapping || [];\\n\\n// 3. Re-Personalisierung durchf\'fchren (Suchen & Ersetzen im Rohtext)\\n// Wir machen das VOR dem JSON-Parsing, damit auch Namen in Strings ersetzt werden.\\nlet processedText = agentOutput;\\n\\nfor (const item of nameMapping) \{\\n  // Ersetze [PERSON_X] durch den echten Namen (global)\\n  // Wir escapen die Klammern f\'fcr den Regex\\n  const placeholderRegex = new RegExp(item.placeholder.replace(/\\[/g, '\\\\[').replace(/\\]/g, '\\\\]'), 'g');\\n  processedText = processedText.replace(placeholderRegex, item.original);\\n\}\\n\\n// 4. JSON Extrahieren (Der "Gespr\'e4chigkeit"-Filter)\\n// Wir suchen den Bereich zwischen der ersten '\{' und der letzten '\}'\\nconst firstBracket = processedText.indexOf('\{');\\nconst lastBracket = processedText.lastIndexOf('\}');\\n\\nif (firstBracket !== -1 && lastBracket !== -1) \{\\n  // Schneide alles vor der ersten Klammer und nach der letzten Klammer weg\\n  const jsonString = processedText.substring(firstBracket, lastBracket + 1);\\n  \\n  try \{\\n    const finalObject = JSON.parse(jsonString);\\n    return finalObject; // Gib das saubere Objekt zur\'fcck\\n  \} catch (e) \{\\n    return \{ error: "JSON war trotz Filterung ung\'fcltig", raw: processedText \};\\n  \}\\n\} else \{\\n  // Fallback, falls gar keine Klammern gefunden wurden\\n  return \{ error: "Kein JSON im Antworttext gefunden", raw: processedText \};\\n\}\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1568\
1:-256\
id:dc903612-dc03-4d32-9a3a-888ce846202e\
name:Re-Personalisierung\
8\
parameters\
method:POST\
url:https://berent-ki.services.ai.azure.com/models/chat/completions?api-version=2024-05-01-preview\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
contentType:=json\
specifyBody:json\
bodyParameters\
parameters\
0:\{empty object\}\
jsonBody:=\{\{ $json \}\}\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.3\
position\
0:768\
1:-256\
id:14b1d91c-ef2b-4658-822b-198e191a4ff7\
name:Namen-Anonymisierung (Azure)\
retryOnFail:true\
waitBetweenTries:5000\
maxTries:5\
credentials\
httpHeaderAuth\
id:x5y4aJ1X9shkkOZh\
name:API Threema Work Secret\
9\
parameters\
jsCode:// Wir greifen auf die Antwort der Azure-Node zu\\nconst response = $input.item.json;\\n\\n// Sicherstellen, dass wir eine Antwort haben\\nif (response.choices && response.choices[0] && response.choices[0].message) \{\\n  \\n  // Den Textinhalt holen\\n  let content = response.choices[0].message.content;\\n  \\n  // Oft sendet die KI den Text in Markdown-Bl\'f6cken (```json ... ```).\\n  // Diese entfernen wir hier, damit das JSON sauber ist.\\n  content = content.replace(/^```json\\s*/, "").replace(/\\s*```$/, "");\\n  \\n  try \{\\n    // Den Textstring in ein echtes JSON-Objekt umwandeln\\n    const parsedData = JSON.parse(content);\\n    \\n    // Das saubere Ergebnis zur\'fcckgeben\\n    return parsedData;\\n    \\n  \} catch (error) \{\\n    // Falls die KI kein g\'fcltiges JSON geschickt hat, geben wir den Rohtext zur\'fcck\\n    return \{\\n      error: "Konnte JSON nicht parsen",\\n      rawContent: content\\n    \};\\n  \}\\n\} else \{\\n  return \{ error: "Keine g\'fcltige Antwort von Azure erhalten" \};\\n\}\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:992\
1:-256\
id:cc46e049-8203-49f2-8feb-2b833caa4035\
name:Azure Response Verarbeitung\
10\
parameters\
mode:runOnceForEachItem\
jsCode:// Daten aus der vorherigen Node holen\\n// Fallback auf leeren String, falls keine Daten da sind\\nconst transcript = $input.item.json.guardrailsInput || $input.item.json.output || "";\\n\\nconst systemPrompt = `Du bist ein Spezialist f\'fcr die Anonymisierung von Personennamen in deutschen Telefon-Transkripten.\\n\\n###DEINE AUFGABE###\\nErkenne alle Personennamen (Vornamen und Nachnamen) im gegebenen Text und ersetze sie durch nummerierte Platzhalter im Format [PERSON_1], [PERSON_2], [PERSON_3] etc.\\n\\n###REGELN###\\n1. Erkenne nur echte Personennamen (z.B. Thomas, Anna, M\'fcller, Schmidt)\\n2. Ignoriere Titel wie 'Herr', 'Frau', 'Dr.' - diese bleiben unver\'e4ndert\\n3. Ersetze jeden gefundenen Namen durch einen eindeutigen Platzhalter [PERSON_N]\\n4. Gleiche Namen im Text erhalten den gleichen Platzhalter (z.B. 'Thomas' wird immer zu [PERSON_1])\\n5. Verschiedene Namen erhalten verschiedene Platzhalter (z.B. 'Thomas' \uc0\u8594  [PERSON_1], 'Anna' \u8594  [PERSON_2])\\n6. Behalte die urspr\'fcngliche Formatierung bei (Zeilenumbr\'fcche, Interpunktion)\\n\\n###AUSGABEFORMAT###\\nGib dein Ergebnis im folgenden JSON-Format zur\'fcck:\\n\\`\\`\\`json\\n\{\\n  "anonymizedText": "Der anonymisierte Text mit [PERSON_1], [PERSON_2] etc.",\\n  "nameMapping": [\\n    \{"original": "Thomas", "placeholder": "[PERSON_1]"\},\\n    \{"original": "Anna", "placeholder": "[PERSON_2]"\}\\n  ]\\n\}\\n\\`\\`\\``;\\n\\n// Das fertige Payload-Objekt zur\'fcckgeben\\nreturn \{\\n  model: "mistral-namen-anonymisierung",\\n  messages: [\\n    \{\\n      role: "system",\\n      content: systemPrompt\\n    \},\\n    \{\\n      role: "user",\\n      content: transcript\\n    \}\\n  ],\\n  temperature: 0.1,\\n  max_tokens: 1000\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:544\
1:-256\
id:e79ea409-47a0-4a3a-916d-f14b107c9ff2\
name:Azure Request Vorbereitung\
11\
parameters\
method:POST\
url:https://msgapi.threema.ch/send_simple\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
contentType:form-urlencoded\
bodyParameters\
parameters\
0\
name:from\
value:*BERENT1\
1\
name:to\
value:BUMFMZ39\
2\
name:secret\
value:=\{\{ $('Config').item.json.secret \}\}\
3\
name:text\
value:=\uc0\u55357 \u56580  Verarbeitung erfolgreich  \{\{ $json.summary \}\}  Details: \{\{ $json.changedList \}\}  \u55357 \u56599  https://github.com/peerendees/n8n-workflows\
options:\{empty object\}\
id:346eacc7-2fe2-4646-9d8a-34127f127d62\
name:Send Threema Notification\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:2016\
1:-256\
credentials\
httpHeaderAuth\
id:nSNvIRCSAnKXrLyH\
name:API Threema Work BERENT1\
12\
parameters\
assignments\
assignments\
0\
id:9cac8552-e981-44e5-bfc7-854012461c3f\
name:subject\
value:=\{\{ $json.Kategorie \}\} | \{\{ $('Daten extrahieren').first().json.body[0].body.context.einrichtung_name \}\}, \{\{ $('Daten extrahieren').first().json.body[0].body.context.anrufer_name \}\} | \{\{ $json.Themenstichwort \}\}\
type:string\
1\
id:988dd2a7-83ea-48b9-9e7e-bcc66745c72c\
name:htmlBody\
value:=<h3>Problemtyp: \{\{ $json.Problemtyp \}\}</h3>\\n\\n<h4>KI-Einsch\'e4tzung</h4>\\n<p>\\n  <b>Einrichtung:</b> \{\{ $('Daten extrahieren').first().json.body[0].body.context.einrichtung_typ \}\}<br>\\n  <b>Anrufer:</b> \{\{ $('Daten extrahieren').first().json.body[0].body.context.anrufer_name \}\} (\{\{ $('Daten extrahieren').first().json.body[0].body.fromNumber \}\})<br>\\n  <b>Ansprechpartner:</b> \{\{ $json.AnsprechpartnerName ? $json.AnsprechpartnerName : "Wie Anrufer" \}\}<br>\\n  <b>R\'fcckrufnummer:</b> \{\{ $json.Rueckrufnummer ? $json.Rueckrufnummer : $('Daten extrahieren').first().json.body[0].body.fromNumber \}\}<br>\\n  <b>Thema:</b> \{\{ $json.Themenstichwort \}\}\\n</p>\\n\\n<b>Beschreibung:</b>\\n<ul>\\n\{\{ $json.Beschreibung.map(item => `<li>$\{item\}</li>`).join('') \}\}\\n</ul>\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:1792\
1:-256\
id:78bd0002-231d-4cb3-8368-fded30482f57\
name:Nachricht an Threema Work vorbereiten\
connections\
Webhook\
main\
0\
0\
node:Daten extrahieren\
type:main\
index:0\
1\
node:Dringlichkeitskriterien laden\
type:main\
index:0\
Daten extrahieren\
main\
0\
0\
node:Merge\
type:main\
index:0\
Anthropic Chat Model\
ai_languageModel\
0\
0\
node:AI Agent\
type:ai_languageModel\
index:0\
Dringlichkeitskriterien laden\
main\
0\
0\
node:Merge\
type:main\
index:1\
Merge\
main\
0\
0\
node:Daten anonymisieren\
type:main\
index:0\
AI Agent\
main\
0\
0\
node:Re-Personalisierung\
type:main\
index:0\
Daten anonymisieren\
main\
0\
0\
node:Azure Request Vorbereitung\
type:main\
index:0\
Re-Personalisierung\
main\
0\
0\
node:Nachricht an Threema Work vorbereiten\
type:main\
index:0\
Namen-Anonymisierung (Azure)\
main\
0\
0\
node:Azure Response Verarbeitung\
type:main\
index:0\
Azure Response Verarbeitung\
main\
0\
0\
node:AI Agent\
type:main\
index:0\
Azure Request Vorbereitung\
main\
0\
0\
node:Namen-Anonymisierung (Azure)\
type:main\
index:0\
Nachricht an Threema Work vorbereiten\
main\
0\
0\
node:Send Threema Notification\
type:main\
index:0\
authors:Marcus Kunkel\
name:Version 3c36e20c\
description:empty\
autosaved:false\
tags\
0\
updatedAt:2025-12-23T09:34:57.682Z\
createdAt:2025-12-23T09:34:57.682Z\
id:1G25hJ4CstTCgKO9\
name:G\'f6hrum\
1\
updatedAt:2025-11-23T13:54:55.934Z\
createdAt:2025-11-23T13:54:55.934Z\
id:UbtH830CoddJZ3Zk\
name:generator\
2\
updatedAt:2025-12-23T09:34:51.833Z\
createdAt:2025-12-23T09:34:51.833Z\
id:jj3XLdaKjqa8OQ2V\
name:BERENT\
3\
updatedAt:2025-12-04T19:32:55.000Z\
createdAt:2025-11-23T15:45:35.268Z\
id:BFYzOmXZPvhoUbBS\
name:fonio AGS Nachbearbeitung Transkript alt\
active:false\
isArchived:false\
nodes\
0\
parameters\
httpMethod:POST\
path:fonio-ags-transkript\
options:\{empty object\}\
type:n8n-nodes-base.webhook\
typeVersion:2.1\
position\
0:0\
1:0\
id:dbb2ce2e-7047-422a-b8a2-7cd7f735f599\
name:Webhook\
webhookId:d9a56c84-3178-44a5-9d50-e8a42a1f9a00\
1\
parameters\
assignments\
assignments\
0\
id:04f27e3e-ebed-4ae5-a22f-23d0f7c61904\
name:body[0].body.formattedTranscript\
value:=\{\{ $json.body[0].body.formattedTranscript \}\}\
type:string\
1\
id:017777fc-53d7-473d-b3c8-09a32e601385\
name:body[0].body.fromNumber\
value:=\{\{ $json.body[0].body.fromNumber \}\}\
type:string\
2\
id:882e8a05-a492-4445-bb4a-1856bfb586a1\
name:body[0].body.context.anrufer_name\
value:=\{\{ $json.body[0].body.context.anrufer_name \}\}\
type:string\
3\
id:a6508b49-d751-49d7-b40c-c91be52f5839\
name:body[0].body.context.einrichtung_typ\
value:=\{\{ $json.body[0].body.context.einrichtung_typ \}\}\
type:string\
4\
id:08190377-3019-449b-9374-494e642c5125\
name:body[0].body.context.einrichtung_name\
value:=\{\{ $json.body[0].body.context.einrichtung_name \}\}\
type:string\
5\
id:58740a6d-b29d-48ca-b2a3-fc14e3dedaeb\
name:body[0].body.context.technisch\
value:=\{\{ $json.body[0].body.context.technisch \}\}\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:224\
1:0\
id:b905e673-945d-4303-8ddb-de9c95625fc3\
name:Daten extrahieren\
2\
parameters\
options\
systemMessage:<system_prompt>\\nDU BIST EIN HOCHSPEZIALISIERTER KLASSIFIKATIONS-AGENT F\'dcR IT-HOTLINE-TRANSKRIPTE. DEINE HAUPTAUFGABE IST ES, JEDE ANFRAGE PR\'c4ZISE IN EINE DER DRINGLICHKEITSKATEGORIEN A, B, C ODER D EINZUORDNEN. DIE GRUNDLAGE DEINER KLASSIFIKATION SIND DIE **DEFINITIONEN, REGELN UND BEISPIELE**, DIE IN EINEM EXTERN GEPFLEGTEN **GOOGLE SHEET** ENTHALTEN SIND.\\n\\n###ZIEL###\\n\\nSTELLE SICHER, DASS TECHNIKER DURCH DEINE KATEGORISIERUNG **HOCHVORBEREITET UND ZIELGERICHTET** AUF DIE ANFRAGE REAGIEREN K\'d6NNEN. JEDE EINORDNUNG MUSS DIE **DRINGLICHKEIT** DER TECHNISCHEN ANFRAGE REALISTISCH UND ZUVERL\'c4SSIG ABBILDEN.\\n\\n---\\n\\n###CHAIN OF THOUGHTS###\\n\\nFOLGE DIESER SYSTEMATISCHEN VORGEHENSWEISE, UM DIE TRANSKRIPTE ZU ANALYSIEREN UND DIE RICHTIGE DRINGLICHKEITSSTUFE FESTZULEGEN:\\n\\n1. **UNDERSTAND**  \\n   - LESE DAS TRANSKRIPT GR\'dcNDLICH UND IDENTIFIZIERE DAS KONKRETE TECHNISCHE PROBLEM SOWIE DIE AUSWIRKUNGEN AUF DEN ANRUFER (z.\uc0\u8239 B. Produktivit\'e4tsausfall, Datenverlust, Eskalationsdrohung).\\n\\n2. **BASICS**  \\n   - ERKENNE ZENTRALE SCHL\'dcSSELBEGRIFFE UND SIGNALW\'d6RTER, DIE AUF HOHE/NIEDRIGE DRINGLICHKEIT HINDEUTEN (z.\u8239 B. \'84NICHT ARBEITSF\'c4HIG\'93, \'84WARTEN AUF KUNDEN\'93, \'84IST DRINGEND\'93, \'84NICHT ZEITKRITISCH\'93).\\n\\n3. **BREAK DOWN**  \\n   - IDENTIFIZIERE:\\n     - OB EIN GESCH\'c4FTSKRITISCHER AUSFALL VORLIEGT\\n     - OB MEHRERE NUTZER BETROFFEN SIND\\n     - OB ES SICH UM EINEN STANDARDVORGANG HANDELT\\n     - OB FRISTEN / SLA-RELEVANTE ZEITPUNKTE BENANNT WERDEN\\n\\n4. **ANALYZE**  \\n   - VERGLEICHE DIE ERKANNTEN MERKMALE MIT DEN REFERENZBEISPIELEN IM GOOGLE SHEET.\\n   - W\'c4HLE DIE DRINGLICHKEITSSTUFE (A\'96D), DIE DER FALLBESCHREIBUNG IM TRANSKRIPT **AM N\'c4CHSTEN KOMMT**.\\n\\n5. **BUILD**  \\n   - FASSE DEINE ANALYSE IN EINEM KURZEN BEGR\'dcNDETEN KOMMENTAR ZUSAMMEN.\\n   - GIB DIE FINAL ZUGEORDNETE KATEGORIE AUS.\\n\\n6. **EDGE CASES**  \\n   - WENN DAS TRANSKRIPT **UNKLAR ODER WIDERSPR\'dcCHLICH** IST, W\'c4HLE DIE KONSERVATIVERE (H\'d6HERE) KATEGORIE UND WEISE EXPLIZIT AUF DIE UNSICHERHEIT HIN.\\n\\n7. **FINAL ANSWER FORMAT**  \\n   - GIB DEINE ANTWORT IM FOLGENDEN FORMAT AUS:\\n\\n```json\\n\{\\n  "Dringlichkeit": "B",\\n  "Begr\'fcndung": "Der Kunde ist arbeitsf\'e4hig, jedoch blockiert ein IT-Fehler einen zeitkritischen Gesch\'e4ftsprozess. \'c4hnliche F\'e4lle wurden im Sheet als B eingestuft."\\n\}\\n```\\n\\n---\\n\\n###WAS NICHT ZU TUN IST###\\n\\nVERMEIDE UNBEDINGT FOLGENDE FEHLER:\\n\\n- **NIEMALS** KATEGORIEN OHNE BEZUG ZUM GOOGLE SHEET FESTLEGEN  \\n- **VERMEIDE VAGE BEGR\'dcNDUNGEN** WIE \'84H\'d6RT SICH DRINGEND AN\'93 ODER \'84KLINGT NICHT WICHTIG\'93  \\n- **NICHT EINFACH NACH SCHL\'dcSSELWORTEN KLASSIFIZIEREN**, SONDERN IMMER DIE GESAMTSITUATION ANALYSIEREN  \\n- **NIEMALS AUSSAGEN ERFINDEN**, DIE NICHT IM TRANSKRIPT ENTHALTEN SIND  \\n- **NICHT \'dcBERKATEGORISIEREN**: W\'c4HLE NICHT \'84A\'93, NUR WEIL EIN KUNDE UNZUFRIEDEN IST, WENN DIE TECHNISCHE LAGE ES NICHT RECHTFERTIGT  \\n- **IGNORIERE KEINESFALLS** HINWEISE AUF SYSTEMRELEVANZ ODER PRODUKTIONSSTOPP\\n\\n---\\n\\n###FEW-SHOT BEISPIELE###\\n\\n####Beispiel 1:\\n**Transkript (Auszug):**  \\n\'84Ich kann mich nicht mehr in SAP anmelden, wir m\'fcssen heute unbedingt die Monatsabrechnung machen.\'93\\n\\n**Ausgabe:**  \\n```json\\n\{\\n  "Dringlichkeit": "A",\\n  "Begr\'fcndung": "Ein gesch\'e4ftskritischer Prozess (Monatsabrechnung) ist blockiert. Entsprechend der Referenzf\'e4lle im Sheet ist dies Kategorie A."\\n\}\\n```\\n\\n####Beispiel 2:\\n**Transkript (Auszug):**  \\n\'84Ich wollte nur fragen, ob man den Drucker auch \'fcber WLAN verbinden kann \'96 ist aber nicht eilig.\'93\\n\\n**Ausgabe:**  \\n```json\\n\{\\n  "Dringlichkeit": "D",\\n  "Begr\'fcndung": "Kein akuter Vorfall, Informationsanfrage ohne Zeitdruck. Entspricht klar Kategorie D im Sheet."\\n\}\\n```\\n\\n</system_prompt>\
type:@n8n/n8n-nodes-langchain.agent\
typeVersion:3\
position\
0:432\
1:0\
id:0aeac5e6-c9be-4642-9858-9cf4394bc907\
name:AI Agent\
3\
parameters\
model\
__rl:true\
value:claude-sonnet-4-20250514\
mode:list\
cachedResultName:Claude Sonnet 4\
options:\{empty object\}\
type:@n8n/n8n-nodes-langchain.lmChatAnthropic\
typeVersion:1.3\
position\
0:304\
1:208\
id:b72b4dd9-4588-4dc0-996c-834b03ded117\
name:Anthropic Chat Model\
credentials\
anthropicApi\
id:6RlfJdXsmselCNpN\
name:Anthropic account 2\
connections\
Webhook\
main\
0\
0\
node:Daten extrahieren\
type:main\
index:0\
Daten extrahieren\
main\
0\
0\
node:AI Agent\
type:main\
index:0\
Anthropic Chat Model\
ai_languageModel\
0\
0\
node:AI Agent\
type:ai_languageModel\
index:0\
settings\
executionOrder:v1\
staticData:null\
meta\
templateCredsSetupCompleted:true\
pinData:\{empty object\}\
versionId:d5df5744-7d36-4fbb-ac6a-a36b16241341\
activeVersionId:null\
triggerCount:1\
shared\
0\
updatedAt:2025-11-23T15:45:35.270Z\
createdAt:2025-11-23T15:45:35.270Z\
role:workflow:owner\
workflowId:BFYzOmXZPvhoUbBS\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
4\
updatedAt:2025-12-24T08:50:16.836Z\
createdAt:2025-12-15T21:35:40.591Z\
id:C3QqvJAGjf0KhCZH\
name:n8n to GitHub Auto-Backup (inkrementell)\
active:false\
isArchived:false\
nodes\
0\
parameters:\{empty object\}\
id:e5ca91e2-f818-4bdb-b748-d122e2021c3a\
name:Manual Trigger\
type:n8n-nodes-base.manualTrigger\
typeVersion:1\
position\
0:-720\
1:-656\
1\
parameters\
content:## \uc0\u55357 \u56580  n8n \u8594  GitHub Auto-Backup\\n\\nAutomatisches Backup System\\n\\nTrigger:\\n1. \u9200  Schedule: 7:00-20:00 Uhr (alle 15min)\\n2. \u55357 \u56390  Manual: On-Demand au\'dferhalb der Zeit\\n\\nAblauf:\\n1. Alle Workflows abrufen (n8n API)\\n2. \'c4nderungen erkennen (SHA256 Hash)\\n3. Nur ge\'e4nderte pushen \u8594  GitHub\\n4. Statistik sammeln\\n5. Bei \'c4nderungen: Threema Notification\\n\\n**Features:**\\n\u9989  Inkrementell (nur \'c4nderungen)\\n\u9989  Automatische Kategorisierung\\n\u9989  Hash-basierte Change Detection\\n\u9989  Zeitgesteuert + Manuell\\n\u9989  Threema Work Benachrichtigung\\n\\n**Setup erforderlich:**\\n1. n8n API Key (Settings \u8594  API)\\n2. GitHub Personal Access Token (repo scope)\\n3. Threema Work API Credentials\
height:916\
width:496\
color:4\
id:208c8c16-9e72-47de-994e-af1aee214010\
name:Workflow Documentation\
type:n8n-nodes-base.stickyNote\
typeVersion:1\
position\
0:-816\
1:-1408\
2\
parameters\
assignments\
assignments\
0\
id:161e6775-602d-4527-befd-e58008924f10\
name:secret\
value:18DOvPKBV7ize3Nh\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:-496\
1:-736\
id:a5028991-8793-4104-96e7-4e5de99cdd37\
name:Config\
3\
parameters\
mode:runOnceForEachItem\
jsCode:const r = $json; // Das ist der Rucksack\\nconst wf = r.workflows[r.index];\\n\\n// Selbst-Backup Sperre\\nconst isSelf = wf.id === 'C3QqvJAGjf0KhCZH';\\n\\nconst name = wf.name || "unnamed";\\nconst clean = String(name).replace(/[^a-zA-Z0-9-_\'e4\'f6\'fc\'c4\'d6\'dc\'df ]/g, '').replace(/\\s+/g, '-').toLowerCase();\\n\\nr.aktueller_name = name;\\nr.aktueller_pfad = `n8n/$\{clean\}.json`;\\nr.aktueller_inhalt = Buffer.from(JSON.stringify(wf, null, 2)).toString('base64');\\nr.ist_self = isSelf;\\n\\nreturn r;\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:400\
1:-928\
id:e7de0b76-4ed8-425c-9f93-f4727a4a57a6\
name:Extrahieren und Verarbeiten\
4\
parameters\
jsCode:const r = $json;\\nconst wort = r.anzahl === 1 ? 'Workflow' : 'Workflows';\\n\\nreturn \{\\n  hasChanges: (r.neu + r.updates) > 0,\\n  text: `\uc0\u9989  Backup beendet: $\{r.anzahl\} $\{wort\} gepr\'fcft.\\n` +\\n        `Ergebnis: $\{r.neu\} neu, $\{r.updates\} aktualisiert, $\{r.skip\} unver\'e4ndert.\\n\\n` +\\n        `$\{r.tabelle.join('\\n') || 'Keine \'c4nderungen'\}`\\n\};\
id:da117cd8-c031-4d5f-8313-701cdfe54c64\
name:Backup-Statistik einsammeln\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:400\
1:-736\
5\
parameters\
mode:runOnceForEachItem\
jsCode:const remote = $json; // GitHub Ergebnis\\nconst r = $node["Extrahieren und Verarbeiten"].json; // Unser Rucksack\\n\\nlet action = 'skip';\\nlet sha = remote.sha || null;\\n\\nif (!r.ist_self) \{\\n    if (remote.error || !remote.sha) \{\\n        action = 'create';\\n    \} else \{\\n        const remoteContent = (remote.content || '').replace(/\\s/g, '');\\n        const localContent = (r.aktueller_inhalt || '').replace(/\\s/g, '');\\n        if (remoteContent !== localContent) \{\\n            action = 'update';\\n        \}\\n    \}\\n\}\\n\\n// WICHTIG: Wir geben den Rucksack (r) plus die neue Entscheidung zur\'fcck\\nreturn \{ ...r, action, sha \};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:848\
1:-928\
id:f03cf7be-e43f-4b2d-945d-2662dd6a2baa\
name:Bestimme Handlung\
6\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:1\
conditions\
0\
id:stats-has-changes\
leftValue:=\{\{ $json.hasChanges \}\}\
rightValue:true\
operator\
type:boolean\
operation:equals\
combinator:and\
options:\{empty object\}\
id:9765e155-b5b2-4532-84dc-4815626bdbca\
name:Benachrichtigung senden?\
type:n8n-nodes-base.if\
typeVersion:2\
position\
0:624\
1:-736\
7\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:a21035d4-b914-483c-aca3-c493a3546872\
leftValue:=\{\{ $json.action \}\}\
rightValue:skip\
operator\
type:string\
operation:notEquals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:1072\
1:-928\
id:c5e4a411-fe36-42d3-9fe5-cf284bc5d850\
name:Ge\'e4nderter Workflow?\
8\
parameters\
url:http://localhost:5678/api/v1/workflows\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
options\
response\
response\
responseFormat:json\
pagination\
pagination\
parameters\
parameters\
0\
name:cursor\
value:=\{\{ $response.body.nextCursor \}\}\
paginationCompleteWhen:other\
completeExpression:=\{\{ !$response.body.nextCursor \}\}\
limitPagesFetched:true\
id:7965aee1-74f5-4967-8296-d7fb7bff9e18\
name:Hole alle Workflows\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-272\
1:-736\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:API n8n\
9\
parameters\
method:POST\
url:https://msgapi.threema.ch/send_simple\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
contentType:form-urlencoded\
bodyParameters\
parameters\
0\
name:from\
value:*BERENT1\
1\
name:to\
value:BUMFMZ39\
2\
name:secret\
value:=\{\{ $('Config').first().json.secret \}\}\
3\
name:text\
value:=\{\{ $json.text \}\}\\n\\n\uc0\u55357 \u56599  https://github.com/peerendees/n8n-workflows/n8n\
options:\{empty object\}\
id:1a8aaca0-70af-4dd0-b513-4f3de2c10ef5\
name:Threema Benachrichtigung\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:848\
1:-736\
credentials\
httpHeaderAuth\
id:nSNvIRCSAnKXrLyH\
name:API Threema Work BERENT1\
10\
parameters\
method:PUT\
url:=https://api.github.com/repos/peerendees/n8n-workflows/contents/\{\{ $json.aktueller_pfad \}\}\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
bodyParameters\
parameters\
0\
name:message\
value:=\uc0\u55358 \u56598  Auto-Backup: \{\{ $json.aktueller_name \}\} (\{\{ $json.action \}\})\
1\
name:content\
value:=\{\{ $json.aktueller_inhalt \}\}\
2\
name:branch\
value:main\
3\
name:sha\
value:=\{\{ $json.sha ? $json.sha : undefined \}\}\
options:\{empty object\}\
id:5de3d43a-8ae0-4b28-bb44-4487d37d09f8\
name:An GitHub \'fcbergeben\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:1296\
1:-992\
credentials\
httpHeaderAuth\
id:aZMd0okvVFkvyGnj\
name:GitHub Token\
onError:continueRegularOutput\
11\
parameters\
rule\
interval\
0\
field:cronExpression\
expression:*/15 7-20 * * *\
id:7b387171-2246-4827-8c8b-1293ad9ede50\
name:Zeitplan: 7-20 Uhr (alle 15min)\
type:n8n-nodes-base.scheduleTrigger\
typeVersion:1.2\
position\
0:-720\
1:-848\
12\
parameters\
jsCode:const workflows = $node["Hole alle Workflows"].json.data || [];\\nreturn \{\\n  workflows: workflows,\\n  index: 0,\\n  anzahl: workflows.length,\\n  neu: 0,\\n  updates: 0,\\n  skip: 0,\\n  tabelle: [] // Hier kommen die Namen rein\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-48\
1:-736\
id:bfebb75e-854b-4e01-9183-f51fb8064fc1\
name:Initialisierung\
13\
parameters\
mode:runOnceForEachItem\
jsCode:// WICHTIG: Wir ignorieren das direkte Input-JSON (GitHub Antwort)\\n// und holen uns den Rucksack direkt von "Bestimme Handlung" zur\'fcck.\\nconst r = $("Bestimme Handlung").item.json;\\n\\nif (!r.ist_self) \{\\n    if (r.action === 'create') \{\\n        r.neu++;\\n        r.tabelle.push(`\'95 $\{r.aktueller_name\} (Neu)`);\\n    \} else if (r.action === 'update') \{\\n        r.updates++;\\n        r.tabelle.push(`\'95 $\{r.aktueller_name\} (Update)`);\\n    \} else \{\\n        r.skip++;\\n    \}\\n\} else \{\\n    r.skip++;\\n\}\\n\\n// Z\'e4hler erh\'f6hen\\nr.index++;\\n\\n// Jetzt ist der Rucksack wieder das Haupt-Objekt f\'fcr die n\'e4chste Runde\\nreturn r;\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1520\
1:-800\
id:bbf7cbd3-5a12-4db8-8c21-97a2e10ca6a4\
name:Tabelle pflegen\
14\
parameters\
resource:file\
operation:get\
owner\
__rl:true\
value:peerendees\
mode:name\
repository\
__rl:true\
value:n8n-workflows\
mode:list\
cachedResultName:n8n-workflows\
cachedResultUrl:https://github.com/peerendees/n8n-workflows\
filePath:=\{\{ $json.aktueller_pfad \}\}\
asBinaryProperty:false\
additionalParameters\
reference:main\
type:n8n-nodes-base.github\
typeVersion:1.1\
position\
0:624\
1:-928\
id:ca6d1fd3-4d01-49ba-86f8-98929e969590\
name:Pr\'fcfe GitHub zur Datei\
webhookId:694567e2-c3e8-4bfc-91af-aae5697aca36\
credentials\
githubApi\
id:uE78TkEY6lWLV4oP\
name:API GitHub\
onError:continueRegularOutput\
15\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:54a2217a-25f1-452b-a80a-b7b77c94f9f7\
leftValue:=\{\{ $json.index \}\}\
rightValue:=\{\{ $json.anzahl \}\}\
operator\
type:number\
operation:lt\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:176\
1:-736\
id:1a2a15c5-1990-4fa7-808d-0bb3f9e2af6a\
name:Schleife pr\'fcfen\
16\
parameters\
url:=http://localhost:5678/api/v1/workflows/C3QqvJAGjf0KhCZH\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
options\
response\
response\
responseFormat:json\
id:9fae7de8-e952-4872-9802-c84534196ea4\
name:Hole aktuellen Workflow\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:0\
1:-336\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:API n8n\
17\
parameters\
jsCode:const workflow = $json.data || $json;\\nconst workflowJson = JSON.stringify(workflow, null, 2);\\nconst content = Buffer.from(workflowJson).toString('base64');\\n\\nreturn \{\\n  workflow_name: workflow.name || 'n8n-Backup-Workflow',\\n  workflow_content: content,\\n  workflow_json: workflowJson\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:224\
1:-336\
id:7dd007f5-71f7-4912-9f4a-eed95182740e\
name:Workflow vorbereiten\
18\
parameters\
resource:file\
operation:get\
owner\
__rl:true\
value:peerendees\
mode:name\
repository\
__rl:true\
value:n8n-workflows\
mode:list\
cachedResultName:n8n-workflows\
cachedResultUrl:https://github.com/peerendees/n8n-workflows\
filePath:n8n-Backup-Workflow.json\
asBinaryProperty:false\
additionalParameters\
reference:main\
type:n8n-nodes-base.github\
typeVersion:1.1\
position\
0:448\
1:-336\
id:930cd93d-7b02-4843-8915-8b21fa349a25\
name:Pr\'fcfe Workflow auf GitHub\
webhookId:694567e2-c3e8-4bfc-91af-aae5697aca36\
credentials\
githubApi\
id:uE78TkEY6lWLV4oP\
name:API GitHub\
onError:continueRegularOutput\
19\
parameters\
jsCode:const remote = $json;\\nconst local = $node["Workflow vorbereiten"].json;\\n\\nlet sha = null;\\nlet action = 'create';\\n\\nif (!remote.error && remote.sha) \{\\n  sha = remote.sha;\\n  const remoteContent = (remote.content || '').replace(/\\s/g, '');\\n  const localContent = (local.workflow_content || '').replace(/\\s/g, '');\\n  if (remoteContent !== localContent) \{\\n    action = 'update';\\n  \} else \{\\n    action = 'skip';\\n  \}\\n\}\\n\\nreturn \{\\n  ...local,\\n  sha: sha,\\n  action: action\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:672\
1:-336\
id:1930e4ff-a42a-425a-98e6-24c418377c22\
name:Bestimme Workflow-Aktion\
20\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:workflow-action-check\
leftValue:=\{\{ $json.action \}\}\
rightValue:skip\
operator\
type:string\
operation:notEquals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:896\
1:-336\
id:fe6ad7df-5b8c-4ba2-938e-70aa2d8632f7\
name:Workflow ge\'e4ndert?\
21\
parameters\
method:PUT\
url:https://api.github.com/repos/peerendees/n8n-workflows/contents/n8n-Backup-Workflow.json\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
bodyParameters\
parameters\
0\
name:message\
value:=\uc0\u55358 \u56598  Workflow-Backup: \{\{ $json.workflow_name \}\} (\{\{ $json.action \}\})\
1\
name:content\
value:=\{\{ $json.workflow_content \}\}\
2\
name:branch\
value:main\
3\
name:sha\
value:=\{\{ $json.sha ? $json.sha : undefined \}\}\
options:\{empty object\}\
id:ac2c61ea-404a-45c5-8e90-33a4b8d78e98\
name:Workflow auf GitHub speichern\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:1120\
1:-336\
credentials\
httpHeaderAuth\
id:aZMd0okvVFkvyGnj\
name:GitHub Token\
onError:continueRegularOutput\
connections\
Manual Trigger\
main\
0\
0\
node:Config\
type:main\
index:0\
Config\
main\
0\
0\
node:Hole alle Workflows\
type:main\
index:0\
Extrahieren und Verarbeiten\
main\
0\
0\
node:Pr\'fcfe GitHub zur Datei\
type:main\
index:0\
Backup-Statistik einsammeln\
main\
0\
0\
node:Benachrichtigung senden?\
type:main\
index:0\
Bestimme Handlung\
main\
0\
0\
node:Ge\'e4nderter Workflow?\
type:main\
index:0\
Benachrichtigung senden?\
main\
0\
0\
node:Threema Benachrichtigung\
type:main\
index:0\
Ge\'e4nderter Workflow?\
main\
0\
0\
node:An GitHub \'fcbergeben\
type:main\
index:0\
1\
0\
node:Tabelle pflegen\
type:main\
index:0\
Hole alle Workflows\
main\
0\
0\
node:Initialisierung\
type:main\
index:0\
Threema Benachrichtigung\
main\
0:[empty array]\
An GitHub \'fcbergeben\
main\
0\
0\
node:Tabelle pflegen\
type:main\
index:0\
Zeitplan: 7-20 Uhr (alle 15min)\
main\
0\
0\
node:Config\
type:main\
index:0\
Initialisierung\
main\
0\
0\
node:Schleife pr\'fcfen\
type:main\
index:0\
Tabelle pflegen\
main\
0\
0\
node:Schleife pr\'fcfen\
type:main\
index:0\
Pr\'fcfe GitHub zur Datei\
main\
0\
0\
node:Bestimme Handlung\
type:main\
index:0\
Schleife pr\'fcfen\
main\
0\
0\
node:Extrahieren und Verarbeiten\
type:main\
index:0\
1\
0\
node:Backup-Statistik einsammeln\
type:main\
index:0\
Hole aktuellen Workflow\
main\
0\
0\
node:Workflow vorbereiten\
type:main\
index:0\
Workflow vorbereiten\
main\
0\
0\
node:Pr\'fcfe Workflow auf GitHub\
type:main\
index:0\
Pr\'fcfe Workflow auf GitHub\
main\
0\
0\
node:Bestimme Workflow-Aktion\
type:main\
index:0\
Bestimme Workflow-Aktion\
main\
0\
0\
node:Workflow ge\'e4ndert?\
type:main\
index:0\
Workflow ge\'e4ndert?\
main\
0\
0\
node:Workflow auf GitHub speichern\
type:main\
index:0\
settings\
executionOrder:v1\
staticData\
node:Schedule: 7-18 Uhr (alle 15min)\
recurrenceRules:[empty array]\
node:Zeitplan: 7-20 Uhr (alle 15min)\
recurrenceRules:[empty array]\
meta\
templateCredsSetupCompleted:true\
pinData:\{empty object\}\
versionId:c322cc04-8f1d-4dda-a5d8-f0d6b91b439d\
activeVersionId:null\
triggerCount:1\
shared\
0\
updatedAt:2025-12-15T21:35:40.595Z\
createdAt:2025-12-15T21:35:40.595Z\
role:workflow:owner\
workflowId:C3QqvJAGjf0KhCZH\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
5\
updatedAt:2025-12-03T14:11:05.000Z\
createdAt:2025-11-17T21:03:36.257Z\
id:CCJmgqzH9XCESXGz\
name:My Sub-workflow\
active:true\
isArchived:false\
nodes\
0\
parameters:\{empty object\}\
type:@n8n/n8n-nodes-langchain.code\
typeVersion:1\
position\
0:-640\
1:336\
id:7529b4b9-a2c9-4732-8dc8-8c7b4e924aa9\
name:LangChain Code\
1\
parameters\
inputSource:passthrough\
id:414d8426-53cf-4db3-ae65-58b9ab576d9a\
typeVersion:1.1\
name:Start\
type:n8n-nodes-base.executeWorkflowTrigger\
position\
0:-848\
1:336\
2\
parameters\
authentication:serviceAccount\
documentId\
__rl:true\
value:1kyIdVpLg4Ate6b0o2yyB4wzu3e7stQjcILLVrWX6RD8\
mode:id\
sheetName\
__rl:true\
value:gid=0\
mode:list\
cachedResultName:Anrufer\
cachedResultUrl:https://docs.google.com/spreadsheets/d/1kyIdVpLg4Ate6b0o2yyB4wzu3e7stQjcILLVrWX6RD8/edit#gid=0\
options:\{empty object\}\
type:n8n-nodes-base.googleSheets\
typeVersion:4.7\
position\
0:-320\
1:224\
id:86ba2908-e79b-4cea-b516-72436f22c05c\
name:Get row(s) in sheet\
credentials\
googleApi\
id:vRVq7GTwn9kTIi8N\
name:Google Sheets account 2\
3\
parameters:\{empty object\}\
type:n8n-nodes-base.manualTrigger\
typeVersion:1\
position\
0:-640\
1:128\
id:d6d88f12-945d-485a-ad0e-19afa6233241\
name:When clicking \'91Execute workflow\'92\
disabled:true\
4\
parameters\
jsCode:const items = $input.all();\\nconst now = new Date();\\n\\nconsole.log("Aktuelle Zeit:", now.toISOString());\\n\\nconst itemsToCall = items.filter(item => \{\\n  const anrufzeitpunkt = item.json.Anrufzeitpunkt;\\n  console.log("Anrufzeitpunkt aus Sheet:", anrufzeitpunkt);\\n  \\n  const callTime = new Date(anrufzeitpunkt);\\n  console.log("Geparste callTime:", callTime.toISOString());\\n  \\n  const timeDiff = now.getTime() - callTime.getTime();\\n  console.log("TimeDiff in ms:", timeDiff);\\n  console.log("Bedingung erf\'fcllt?", timeDiff >= 0 && timeDiff <= 60000);\\n  \\n  return timeDiff >= 0 && timeDiff <= 60000;\\n\});\\n\\nreturn itemsToCall;\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-112\
1:224\
id:fa54ed68-a3f2-4ce1-9b59-597e25d9d736\
name:Check Time\
5\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:2\
conditions\
0\
id:fcd2afab-561c-46c7-85fb-cf7f44ae08d4\
leftValue:empty\
rightValue:empty\
operator\
type:string\
operation:equals\
name:filter.operator.equals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.2\
position\
0:96\
1:224\
id:3ff081fa-082a-4377-afa3-93cdd34f1b3f\
name:If\
connections\
When clicking \'91Execute workflow\'92\
main\
0\
0\
node:Get row(s) in sheet\
type:main\
index:0\
Get row(s) in sheet\
main\
0\
0\
node:Check Time\
type:main\
index:0\
Check Time\
main\
0\
0\
node:If\
type:main\
index:0\
settings\
executionOrder:v1\
staticData:null\
meta\
templateCredsSetupCompleted:true\
pinData:\{empty object\}\
versionId:99d3901b-455e-4629-804b-823baef4fa18\
activeVersionId:99d3901b-455e-4629-804b-823baef4fa18\
triggerCount:0\
shared\
0\
updatedAt:2025-11-17T21:03:36.264Z\
createdAt:2025-11-17T21:03:36.264Z\
role:workflow:owner\
workflowId:CCJmgqzH9XCESXGz\
projectId:yr4Hj71ou1NOsi2p\
activeVersion\
updatedAt:2025-12-18T10:08:31.967Z\
createdAt:2025-12-18T10:08:31.967Z\
versionId:99d3901b-455e-4629-804b-823baef4fa18\
workflowId:CCJmgqzH9XCESXGz\
nodes\
0\
parameters:\{empty object\}\
type:@n8n/n8n-nodes-langchain.code\
typeVersion:1\
position\
0:-640\
1:336\
id:7529b4b9-a2c9-4732-8dc8-8c7b4e924aa9\
name:LangChain Code\
1\
parameters\
inputSource:passthrough\
id:414d8426-53cf-4db3-ae65-58b9ab576d9a\
typeVersion:1.1\
name:Start\
type:n8n-nodes-base.executeWorkflowTrigger\
position\
0:-848\
1:336\
2\
parameters\
authentication:serviceAccount\
documentId\
__rl:true\
value:1kyIdVpLg4Ate6b0o2yyB4wzu3e7stQjcILLVrWX6RD8\
mode:id\
sheetName\
__rl:true\
value:gid=0\
mode:list\
cachedResultName:Anrufer\
cachedResultUrl:https://docs.google.com/spreadsheets/d/1kyIdVpLg4Ate6b0o2yyB4wzu3e7stQjcILLVrWX6RD8/edit#gid=0\
options:\{empty object\}\
type:n8n-nodes-base.googleSheets\
typeVersion:4.7\
position\
0:-320\
1:224\
id:86ba2908-e79b-4cea-b516-72436f22c05c\
name:Get row(s) in sheet\
credentials\
googleApi\
id:vRVq7GTwn9kTIi8N\
name:Google Sheets account 2\
3\
parameters:\{empty object\}\
type:n8n-nodes-base.manualTrigger\
typeVersion:1\
position\
0:-640\
1:128\
id:d6d88f12-945d-485a-ad0e-19afa6233241\
name:When clicking \'91Execute workflow\'92\
disabled:true\
4\
parameters\
jsCode:const items = $input.all();\\nconst now = new Date();\\n\\nconsole.log("Aktuelle Zeit:", now.toISOString());\\n\\nconst itemsToCall = items.filter(item => \{\\n  const anrufzeitpunkt = item.json.Anrufzeitpunkt;\\n  console.log("Anrufzeitpunkt aus Sheet:", anrufzeitpunkt);\\n  \\n  const callTime = new Date(anrufzeitpunkt);\\n  console.log("Geparste callTime:", callTime.toISOString());\\n  \\n  const timeDiff = now.getTime() - callTime.getTime();\\n  console.log("TimeDiff in ms:", timeDiff);\\n  console.log("Bedingung erf\'fcllt?", timeDiff >= 0 && timeDiff <= 60000);\\n  \\n  return timeDiff >= 0 && timeDiff <= 60000;\\n\});\\n\\nreturn itemsToCall;\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-112\
1:224\
id:fa54ed68-a3f2-4ce1-9b59-597e25d9d736\
name:Check Time\
5\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:2\
conditions\
0\
id:fcd2afab-561c-46c7-85fb-cf7f44ae08d4\
leftValue:empty\
rightValue:empty\
operator\
type:string\
operation:equals\
name:filter.operator.equals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.2\
position\
0:96\
1:224\
id:3ff081fa-082a-4377-afa3-93cdd34f1b3f\
name:If\
connections\
When clicking \'91Execute workflow\'92\
main\
0\
0\
node:Get row(s) in sheet\
type:main\
index:0\
Get row(s) in sheet\
main\
0\
0\
node:Check Time\
type:main\
index:0\
Check Time\
main\
0\
0\
node:If\
type:main\
index:0\
authors:system migration\
name:null\
description:null\
autosaved:false\
tags:[empty array]\
6\
updatedAt:2025-12-23T22:48:49.094Z\
createdAt:2025-11-11T22:01:32.621Z\
id:CKF3dFWeZX0gTU1U\
name:YouTube-Transkript f\'fcr Notion 0.9.1\
active:false\
isArchived:false\
nodes\
0\
parameters:\{empty object\}\
id:0529cc23-465a-4869-905d-7ffdf002f3f5\
name:Manueller Start\
type:n8n-nodes-base.manualTrigger\
typeVersion:1\
position\
0:-544\
1:128\
1\
parameters\
options:\{empty object\}\
id:08656112-da08-41bd-8afe-0f30a17bb215\
name:Kanal Konfiguration\
type:n8n-nodes-base.set\
typeVersion:3\
position\
0:-368\
1:128\
2\
parameters:\{empty object\}\
id:2911386d-5ba0-4f0a-8f54-72534aed4e3a\
name:YouTube Videos abrufen\
type:n8n-nodes-youtube.youtube\
typeVersion:1\
position\
0:-192\
1:128\
3\
parameters:\{empty object\}\
id:c37e66e7-bd0c-47bb-ad6e-977633822372\
name:Video Details\
type:n8n-nodes-youtube.youtube\
typeVersion:1\
position\
0:0\
1:0\
4\
parameters\
url:=https://api.youtubetranscript.com/?video_id=\{\{ $json.id.videoId \}\}\
options\
timeout:30000\
id:6008e63c-6c09-4572-ab87-e5340024d883\
name:Transkript extrahieren\
type:n8n-nodes-base.httpRequest\
typeVersion:4.1\
position\
0:0\
1:144\
5\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
conditions\
0\
id:has-transcript\
leftValue:=\{\{ $json.transcript || $json.text || '' \}\}\
rightValue:empty\
operator\
type:string\
operation:notEmpty\
1\
id:min-length\
leftValue:=\{\{ ($json.transcript || $json.text || '').length \}\}\
rightValue:100\
operator\
type:number\
operation:gt\
combinator:and\
options:\{empty object\}\
id:7319f50a-bdf6-4a97-9e8e-90e64d0b3eb4\
name:Transkript validieren\
type:n8n-nodes-base.if\
typeVersion:2\
position\
0:176\
1:144\
6\
parameters\
mode:runOnceForEachItem\
jsCode:// Alle Daten aus vorherigen Nodes sammeln\\nconst searchData = $('youtube-search').item(0).json;\\nconst videoDetails = $('video-details').item(0).json;\\nconst transcriptData = $('get-transcript').item(0).json;\\nconst config = $('config').item(0).json;\\n\\n// Transkript extrahieren und bereinigen\\nlet rawTranscript = transcriptData.transcript || transcriptData.text || '';\\nif (Array.isArray(transcriptData)) \{\\n  rawTranscript = transcriptData.map(item => item.text || item.content || '').join(' ');\\n\}\\n\\n// Text bereinigen und formatieren\\nconst cleanTranscript = rawTranscript\\n  .replace(/\\[.*?\\]/g, '')           // [Musik], [Applaus] etc.\\n  .replace(/\\(.*?\\)/g, '')           // (inaudible) etc.\\n  .replace(/\\s+/g, ' ')              // Mehrfache Leerzeichen\\n  .replace(/\\n+/g, '\\n\\n')           // Abs\'e4tze formatieren\\n  .trim();\\n\\n// Video-Dauer aus ISO 8601 Format parsen (PT4M13S -> 4:13)\\nfunction parseDuration(duration) \{\\n  if (!duration) return 'Unknown';\\n  const match = duration.match(/PT(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+)S)?/);\\n  if (!match) return duration;\\n  \\n  const hours = parseInt(match[1] || 0);\\n  const minutes = parseInt(match[2] || 0);\\n  const seconds = parseInt(match[3] || 0);\\n  \\n  if (hours > 0) \{\\n    return `$\{hours\}:$\{minutes.toString().padStart(2, '0')\}:$\{seconds.toString().padStart(2, '0')\}`;\\n  \} else \{\\n    return `$\{minutes\}:$\{seconds.toString().padStart(2, '0')\}`;\\n  \}\\n\}\\n\\n// Tags aus Video-Titel und Beschreibung extrahieren\\nfunction extractTags(title, description) \{\\n  const tags = [];\\n  const text = (title + ' ' + description).toLowerCase();\\n  \\n  // AI/KI-bezogene Keywords\\n  if (text.match(/(ai|artificial intelligence|chatgpt|gpt|claude|llm|machine learning|automation)/)) \{\\n    tags.push('AI');\\n  \}\\n  \\n  // Marketing Keywords\\n  if (text.match(/(marketing|sales|business|growth|strategy|revenue)/)) \{\\n    tags.push('Marketing');\\n  \}\\n  \\n  // Tutorial Keywords\\n  if (text.match(/(tutorial|how to|guide|step by step|walkthrough|setup)/)) \{\\n    tags.push('Tutorial');\\n  \}\\n  \\n  // Tool Keywords\\n  if (text.match(/(tool|software|app|platform|api|integration)/)) \{\\n    tags.push('Tools');\\n  \}\\n  \\n  return tags.length > 0 ? tags : ['AI']; // Default fallback\\n\}\\n\\nreturn \{\\n  // Video Grunddaten\\n  videoId: searchData.id.videoId,\\n  title: videoDetails.snippet.title,\\n  channelTitle: videoDetails.snippet.channelTitle,\\n  authorName: config.authorName,\\n  publishedAt: videoDetails.snippet.publishedAt,\\n  description: videoDetails.snippet.description,\\n  \\n  // Statistiken\\n  viewCount: parseInt(videoDetails.statistics?.viewCount || 0),\\n  likeCount: parseInt(videoDetails.statistics?.likeCount || 0),\\n  duration: parseDuration(videoDetails.contentDetails?.duration),\\n  \\n  // URLs\\n  videoUrl: `https://youtube.com/watch?v=$\{searchData.id.videoId\}`,\\n  thumbnailUrl: videoDetails.snippet?.thumbnails?.high?.url || '',\\n  \\n  // Transkript\\n  cleanTranscript: cleanTranscript,\\n  transcriptLength: cleanTranscript.length,\\n  wordCount: cleanTranscript.split(' ').length,\\n  estimatedReadingTime: Math.ceil(cleanTranscript.split(' ').length / 200),\\n  \\n  // Auto-Tags\\n  autoTags: extractTags(videoDetails.snippet.title, videoDetails.snippet.description)\\n\};\
id:dcfdaf32-c774-400d-8290-bdd6e2f6d4e9\
name:Daten zusammenf\'fchren\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:368\
1:48\
7\
parameters\
text:=\{\{ $json.cleanTranscript \}\}\
translateTo:DE\
additionalFields:\{empty object\}\
id:fdb1c480-70bf-4817-93bc-8648c73e5b7b\
name:DeepL \'dcbersetzen\
type:n8n-nodes-base.deepL\
typeVersion:1\
position\
0:544\
1:48\
8\
parameters\
resource:databasePage\
databaseId:22f31cc6-fd56-80f8-9a68-da6f99f3dade\
options:\{empty object\}\
id:575440c2-7ac3-4366-9f15-2bd1fbb4a40c\
name:Notion Eintrag erstellen\
type:n8n-nodes-base.notion\
typeVersion:2\
position\
0:720\
1:48\
9\
parameters:\{empty object\}\
id:1f1a0e3c-192b-4300-bf97-9bee858e0220\
name:Threema Benachrichtigung\
type:n8n-nodes-base.threema\
typeVersion:1\
position\
0:896\
1:48\
connections:\{empty object\}\
settings\
executionOrder:v1\
staticData:null\
meta:null\
pinData:\{empty object\}\
versionId:56bf5671-3ae3-43b6-9d15-7293f763a9a2\
activeVersionId:null\
triggerCount:0\
shared\
0\
updatedAt:2025-11-11T22:01:32.624Z\
createdAt:2025-11-11T22:01:32.624Z\
role:workflow:owner\
workflowId:CKF3dFWeZX0gTU1U\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
7\
updatedAt:2025-12-31T19:20:42.765Z\
createdAt:2025-12-31T18:22:13.596Z\
id:CXNW6swsN3tf28Ux\
name:n8n \uc0\u8594  GitHub Sicherung\
active:true\
isArchived:false\
nodes\
0\
parameters\
rule\
interval\
0\
field:cronExpression\
expression:*/15 * * * *\
id:schedule-trigger\
name:Zeitplan: alle 15 Minuten\
type:n8n-nodes-base.scheduleTrigger\
typeVersion:1.2\
position\
0:-720\
1:-568\
1\
parameters\
url:=https://n8n.srv1098810.hstgr.cloud/api/v1/workflows\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
options\
response\
response\
responseFormat:json\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-272\
1:-568\
id:hole-alle-workflows\
name:Hole alle Workflows\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:API n8n\
2\
parameters\
jsCode:const workflows = $json.data || [];\\nreturn \{\\n  workflows: workflows,\\n  index: 0,\\n  anzahl: workflows.length,\\n  neu: 0,\\n  updates: 0,\\n  skip: 0,\\n  tabelle: []\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-48\
1:-568\
id:initialisierung\
name:Initialisierung\
3\
parameters\
mode:runOnceForEachItem\
jsCode:const r = $json; // Rucksack\\nconst wf = r.workflows[r.index];\\n\\n// \'dcberspringe archivierte Workflows\\nif (wf.isArchived === true) \{\\n  return null;\\n\}\\n\\nconst workflowId = wf.id || '';\\nconst workflowName = wf.name || 'Unnamed Workflow';\\nconst cleanName = String(workflowName).replace(/[^a-zA-Z0-9-_\'e4\'f6\'fc\'c4\'d6\'dc\'df ]/g, '').replace(/\\s+/g, '-').toLowerCase();\\n\\n// Neue Struktur: n8n/\{workflowId\}/\{workflowName\}.json\\nconst dateipfad = `n8n/$\{workflowId\}/$\{cleanName\}.json`;\\nconst workflowContent = Buffer.from(JSON.stringify(wf, null, 2)).toString('base64');\\n\\nreturn \{\\n  ...r,\\n  workflowId: workflowId,\\n  workflowName: workflowName,\\n  workflowData: wf,\\n  dateipfad: dateipfad,\\n  workflowContent: workflowContent,\\n  updatedAt: wf.updatedAt || wf.createdAt || new Date().toISOString()\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:176\
1:-568\
id:extrahiere-workflow\
name:Extrahiere Workflow\
4\
parameters\
resource:file\
operation:get\
owner\
__rl:true\
value:peerendees\
mode:name\
repository\
__rl:true\
value:n8n-workflows\
mode:list\
cachedResultName:n8n-workflows\
cachedResultUrl:https://github.com/peerendees/n8n-workflows\
filePath:=\{\{ $json.dateipfad \}\}\
asBinaryProperty:false\
additionalParameters\
reference:main\
type:n8n-nodes-base.github\
typeVersion:1.1\
position\
0:400\
1:-640\
id:pruefe-github-datei\
name:Pr\'fcfe GitHub Datei\
webhookId:694567e2-c3e8-4bfc-91af-aae5697aca36\
credentials\
githubApi\
id:uE78TkEY6lWLV4oP\
name:API GitHub\
onError:continueRegularOutput\
5\
parameters\
jsCode:const r = $json; // Rucksack\\nconst githubFile = $node["Pr\'fcfe GitHub Datei"].json;\\n\\nlet action = 'skip';\\nlet sha = null;\\n\\n// Pr\'fcfe ob Datei auf GitHub existiert\\nif (githubFile && !githubFile.error && githubFile.sha) \{\\n  sha = githubFile.sha;\\n  \\n  // Vergleich: Inhalt ge\'e4ndert?\\n  const remoteContent = (githubFile.content || '').replace(/\\s/g, '');\\n  const localContent = (r.workflowContent || '').replace(/\\s/g, '');\\n  \\n  if (remoteContent !== localContent) \{\\n    action = 'update';\\n  \}\\n\} else \{\\n  // Datei existiert nicht - neu anlegen\\n  action = 'create';\\n\}\\n\\nreturn \{\\n  ...r,\\n  action: action,\\n  sha: sha\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:624\
1:-640\
id:bestimme-handlung\
name:Bestimme Handlung\
6\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-action\
leftValue:=\{\{ $json.action \}\}\
rightValue:skip\
operator\
type:string\
operation:notEquals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:848\
1:-640\
id:pruefe-ob-sichern\
name:Pr\'fcfe ob Sichern\
7\
parameters\
method:PUT\
url:=https://api.github.com/repos/peerendees/n8n-workflows/contents/\{\{ $json.dateipfad \}\}\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
bodyParameters\
parameters\
0\
name:message\
value:=\uc0\u55358 \u56598  Auto-Backup: \{\{ $json.workflowName \}\} (\{\{ $json.action \}\})\
1\
name:content\
value:=\{\{ $json.workflowContent \}\}\
2\
name:branch\
value:main\
3\
name:sha\
value:=\{\{ $json.sha || undefined \}\}\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:1072\
1:-736\
id:sichere-auf-github\
name:Sichere auf GitHub\
credentials\
httpHeaderAuth\
id:aZMd0okvVFkvyGnj\
name:GitHub Token\
onError:continueRegularOutput\
8\
parameters\
mode:runOnceForEachItem\
jsCode:// Aktualisiere Statistiken\\n// Hole Rucksack von Bestimme Handlung\\nconst r = $node["Bestimme Handlung"].json;\\nconst githubResponse = $json;\\n\\nif (r.action === 'create') \{\\n  r.neu++;\\n\} else if (r.action === 'update') \{\\n  r.updates++;\\n\} else \{\\n  r.skip++;\\n\}\\n\\n// F\'fcge zur Tabelle hinzu\\nif (r.action !== 'skip') \{\\n  const status = githubResponse.error ? '\uc0\u10060  Fehler' : '\u9989  Erfolg';\\n  r.tabelle.push(`$\{status\} $\{r.action === 'create' ? 'NEU' : 'UPDATE'\}: $\{r.workflowName\}`);\\n\}\\n\\n// Z\'e4hler erh\'f6hen\\nr.index++;\\n\\nreturn r;\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1296\
1:-736\
id:aktualisiere-statistik\
name:Aktualisiere Statistik\
9\
parameters\
mode:runOnceForEachItem\
jsCode:// Wenn skip: Aktualisiere Statistik direkt\\nconst r = $json;\\n\\nr.skip++;\\nr.index++;\\n\\nreturn r;\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1296\
1:-544\
id:skip-statistik\
name:Skip Statistik\
10\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-loop\
leftValue:=\{\{ $json.index \}\}\
rightValue:=\{\{ $json.anzahl \}\}\
operator\
type:number\
operation:lt\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:1520\
1:-544\
id:schleife-pruefen\
name:Schleife pr\'fcfen\
11\
parameters\
jsCode:const r = $json;\\nconst wort = r.anzahl === 1 ? 'Workflow' : 'Workflows';\\n\\nreturn \{\\n  hasChanges: (r.neu + r.updates) > 0,\\n  text: `\uc0\u9989  Backup beendet: $\{r.anzahl\} $\{wort\} gepr\'fcft.\\n` +\\n        `Ergebnis: $\{r.neu\} neu, $\{r.updates\} aktualisiert, $\{r.skip\} unver\'e4ndert.\\n\\n` +\\n        `$\{r.tabelle.join('\\n') || 'Keine \'c4nderungen'\}`\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1744\
1:-544\
id:backup-statistik\
name:Backup-Statistik\
12\
parameters\
assignments\
assignments\
0\
id:threema-secret\
name:secret\
value:18DOvPKBV7ize3Nh\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:-496\
1:-568\
id:config\
name:Config\
13\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-has-changes\
leftValue:=\{\{ $json.hasChanges \}\}\
rightValue:true\
operator\
type:boolean\
operation:equals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:1968\
1:-544\
id:pruefe-aenderungen\
name:Pr\'fcfe \'c4nderungen\
14\
parameters\
method:POST\
url:https://msgapi.threema.ch/send_simple\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
contentType:form-urlencoded\
bodyParameters\
parameters\
0\
name:from\
value:*BERENT1\
1\
name:to\
value:BUMFMZ39\
2\
name:secret\
value:=\{\{ $('Config').first().json.secret \}\}\
3\
name:text\
value:=\{\{ $json.text \}\}\\n\\n\uc0\u55357 \u56599  https://github.com/peerendees/n8n-workflows/n8n\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:2192\
1:-544\
id:threema-benachrichtigung\
name:Threema Benachrichtigung\
credentials\
httpHeaderAuth\
id:nSNvIRCSAnKXrLyH\
name:API Threema Work BERENT1\
connections\
Zeitplan: alle 15 Minuten\
main\
0\
0\
node:Config\
type:main\
index:0\
Config\
main\
0\
0\
node:Hole alle Workflows\
type:main\
index:0\
Hole alle Workflows\
main\
0\
0\
node:Initialisierung\
type:main\
index:0\
Initialisierung\
main\
0\
0\
node:Extrahiere Workflow\
type:main\
index:0\
Extrahiere Workflow\
main\
0\
0\
node:Pr\'fcfe GitHub Datei\
type:main\
index:0\
Pr\'fcfe GitHub Datei\
main\
0\
0\
node:Bestimme Handlung\
type:main\
index:0\
Bestimme Handlung\
main\
0\
0\
node:Pr\'fcfe ob Sichern\
type:main\
index:0\
Pr\'fcfe ob Sichern\
main\
0\
0\
node:Sichere auf GitHub\
type:main\
index:0\
1\
0\
node:Skip Statistik\
type:main\
index:0\
Skip Statistik\
main\
0\
0\
node:Schleife pr\'fcfen\
type:main\
index:0\
Sichere auf GitHub\
main\
0\
0\
node:Aktualisiere Statistik\
type:main\
index:0\
Aktualisiere Statistik\
main\
0\
0\
node:Schleife pr\'fcfen\
type:main\
index:0\
Schleife pr\'fcfen\
main\
0\
0\
node:Extrahiere Workflow\
type:main\
index:0\
1\
0\
node:Backup-Statistik\
type:main\
index:0\
Backup-Statistik\
main\
0\
0\
node:Pr\'fcfe \'c4nderungen\
type:main\
index:0\
Pr\'fcfe \'c4nderungen\
main\
0\
0\
node:Threema Benachrichtigung\
type:main\
index:0\
1:[empty array]\
Threema Benachrichtigung\
main\
0:[empty array]\
settings\
executionOrder:v1\
callerPolicy:workflowsFromSameOwner\
availableInMCP:false\
staticData\
node:Zeitplan: alle 15 Minuten\
recurrenceRules:[empty array]\
meta:null\
pinData:\{empty object\}\
versionId:7ee60282-1b91-45da-a7ec-3d4729559c5c\
activeVersionId:c744c3f9-fc90-492f-babe-87d3cfc3f68a\
triggerCount:1\
shared\
0\
updatedAt:2025-12-31T18:22:13.598Z\
createdAt:2025-12-31T18:22:13.598Z\
role:workflow:owner\
workflowId:CXNW6swsN3tf28Ux\
projectId:yr4Hj71ou1NOsi2p\
activeVersion\
updatedAt:2025-12-31T19:04:57.000Z\
createdAt:2025-12-31T18:22:13.602Z\
versionId:c744c3f9-fc90-492f-babe-87d3cfc3f68a\
workflowId:CXNW6swsN3tf28Ux\
nodes\
0\
parameters\
rule\
interval\
0\
field:cronExpression\
expression:*/15 * * * *\
id:schedule-trigger\
name:Zeitplan: alle 15 Minuten\
type:n8n-nodes-base.scheduleTrigger\
typeVersion:1.2\
position\
0:-720\
1:-656\
1\
parameters\
method:GET\
url:=https://n8n.srv1098810.hstgr.cloud/api/v1/workflows\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
options\
response\
response\
responseFormat:json\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-496\
1:-656\
id:hole-alle-workflows\
name:Hole alle Workflows\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:API n8n\
2\
parameters\
jsCode:const workflows = $json.data || [];\\nreturn \{\\n  workflows: workflows,\\n  index: 0,\\n  anzahl: workflows.length,\\n  neu: 0,\\n  updates: 0,\\n  skip: 0,\\n  tabelle: []\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-272\
1:-656\
id:initialisierung\
name:Initialisierung\
3\
parameters\
mode:runOnceForEachItem\
jsCode:const r = $json; // Rucksack\\nconst wf = r.workflows[r.index];\\n\\n// \'dcberspringe archivierte Workflows\\nif (wf.isArchived === true) \{\\n  return null;\\n\}\\n\\nconst workflowId = wf.id || '';\\nconst workflowName = wf.name || 'Unnamed Workflow';\\nconst cleanName = String(workflowName).replace(/[^a-zA-Z0-9-_\'e4\'f6\'fc\'c4\'d6\'dc\'df ]/g, '').replace(/\\s+/g, '-').toLowerCase();\\n\\n// Neue Struktur: n8n/\{workflowId\}/\{workflowName\}.json\\nconst dateipfad = `n8n/$\{workflowId\}/$\{cleanName\}.json`;\\nconst workflowContent = Buffer.from(JSON.stringify(wf, null, 2)).toString('base64');\\n\\nreturn \{\\n  ...r,\\n  workflowId: workflowId,\\n  workflowName: workflowName,\\n  workflowData: wf,\\n  dateipfad: dateipfad,\\n  workflowContent: workflowContent,\\n  updatedAt: wf.updatedAt || wf.createdAt || new Date().toISOString()\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-48\
1:-656\
id:extrahiere-workflow\
name:Extrahiere Workflow\
4\
parameters\
resource:file\
operation:get\
owner\
__rl:true\
value:peerendees\
mode:name\
repository\
__rl:true\
value:n8n-workflows\
mode:list\
cachedResultName:n8n-workflows\
cachedResultUrl:https://github.com/peerendees/n8n-workflows\
filePath:=\{\{ $json.dateipfad \}\}\
asBinaryProperty:false\
additionalParameters\
reference:main\
type:n8n-nodes-base.github\
typeVersion:1.1\
position\
0:176\
1:-656\
id:pruefe-github-datei\
name:Pr\'fcfe GitHub Datei\
webhookId:694567e2-c3e8-4bfc-91af-aae5697aca36\
credentials\
githubApi\
id:uE78TkEY6lWLV4oP\
name:API GitHub\
onError:continueRegularOutput\
5\
parameters\
jsCode:const r = $json; // Rucksack\\nconst githubFile = $node["Pr\'fcfe GitHub Datei"].json;\\n\\nlet action = 'skip';\\nlet sha = null;\\n\\n// Pr\'fcfe ob Datei auf GitHub existiert\\nif (githubFile && !githubFile.error && githubFile.sha) \{\\n  sha = githubFile.sha;\\n  \\n  // Vergleich: Inhalt ge\'e4ndert?\\n  const remoteContent = (githubFile.content || '').replace(/\\s/g, '');\\n  const localContent = (r.workflowContent || '').replace(/\\s/g, '');\\n  \\n  if (remoteContent !== localContent) \{\\n    action = 'update';\\n  \}\\n\} else \{\\n  // Datei existiert nicht - neu anlegen\\n  action = 'create';\\n\}\\n\\nreturn \{\\n  ...r,\\n  action: action,\\n  sha: sha\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:400\
1:-656\
id:bestimme-handlung\
name:Bestimme Handlung\
6\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-action\
leftValue:=\{\{ $json.action \}\}\
rightValue:skip\
operator\
type:string\
operation:notEquals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:624\
1:-656\
id:pruefe-ob-sichern\
name:Pr\'fcfe ob Sichern\
7\
parameters\
method:PUT\
url:=https://api.github.com/repos/peerendees/n8n-workflows/contents/\{\{ $json.dateipfad \}\}\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
bodyParameters\
parameters\
0\
name:message\
value:=\uc0\u55358 \u56598  Auto-Backup: \{\{ $json.workflowName \}\} (\{\{ $json.action \}\})\
1\
name:content\
value:=\{\{ $json.workflowContent \}\}\
2\
name:branch\
value:main\
3\
name:sha\
value:=\{\{ $json.sha || undefined \}\}\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:848\
1:-656\
id:sichere-auf-github\
name:Sichere auf GitHub\
credentials\
httpHeaderAuth\
id:aZMd0okvVFkvyGnj\
name:GitHub Token\
onError:continueRegularOutput\
8\
parameters\
mode:runOnceForEachItem\
jsCode:// Aktualisiere Statistiken\\n// Hole Rucksack von Bestimme Handlung\\nconst r = $node["Bestimme Handlung"].json;\\nconst githubResponse = $json;\\n\\nif (r.action === 'create') \{\\n  r.neu++;\\n\} else if (r.action === 'update') \{\\n  r.updates++;\\n\} else \{\\n  r.skip++;\\n\}\\n\\n// F\'fcge zur Tabelle hinzu\\nif (r.action !== 'skip') \{\\n  const status = githubResponse.error ? '\uc0\u10060  Fehler' : '\u9989  Erfolg';\\n  r.tabelle.push(`$\{status\} $\{r.action === 'create' ? 'NEU' : 'UPDATE'\}: $\{r.workflowName\}`);\\n\}\\n\\n// Z\'e4hler erh\'f6hen\\nr.index++;\\n\\nreturn r;\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1072\
1:-656\
id:aktualisiere-statistik\
name:Aktualisiere Statistik\
9\
parameters\
mode:runOnceForEachItem\
jsCode:// Wenn skip: Aktualisiere Statistik direkt\\nconst r = $json;\\n\\nr.skip++;\\nr.index++;\\n\\nreturn r;\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:624\
1:-720\
id:skip-statistik\
name:Skip Statistik\
10\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-loop\
leftValue:=\{\{ $json.index \}\}\
rightValue:=\{\{ $json.anzahl \}\}\
operator\
type:number\
operation:lt\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:1296\
1:-656\
id:schleife-pruefen\
name:Schleife pr\'fcfen\
11\
parameters\
jsCode:const r = $json;\\nconst wort = r.anzahl === 1 ? 'Workflow' : 'Workflows';\\n\\nreturn \{\\n  hasChanges: (r.neu + r.updates) > 0,\\n  text: `\uc0\u9989  Backup beendet: $\{r.anzahl\} $\{wort\} gepr\'fcft.\\n` +\\n        `Ergebnis: $\{r.neu\} neu, $\{r.updates\} aktualisiert, $\{r.skip\} unver\'e4ndert.\\n\\n` +\\n        `$\{r.tabelle.join('\\n') || 'Keine \'c4nderungen'\}`\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1520\
1:-656\
id:backup-statistik\
name:Backup-Statistik\
12\
parameters\
assignments\
assignments\
0\
id:threema-secret\
name:secret\
value:18DOvPKBV7ize3Nh\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:-720\
1:-592\
id:config\
name:Config\
13\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-has-changes\
leftValue:=\{\{ $json.hasChanges \}\}\
rightValue:true\
operator\
type:boolean\
operation:equals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:1744\
1:-656\
id:pruefe-aenderungen\
name:Pr\'fcfe \'c4nderungen\
14\
parameters\
method:POST\
url:https://msgapi.threema.ch/send_simple\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
contentType:form-urlencoded\
bodyParameters\
parameters\
0\
name:from\
value:*BERENT1\
1\
name:to\
value:BUMFMZ39\
2\
name:secret\
value:=\{\{ $('Config').first().json.secret \}\}\
3\
name:text\
value:=\{\{ $json.text \}\}\\n\\n\uc0\u55357 \u56599  https://github.com/peerendees/n8n-workflows/n8n\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:1968\
1:-656\
id:threema-benachrichtigung\
name:Threema Benachrichtigung\
credentials\
httpHeaderAuth\
id:nSNvIRCSAnKXrLyH\
name:API Threema Work BERENT1\
connections\
Zeitplan: alle 15 Minuten\
main\
0\
0\
node:Config\
type:main\
index:0\
Config\
main\
0\
0\
node:Hole alle Workflows\
type:main\
index:0\
Hole alle Workflows\
main\
0\
0\
node:Initialisierung\
type:main\
index:0\
Initialisierung\
main\
0\
0\
node:Extrahiere Workflow\
type:main\
index:0\
Extrahiere Workflow\
main\
0\
0\
node:Pr\'fcfe GitHub Datei\
type:main\
index:0\
Pr\'fcfe GitHub Datei\
main\
0\
0\
node:Bestimme Handlung\
type:main\
index:0\
Bestimme Handlung\
main\
0\
0\
node:Pr\'fcfe ob Sichern\
type:main\
index:0\
Pr\'fcfe ob Sichern\
main\
0\
0\
node:Sichere auf GitHub\
type:main\
index:0\
1\
0\
node:Skip Statistik\
type:main\
index:0\
Skip Statistik\
main\
0\
0\
node:Schleife pr\'fcfen\
type:main\
index:0\
Sichere auf GitHub\
main\
0\
0\
node:Aktualisiere Statistik\
type:main\
index:0\
Aktualisiere Statistik\
main\
0\
0\
node:Schleife pr\'fcfen\
type:main\
index:0\
Schleife pr\'fcfen\
main\
0\
0\
node:Extrahiere Workflow\
type:main\
index:0\
1\
0\
node:Backup-Statistik\
type:main\
index:0\
Backup-Statistik\
main\
0\
0\
node:Pr\'fcfe \'c4nderungen\
type:main\
index:0\
Pr\'fcfe \'c4nderungen\
main\
0\
0\
node:Threema Benachrichtigung\
type:main\
index:0\
1:[empty array]\
Threema Benachrichtigung\
main\
0:[empty array]\
authors:Marcus Kunkel\
name:Version c744c3f9\
description:empty\
autosaved:false\
tags:[empty array]\
8\
updatedAt:2025-12-23T22:49:15.404Z\
createdAt:2025-11-11T22:30:16.638Z\
id:DKEKrzFx9oYFubkV\
name:YouTube-Transkript f\'fcr Notion 0.9.2\
active:false\
isArchived:false\
nodes\
0\
parameters\
httpMethod:POST\
path:youtube-transcript\
responseMode:responseNode\
options\
rawBody:true\
id:8578df34-bc02-4bd1-9715-42f75f19702a\
name:Webhook Trigger\
type:n8n-nodes-base.webhook\
typeVersion:1.1\
position\
0:-240\
1:112\
webhookId:youtube-transcript-webhook\
1\
parameters\
assignments\
assignments\
0\
id:youtube-url\
name:youtubeUrl\
value:=\{\{ $json.body.url || $json.query.url || $json.url \}\}\
type:string\
1\
id:video-id\
name:videoId\
value:=\{\{ $json.body.url ? $json.body.url.match(/(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/)([^&]+)/)?.[1] : '' \}\}\
type:string\
2\
id:author-name\
name:authorName\
value:=\{\{ $json.body.author || 'Unbekannt' \}\}\
type:string\
options:\{empty object\}\
id:bc66bf3f-464a-4a6c-a242-22b99c3fdf87\
name:Webhook Daten extrahieren\
type:n8n-nodes-base.set\
typeVersion:3.3\
position\
0:-16\
1:112\
2\
parameters\
operation:get\
part:snippet,contentDetails,statistics\
id:f38ef7ea-6f13-4373-8c7d-ac4cac265458\
name:YouTube Video Details\
type:n8n-nodes-base.youTube\
typeVersion:1\
position\
0:208\
1:112\
3\
parameters\
url:=https://api.youtubetranscript.com/?video_id=\{\{ $json.videoId \}\}\
options\
timeout:30000\
id:dd98d656-4525-4c0d-9927-df71725dfe4b\
name:Transkript extrahieren\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:432\
1:112\
4\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
conditions\
0\
id:has-transcript\
leftValue:=\{\{ $json.transcript || $json.text || '' \}\}\
rightValue:empty\
operator\
type:string\
operation:notEmpty\
1\
id:min-length\
leftValue:=\{\{ ($json.transcript || $json.text || '').length \}\}\
rightValue:100\
operator\
type:number\
operation:gt\
combinator:and\
options:\{empty object\}\
id:44540dcd-3aa0-4f12-a9b9-1545880563b9\
name:Transkript validieren\
type:n8n-nodes-base.if\
typeVersion:2\
position\
0:656\
1:112\
5\
parameters\
mode:runOnceForEachItem\
jsCode:// Alle Daten aus vorherigen Nodes sammeln\\nconst config = $('Webhook Daten extrahieren').item.json;\\nconst videoDetails = $('YouTube Video Details').item.json;\\nconst transcriptData = $('Transkript extrahieren').item.json;\\n\\n// Transkript extrahieren und bereinigen\\nlet rawTranscript = transcriptData.transcript || transcriptData.text || '';\\nif (Array.isArray(transcriptData)) \{\\n  rawTranscript = transcriptData.map(item => item.text || item.content || '').join(' ');\\n\}\\n\\n// Text bereinigen und formatieren\\nconst cleanTranscript = rawTranscript\\n  .replace(/\\[.*?\\]/g, '')           // [Musik], [Applaus] etc.\\n  .replace(/\\(.*?\\)/g, '')           // (inaudible) etc.\\n  .replace(/\\s+/g, ' ')              // Mehrfache Leerzeichen\\n  .replace(/\\n+/g, '\\n\\n')           // Abs\'e4tze formatieren\\n  .trim();\\n\\n// Video-Dauer aus ISO 8601 Format parsen (PT4M13S -> 4:13)\\nfunction parseDuration(duration) \{\\n  if (!duration) return 'Unknown';\\n  const match = duration.match(/PT(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+)S)?/);\\n  if (!match) return duration;\\n  \\n  const hours = parseInt(match[1] || 0);\\n  const minutes = parseInt(match[2] || 0);\\n  const seconds = parseInt(match[3] || 0);\\n  \\n  if (hours > 0) \{\\n    return `$\{hours\}:$\{minutes.toString().padStart(2, '0')\}:$\{seconds.toString().padStart(2, '0')\}`;\\n  \} else \{\\n    return `$\{minutes\}:$\{seconds.toString().padStart(2, '0')\}`;\\n  \}\\n\}\\n\\n// Tags aus Video-Titel und Beschreibung extrahieren\\nfunction extractTags(title, description) \{\\n  const tags = [];\\n  const text = (title + ' ' + description).toLowerCase();\\n  \\n  // AI/KI-bezogene Keywords\\n  if (text.match(/(ai|artificial intelligence|chatgpt|gpt|claude|llm|machine learning|automation)/)) \{\\n    tags.push('AI');\\n  \}\\n  \\n  // Marketing Keywords\\n  if (text.match(/(marketing|sales|business|growth|strategy|revenue)/)) \{\\n    tags.push('Marketing');\\n  \}\\n  \\n  // Tutorial Keywords\\n  if (text.match(/(tutorial|how to|guide|step by step|walkthrough|setup)/)) \{\\n    tags.push('Tutorial');\\n  \}\\n  \\n  // Tool Keywords\\n  if (text.match(/(tool|software|app|platform|api|integration)/)) \{\\n    tags.push('Tools');\\n  \}\\n  \\n  return tags.length > 0 ? tags : ['AI']; // Default fallback\\n\}\\n\\nreturn \{\\n  // Video Grunddaten\\n  videoId: config.videoId,\\n  title: videoDetails.snippet?.title || 'Unbekannt',\\n  channelTitle: videoDetails.snippet?.channelTitle || 'Unbekannt',\\n  authorName: config.authorName || 'Unbekannt',\\n  publishedAt: videoDetails.snippet?.publishedAt || new Date().toISOString(),\\n  description: videoDetails.snippet?.description || '',\\n  \\n  // Statistiken\\n  viewCount: parseInt(videoDetails.statistics?.viewCount || 0),\\n  likeCount: parseInt(videoDetails.statistics?.likeCount || 0),\\n  duration: parseDuration(videoDetails.contentDetails?.duration),\\n  \\n  // URLs\\n  videoUrl: `https://youtube.com/watch?v=$\{config.videoId\}`,\\n  thumbnailUrl: videoDetails.snippet?.thumbnails?.high?.url || '',\\n  \\n  // Transkript\\n  cleanTranscript: cleanTranscript,\\n  transcriptLength: cleanTranscript.length,\\n  wordCount: cleanTranscript.split(' ').length,\\n  estimatedReadingTime: Math.ceil(cleanTranscript.split(' ').length / 200),\\n  \\n  // Auto-Tags\\n  autoTags: extractTags(videoDetails.snippet?.title || '', videoDetails.snippet?.description || '')\\n\};\
id:8da16805-22c9-4587-9123-d9adeeef36ff\
name:Daten zusammenf\'fchren\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:880\
1:112\
6\
parameters\
text:=\{\{ $json.cleanTranscript \}\}\
translateTo:DE\
additionalFields:\{empty object\}\
id:b1940f22-06d0-4976-ae4e-4b1d42ebb692\
name:DeepL \'dcbersetzen\
type:n8n-nodes-base.deepL\
typeVersion:1\
position\
0:1104\
1:112\
7\
parameters\
resource:databasePage\
databaseId\
__rl:true\
mode:url\
value:=22f31cc6fd5680f89a68da6f99f3dade\
__regex:(?:https|http)://www\\.notion\\.so/(?:[a-z0-9-]\{2,\}/)?([0-9a-f]\{8\}-?[0-9a-f]\{4\}-?[0-9a-f]\{4\}-?[0-9a-f]\{4\}-?[0-9a-f]\{12\})\
title:YouTube Transkripte\
simple:false\
propertiesUi\
propertyValues\
0\
key:Autor\
options:\{empty object\}\
id:0c40d5b2-9606-4b6f-9e8f-634b726738d4\
name:Notion Eintrag erstellen\
type:n8n-nodes-base.notion\
typeVersion:2\
position\
0:1328\
1:112\
notesInFlow:true\
credentials\
notionApi\
id:KpKj51GJ0big0oYv\
name:API Notion\
notes:Datenbank-ID als ENV-Variable: NOTION_DATABASE_ID\
8\
parameters\
url:https://msgapi.threema.ch/send_simple\
authentication:generic\
options:\{empty object\}\
id:b35e4ad7-9a42-4754-b9fd-b5da476968d9\
name:Threema Work Benachrichtigung\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:1552\
1:112\
notesInFlow:true\
notes:Threema Work API - Empf\'e4nger-ID noch anzupassen\
9\
parameters\
respondWith:json\
responseBody:=\{\{ \{\\n  "success": true,\\n  "message": "Video erfolgreich verarbeitet",\\n  "videoId": $('Webhook Daten extrahieren').item.json.videoId,\\n  "title": $('Daten zusammenf\'fchren').item.json.title,\\n  "notionUrl": $('Notion Eintrag erstellen').item.json.url || 'Erstellt'\\n\} \}\}\
options:\{empty object\}\
id:bb891e48-698a-4b94-8eac-61cbc94e57fc\
name:Webhook Response\
type:n8n-nodes-base.respondToWebhook\
typeVersion:1\
position\
0:1776\
1:112\
connections\
Webhook Trigger\
main\
0\
0\
node:Webhook Daten extrahieren\
type:main\
index:0\
Webhook Daten extrahieren\
main\
0\
0\
node:YouTube Video Details\
type:main\
index:0\
YouTube Video Details\
main\
0\
0\
node:Transkript extrahieren\
type:main\
index:0\
Transkript extrahieren\
main\
0\
0\
node:Transkript validieren\
type:main\
index:0\
Transkript validieren\
main\
0\
0\
node:Daten zusammenf\'fchren\
type:main\
index:0\
Daten zusammenf\'fchren\
main\
0\
0\
node:DeepL \'dcbersetzen\
type:main\
index:0\
DeepL \'dcbersetzen\
main\
0\
0\
node:Notion Eintrag erstellen\
type:main\
index:0\
Notion Eintrag erstellen\
main\
0\
0\
node:Threema Work Benachrichtigung\
type:main\
index:0\
Threema Work Benachrichtigung\
main\
0\
0\
node:Webhook Response\
type:main\
index:0\
settings\
executionOrder:v1\
staticData:null\
meta\
templateCredsSetupCompleted:true\
pinData:\{empty object\}\
versionId:baed3b53-0023-4b19-8c53-4c8d1d50ec86\
activeVersionId:null\
triggerCount:0\
shared\
0\
updatedAt:2025-11-11T22:30:16.641Z\
createdAt:2025-11-11T22:30:16.641Z\
role:workflow:owner\
workflowId:DKEKrzFx9oYFubkV\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
9\
updatedAt:2025-11-23T13:53:12.000Z\
createdAt:2025-11-23T09:39:02.746Z\
id:FW97dPOfs3cg6oqO\
name:fonio-ags-anrufername alt\
active:false\
isArchived:true\
nodes\
0\
parameters\
httpMethod:POST\
path:anrufer-check\
responseMode:streaming\
options:\{empty object\}\
type:n8n-nodes-base.webhook\
typeVersion:2.1\
position\
0:-640\
1:16\
id:d60b24e2-8942-43cb-83d8-b34df837b7d7\
name:Webhook\
webhookId:b8ea38a3-1648-4893-9832-ffce7ef7d3ce\
alwaysOutputData:false\
executeOnce:false\
1\
parameters\
rules\
values\
0\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:2\
conditions\
0\
leftValue:=\{\{ $('Anrufername').first() \}\}\
rightValue:1\
operator\
type:object\
operation:notEmpty\
singleValue:true\
id:aa7cfa1c-48e4-4932-91f9-a2334b600d96\
combinator:and\
renameOutput:true\
outputKey:Bekannt\
1\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:2\
conditions\
0\
id:afc9691c-cfdc-4dad-a1b4-278ad46c5076\
leftValue:=\{\{ $('Anrufername') \}\}\
rightValue:0\
operator\
type:object\
operation:empty\
singleValue:true\
combinator:and\
renameOutput:true\
outputKey:Unbekannt\
options:\{empty object\}\
type:n8n-nodes-base.switch\
typeVersion:3.3\
position\
0:-192\
1:16\
id:fbb3825c-a9cd-4698-9d18-d0c6839479e2\
name:Switch\
2\
parameters\
authentication:serviceAccount\
documentId\
__rl:true\
value:1kyIdVpLg4Ate6b0o2yyB4wzu3e7stQjcILLVrWX6RD8\
mode:id\
sheetName\
__rl:true\
value:Anrufer\
mode:name\
filtersUI\
values\
0\
lookupColumn:Telefonnumer\
lookupValue:=\{\{ $json.body.fromNumber \}\}\
options:\{empty object\}\
type:n8n-nodes-base.googleSheets\
typeVersion:4.7\
position\
0:-416\
1:16\
id:a9fec415-876a-43b3-90b2-fc4881fd0a17\
name:Anrufername\
alwaysOutputData:true\
credentials\
googleApi\
id:vRVq7GTwn9kTIi8N\
name:Google Sheets account 2\
3\
parameters\
mode:raw\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:32\
1:-80\
id:34a729fc-9802-429b-8df0-f3ab3d7d8724\
name:Anrufer bekannt\
4\
parameters\
mode:raw\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:32\
1:112\
id:7c1d4587-97b9-4a81-9619-ccc35d30d0dd\
name:Anrufer unbekannt\
connections\
Webhook\
main\
0\
0\
node:Anrufername\
type:main\
index:0\
Anrufername\
main\
0\
0\
node:Switch\
type:main\
index:0\
Switch\
main\
0\
0\
node:Anrufer bekannt\
type:main\
index:0\
1\
0\
node:Anrufer unbekannt\
type:main\
index:0\
Anrufer bekannt\
main\
0:[empty array]\
Anrufer unbekannt\
main\
0:[empty array]\
settings\
executionOrder:v1\
staticData:null\
meta\
templateCredsSetupCompleted:true\
pinData:\{empty object\}\
versionId:2c6b34a5-183b-4269-a9e3-4033dde41c44\
activeVersionId:null\
triggerCount:1\
shared\
0\
updatedAt:2025-11-23T09:39:02.750Z\
createdAt:2025-11-23T09:39:02.750Z\
role:workflow:owner\
workflowId:FW97dPOfs3cg6oqO\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
10\
updatedAt:2025-12-31T18:20:36.513Z\
createdAt:2025-12-24T10:21:45.757Z\
id:MHpLYxsxsy0aSsEC\
name:GitHub \uc0\u8594  n8n Synchronisation (alt)\
active:false\
isArchived:false\
nodes\
0\
parameters\
httpMethod:POST\
path:github-sync-webhook\
options:\{empty object\}\
id:3f6024e1-e93e-40c6-a739-f4aa87f8c3a0\
name:GitHub Webhook Trigger\
type:n8n-nodes-base.webhook\
typeVersion:1\
position\
0:-11984\
1:-368\
webhookId:github-sync-webhook\
1\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-push-event\
leftValue:=\{\{ $json.headers['x-github-event'] \}\}\
rightValue:push\
operator\
type:string\
operation:equals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:-11760\
1:-368\
id:d4630a37-dee6-4fb6-a443-826bb5430291\
name:Pr\'fcfe Push Event\
2\
parameters\
jsCode:// Extrahiere ge\'e4nderte Dateien aus GitHub Webhook\\nconst body = $json.body || \{\};\\nconst commits = body.commits || [];\\nconst changedFiles = [];\\n\\n// Sammle alle ge\'e4nderten Dateien\\nfor (const commit of commits) \{\\n  const added = commit.added || [];\\n  const modified = commit.modified || [];\\n  \\n  for (const file of [...added, ...modified]) \{\\n    // Workflow-Dateien:\\n    // - Im n8n/ Verzeichnis (alte Struktur: n8n/workflow-name.json)\\n    // - In n8n/\{workflowId\}/ (neue Struktur: n8n/\{workflowId\}/\{workflowName\}.json)\\n    // - Im Root mit -workflow.json (z.B. github-to-n8n-sync-workflow.json)\\n    if (file.endsWith('.json') && \\n        (file.startsWith('n8n/') || file.includes('-workflow.json'))) \{\\n      changedFiles.push(file);\\n    \}\\n  \}\\n\}\\n\\nreturn changedFiles.map(file => (\{ filePath: file \}));\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-11536\
1:-368\
id:70782a79-3969-40cf-a6c5-7aee7c699e12\
name:Extrahiere ge\'e4nderte Dateien\
3\
parameters\
mode:runOnceForEachItem\
jsCode:const filePath = $json.filePath;\\nreturn \{ filePath \};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-11312\
1:-368\
id:2f0f0678-1667-40bf-98aa-b3bb2614e86c\
name:Vorbereiten Datei\
4\
parameters\
resource:file\
operation:get\
owner\
__rl:true\
value:peerendees\
mode:name\
repository\
__rl:true\
value:n8n-workflows\
mode:list\
cachedResultName:n8n-workflows\
cachedResultUrl:https://github.com/peerendees/n8n-workflows\
filePath:=\{\{ $json.filePath \}\}\
asBinaryProperty:false\
additionalParameters\
reference:main\
type:n8n-nodes-base.github\
typeVersion:1.1\
position\
0:-11088\
1:-368\
id:5fba3f0b-cbcf-49ac-ac5e-9dd3b7a85c66\
name:Hole Datei von GitHub\
webhookId:694567e2-c3e8-4bfc-91af-aae5697aca36\
credentials\
githubApi\
id:uE78TkEY6lWLV4oP\
name:API GitHub\
onError:continueRegularOutput\
5\
parameters\
jsCode:// Extrahiere Workflow-Daten aus GitHub-Datei\\nconst githubFile = $json;\\n\\nif (githubFile.error || !githubFile.content) \{\\n  return \{ error: 'Datei konnte nicht geladen werden' \};\\n\}\\n\\ntry \{\\n  const content = Buffer.from(githubFile.content, 'base64').toString('utf-8');\\n  const workflow = JSON.parse(content);\\n  \\n  // \'dcberspringe archivierte Workflows\\n  if (workflow.isArchived === true) \{\\n    return \{ error: 'Archivierter Workflow wird \'fcbersprungen' \};\\n  \}\\n  \\n  // Stelle sicher, dass workflowId vorhanden ist (kann leer sein f\'fcr neue Workflows)\\n  const workflowId = workflow.id || '';\\n  \\n  // Stelle sicher, dass name vorhanden ist\\n  const fileName = (githubFile.path || githubFile.name || '').split('/').pop().replace(/\\.json$/, '') || 'Unnamed Workflow';\\n  const finalWorkflowName = workflow.name || fileName;\\n  \\n  // Stelle sicher, dass workflowData das name-Feld hat\\n  const workflowData = \{\\n    ...workflow,\\n    name: finalWorkflowName\\n  \};\\n  \\n  // Wenn keine ID vorhanden ist, entferne sie aus workflowData (n8n vergibt neue ID)\\n  if (!workflowId) \{\\n    delete workflowData.id;\\n  \}\\n  \\n  return \{\\n    workflowId: workflowId,\\n    workflowName: finalWorkflowName,\\n    workflowData: workflowData,\\n    filePath: githubFile.path || githubFile.name,\\n    isNewWorkflow: !workflowId\\n  \};\\n\} catch (e) \{\\n  return \{ error: 'Fehler beim Parsen der Workflow-Datei: ' + e.message \};\\n\}\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-10864\
1:-368\
id:fc6afd70-8a39-4a34-a909-7ef99b901bdd\
name:Parse Workflow\
6\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-error\
leftValue:=\{\{ $json.error || '' \}\}\
rightValue:empty\
operator\
type:string\
operation:equals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:-10640\
1:-368\
id:fcd6eeba-4914-4969-bd1e-5e300dfdd023\
name:Pr\'fcfe Workflow\
7\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-has-id\
leftValue:=\{\{ $json.workflowId || '' \}\}\
rightValue:empty\
operator\
type:string\
operation:notEquals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:-10416\
1:-464\
id:2fb5b54b-234a-4fc5-982c-e61b2812ad7e\
name:Pr\'fcfe ob ID vorhanden\
8\
parameters\
url:=https://n8n.srv1098810.hstgr.cloud/api/v1/workflows/\{\{ $json.workflowId \}\}\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
options\
response\
response\
responseFormat:json\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-10192\
1:-560\
id:2b0e5a6c-259b-431c-ad9d-7b74b82f3158\
name:Pr\'fcfe ob Workflow existiert\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:API n8n\
onError:continueRegularOutput\
9\
parameters\
jsCode:// Analysiere die Antwort vom HTTP Request Node\\nconst response = $json;\\nconst parseWorkflowData = $node["Parse Workflow"].json;\\n\\n// Pr\'fcfe ob ein Fehler vorhanden ist (404 = Workflow existiert nicht)\\nif (response.error) \{\\n  // 404 bedeutet: Workflow existiert nicht\\n  if (response.error.message && response.error.message.includes('404')) \{\\n    return \{\\n      exists: false,\\n      workflowId: parseWorkflowData.workflowId,\\n      workflowName: parseWorkflowData.workflowName,\\n      workflowData: parseWorkflowData.workflowData,\\n      filePath: parseWorkflowData.filePath\\n    \};\\n  \}\\n  // Andere Fehler\\n  return \{\\n    exists: false,\\n    error: response.error.message || response.error,\\n    workflowId: parseWorkflowData.workflowId,\\n    workflowName: parseWorkflowData.workflowName,\\n    workflowData: parseWorkflowData.workflowData,\\n    filePath: parseWorkflowData.filePath\\n  \};\\n\}\\n\\n// Pr\'fcfe Status-Code\\nif (response.statusCode === 200 || (response.id && response.name)) \{\\n  return \{\\n    exists: true,\\n    workflowId: parseWorkflowData.workflowId,\\n    workflowName: parseWorkflowData.workflowName,\\n    workflowData: parseWorkflowData.workflowData,\\n    filePath: parseWorkflowData.filePath\\n  \};\\n\}\\n\\n// Workflow existiert nicht\\nreturn \{\\n  exists: false,\\n  workflowId: parseWorkflowData.workflowId,\\n  workflowName: parseWorkflowData.workflowName,\\n  workflowData: parseWorkflowData.workflowData,\\n  filePath: parseWorkflowData.filePath\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-9968\
1:-560\
id:2a159b51-df16-4663-8d32-b524f53ff510\
name:Analysiere Response\
10\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-exists\
leftValue:=\{\{ $json.exists \}\}\
rightValue:true\
operator\
type:boolean\
operation:equals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:-9744\
1:-560\
id:5ae25280-db83-491e-9f29-3633d0f2e306\
name:Workflow existiert?\
11\
parameters\
method:PUT\
url:=https://n8n.srv1098810.hstgr.cloud/api/v1/workflows/\{\{ $json.workflowId \}\}\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
bodyParameters\
parameters\
0:\{empty object\}\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-9520\
1:-608\
id:5ce95198-17c1-42c8-95c0-ee0e90fef17d\
name:Update Workflow\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:API n8n\
onError:continueRegularOutput\
12\
parameters\
method:POST\
url:=https://n8n.srv1098810.hstgr.cloud/api/v1/workflows\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
specifyBody:json\
jsonBody:=\{\{ $json.workflowData \}\}\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-9520\
1:-368\
id:20511787-e0ca-4cdf-9280-956554c80092\
name:Erstelle Workflow\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:API n8n\
onError:continueRegularOutput\
13\
parameters\
jsCode:// Vorbereite workflowData f\'fcr Erstellen\\nconst parseData = $node["Parse Workflow"].json;\\nconst workflowData = parseData.workflowData || \{\};\\nconst workflowName = parseData.workflowName || 'Unnamed Workflow';\\n\\n// Minimale erlaubte Felder f\'fcr n8n API beim Erstellen\\n// Nur die absolut notwendigen Felder\\nconst finalWorkflowData = \{\\n  name: workflowName,\\n  nodes: workflowData.nodes || [],\\n  connections: workflowData.connections || \{\}, // Pflichtfeld!\\n  settings: workflowData.settings || \{\\n    executionOrder: 'v1'\\n  \}\\n\};\\n\\n// Optionale Felder nur hinzuf\'fcgen, wenn sie vorhanden sind\\nif (workflowData.description) \{\\n  finalWorkflowData.description = workflowData.description;\\n\}\\nif (typeof workflowData.active === 'boolean') \{\\n  finalWorkflowData.active = workflowData.active;\\n\}\\nif (Array.isArray(workflowData.tags) && workflowData.tags.length > 0) \{\\n  finalWorkflowData.tags = workflowData.tags;\\n\}\\nif (workflowData.staticData) \{\\n  finalWorkflowData.staticData = workflowData.staticData;\\n\}\\n\\n// meta, pinData und andere interne Felder werden NICHT gesendet\\n// Diese werden von n8n automatisch gesetzt\\n\\n// Erstelle Body-String direkt hier\\nconst bodyString = JSON.stringify(finalWorkflowData);\\n\\nreturn \{\\n  ...parseData,\\n  workflowData: finalWorkflowData,\\n  bodyString: bodyString,\\n  debug: \{\\n    hasName: !!finalWorkflowData.name,\\n    nameValue: finalWorkflowData.name,\\n    hasSettings: !!finalWorkflowData.settings,\\n    fields: Object.keys(finalWorkflowData)\\n  \}\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-9744\
1:-320\
id:cb03822f-e87d-41b2-8275-a023e08c53a0\
name:Debug: Vor Erstellen\
14\
parameters\
jsCode:// Debug: Log Ergebnis\\nconst response = $json;\\nconst parseData = $node["Parse Workflow"].json;\\n\\n// Bestimme action basierend auf dem vorherigen Node\\nlet action = 'create';\\ntry \{\\n  const workflowExistsNode = $node["Workflow existiert?"];\\n  if (workflowExistsNode && workflowExistsNode.json && workflowExistsNode.json.exists !== undefined) \{\\n    action = workflowExistsNode.json.exists ? 'update' : 'create';\\n  \} else \{\\n    // Wenn Node nicht ausgef\'fchrt wurde, pr\'fcfe ob Update-Node ausgef\'fchrt wurde\\n    const updateNode = $node["Update Workflow"];\\n    if (updateNode && updateNode.json) \{\\n      action = 'update';\\n    \}\\n  \}\\n\} catch (e) \{\\n  // Node wurde nicht ausgef\'fchrt, default zu 'create'\\n  action = 'create';\\n\}\\n\\nif (response.error) \{\\n  return \{\\n    success: false,\\n    error: response.error.message || response.error,\\n    workflowName: parseData.workflowName || 'Unbekannt',\\n    workflowId: parseData.workflowId || '',\\n    action: action\\n  \};\\n\}\\n\\nif (response.statusCode && response.statusCode >= 400) \{\\n  return \{\\n    success: false,\\n    error: `HTTP $\{response.statusCode\}: $\{JSON.stringify(response.body || response)\}`,\\n    workflowName: parseData.workflowName || 'Unbekannt',\\n    workflowId: parseData.workflowId || '',\\n    action: action\\n  \};\\n\}\\n\\nreturn \{\\n  success: true,\\n  workflowName: response.name || parseData.workflowName || 'Unbekannt',\\n  workflowId: response.id || parseData.workflowId || '',\\n  action: action\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-9296\
1:-464\
id:87570ffe-7b04-4c11-82b7-084d4cfc30cc\
name:Debug: Ergebnis\
15\
parameters\
jsCode:// \'dcberspringe Workflow bei Fehler\\nconst data = $json;\\nreturn data;\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-10416\
1:-272\
id:545c140a-7fed-4737-b8a0-8b85cf88b56a\
name:\'dcberspringe Workflow\
connections\
GitHub Webhook Trigger\
main\
0\
0\
node:Pr\'fcfe Push Event\
type:main\
index:0\
Pr\'fcfe Push Event\
main\
0\
0\
node:Extrahiere ge\'e4nderte Dateien\
type:main\
index:0\
Extrahiere ge\'e4nderte Dateien\
main\
0\
0\
node:Vorbereiten Datei\
type:main\
index:0\
Vorbereiten Datei\
main\
0\
0\
node:Hole Datei von GitHub\
type:main\
index:0\
Hole Datei von GitHub\
main\
0\
0\
node:Parse Workflow\
type:main\
index:0\
Parse Workflow\
main\
0\
0\
node:Pr\'fcfe Workflow\
type:main\
index:0\
Pr\'fcfe Workflow\
main\
0\
0\
node:Pr\'fcfe ob ID vorhanden\
type:main\
index:0\
1\
0\
node:\'dcberspringe Workflow\
type:main\
index:0\
Pr\'fcfe ob ID vorhanden\
main\
0\
0\
node:Pr\'fcfe ob Workflow existiert\
type:main\
index:0\
1\
0\
node:Debug: Vor Erstellen\
type:main\
index:0\
Debug: Vor Erstellen\
main\
0\
0\
node:Erstelle Workflow\
type:main\
index:0\
Pr\'fcfe ob Workflow existiert\
main\
0\
0\
node:Analysiere Response\
type:main\
index:0\
Analysiere Response\
main\
0\
0\
node:Workflow existiert?\
type:main\
index:0\
Workflow existiert?\
main\
0\
0\
node:Update Workflow\
type:main\
index:0\
1\
0\
node:Erstelle Workflow\
type:main\
index:0\
Update Workflow\
main\
0\
0\
node:Debug: Ergebnis\
type:main\
index:0\
Erstelle Workflow\
main\
0\
0\
node:Debug: Ergebnis\
type:main\
index:0\
settings\
executionOrder:v1\
timeSavedMode:fixed\
callerPolicy:workflowsFromSameOwner\
availableInMCP:false\
staticData:null\
meta:null\
pinData:\{empty object\}\
versionId:a0390bb5-1e26-453d-9bd4-410992a71063\
activeVersionId:null\
triggerCount:1\
shared\
0\
updatedAt:2025-12-24T10:21:45.762Z\
createdAt:2025-12-24T10:21:45.762Z\
role:workflow:owner\
workflowId:MHpLYxsxsy0aSsEC\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
11\
updatedAt:2025-12-09T15:44:57.090Z\
createdAt:2025-12-09T15:44:57.090Z\
id:MNVWOs19VgaZTF6G\
name:fonio AGS Nachbearbeitung Transkript Version 0.9 20251209 16:45\
active:false\
isArchived:false\
nodes\
0\
parameters\
httpMethod:POST\
path:c439b942-fec5-44c5-af5f-4dbb41cf58b9\
options:\{empty object\}\
type:n8n-nodes-base.webhook\
typeVersion:2.1\
position\
0:-352\
1:-256\
id:77a1257d-7d34-4671-b10d-b83268a2c853\
name:Webhook\
webhookId:c439b942-fec5-44c5-af5f-4dbb41cf58b9\
1\
parameters\
assignments\
assignments\
0\
id:011ef203-63fd-49f7-ae0d-4ed7318ad11f\
name:headers.host\
value:=\{\{ $json.headers.host \}\}\
type:string\
1\
id:04f27e3e-ebed-4ae5-a22f-23d0f7c61904\
name:body[0].body.formattedTranscript\
value:=\{\{ $json.body[0].body.formattedTranscript \}\}\
type:string\
2\
id:017777fc-53d7-473d-b3c8-09a32e601385\
name:body[0].body.fromNumber\
value:=\{\{ $json.body[0].body.fromNumber \}\}\
type:string\
3\
id:882e8a05-a492-4445-bb4a-1856bfb586a1\
name:body[0].body.context.anrufer_name\
value:=\{\{ $json.body[0].body.context.anrufer_name \}\}\
type:string\
4\
id:a6508b49-d751-49d7-b40c-c91be52f5839\
name:body[0].body.context.einrichtung_typ\
value:=\{\{ $json.body[0].body.context.einrichtung_typ \}\}\
type:string\
5\
id:08190377-3019-449b-9374-494e642c5125\
name:body[0].body.context.einrichtung_name\
value:=\{\{ $json.body[0].body.context.einrichtung_name \}\}\
type:string\
6\
id:58740a6d-b29d-48ca-b2a3-fc14e3dedaeb\
name:body[0].body.context.technisch\
value:=\{\{ $json.body[0].body.context.technisch \}\}\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:-128\
1:-352\
id:9cf46d84-24bf-4147-979c-e1273e9e4839\
name:Daten extrahieren\
2\
parameters\
promptType:define\
text:=F\'fchre die Klassifikation durch.\
hasOutputParser:true\
options\
systemMessage:=DU BIST EIN HOCHSPEZIALISIERTER KLASSIFIKATIONS-AGENT F\'dcR IT-HOTLINE-TRANSKRIPTE.\\n\\n###DEINE HAUPTAUFGABE###\\nAnalysiere Telefon-Transkripte und ordne sie pr\'e4zise in eine Dringlichkeitskategorie (A, B, C oder D) ein, basierend auf den Kriterien aus der bereitgestellten Wissensdatenbank. Deine Klassifikation erm\'f6glicht Technikern eine zielgerichtete, priorisierte Bearbeitung.\\n\\n---\\n\\n###VERF\'dcGBARE DATEN###\\n\\n**DRINGLICHKEITSKRITERIEN (aus Google Sheet):**\\n\{\{ $('Dringlichkeitskriterien laden').all().slice(1).map(item =>\\n`Kategorie $\{item.json.Dringlichkeit\}: $\{item.json.Kategorie\}\\nSchl\'fcsselworte: $\{item.json.Schlagworte\}\\nBeispiele: $\{item.json.Beispiele\}`\\n).join('\\n\\n') \}\}\\n\\n**ZU ANALYSIERENDES TRANSKRIPT:**\\n\{\{ $json.anonymizedText \}\}\\n\\n---\\n\\n###ANALYSE-METHODIK (CHAIN OF THOUGHTS)###\\n\\n1. **UNDERSTAND**\\n   - Lies das Transkript gr\'fcndlich und identifiziere das konkrete technische Problem\\n   - Erkenne die Auswirkungen: Produktivit\'e4tsausfall, Datenverlust, Eskalation, Gesch\'e4ftskritikalit\'e4t\\n\\n2. **IDENTIFY KEY SIGNALS**\\n   - Schl\'fcsselbegriffe f\'fcr hohe Dringlichkeit: "nicht arbeitsf\'e4hig", "Produktion steht", "Kunde wartet", "dringend", "sofort"\\n   - Schl\'fcsselbegriffe f\'fcr niedrige Dringlichkeit: "nicht eilig", "wenn Zeit ist", "Informationsfrage", "optional"\\n\\n3. **ASSESS IMPACT**\\n   - Ist ein gesch\'e4ftskritischer Prozess blockiert?\\n   - Sind mehrere Nutzer betroffen?\\n   - Gibt es Fristen oder SLA-relevante Zeitpunkte?\\n   - Handelt es sich um einen Standardvorgang oder eine Informationsanfrage?\\n\\n4. **MATCH WITH CRITERIA**\\n   - Vergleiche die erkannten Merkmale mit den Referenzbeispielen aus dem Google Sheet\\n   - W\'e4hle die Kategorie, die der Fallbeschreibung AM N\'c4CHSTEN kommt\\n\\n5. **HANDLE EDGE CASES**\\n   - Bei unklaren oder widerspr\'fcchlichen Transkripten: W\'e4hle die konservativere (h\'f6here) Kategorie\\n   - Weise explizit auf Unsicherheiten hin\\n\\n---\\n\\n###AUSGABEFORMAT###\\n\\n***WICHTIGER HINWEIS ZUR DATENSCHUTZ-KONFORMIT\'c4T***\\nDer Text enth\'e4lt anonymisierte Platzhalter wie [PERSON_1], [PERSON_2].\\nWenn du Namen extrahierst (z.B. f\'fcr "AnsprechpartnerName" oder in der "Beschreibung"),\\nNUTZE AUSSCHLIESSLICH DIESE PLATZHALTER.\\nWandle sie NICHT um und erfinde keine Namen.\\nBeispiel korrekt: "AnsprechpartnerName": "[PERSON_2]"\\n\\nGib deine Analyse im folgenden JSON-Format zur\'fcck:\\n```json\\n\{\\n  "Dringlichkeit": "B",\\n  "Kategorie": "Dringend",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Server-Ausfall",\\n  "Beschreibung": [\\n    "Mehrere Mitarbeiter betroffen (Buchhaltung)",\\n    "Datenbankverbindung unterbrochen seit 8 Uhr",\\n    "Fehlende Rechnungen der letzten 2 Wochen",\\n    "Zeitkritisch: Jahresabschluss-Termin in 2 Stunden"\\n  ],\\n  "AnsprechpartnerBleibt": true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\\n  "AnsprechpartnerName": "Frau Weber",\\n  "RueckrufnummerAnders": true = andere R\'fcckrufnummer gew\'fcnscht, false = unter anrufender Nummer zur\'fcckrufen\\n  "Rueckrufnummer": Die vom Anrufer genannte R\'fcckrufnummer (mit Durchwahl falls vorhanden)\\n  "Begr\'fcndung": "Der Kunde ist grunds\'e4tzlich arbeitsf\'e4hig, jedoch blockiert ein IT-Fehler einen zeitkritischen Gesch\'e4ftsprozess. Entspricht den Beispielen f\'fcr Kategorie B im Sheet."\\n\}\\n```\\n\\n**WICHTIG: Feldbeschreibungen** \\n- Die Dringlichkeit MUSS ein einzelner Buchstabe sein: A, B, C oder D, entsprechend der M\'f6glichkeiten im Google Sheet\\n- Die Kategorie MUSS sich auf die entsprechende Spalte im Google Sheet beziehen\\n- Problemtyp: Klassifiziere in GENAU EINE dieser Kategorien:\\n  \'95 "Technisch" = Hardware-Probleme, Netzwerkausf\'e4lle, Ger\'e4tedefekte, Server-Ausf\'e4lle\\n  \'95 "Software" = Programmfehler, Anmeldeprobleme, Softwarest\'f6rungen, Datenbankprobleme\\n  \'95 "Anliegen" = Informationsanfragen, Beratung, allgemeine Fragen ohne akutes technisches Problem\\n- Themenstichwort: Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z. B. "SAP-Login", "E-Mail-Sync", "Drucker-WLAN")\\n- Beschreibung: Array mit 3-6 Stichpunkten, die wichtigsten Informationen zuerst:\\n  \'95 Betroffene Personen/Systeme\\n  \'95 Zeitpunkt des Auftretens\\n  \'95 Konkrete Symptome/Fehler\\n  \'95 Gesch\'e4ftliche Auswirkungen\\n  \'95 Fristen/Zeitdruck\\n  \'95 Bereits versuchte L\'f6sungen\\n- AnsprechpartnerBleibt: true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\\n- AnsprechpartnerName: Name des Ansprechpartners (falls abweichend vom Anrufer, sonst leer lassen)\\n- AnsprechpartnerTelefon: Telefonnummer des Ansprechpartners (falls abweichend, sonst leer lassen)\\n- RueckrufnummerAnders: true = andere R\'fcckrufnummer als anrufende Nummer, false = unter anrufender Nummer zur\'fcckrufen\\n- Rueckrufnummer: Die R\'fcckrufnummer (kann identisch mit AnsprechpartnerTelefon sein)\\n- Die Begr\'fcndung MUSS sich auf die Kriterien im Google Sheet beziehen\\n- Halte dich strikt an das JSON-Format\\n\\n---\\n\\n###WAS NICHT ZU TUN IST###\\n\\nNIEMALS Kategorien ohne Bezug zum Google Sheet festlegen\\nVERMEIDE vage Begr\'fcndungen wie "klingt dringend" oder "scheint wichtig"\\nNICHT nur nach einzelnen Schl\'fcsselworten klassifizieren \'96 analysiere die Gesamtsituation\\nNIEMALS Aussagen erfinden, die nicht im Transkript stehen\\nNICHT \'fcberkategorisieren: Unzufriedenheit allein rechtfertigt keine Kategorie A\\nIGNORIERE NIEMALS Hinweise auf Systemrelevanz, Produktionsstopp oder gesch\'e4ftskritische Prozesse\\n\\n---\\n\\n###FEW-SHOT BEISPIELE###\\n\\n**Beispiel 1 - Kategorie A:**\\nTranskript: "Ich kann mich nicht mehr in SAP anmelden, wir m\'fcssen heute unbedingt die Monatsabrechnung machen."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "A",\\n  "Kategorie": "Notfall",\\n  "Problemtyp": "Software",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Gesch\'e4ftskritischer Prozess (Monatsabrechnung) ist komplett blockiert. Entspricht den Referenzf\'e4llen f\'fcr Kategorie A im Sheet."\\n\}\\n```\\n\\n**Beispiel 2 - Kategorie D:**\\nTranskript: "Ich wollte nur fragen, ob man den Drucker auch \'fcber WLAN verbinden kann \'96 ist aber nicht eilig."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "D",\\n  "Kategorie": "Informativ",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Informationsanfrage ohne Zeitdruck, kein akuter Vorfall. Entspricht klar Kategorie D im Sheet."\\n\}\\n```\\n\\n**Beispiel 3 - Kategorie B:**\\nTranskript: "Mein Outlook synchronisiert nicht mehr. Ich kann arbeiten, aber wichtige E-Mails von Kunden kommen nicht an."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "B",\\n  "Kategorie": "Dringend",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Eingeschr\'e4nkte Arbeitsf\'e4higkeit bei einem wichtigen Kommunikationskanal. Keine komplette Blockade, aber gesch\'e4ftsrelevant. Entspricht Kategorie B."\\n\}\\n```\
type:@n8n/n8n-nodes-langchain.agent\
typeVersion:3\
position\
0:1168\
1:-256\
id:d2d54986-6130-46cd-9a5b-51bd5c1bc20f\
name:AI Agent\
executeOnce:true\
3\
parameters\
model\
__rl:true\
value:claude-3-5-haiku-20241022\
mode:list\
cachedResultName:Claude Haiku 3.5\
options:\{empty object\}\
type:@n8n/n8n-nodes-langchain.lmChatAnthropic\
typeVersion:1.3\
position\
0:1240\
1:-32\
id:9eeded28-e2c0-44e0-b5a8-d55da2461c18\
name:Anthropic Chat Model\
credentials\
anthropicApi\
id:6RlfJdXsmselCNpN\
name:Anthropic account 2\
4\
parameters\
authentication:serviceAccount\
documentId\
__rl:true\
value:1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw\
mode:id\
sheetName\
__rl:true\
value:gid=0\
mode:list\
cachedResultName:Dringlichkeiten\
cachedResultUrl:https://docs.google.com/spreadsheets/d/1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw/edit#gid=0\
options:\{empty object\}\
type:n8n-nodes-base.googleSheets\
typeVersion:4.7\
position\
0:-128\
1:-160\
id:c9cf5d34-b600-4077-9458-1ac6f92a000a\
name:Dringlichkeitskriterien laden\
credentials\
googleApi\
id:vRVq7GTwn9kTIi8N\
name:Google Sheets account 2\
5\
parameters:\{empty object\}\
type:n8n-nodes-base.merge\
typeVersion:3.2\
position\
0:96\
1:-256\
id:7684c1a2-a32e-4758-a773-d3a8a4e8e8cd\
name:Merge\
6\
parameters\
assignments\
assignments\
0\
id:9cac8552-e981-44e5-bfc7-854012461c3f\
name:subject\
value:=\{\{ $json.Kategorie \}\} | \{\{ $('Daten extrahieren').first().json.body[0].body.context.einrichtung_name \}\}, \{\{ $('Daten extrahieren').first().json.body[0].body.context.anrufer_name \}\}| \{\{ $json.Themenstichwort \}\}\
type:string\
1\
id:988dd2a7-83ea-48b9-9e7e-bcc66745c72c\
name:htmlBody\
value:=<h3>Problemtyp: \{\{ $json.Problemtyp \}\}</h3>\\n\\n<h4>KI-Einsch\'e4tzung</h4>\\n<p>\\n  <b>Einrichtung:</b> \{\{ $('Daten extrahieren').first().json.body[0].body.context.einrichtung_typ \}\}<br>\\n  <b>Anrufer:</b> \{\{ $('Daten extrahieren').first().json.body[0].body.context.anrufer_name \}\} (\{\{ $('Daten extrahieren').first().json.body[0].body.fromNumber \}\})<br>\\n  <b>Ansprechpartner:</b> \{\{ $json.AnsprechpartnerName ? $json.AnsprechpartnerName : "Wie Anrufer" \}\}<br>\\n  <b>R\'fcckrufnummer:</b> \{\{ $json.Rueckrufnummer ? $json.Rueckrufnummer : $('Daten extrahieren').first().json.body[0].body.fromNumber \}\}<br>\\n  <b>Thema:</b> \{\{ $json.Themenstichwort \}\}\\n</p>\\n\\n<b>Beschreibung:</b>\\n<ul>\\n\{\{ $json.Beschreibung.map(item => `<li>$\{item\}</li>`).join('') \}\}\\n</ul>\\n\\n<b>Begr\'fcndung der Dringlichkeitseinstufung:</b>\\n<p>\{\{ $json.Begr\'fcndung \}\}</p>\\n\\n<hr>\\n\\n<h4>Vollst\'e4ndiges Transkript</h4>\\n<p style="white-space: pre-wrap; color: #555;">\\n\{\{ $('Azure Request Vorbereitung').first().json.messages[1].content \}\}\\n</p>\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:1744\
1:-256\
id:7a4b14e3-b2c1-4b91-86da-a1a85cd49aaf\
name:E-Mail vorbereiten\
7\
parameters\
fromEmail:office@berent.ai\
toEmail:office@berent.ai\
subject:=\{\{ $json.subject \}\}\
html:=\{\{ $json.htmlBody \}\}\
options:\{empty object\}\
path:59178415-63e1-4be6-869e-cd65d84337d1\
type:n8n-nodes-base.emailSend\
typeVersion:2.1\
position\
0:1968\
1:-256\
id:d384cea2-2209-42dc-9ced-92966ea5378f\
name:Send email\
webhookId:59178415-63e1-4be6-869e-cd65d84337d1\
credentials\
smtp\
id:8O5B5z4vS8yeagJh\
name:SMTP account\
8\
parameters\
operation:sanitize\
text:=\{\{ $('Merge').item.json.body[0].body.formattedTranscript \}\}\
guardrails\
pii\
value\
type:selected\
entities\
0:EMAIL_ADDRESS\
1:PHONE_NUMBER\
2:IP_ADDRESS\
3:LOCATION\
type:@n8n/n8n-nodes-langchain.guardrails\
typeVersion:1\
position\
0:320\
1:-256\
id:e360d1f5-fb81-4f05-969c-e135d0e21cf1\
name:Daten anonymisieren\
9\
parameters\
jsCode:// 1. Zugriff auf die Antwort des AI Agents\\nlet agentOutput = $input.item.json.output || $input.item.json.text || "";\\n\\n// Wir machen sicherheitshalber einen String daraus\\nif (typeof agentOutput === 'object') \{\\n  agentOutput = JSON.stringify(agentOutput);\\n\}\\n\\n// 2. Das Mapping holen (exakter Name der Node davor ist wichtig!)\\nconst mappingData = $('Azure Response Verarbeitung').first();\\nconst nameMapping = mappingData.json.nameMapping || [];\\n\\n// 3. Re-Personalisierung durchf\'fchren (Suchen & Ersetzen im Rohtext)\\n// Wir machen das VOR dem JSON-Parsing, damit auch Namen in Strings ersetzt werden.\\nlet processedText = agentOutput;\\n\\nfor (const item of nameMapping) \{\\n  // Ersetze [PERSON_X] durch den echten Namen (global)\\n  // Wir escapen die Klammern f\'fcr den Regex\\n  const placeholderRegex = new RegExp(item.placeholder.replace(/\\[/g, '\\\\[').replace(/\\]/g, '\\\\]'), 'g');\\n  processedText = processedText.replace(placeholderRegex, item.original);\\n\}\\n\\n// 4. JSON Extrahieren (Der "Gespr\'e4chigkeit"-Filter)\\n// Wir suchen den Bereich zwischen der ersten '\{' und der letzten '\}'\\nconst firstBracket = processedText.indexOf('\{');\\nconst lastBracket = processedText.lastIndexOf('\}');\\n\\nif (firstBracket !== -1 && lastBracket !== -1) \{\\n  // Schneide alles vor der ersten Klammer und nach der letzten Klammer weg\\n  const jsonString = processedText.substring(firstBracket, lastBracket + 1);\\n  \\n  try \{\\n    const finalObject = JSON.parse(jsonString);\\n    return finalObject; // Gib das saubere Objekt zur\'fcck\\n  \} catch (e) \{\\n    return \{ error: "JSON war trotz Filterung ung\'fcltig", raw: processedText \};\\n  \}\\n\} else \{\\n  // Fallback, falls gar keine Klammern gefunden wurden\\n  return \{ error: "Kein JSON im Antworttext gefunden", raw: processedText \};\\n\}\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1520\
1:-256\
id:91617cfe-2de6-43ad-9b1f-ae0b50d222e9\
name:Re-Personalisierung\
10\
parameters\
method:POST\
url:https://berent-ki.services.ai.azure.com/models/chat/completions?api-version=2024-05-01-preview\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
contentType:=json\
specifyBody:json\
bodyParameters\
parameters\
0:\{empty object\}\
jsonBody:=\{\{ $json \}\}\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.3\
position\
0:768\
1:-256\
id:54f2b104-2744-4323-8044-b6caae62bf59\
name:Namen-Anonymisierung (Azure)\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:Header Auth account\
httpBearerAuth\
id:24SORzPv91ZRH2UW\
name:Bearer Auth account\
11\
parameters\
jsCode:// Wir greifen auf die Antwort der Azure-Node zu\\nconst response = $input.item.json;\\n\\n// Sicherstellen, dass wir eine Antwort haben\\nif (response.choices && response.choices[0] && response.choices[0].message) \{\\n  \\n  // Den Textinhalt holen\\n  let content = response.choices[0].message.content;\\n  \\n  // Oft sendet die KI den Text in Markdown-Bl\'f6cken (```json ... ```).\\n  // Diese entfernen wir hier, damit das JSON sauber ist.\\n  content = content.replace(/^```json\\s*/, "").replace(/\\s*```$/, "");\\n  \\n  try \{\\n    // Den Textstring in ein echtes JSON-Objekt umwandeln\\n    const parsedData = JSON.parse(content);\\n    \\n    // Das saubere Ergebnis zur\'fcckgeben\\n    return parsedData;\\n    \\n  \} catch (error) \{\\n    // Falls die KI kein g\'fcltiges JSON geschickt hat, geben wir den Rohtext zur\'fcck\\n    return \{\\n      error: "Konnte JSON nicht parsen",\\n      rawContent: content\\n    \};\\n  \}\\n\} else \{\\n  return \{ error: "Keine g\'fcltige Antwort von Azure erhalten" \};\\n\}\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:992\
1:-256\
id:77db8668-5102-4565-85d4-bdece72d8b59\
name:Azure Response Verarbeitung\
12\
parameters\
mode:runOnceForEachItem\
jsCode:// Daten aus der vorherigen Node holen\\n// Fallback auf leeren String, falls keine Daten da sind\\nconst transcript = $input.item.json.guardrailsInput || $input.item.json.output || "";\\n\\nconst systemPrompt = `Du bist ein Spezialist f\'fcr die Anonymisierung von Personennamen in deutschen Telefon-Transkripten.\\n\\n###DEINE AUFGABE###\\nErkenne alle Personennamen (Vornamen und Nachnamen) im gegebenen Text und ersetze sie durch nummerierte Platzhalter im Format [PERSON_1], [PERSON_2], [PERSON_3] etc.\\n\\n###REGELN###\\n1. Erkenne nur echte Personennamen (z.B. Thomas, Anna, M\'fcller, Schmidt)\\n2. Ignoriere Titel wie 'Herr', 'Frau', 'Dr.' - diese bleiben unver\'e4ndert\\n3. Ersetze jeden gefundenen Namen durch einen eindeutigen Platzhalter [PERSON_N]\\n4. Gleiche Namen im Text erhalten den gleichen Platzhalter (z.B. 'Thomas' wird immer zu [PERSON_1])\\n5. Verschiedene Namen erhalten verschiedene Platzhalter (z.B. 'Thomas' \uc0\u8594  [PERSON_1], 'Anna' \u8594  [PERSON_2])\\n6. Behalte die urspr\'fcngliche Formatierung bei (Zeilenumbr\'fcche, Interpunktion)\\n\\n###AUSGABEFORMAT###\\nGib dein Ergebnis im folgenden JSON-Format zur\'fcck:\\n\\`\\`\\`json\\n\{\\n  "anonymizedText": "Der anonymisierte Text mit [PERSON_1], [PERSON_2] etc.",\\n  "nameMapping": [\\n    \{"original": "Thomas", "placeholder": "[PERSON_1]"\},\\n    \{"original": "Anna", "placeholder": "[PERSON_2]"\}\\n  ]\\n\}\\n\\`\\`\\``;\\n\\n// Das fertige Payload-Objekt zur\'fcckgeben\\nreturn \{\\n  model: "mistral-namen-anonymisierung",\\n  messages: [\\n    \{\\n      role: "system",\\n      content: systemPrompt\\n    \},\\n    \{\\n      role: "user",\\n      content: transcript\\n    \}\\n  ],\\n  temperature: 0.1,\\n  max_tokens: 4000\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:544\
1:-256\
id:8b9e7bfc-31a2-468b-8b99-56e08a5e0481\
name:Azure Request Vorbereitung\
connections\
Webhook\
main\
0\
0\
node:Daten extrahieren\
type:main\
index:0\
1\
node:Dringlichkeitskriterien laden\
type:main\
index:0\
Daten extrahieren\
main\
0\
0\
node:Merge\
type:main\
index:0\
Anthropic Chat Model\
ai_languageModel\
0\
0\
node:AI Agent\
type:ai_languageModel\
index:0\
Dringlichkeitskriterien laden\
main\
0\
0\
node:Merge\
type:main\
index:1\
Merge\
main\
0\
0\
node:Daten anonymisieren\
type:main\
index:0\
AI Agent\
main\
0\
0\
node:Re-Personalisierung\
type:main\
index:0\
E-Mail vorbereiten\
main\
0\
0\
node:Send email\
type:main\
index:0\
Daten anonymisieren\
main\
0\
0\
node:Azure Request Vorbereitung\
type:main\
index:0\
Re-Personalisierung\
main\
0\
0\
node:E-Mail vorbereiten\
type:main\
index:0\
Namen-Anonymisierung (Azure)\
main\
0\
0\
node:Azure Response Verarbeitung\
type:main\
index:0\
Azure Response Verarbeitung\
main\
0\
0\
node:AI Agent\
type:main\
index:0\
Azure Request Vorbereitung\
main\
0\
0\
node:Namen-Anonymisierung (Azure)\
type:main\
index:0\
settings\
executionOrder:v1\
staticData:null\
meta\
templateCredsSetupCompleted:true\
pinData:\{empty object\}\
versionId:d96a96f2-8499-4005-911d-f70b3bf9c199\
activeVersionId:null\
triggerCount:0\
shared\
0\
updatedAt:2025-12-09T15:44:57.094Z\
createdAt:2025-12-09T15:44:57.094Z\
role:workflow:owner\
workflowId:MNVWOs19VgaZTF6G\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
12\
updatedAt:2025-12-30T17:30:24.273Z\
createdAt:2025-12-30T17:30:24.273Z\
id:MlrcUNb7oucTRnLi\
name:GitHub \uc0\u8594  n8n Synchronisation 1830\
active:false\
isArchived:false\
nodes\
0\
parameters\
httpMethod:POST\
path:5bd4deb3-a50d-4794-a920-abc915701f7d\
options:\{empty object\}\
id:aebad4b6-628f-4a23-ac31-d80dbfddb6f1\
name:GitHub Webhook Trigger\
type:n8n-nodes-base.webhook\
typeVersion:1\
position\
0:-2016\
1:-96\
webhookId:5bd4deb3-a50d-4794-a920-abc915701f7d\
1\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-push-event\
leftValue:=\{\{ $json.headers['x-github-event'] \}\}\
rightValue:push\
operator\
type:string\
operation:equals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:-1792\
1:-96\
id:70fe03b0-61fb-4391-ae62-243676773756\
name:Pr\'fcfe Push Event\
2\
parameters\
jsCode:// Extrahiere ge\'e4nderte Dateien aus GitHub Webhook\\nconst body = $json.body || \{\};\\nconst commits = body.commits || [];\\nconst changedFiles = [];\\n\\n// Sammle alle ge\'e4nderten Dateien\\nfor (const commit of commits) \{\\n  const added = commit.added || [];\\n  const modified = commit.modified || [];\\n  \\n  for (const file of [...added, ...modified]) \{\\n    // Workflow-Dateien im n8n/ Verzeichnis ODER im Root (z.B. github-to-n8n-sync-workflow.json)\\n    if (file.endsWith('.json') && (file.startsWith('n8n/') || file.includes('-workflow.json'))) \{\\n      changedFiles.push(file);\\n    \}\\n  \}\\n\}\\n\\nreturn changedFiles.map(file => (\{ filePath: file \}));\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-1568\
1:-96\
id:6b8b2c58-f208-4d56-8422-bfa513a4a4ea\
name:Extrahiere ge\'e4nderte Dateien\
3\
parameters\
mode:runOnceForEachItem\
jsCode:const filePath = $json.filePath;\\nreturn \{ filePath \};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-1344\
1:-96\
id:f6a0b7fd-7fbd-45aa-849f-219cce814301\
name:Vorbereiten Datei\
4\
parameters\
resource:file\
operation:get\
owner\
__rl:true\
value:peerendees\
mode:name\
repository\
__rl:true\
value:n8n-workflows\
mode:list\
cachedResultName:n8n-workflows\
cachedResultUrl:https://github.com/peerendees/n8n-workflows\
filePath:=\{\{ $json.filePath \}\}\
asBinaryProperty:false\
additionalParameters\
reference:main\
path:a99a201d-91fd-469e-91a7-8226c15b597c\
type:n8n-nodes-base.github\
typeVersion:1.1\
position\
0:-1120\
1:-96\
id:82f8ae18-c254-4002-ae8c-d264407f51d5\
name:Hole Datei von GitHub\
webhookId:a99a201d-91fd-469e-91a7-8226c15b597c\
credentials\
githubApi\
id:uE78TkEY6lWLV4oP\
name:API GitHub\
onError:continueRegularOutput\
5\
parameters\
jsCode:// Extrahiere Workflow-Daten aus GitHub-Datei\\nconst githubFile = $json;\\n\\nif (githubFile.error || !githubFile.content) \{\\n  return \{ error: 'Datei konnte nicht geladen werden' \};\\n\}\\n\\ntry \{\\n  const content = Buffer.from(githubFile.content, 'base64').toString('utf-8');\\n  const workflow = JSON.parse(content);\\n  \\n  return \{\\n    workflowId: workflow.id || null,\\n    workflowName: workflow.name || 'unnamed',\\n    workflowData: workflow,\\n    filePath: githubFile.path || githubFile.name\\n  \};\\n\} catch (e) \{\\n  return \{ error: 'Fehler beim Parsen der Workflow-Datei: ' + e.message \};\\n\}\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-896\
1:-96\
id:ce3fbbca-d61b-420d-a53f-7da50a1cb348\
name:Parse Workflow\
6\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-error\
leftValue:=\{\{ $json.error \}\}\
rightValue:empty\
operator\
type:string\
operation:equals\
1\
id:check-workflow-id\
leftValue:=\{\{ $json.workflowId \}\}\
rightValue:null\
operator\
type:string\
operation:notEquals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:-672\
1:-96\
id:b856ec8c-69da-459d-9fee-a1e5cce10f5c\
name:Pr\'fcfe Workflow\
7\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-exists\
leftValue:=\{\{ $json.statusCode \}\}\
rightValue:200\
operator\
type:number\
operation:equals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:-224\
1:-96\
id:d1e4a938-8cea-476a-9d12-24c3b9cbf764\
name:Workflow existiert?\
8\
parameters\
method:PUT\
url:=https://n8n.srv1098810.hstgr.cloud/api/v1/workflows/\{\{ $node["Parse Workflow"].json.workflowId \}\}\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
bodyParameters\
parameters\
0:\{empty object\}\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:0\
1:-192\
id:ab93ae13-864f-423c-9b99-4477269eb710\
name:Update Workflow\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:API n8n\
onError:continueRegularOutput\
9\
parameters\
method:POST\
url:=https://n8n.srv1098810.hstgr.cloud/api/v1/workflows\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
bodyParameters\
parameters\
0:\{empty object\}\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:0\
1:0\
id:ada51853-b0fc-4c41-902c-4d419f9c8721\
name:Erstelle Workflow\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:API n8n\
onError:continueRegularOutput\
10\
parameters\
url:=https://n8n.srv1098810.hstgr.cloud/api/v1/workflows/\{\{ $json.workflowId \}\}\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
options\
response\
response\
responseFormat:json\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-448\
1:-96\
id:7db3c9c9-ab4f-4d84-9dbb-1342f89ff37e\
name:Pr\'fcfe, ob Workflow existiert\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:API n8n\
onError:continueRegularOutput\
connections\
GitHub Webhook Trigger\
main\
0\
0\
node:Pr\'fcfe Push Event\
type:main\
index:0\
Pr\'fcfe Push Event\
main\
0\
0\
node:Extrahiere ge\'e4nderte Dateien\
type:main\
index:0\
Extrahiere ge\'e4nderte Dateien\
main\
0\
0\
node:Vorbereiten Datei\
type:main\
index:0\
Vorbereiten Datei\
main\
0\
0\
node:Hole Datei von GitHub\
type:main\
index:0\
Hole Datei von GitHub\
main\
0\
0\
node:Parse Workflow\
type:main\
index:0\
Parse Workflow\
main\
0\
0\
node:Pr\'fcfe Workflow\
type:main\
index:0\
Pr\'fcfe Workflow\
main\
0\
0\
node:Pr\'fcfe, ob Workflow existiert\
type:main\
index:0\
Workflow existiert?\
main\
0\
0\
node:Update Workflow\
type:main\
index:0\
1\
0\
node:Erstelle Workflow\
type:main\
index:0\
Pr\'fcfe, ob Workflow existiert\
main\
0\
0\
node:Workflow existiert?\
type:main\
index:0\
settings\
executionOrder:v1\
timeSavedMode:fixed\
callerPolicy:workflowsFromSameOwner\
availableInMCP:false\
staticData:null\
meta:null\
pinData:\{empty object\}\
versionId:5d6d7994-84e5-4293-b1ca-eea15184889b\
activeVersionId:null\
triggerCount:1\
shared\
0\
updatedAt:2025-12-30T17:30:24.275Z\
createdAt:2025-12-30T17:30:24.275Z\
role:workflow:owner\
workflowId:MlrcUNb7oucTRnLi\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
13\
updatedAt:2025-11-23T14:11:41.000Z\
createdAt:2025-11-23T13:33:43.638Z\
id:QxKsC28H7gqaUd3j\
name:fonio AGS Anrufername\
active:false\
isArchived:false\
nodes\
0\
parameters\
httpMethod:POST\
path:anrufer-check\
responseMode:responseNode\
options:\{empty object\}\
type:n8n-nodes-base.webhook\
typeVersion:2.1\
position\
0:0\
1:0\
id:e9b1d0ae-3c4f-49bc-bd04-cd6d257fa877\
name:Webhook\
webhookId:517dd008-c998-4975-847b-4cfae5858518\
1\
parameters\
authentication:serviceAccount\
documentId\
__rl:true\
value:1kyIdVpLg4Ate6b0o2yyB4wzu3e7stQjcILLVrWX6RD8\
mode:id\
sheetName\
__rl:true\
value:Anrufer\
mode:name\
filtersUI\
values\
0\
lookupColumn:Telefonnumer\
lookupValue:=\{\{ $json.body.fromNumber \}\}\
options:\{empty object\}\
type:n8n-nodes-base.googleSheets\
typeVersion:4.7\
position\
0:224\
1:0\
id:b5e4227b-c77f-42c5-9433-08901445734f\
name:Anrufername\
alwaysOutputData:true\
credentials\
googleApi\
id:vRVq7GTwn9kTIi8N\
name:Google Sheets account 2\
2\
parameters\
assignments\
assignments\
0\
id:05b8eded-5465-4955-9b1b-a4094a57619c\
name:Name\
value:=\{\{ $json.Name \}\}\
type:string\
1\
id:71253abe-5210-4e95-87a4-7defcec8f7d7\
name:Anredeform\
value:=\{\{ $json.Anredeform \}\}\
type:string\
2\
id:b874dcc8-9c21-4517-87b9-8acfac896973\
name:Anrede\
value:=\{\{ $json.Anrede \}\}\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:672\
1:-96\
id:09f101f9-0fb6-4eb3-8fa0-bcfeb48ed1f8\
name:Anrufer bekannt\
3\
parameters\
assignments\
assignments\
0\
id:0b518e17-3f4e-4385-b10b-f608a27799ff\
name:Name\
value:Anrufer unbekannt\
type:string\
1\
id:d460ff3a-d25f-4cd7-a317-aa183b90ec4a\
name:Anredeform\
value:Sie\
type:string\
2\
id:c121a38a-6524-4cad-a483-aa2beaf21ccf\
name:Anrede\
value:empty\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:672\
1:96\
id:f22df247-85a9-4e20-b2b9-e5c71e70b55c\
name:Anrufer unbekannt\
4\
parameters\
respondWith:json\
responseBody:=\{\\n     "name": "\{\{ $json.Name \}\}",\\n     "anredeform": "\{\{ $json.Anredeform \}\}",\\n     "anrede": "\{\{ $json.Anrede \}\}"\\n   \}\
options:\{empty object\}\
type:n8n-nodes-base.respondToWebhook\
typeVersion:1.4\
position\
0:896\
1:0\
id:500ac86f-a1af-4604-b411-d433b179484e\
name:Respond to Webhook\
5\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:2\
conditions\
0\
id:7921be39-4d82-4d4c-905c-9956b9e30216\
leftValue:=\{\{ $json.Name \}\}\
rightValue:empty\
operator\
type:string\
operation:notEmpty\
singleValue:true\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.2\
position\
0:416\
1:0\
id:64962ca7-67c6-4cd5-8ba4-25172fced119\
name:If\
connections\
Webhook\
main\
0\
0\
node:Anrufername\
type:main\
index:0\
Anrufername\
main\
0\
0\
node:If\
type:main\
index:0\
Anrufer unbekannt\
main\
0\
0\
node:Respond to Webhook\
type:main\
index:0\
Anrufer bekannt\
main\
0\
0\
node:Respond to Webhook\
type:main\
index:0\
If\
main\
0\
0\
node:Anrufer bekannt\
type:main\
index:0\
1\
0\
node:Anrufer unbekannt\
type:main\
index:0\
settings\
executionOrder:v1\
staticData:null\
meta:null\
pinData:\{empty object\}\
versionId:404b4f81-27b9-4597-8698-6bea8ff768fa\
activeVersionId:null\
triggerCount:0\
shared\
0\
updatedAt:2025-11-23T13:33:43.644Z\
createdAt:2025-11-23T13:33:43.644Z\
role:workflow:owner\
workflowId:QxKsC28H7gqaUd3j\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
14\
updatedAt:2026-01-02T11:35:53.227Z\
createdAt:2025-12-31T18:13:36.084Z\
id:R307XPK2xOtEQ2UW\
name:GitHub \uc0\u8594  n8n Synchronisation\
active:true\
isArchived:false\
nodes\
0\
parameters\
httpMethod:POST\
path:github-sync-webhook\
options:\{empty object\}\
id:d06d3a29-0811-4543-9127-7bc02d9a3877\
name:GitHub Webhook Trigger\
type:n8n-nodes-base.webhook\
typeVersion:1\
position\
0:-3264\
1:160\
webhookId:github-sync-webhook\
1\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-push-event\
leftValue:=\{\{ $json.headers['x-github-event'] \}\}\
rightValue:push\
operator\
type:string\
operation:equals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:-3040\
1:160\
id:46f9630e-112c-4145-b98b-c81909aeb710\
name:Pr\'fcfe Push Event\
2\
parameters\
jsCode:// Extrahiere ge\'e4nderte Dateien aus GitHub Webhook\\nconst body = $json.body || \{\};\\nconst commits = body.commits || [];\\nconst changedFiles = [];\\n\\n// Sammle alle ge\'e4nderten Dateien\\nfor (const commit of commits) \{\\n  const added = commit.added || [];\\n  const modified = commit.modified || [];\\n  \\n  for (const file of [...added, ...modified]) \{\\n    // Workflow-Dateien:\\n    // - Im n8n/ Verzeichnis (alte Struktur: n8n/workflow-name.json)\\n    // - In n8n/\{workflowId\}/ (neue Struktur: n8n/\{workflowId\}/\{workflowName\}.json)\\n    // - Im Root mit -workflow.json oder -Workflow.json (z.B. n8n-Backup-Workflow.json, github-to-n8n-sync-workflow.json)\\n    if (file.endsWith('.json') && (file.startsWith('n8n/') || file.includes('-workflow.json') || file.includes('-Workflow.json'))) \{\\n      changedFiles.push(file);\\n    \}\\n  \}\\n\}\\n\\nreturn changedFiles.map(file => (\{ filePath: file \}));\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-2816\
1:160\
id:bd898be3-9a52-4de0-84c1-187f150fca31\
name:Extrahiere ge\'e4nderte Dateien\
3\
parameters\
mode:runOnceForEachItem\
jsCode:const filePath = $json.filePath;\\nreturn \{ filePath \};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-2592\
1:160\
id:55c2883c-b7d4-4949-97df-36546f2fa110\
name:Vorbereiten Datei\
4\
parameters\
resource:file\
operation:get\
owner\
__rl:true\
value:peerendees\
mode:name\
repository\
__rl:true\
value:n8n-workflows\
mode:list\
cachedResultName:n8n-workflows\
cachedResultUrl:https://github.com/peerendees/n8n-workflows\
filePath:=\{\{ $json.filePath \}\}\
asBinaryProperty:false\
additionalParameters\
reference:main\
type:n8n-nodes-base.github\
typeVersion:1.1\
position\
0:-2368\
1:160\
id:2f1f39c7-8f10-416e-9735-d98d9ccf219b\
name:Hole Datei von GitHub\
webhookId:694567e2-c3e8-4bfc-91af-aae5697aca36\
credentials\
githubApi\
id:uE78TkEY6lWLV4oP\
name:API GitHub\
onError:continueRegularOutput\
5\
parameters\
jsCode:// Extrahiere Workflow-Daten aus GitHub-Datei\\nconst githubFile = $json;\\n\\nif (githubFile.error || !githubFile.content) \{\\n  return \{ error: 'Datei konnte nicht geladen werden' \};\\n\}\\n\\ntry \{\\n  const content = Buffer.from(githubFile.content, 'base64').toString('utf-8');\\n  const workflow = JSON.parse(content);\\n  \\n  // Selbst-Sync Sperre: \'dcberspringe den Sync-Workflow selbst\\n  const isSelf = workflow.id === 'R307XPK2xOtEQ2UW';\\n  if (isSelf) \{\\n    return \{ error: 'Sync-Workflow wird \'fcbersprungen (Selbst-Sync Sperre)' \};\\n  \}\\n  \\n  // Stelle sicher, dass name immer vorhanden ist (explizit setzen)\\n  const workflowName = workflow.name || 'Unnamed Workflow';\\n  \\n  // Erstelle workflowData - entferne name falls vorhanden, dann setze es explizit\\n  const workflowData = \{\\n    ...workflow\\n  \};\\n  \\n  // Stelle sicher, dass name-Feld explizit gesetzt ist (auch wenn es undefined war)\\n  workflowData.name = workflowName;\\n  \\n  return \{\\n    workflowId: workflow.id || null,\\n    workflowName: workflowName,\\n    workflowData: workflowData,\\n    filePath: githubFile.path || githubFile.name\\n  \};\\n\} catch (e) \{\\n  return \{ error: 'Fehler beim Parsen der Workflow-Datei: ' + e.message \};\\n\}\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-2144\
1:160\
id:29ff16ee-047a-465f-8d09-dab9be4214f5\
name:Parse Workflow\
6\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-error\
leftValue:=\{\{ $json.error \}\}\
rightValue:empty\
operator\
type:string\
operation:equals\
1\
id:check-workflow-id\
leftValue:=\{\{ $json.workflowId \}\}\
rightValue:null\
operator\
type:string\
operation:notEquals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:-1920\
1:160\
id:afc2c48f-0fe1-44c2-9bbf-86077316e54e\
name:Pr\'fcfe Workflow\
7\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-exists\
leftValue:=\{\{ $json.statusCode \}\}\
rightValue:200\
operator\
type:number\
operation:equals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:-1472\
1:160\
id:f31717c9-cd55-4203-ad1b-65b0ffe739a1\
name:Workflow existiert?\
8\
parameters\
method:PUT\
url:=https://n8n.srv1098810.hstgr.cloud/api/v1/workflows/\{\{ $node["Parse Workflow"].json.workflowId \}\}\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
specifyBody:json\
jsonBody:=\{\{ $node["Parse Workflow"].json.workflowData \}\}\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-1248\
1:64\
id:62770be0-c3e4-49a5-9c21-d898e77b2b40\
name:Update Workflow\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:API n8n\
onError:continueRegularOutput\
9\
parameters\
method:POST\
url:=https://n8n.srv1098810.hstgr.cloud/api/v1/workflows\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
specifyBody:json\
jsonBody:=\{\{ $node["Parse Workflow"].json.workflowData \}\}\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-1248\
1:256\
id:2ecc9176-8c58-44e6-9f63-9555b4990cb1\
name:Erstelle Workflow\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:API n8n\
onError:continueRegularOutput\
10\
parameters\
url:=https://n8n.srv1098810.hstgr.cloud/api/v1/workflows/\{\{ $json.workflowId \}\}\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
options\
response\
response\
responseFormat:json\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-1696\
1:160\
id:510109dc-f01f-47fb-ae2d-46066c3ad206\
name:Pr\'fcfe, ob Workflow existiert\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:API n8n\
onError:continueRegularOutput\
connections\
GitHub Webhook Trigger\
main\
0\
0\
node:Pr\'fcfe Push Event\
type:main\
index:0\
Pr\'fcfe Push Event\
main\
0\
0\
node:Extrahiere ge\'e4nderte Dateien\
type:main\
index:0\
Extrahiere ge\'e4nderte Dateien\
main\
0\
0\
node:Vorbereiten Datei\
type:main\
index:0\
Vorbereiten Datei\
main\
0\
0\
node:Hole Datei von GitHub\
type:main\
index:0\
Hole Datei von GitHub\
main\
0\
0\
node:Parse Workflow\
type:main\
index:0\
Parse Workflow\
main\
0\
0\
node:Pr\'fcfe Workflow\
type:main\
index:0\
Pr\'fcfe Workflow\
main\
0\
0\
node:Pr\'fcfe, ob Workflow existiert\
type:main\
index:0\
Workflow existiert?\
main\
0\
0\
node:Update Workflow\
type:main\
index:0\
1\
0\
node:Erstelle Workflow\
type:main\
index:0\
Pr\'fcfe, ob Workflow existiert\
main\
0\
0\
node:Workflow existiert?\
type:main\
index:0\
settings\
executionOrder:v1\
callerPolicy:workflowsFromSameOwner\
availableInMCP:false\
staticData:null\
meta:null\
pinData:\{empty object\}\
versionId:2a896f59-f551-433b-a6d5-581bc6ddab08\
activeVersionId:2a896f59-f551-433b-a6d5-581bc6ddab08\
triggerCount:1\
shared\
0\
updatedAt:2025-12-31T18:13:36.088Z\
createdAt:2025-12-31T18:13:36.088Z\
role:workflow:owner\
workflowId:R307XPK2xOtEQ2UW\
projectId:yr4Hj71ou1NOsi2p\
activeVersion\
updatedAt:2026-01-02T11:35:56.000Z\
createdAt:2026-01-02T11:35:53.228Z\
versionId:2a896f59-f551-433b-a6d5-581bc6ddab08\
workflowId:R307XPK2xOtEQ2UW\
nodes\
0\
parameters\
httpMethod:POST\
path:github-sync-webhook\
options:\{empty object\}\
id:d06d3a29-0811-4543-9127-7bc02d9a3877\
name:GitHub Webhook Trigger\
type:n8n-nodes-base.webhook\
typeVersion:1\
position\
0:-3264\
1:160\
webhookId:github-sync-webhook\
1\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-push-event\
leftValue:=\{\{ $json.headers['x-github-event'] \}\}\
rightValue:push\
operator\
type:string\
operation:equals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:-3040\
1:160\
id:46f9630e-112c-4145-b98b-c81909aeb710\
name:Pr\'fcfe Push Event\
2\
parameters\
jsCode:// Extrahiere ge\'e4nderte Dateien aus GitHub Webhook\\nconst body = $json.body || \{\};\\nconst commits = body.commits || [];\\nconst changedFiles = [];\\n\\n// Sammle alle ge\'e4nderten Dateien\\nfor (const commit of commits) \{\\n  const added = commit.added || [];\\n  const modified = commit.modified || [];\\n  \\n  for (const file of [...added, ...modified]) \{\\n    // Workflow-Dateien:\\n    // - Im n8n/ Verzeichnis (alte Struktur: n8n/workflow-name.json)\\n    // - In n8n/\{workflowId\}/ (neue Struktur: n8n/\{workflowId\}/\{workflowName\}.json)\\n    // - Im Root mit -workflow.json oder -Workflow.json (z.B. n8n-Backup-Workflow.json, github-to-n8n-sync-workflow.json)\\n    if (file.endsWith('.json') && (file.startsWith('n8n/') || file.includes('-workflow.json') || file.includes('-Workflow.json'))) \{\\n      changedFiles.push(file);\\n    \}\\n  \}\\n\}\\n\\nreturn changedFiles.map(file => (\{ filePath: file \}));\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-2816\
1:160\
id:bd898be3-9a52-4de0-84c1-187f150fca31\
name:Extrahiere ge\'e4nderte Dateien\
3\
parameters\
mode:runOnceForEachItem\
jsCode:const filePath = $json.filePath;\\nreturn \{ filePath \};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-2592\
1:160\
id:55c2883c-b7d4-4949-97df-36546f2fa110\
name:Vorbereiten Datei\
4\
parameters\
resource:file\
operation:get\
owner\
__rl:true\
value:peerendees\
mode:name\
repository\
__rl:true\
value:n8n-workflows\
mode:list\
cachedResultName:n8n-workflows\
cachedResultUrl:https://github.com/peerendees/n8n-workflows\
filePath:=\{\{ $json.filePath \}\}\
asBinaryProperty:false\
additionalParameters\
reference:main\
type:n8n-nodes-base.github\
typeVersion:1.1\
position\
0:-2368\
1:160\
id:2f1f39c7-8f10-416e-9735-d98d9ccf219b\
name:Hole Datei von GitHub\
webhookId:694567e2-c3e8-4bfc-91af-aae5697aca36\
credentials\
githubApi\
id:uE78TkEY6lWLV4oP\
name:API GitHub\
onError:continueRegularOutput\
5\
parameters\
jsCode:// Extrahiere Workflow-Daten aus GitHub-Datei\\nconst githubFile = $json;\\n\\nif (githubFile.error || !githubFile.content) \{\\n  return \{ error: 'Datei konnte nicht geladen werden' \};\\n\}\\n\\ntry \{\\n  const content = Buffer.from(githubFile.content, 'base64').toString('utf-8');\\n  const workflow = JSON.parse(content);\\n  \\n  // Selbst-Sync Sperre: \'dcberspringe den Sync-Workflow selbst\\n  const isSelf = workflow.id === 'R307XPK2xOtEQ2UW';\\n  if (isSelf) \{\\n    return \{ error: 'Sync-Workflow wird \'fcbersprungen (Selbst-Sync Sperre)' \};\\n  \}\\n  \\n  // Stelle sicher, dass name immer vorhanden ist (explizit setzen)\\n  const workflowName = workflow.name || 'Unnamed Workflow';\\n  \\n  // Erstelle workflowData - entferne name falls vorhanden, dann setze es explizit\\n  const workflowData = \{\\n    ...workflow\\n  \};\\n  \\n  // Stelle sicher, dass name-Feld explizit gesetzt ist (auch wenn es undefined war)\\n  workflowData.name = workflowName;\\n  \\n  return \{\\n    workflowId: workflow.id || null,\\n    workflowName: workflowName,\\n    workflowData: workflowData,\\n    filePath: githubFile.path || githubFile.name\\n  \};\\n\} catch (e) \{\\n  return \{ error: 'Fehler beim Parsen der Workflow-Datei: ' + e.message \};\\n\}\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-2144\
1:160\
id:29ff16ee-047a-465f-8d09-dab9be4214f5\
name:Parse Workflow\
6\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-error\
leftValue:=\{\{ $json.error \}\}\
rightValue:empty\
operator\
type:string\
operation:equals\
1\
id:check-workflow-id\
leftValue:=\{\{ $json.workflowId \}\}\
rightValue:null\
operator\
type:string\
operation:notEquals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:-1920\
1:160\
id:afc2c48f-0fe1-44c2-9bbf-86077316e54e\
name:Pr\'fcfe Workflow\
7\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:check-exists\
leftValue:=\{\{ $json.statusCode \}\}\
rightValue:200\
operator\
type:number\
operation:equals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:-1472\
1:160\
id:f31717c9-cd55-4203-ad1b-65b0ffe739a1\
name:Workflow existiert?\
8\
parameters\
method:PUT\
url:=https://n8n.srv1098810.hstgr.cloud/api/v1/workflows/\{\{ $node["Parse Workflow"].json.workflowId \}\}\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
specifyBody:json\
jsonBody:=\{\{ $node["Parse Workflow"].json.workflowData \}\}\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-1248\
1:64\
id:62770be0-c3e4-49a5-9c21-d898e77b2b40\
name:Update Workflow\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:API n8n\
onError:continueRegularOutput\
9\
parameters\
method:POST\
url:=https://n8n.srv1098810.hstgr.cloud/api/v1/workflows\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
specifyBody:json\
jsonBody:=\{\{ $node["Parse Workflow"].json.workflowData \}\}\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-1248\
1:256\
id:2ecc9176-8c58-44e6-9f63-9555b4990cb1\
name:Erstelle Workflow\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:API n8n\
onError:continueRegularOutput\
10\
parameters\
url:=https://n8n.srv1098810.hstgr.cloud/api/v1/workflows/\{\{ $json.workflowId \}\}\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
options\
response\
response\
responseFormat:json\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-1696\
1:160\
id:510109dc-f01f-47fb-ae2d-46066c3ad206\
name:Pr\'fcfe, ob Workflow existiert\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:API n8n\
onError:continueRegularOutput\
connections\
GitHub Webhook Trigger\
main\
0\
0\
node:Pr\'fcfe Push Event\
type:main\
index:0\
Pr\'fcfe Push Event\
main\
0\
0\
node:Extrahiere ge\'e4nderte Dateien\
type:main\
index:0\
Extrahiere ge\'e4nderte Dateien\
main\
0\
0\
node:Vorbereiten Datei\
type:main\
index:0\
Vorbereiten Datei\
main\
0\
0\
node:Hole Datei von GitHub\
type:main\
index:0\
Hole Datei von GitHub\
main\
0\
0\
node:Parse Workflow\
type:main\
index:0\
Parse Workflow\
main\
0\
0\
node:Pr\'fcfe Workflow\
type:main\
index:0\
Pr\'fcfe Workflow\
main\
0\
0\
node:Pr\'fcfe, ob Workflow existiert\
type:main\
index:0\
Workflow existiert?\
main\
0\
0\
node:Update Workflow\
type:main\
index:0\
1\
0\
node:Erstelle Workflow\
type:main\
index:0\
Pr\'fcfe, ob Workflow existiert\
main\
0\
0\
node:Workflow existiert?\
type:main\
index:0\
authors:Marcus Kunkel\
name:Version 2a896f59\
description:empty\
autosaved:false\
tags:[empty array]\
15\
updatedAt:2025-11-23T13:53:48.000Z\
createdAt:2025-11-14T16:13:23.250Z\
id:Y56BJExGtL558gem\
name:fonio AGS E-Mail-Generator\
active:false\
isArchived:false\
nodes\
0\
parameters\
fieldToSplitOut:prompts\
include:allOtherFields\
options:\{empty object\}\
type:n8n-nodes-base.splitOut\
typeVersion:1\
position\
0:-416\
1:-320\
id:61e4981e-c9e6-4ee0-ab1d-599894ab8da3\
name:Split Out\
1\
parameters\
mode:raw\
jsonOutput:\{\\n  "prompts": [\\n    \{ "prompt": "Kannst du mir bitte den neuen Workflow erkl\'e4ren?" \},\\n    \{ "prompt": "Ich brauche Hilfe beim Einrichten meines n8n-Projekts." \},\\n    \{ "prompt": "Hier steht mein Passwort: 1234abcd" \}\\n  ]\\n\}\\n\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:-640\
1:-320\
id:96216bfa-9c03-450b-85fc-c3401d6bd39e\
name:Edit Fields\
2\
parameters\
jsCode:const output = [];\\n\\nfor (const item of $input.all()) \{\\n  const body = item.json?.body;\\n\\n  if (!body) \{\\n    // Kein body vorhanden \'96 Fehlerhinweis erg\'e4nzen\\n    output.push(\{\\n      json: \{\\n        error: "Webhook-Body fehlt oder ist undefiniert",\\n        original: item.json\\n      \}\\n    \});\\n    continue;\\n  \}\\n\\n  const name = body?.anrufer_name ?? "unbekannt";\\n  const telefon = body?.anrufer_telefonnummer ?? "keine Nummer";\\n  const typ = body?.einrichtung_typ ?? "unbekannt";\\n  const einrichtung = body?.einrichtung_name ?? "unbekannt";\\n  const technisch = body?.technisch ?? false;\\n\\n  output.push(\{\\n    json: \{\\n      anrufer_name: name,\\n      anrufer_telefonnummer: telefon,\\n      einrichtung_typ: typ,\\n      einrichtung_name: einrichtung,\\n      technisch: technisch,\\n      kurzinfo: `$\{name\} ($\{telefon\}) \'96 $\{typ\}: $\{einrichtung\}`\\n    \}\\n  \});\\n\}\\n\\nreturn output;\\n\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-96\
1:-128\
id:c456c732-1a7e-48a9-a0c7-54490e4f694b\
name:Code in JavaScript\
3\
parameters\
httpMethod:POST\
path:7d6ad4df-13af-439e-97c0-5fdef19f265b\
options:\{empty object\}\
type:n8n-nodes-base.webhook\
typeVersion:2.1\
position\
0:-640\
1:16\
id:851bd2c0-5717-49d8-9827-801d12cdc1bb\
name:Webhook\
webhookId:7d6ad4df-13af-439e-97c0-5fdef19f265b\
4\
parameters\
text:=\{\{ $json.headers.host \}\}\
guardrails\
keywords:empty\
urls\
value\
allowedUrls:=n8n.srv1098810.hstgr.cloud\
allowedSchemes\
0:https\
1:http\
type:@n8n/n8n-nodes-langchain.guardrails\
typeVersion:1\
position\
0:-416\
1:16\
id:43c45bc2-6f0b-4ecd-a8ae-0357231e8060\
name:Guardrails\
5\
parameters\
model\
__rl:true\
mode:list\
value:claude-sonnet-4-5-20250929\
cachedResultName:Claude Sonnet 4.5\
options:\{empty object\}\
type:@n8n/n8n-nodes-langchain.lmChatAnthropic\
typeVersion:1.3\
position\
0:-352\
1:240\
id:7db289a9-d347-403a-bf7d-a870b477ccce\
name:Anthropic Chat Model\
credentials\
anthropicApi\
id:6RlfJdXsmselCNpN\
name:Anthropic account 2\
6\
parameters\
code\
execute\
code:// Im LangChain Code Node\\nimport \{ DynamicTool \} from "langchain/tools";\\n\\n// Custom Tool erstellen\\nconst searchTool = new DynamicTool(\{\\n  name: "web_search",\\n  description: "Sucht im Internet nach Informationen",\\n  func: async (input) => \{\\n    // Hier w\'fcrdest du HTTP Request machen\\n    // oder auf andere n8n Nodes zugreifen\\n    return `Suchergebnis f\'fcr: $\{input\}`;\\n  \},\\n\});\\n\\n// Tool an Agent anh\'e4ngen\\nconst tools = [searchTool];\
type:@n8n/n8n-nodes-langchain.code\
typeVersion:1\
position\
0:-640\
1:336\
id:7529b4b9-a2c9-4732-8dc8-8c7b4e924aa9\
name:LangChain Code\
connections\
Edit Fields\
main\
0\
0\
node:Split Out\
type:main\
index:0\
Webhook\
main\
0\
0\
node:Guardrails\
type:main\
index:0\
Anthropic Chat Model\
ai_languageModel\
0\
0\
node:Guardrails\
type:ai_languageModel\
index:0\
Guardrails\
main\
0\
0\
node:Code in JavaScript\
type:main\
index:0\
settings\
executionOrder:v1\
staticData:null\
meta\
templateCredsSetupCompleted:true\
pinData:\{empty object\}\
versionId:ca8ca0f8-ee9e-4efc-ac99-6ce9ae803b83\
activeVersionId:null\
triggerCount:1\
shared\
0\
updatedAt:2025-11-14T16:13:23.254Z\
createdAt:2025-11-14T16:13:23.254Z\
role:workflow:owner\
workflowId:Y56BJExGtL558gem\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
16\
updatedAt:2025-11-11T19:57:38.000Z\
createdAt:2025-11-11T19:56:45.940Z\
id:ZzyUNBLHABev3X7Q\
name:Telegram Trigger Template\
active:false\
isArchived:false\
nodes\
0\
parameters\
updates\
0:message\
additionalFields\
chatIds:7100977906\
type:n8n-nodes-base.telegramTrigger\
typeVersion:1.2\
position\
0:-672\
1:96\
id:0bf4238e-50d0-4bb1-9c27-0610e45e9fdf\
name:Telegram Trigger\
webhookId:ff92015f-344f-434d-8f46-453f25ecf711\
1\
parameters\
rules\
values\
0\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:2\
conditions\
0\
leftValue:=\{\{ $json.message.text \}\}\
rightValue:empty\
operator\
type:string\
operation:notEmpty\
singleValue:true\
id:c04edae6-42ed-4df6-8089-4e291dc97a26\
combinator:and\
renameOutput:true\
outputKey:Text\
1\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:2\
conditions\
0\
id:33bbf746-caab-435f-a472-2ea238f091f6\
leftValue:=\{\{ $json.message.voice \}\}\
rightValue:empty\
operator\
type:object\
operation:exists\
singleValue:true\
combinator:and\
renameOutput:true\
outputKey:Voice\
options:\{empty object\}\
type:n8n-nodes-base.switch\
typeVersion:3.3\
position\
0:-448\
1:96\
id:84cf7973-1a48-4c3b-82f3-34dd3b0564e0\
name:Switch\
2\
parameters\
assignments\
assignments\
0\
id:1aea2a41-9f7d-4444-b87b-4004caa3a084\
name:text\
value:=\{\{ $json.message.text \}\}\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:-224\
1:0\
id:49e9f956-449d-4e9d-a7a7-fda540d0fd5e\
name:Edit Fields\
3\
parameters\
resource:file\
fileId:=\{\{ $json.message.voice.file_id \}\}\
additionalFields:\{empty object\}\
type:n8n-nodes-base.telegram\
typeVersion:1.2\
position\
0:-224\
1:192\
id:6b86877e-8065-4f82-9a24-a7b5bc5cbde2\
name:Get a file\
webhookId:1b11f79c-3f53-441d-bfd3-6700a62569bc\
4\
parameters\
resource:audio\
operation:transcribe\
options:\{empty object\}\
type:@n8n/n8n-nodes-langchain.openAi\
typeVersion:1.8\
position\
0:0\
1:192\
id:82333d82-5a83-4a7e-8c57-59959725ffaf\
name:Transcribe a recording\
5\
parameters\
operation:sendAudio\
chatId:=\{\{ $('Telegram Trigger').item.json.message.chat.id \}\}\
binaryData:true\
additionalFields:\{empty object\}\
type:n8n-nodes-base.telegram\
typeVersion:1.2\
position\
0:240\
1:80\
id:f51738c3-ee2e-41ce-9e2f-1e342fca00f2\
name:Send an audio file\
webhookId:b0cb3f9e-7a18-4350-89bd-1667be0afd7a\
connections\
Telegram Trigger\
main\
0\
0\
node:Switch\
type:main\
index:0\
Switch\
main\
0\
0\
node:Edit Fields\
type:main\
index:0\
1\
0\
node:Get a file\
type:main\
index:0\
Get a file\
main\
0\
0\
node:Transcribe a recording\
type:main\
index:0\
settings\
executionOrder:v1\
staticData:null\
meta:null\
pinData:\{empty object\}\
versionId:78f6b4df-e0a5-4a39-bf73-cde9cab367e2\
activeVersionId:null\
triggerCount:0\
shared\
0\
updatedAt:2025-11-11T19:56:45.942Z\
createdAt:2025-11-11T19:56:45.942Z\
role:workflow:owner\
workflowId:ZzyUNBLHABev3X7Q\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
17\
updatedAt:2025-11-11T19:11:17.811Z\
createdAt:2025-11-11T19:11:17.811Z\
id:b9iyuWBFH35Nzzp0\
name:LinkedIn Profile and Post Scraper\
active:false\
isArchived:false\
nodes:[empty array]\
connections:\{empty object\}\
settings\
executionOrder:v1\
staticData:null\
meta:null\
pinData:\{empty object\}\
versionId:0317aa28-d2a1-4060-9108-384689e9d401\
activeVersionId:null\
triggerCount:0\
shared\
0\
updatedAt:2025-11-11T19:11:17.814Z\
createdAt:2025-11-11T19:11:17.814Z\
role:workflow:owner\
workflowId:b9iyuWBFH35Nzzp0\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
18\
updatedAt:2025-12-08T15:12:07.204Z\
createdAt:2025-12-08T15:12:07.204Z\
id:dPDoawNHAa6ocJdr\
name:fonio AGS Nachbearbeitung Transkript Sicherung 251208\
active:false\
isArchived:false\
nodes\
0\
parameters\
httpMethod:POST\
path:367bc90b-4189-48db-8440-fd1c7312e700\
options:\{empty object\}\
type:n8n-nodes-base.webhook\
typeVersion:2.1\
position\
0:-352\
1:-112\
id:935a0e09-1723-4f1d-95de-023da9e2962c\
name:Webhook\
webhookId:367bc90b-4189-48db-8440-fd1c7312e700\
1\
parameters\
assignments\
assignments\
0\
id:04f27e3e-ebed-4ae5-a22f-23d0f7c61904\
name:body[0].body.formattedTranscript\
value:=\{\{ $json.body[0].body.formattedTranscript \}\}\
type:string\
1\
id:017777fc-53d7-473d-b3c8-09a32e601385\
name:body[0].body.fromNumber\
value:=\{\{ $json.body[0].body.fromNumber \}\}\
type:string\
2\
id:882e8a05-a492-4445-bb4a-1856bfb586a1\
name:body[0].body.context.anrufer_name\
value:=\{\{ $json.body[0].body.context.anrufer_name \}\}\
type:string\
3\
id:a6508b49-d751-49d7-b40c-c91be52f5839\
name:body[0].body.context.einrichtung_typ\
value:=\{\{ $json.body[0].body.context.einrichtung_typ \}\}\
type:string\
4\
id:08190377-3019-449b-9374-494e642c5125\
name:body[0].body.context.einrichtung_name\
value:=\{\{ $json.body[0].body.context.einrichtung_name \}\}\
type:string\
5\
id:58740a6d-b29d-48ca-b2a3-fc14e3dedaeb\
name:body[0].body.context.technisch\
value:=\{\{ $json.body[0].body.context.technisch \}\}\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:-128\
1:-208\
id:70563cf4-f4af-4ee4-b523-76c9fea3ac75\
name:Daten extrahieren\
2\
parameters\
promptType:define\
text:=F\'fchre die Klassifikation durch.\
hasOutputParser:true\
options\
systemMessage:=DU BIST EIN HOCHSPEZIALISIERTER KLASSIFIKATIONS-AGENT F\'dcR IT-HOTLINE-TRANSKRIPTE.\\n\\n###DEINE HAUPTAUFGABE###\\nAnalysiere Telefon-Transkripte und ordne sie pr\'e4zise in eine Dringlichkeitskategorie (A, B, C oder D) ein, basierend auf den Kriterien aus der bereitgestellten Wissensdatenbank. Deine Klassifikation erm\'f6glicht Technikern eine zielgerichtete, priorisierte Bearbeitung.\\n\\n---\\n\\n###VERF\'dcGBARE DATEN###\\n\\n**DRINGLICHKEITSKRITERIEN (aus Google Sheet):**\\n\{\{ $input.all().slice(1).map(item => \\n`Kategorie $\{item.json.Dringlichkeit\}: $\{item.json.Kategorie\}\\nSchl\'fcsselworte: $\{item.json.Schlagworte\}\\nBeispiele: $\{item.json.Beispiele\}`\\n).join('\\n\\n') \}\}\\n\\n**ZU ANALYSIERENDES TRANSKRIPT:**\\n\{\{ $json.body[0].body.formattedTranscript \}\}\\n\\n**ANRUFERDATEN:**\\n- Name: \{\{ $json.body[0].body.context.anrufer_name \}\}\\n- Von: \{\{ $json.body[0].body.fromNumber \}\}\\n- Einrichtung: \{\{ $json.body[0].body.context.einrichtung_name \}\}\\n\\n---\\n\\n###ANALYSE-METHODIK (CHAIN OF THOUGHTS)###\\n\\n1. **UNDERSTAND**\\n   - Lies das Transkript gr\'fcndlich und identifiziere das konkrete technische Problem\\n   - Erkenne die Auswirkungen: Produktivit\'e4tsausfall, Datenverlust, Eskalation, Gesch\'e4ftskritikalit\'e4t\\n\\n2. **IDENTIFY KEY SIGNALS**\\n   - Schl\'fcsselbegriffe f\'fcr hohe Dringlichkeit: "nicht arbeitsf\'e4hig", "Produktion steht", "Kunde wartet", "dringend", "sofort"\\n   - Schl\'fcsselbegriffe f\'fcr niedrige Dringlichkeit: "nicht eilig", "wenn Zeit ist", "Informationsfrage", "optional"\\n\\n3. **ASSESS IMPACT**\\n   - Ist ein gesch\'e4ftskritischer Prozess blockiert?\\n   - Sind mehrere Nutzer betroffen?\\n   - Gibt es Fristen oder SLA-relevante Zeitpunkte?\\n   - Handelt es sich um einen Standardvorgang oder eine Informationsanfrage?\\n\\n4. **MATCH WITH CRITERIA**\\n   - Vergleiche die erkannten Merkmale mit den Referenzbeispielen aus dem Google Sheet\\n   - W\'e4hle die Kategorie, die der Fallbeschreibung AM N\'c4CHSTEN kommt\\n\\n5. **HANDLE EDGE CASES**\\n   - Bei unklaren oder widerspr\'fcchlichen Transkripten: W\'e4hle die konservativere (h\'f6here) Kategorie\\n   - Weise explizit auf Unsicherheiten hin\\n\\n---\\n\\n###AUSGABEFORMAT###\\n\\nGib deine Analyse im folgenden JSON-Format zur\'fcck:\\n```json\\n\{\\n  "Dringlichkeit": "B",\\n  "Kategorie": "Dringend",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Server-Ausfall",\\n  "Beschreibung": [\\n    "Mehrere Mitarbeiter betroffen (Buchhaltung)",\\n    "Datenbankverbindung unterbrochen seit 8 Uhr",\\n    "Fehlende Rechnungen der letzten 2 Wochen",\\n    "Zeitkritisch: Jahresabschluss-Termin in 2 Stunden"\\n  ],\\n  "AnsprechpartnerBleibt": true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\\n  "AnsprechpartnerName": "Frau Weber",\\n  "RueckrufnummerAnders": true = andere R\'fcckrufnummer gew\'fcnscht, false = unter anrufender Nummer zur\'fcckrufen\\n  "Rueckrufnummer": Die vom Anrufer genannte R\'fcckrufnummer (mit Durchwahl falls vorhanden)\\n  "Begr\'fcndung": "Der Kunde ist grunds\'e4tzlich arbeitsf\'e4hig, jedoch blockiert ein IT-Fehler einen zeitkritischen Gesch\'e4ftsprozess. Entspricht den Beispielen f\'fcr Kategorie B im Sheet."\\n\}\\n```\\n\\n**WICHTIG: Feldbeschreibungen** \\n- Die Dringlichkeit MUSS ein einzelner Buchstabe sein: A, B, C oder D, entsprechend der M\'f6glichkeiten im Google Sheet\\n- Die Kategorie MUSS sich auf die entsprechende Spalte im Google Sheet beziehen\\n- Problemtyp: Klassifiziere in GENAU EINE dieser Kategorien:\\n  \'95 "Technisch" = Hardware-Probleme, Netzwerkausf\'e4lle, Ger\'e4tedefekte, Server-Ausf\'e4lle\\n  \'95 "Software" = Programmfehler, Anmeldeprobleme, Softwarest\'f6rungen, Datenbankprobleme\\n  \'95 "Anliegen" = Informationsanfragen, Beratung, allgemeine Fragen ohne akutes technisches Problem\\n- Themenstichwort: Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z. B. "SAP-Login", "E-Mail-Sync", "Drucker-WLAN")\\n- Beschreibung: Array mit 3-6 Stichpunkten, die wichtigsten Informationen zuerst:\\n  \'95 Betroffene Personen/Systeme\\n  \'95 Zeitpunkt des Auftretens\\n  \'95 Konkrete Symptome/Fehler\\n  \'95 Gesch\'e4ftliche Auswirkungen\\n  \'95 Fristen/Zeitdruck\\n  \'95 Bereits versuchte L\'f6sungen\\n- AnsprechpartnerBleibt: true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\\n- AnsprechpartnerName: Name des Ansprechpartners (falls abweichend vom Anrufer, sonst leer lassen)\\n- AnsprechpartnerTelefon: Telefonnummer des Ansprechpartners (falls abweichend, sonst leer lassen)\\n- RueckrufnummerAnders: true = andere R\'fcckrufnummer als anrufende Nummer, false = unter anrufender Nummer zur\'fcckrufen\\n- Rueckrufnummer: Die R\'fcckrufnummer (kann identisch mit AnsprechpartnerTelefon sein)\\n- Die Begr\'fcndung MUSS sich auf die Kriterien im Google Sheet beziehen\\n- Halte dich strikt an das JSON-Format\\n\\n---\\n\\n###WAS NICHT ZU TUN IST###\\n\\nNIEMALS Kategorien ohne Bezug zum Google Sheet festlegen\\nVERMEIDE vage Begr\'fcndungen wie "klingt dringend" oder "scheint wichtig"\\nNICHT nur nach einzelnen Schl\'fcsselworten klassifizieren \'96 analysiere die Gesamtsituation\\nNIEMALS Aussagen erfinden, die nicht im Transkript stehen\\nNICHT \'fcberkategorisieren: Unzufriedenheit allein rechtfertigt keine Kategorie A\\nIGNORIERE NIEMALS Hinweise auf Systemrelevanz, Produktionsstopp oder gesch\'e4ftskritische Prozesse\\n\\n---\\n\\n###FEW-SHOT BEISPIELE###\\n\\n**Beispiel 1 - Kategorie A:**\\nTranskript: "Ich kann mich nicht mehr in SAP anmelden, wir m\'fcssen heute unbedingt die Monatsabrechnung machen."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "A",\\n  "Kategorie": "Notfall",\\n  "Problemtyp": "Software",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Gesch\'e4ftskritischer Prozess (Monatsabrechnung) ist komplett blockiert. Entspricht den Referenzf\'e4llen f\'fcr Kategorie A im Sheet."\\n\}\\n```\\n\\n**Beispiel 2 - Kategorie D:**\\nTranskript: "Ich wollte nur fragen, ob man den Drucker auch \'fcber WLAN verbinden kann \'96 ist aber nicht eilig."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "D",\\n  "Kategorie": "Informativ",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Informationsanfrage ohne Zeitdruck, kein akuter Vorfall. Entspricht klar Kategorie D im Sheet."\\n\}\\n```\\n\\n**Beispiel 3 - Kategorie B:**\\nTranskript: "Mein Outlook synchronisiert nicht mehr. Ich kann arbeiten, aber wichtige E-Mails von Kunden kommen nicht an."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "B",\\n  "Kategorie": "Dringend",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Eingeschr\'e4nkte Arbeitsf\'e4higkeit bei einem wichtigen Kommunikationskanal. Keine komplette Blockade, aber gesch\'e4ftsrelevant. Entspricht Kategorie B."\\n\}\\n```\
type:@n8n/n8n-nodes-langchain.agent\
typeVersion:3\
position\
0:320\
1:-112\
id:00af3b4a-50a1-41df-a516-df618c013ad5\
name:AI Agent\
executeOnce:true\
3\
parameters\
model\
__rl:true\
value:claude-3-5-haiku-20241022\
mode:list\
cachedResultName:Claude Haiku 3.5\
options:\{empty object\}\
type:@n8n/n8n-nodes-langchain.lmChatAnthropic\
typeVersion:1.3\
position\
0:400\
1:112\
id:a72b2e08-67f3-4591-a6ed-6378bef31572\
name:Anthropic Chat Model\
credentials\
anthropicApi\
id:6RlfJdXsmselCNpN\
name:Anthropic account 2\
4\
parameters\
authentication:serviceAccount\
documentId\
__rl:true\
value:1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw\
mode:id\
sheetName\
__rl:true\
value:gid=0\
mode:list\
cachedResultName:Dringlichkeiten\
cachedResultUrl:https://docs.google.com/spreadsheets/d/1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw/edit#gid=0\
options:\{empty object\}\
type:n8n-nodes-base.googleSheets\
typeVersion:4.7\
position\
0:-128\
1:-16\
id:1b85874a-bd52-4745-aeac-cf0f83b2b548\
name:Dringlichkeitskriterien laden\
credentials\
googleApi\
id:vRVq7GTwn9kTIi8N\
name:Google Sheets account 2\
5\
parameters:\{empty object\}\
type:n8n-nodes-base.merge\
typeVersion:3.2\
position\
0:96\
1:-112\
id:6be52049-555e-4624-aa75-50b17878121d\
name:Merge\
6\
parameters\
assignments\
assignments\
0\
id:ba4494fd-87dc-44a3-be07-3c1e3b0b0f04\
name:Dringlichkeit\
value:=\{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).Dringlichkeit \}\}\
type:string\
1\
id:77fc8f1e-1ef1-4c82-a4c9-1badefb579a4\
name:problemtyp\
value:=\{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).Problemtyp \}\}\
type:string\
2\
id:ea4dea35-112a-47b3-86c9-3252d606adda\
name:betreff\
value:=\{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).Kategorie \}\} | \{\{ $('Merge').item.json.body[0].body.context.einrichtung_name \}\}, \{\{ $('Merge').item.json.body[0].body.context.anrufer_name \}\} | \{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).Themenstichwort \}\}\
type:string\
3\
id:123c771e-c991-4bb9-8860-c5c030773741\
name:emailBody\
value:=<h3>Problemtyp: \{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).Problemtyp \}\}</h3>\\n\\n<h3>KI-Einsch\'e4tzung</h3>\\n<ul>\\n  <li><strong>Einrichtung:</strong> \{\{ $('Merge').item.json.body[0].body.context.einrichtung_name \}\}</li>\\n  <li><strong>Anrufer:</strong> \{\{ $('Merge').item.json.body[0].body.context.anrufer_name \}\} (\{\{ $('Merge').item.json.body[0].body.fromNumber \}\})</li>\\n  <li><strong>Ansprechpartner:</strong> \\n    \{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).AnsprechpartnerBleibt ? 'Anrufer bleibt Ansprechpartner' : JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).AnsprechpartnerName + ' (' + JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).AnsprechpartnerTelefon + ')' \}\}\\n  </li>\\n  <li><strong>R\'fcckrufnummer:</strong> \\n    \{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).RueckrufnummerAnders ? JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).Rueckrufnummer : $('Merge').item.json.body[0].body.fromNumber \}\}\\n  </li>\\n  <li><strong>Thema:</strong> \{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).Themenstichwort \}\}</li>\\n  <li><strong>Beschreibung:</strong>\\n    <ul>\\n      \{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).Beschreibung.map(punkt => `<li>$\{punkt\}</li>`).join('') \}\}\\n    </ul>\\n  </li>\\n</ul>\\n\\n<h3>Begr\'fcndung der Dringlichkeitseinstufung</h3>\\n<p>\{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).Begr\'fcndung \}\}</p>\\n\\n<h3>Vollst\'e4ndiges Transkript</h3>\\n\{\{ $('Merge').item.json.body[0].body.formattedTranscript.replace(/\\n/g, '<br>') \}\}\\n</pre>\
type:string\
4\
id:abbab201-31d0-4200-8c7e-5b3d2c1b1dc7\
name:themenstichwort\
value:=\{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).Themenstichwort \}\}\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:672\
1:-112\
id:5eee655c-a899-4e8e-ba71-6016f32c6061\
name:E-Mail vorbereiten\
7\
parameters\
fromEmail:office@berent.ai\
toEmail:office@berent.ai\
subject:=\{\{ $json.betreff \}\}\
html:=\{\{ $json.emailBody \}\}\
options:\{empty object\}\
path:82009882-a2e2-40b1-9e65-a1befe9e8831\
type:n8n-nodes-base.emailSend\
typeVersion:2.1\
position\
0:880\
1:-112\
id:78cbf6a8-3fc9-4d66-b70c-70ebd3c09956\
name:Send email\
webhookId:82009882-a2e2-40b1-9e65-a1befe9e8831\
credentials\
smtp\
id:8O5B5z4vS8yeagJh\
name:SMTP account\
connections\
Webhook\
main\
0\
0\
node:Daten extrahieren\
type:main\
index:0\
1\
node:Dringlichkeitskriterien laden\
type:main\
index:0\
Daten extrahieren\
main\
0\
0\
node:Merge\
type:main\
index:0\
Anthropic Chat Model\
ai_languageModel\
0\
0\
node:AI Agent\
type:ai_languageModel\
index:0\
Dringlichkeitskriterien laden\
main\
0\
0\
node:Merge\
type:main\
index:1\
Merge\
main\
0\
0\
node:AI Agent\
type:main\
index:0\
AI Agent\
main\
0\
0\
node:E-Mail vorbereiten\
type:main\
index:0\
E-Mail vorbereiten\
main\
0\
0\
node:Send email\
type:main\
index:0\
settings\
executionOrder:v1\
staticData:null\
meta\
templateCredsSetupCompleted:true\
pinData:\{empty object\}\
versionId:a9805cff-7262-44ab-8fba-c14f351bf25e\
activeVersionId:null\
triggerCount:0\
shared\
0\
updatedAt:2025-12-08T15:12:07.211Z\
createdAt:2025-12-08T15:12:07.211Z\
role:workflow:owner\
workflowId:dPDoawNHAa6ocJdr\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
19\
updatedAt:2025-12-09T22:36:44.037Z\
createdAt:2025-11-23T18:11:10.643Z\
id:gkgmJNNtuTAZgcyC\
name:fonio AGS Nachbearbeitung Transkript\
active:true\
isArchived:false\
nodes\
0\
parameters\
httpMethod:POST\
path:fonio-ags-transkript\
options:\{empty object\}\
type:n8n-nodes-base.webhook\
typeVersion:2.1\
position\
0:-352\
1:-256\
id:dbb2ce2e-7047-422a-b8a2-7cd7f735f599\
name:Webhook\
webhookId:d9a56c84-3178-44a5-9d50-e8a42a1f9a00\
1\
parameters\
assignments\
assignments\
0\
id:011ef203-63fd-49f7-ae0d-4ed7318ad11f\
name:headers.host\
value:=\{\{ $json.headers.host \}\}\
type:string\
1\
id:04f27e3e-ebed-4ae5-a22f-23d0f7c61904\
name:body[0].body.formattedTranscript\
value:=\{\{ $json.body[0].body.formattedTranscript \}\}\
type:string\
2\
id:017777fc-53d7-473d-b3c8-09a32e601385\
name:body[0].body.fromNumber\
value:=\{\{ $json.body[0].body.fromNumber \}\}\
type:string\
3\
id:882e8a05-a492-4445-bb4a-1856bfb586a1\
name:body[0].body.context.anrufer_name\
value:=\{\{ $json.body[0].body.context.anrufer_name \}\}\
type:string\
4\
id:a6508b49-d751-49d7-b40c-c91be52f5839\
name:body[0].body.context.einrichtung_typ\
value:=\{\{ $json.body[0].body.context.einrichtung_typ \}\}\
type:string\
5\
id:08190377-3019-449b-9374-494e642c5125\
name:body[0].body.context.einrichtung_name\
value:=\{\{ $json.body[0].body.context.einrichtung_name \}\}\
type:string\
6\
id:58740a6d-b29d-48ca-b2a3-fc14e3dedaeb\
name:body[0].body.context.technisch\
value:=\{\{ $json.body[0].body.context.technisch \}\}\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:-128\
1:-352\
id:b905e673-945d-4303-8ddb-de9c95625fc3\
name:Daten extrahieren\
2\
parameters\
promptType:define\
text:=F\'fchre die Klassifikation durch.\
hasOutputParser:true\
options\
systemMessage:=DU BIST EIN HOCHSPEZIALISIERTER KLASSIFIKATIONS-AGENT F\'dcR IT-HOTLINE-TRANSKRIPTE.\\n\\n###DEINE HAUPTAUFGABE###\\nAnalysiere Telefon-Transkripte und ordne sie pr\'e4zise in eine Dringlichkeitskategorie (A, B, C oder D) ein, basierend auf den Kriterien aus der bereitgestellten Wissensdatenbank. Deine Klassifikation erm\'f6glicht Technikern eine zielgerichtete, priorisierte Bearbeitung.\\n\\n---\\n\\n###VERF\'dcGBARE DATEN###\\n\\n**DRINGLICHKEITSKRITERIEN (aus Google Sheet):**\\n\{\{ $('Dringlichkeitskriterien laden').all().slice(1).map(item =>\\n`Kategorie $\{item.json.Dringlichkeit\}: $\{item.json.Kategorie\}\\nSchl\'fcsselworte: $\{item.json.Schlagworte\}\\nBeispiele: $\{item.json.Beispiele\}`\\n).join('\\n\\n') \}\}\\n\\n**ZU ANALYSIERENDES TRANSKRIPT:**\\n\{\{ $json.anonymizedText \}\}\\n\\n---\\n\\n###ANALYSE-METHODIK (CHAIN OF THOUGHTS)###\\n\\n1. **UNDERSTAND**\\n   - Lies das Transkript gr\'fcndlich und identifiziere das konkrete technische Problem\\n   - Erkenne die Auswirkungen: Produktivit\'e4tsausfall, Datenverlust, Eskalation, Gesch\'e4ftskritikalit\'e4t\\n\\n2. **IDENTIFY KEY SIGNALS**\\n   - Schl\'fcsselbegriffe f\'fcr hohe Dringlichkeit: "nicht arbeitsf\'e4hig", "Produktion steht", "Kunde wartet", "dringend", "sofort"\\n   - Schl\'fcsselbegriffe f\'fcr niedrige Dringlichkeit: "nicht eilig", "wenn Zeit ist", "Informationsfrage", "optional"\\n\\n3. **ASSESS IMPACT**\\n   - Ist ein gesch\'e4ftskritischer Prozess blockiert?\\n   - Sind mehrere Nutzer betroffen?\\n   - Gibt es Fristen oder SLA-relevante Zeitpunkte?\\n   - Handelt es sich um einen Standardvorgang oder eine Informationsanfrage?\\n\\n4. **MATCH WITH CRITERIA**\\n   - Vergleiche die erkannten Merkmale mit den Referenzbeispielen aus dem Google Sheet\\n   - W\'e4hle die Kategorie, die der Fallbeschreibung AM N\'c4CHSTEN kommt\\n\\n5. **HANDLE EDGE CASES**\\n   - Bei unklaren oder widerspr\'fcchlichen Transkripten: W\'e4hle die konservativere (h\'f6here) Kategorie\\n   - Weise explizit auf Unsicherheiten hin\\n\\n---\\n\\n###AUSGABEFORMAT###\\n\\n***WICHTIGER HINWEIS ZUR DATENSCHUTZ-KONFORMIT\'c4T***\\nDer Text enth\'e4lt anonymisierte Platzhalter wie [PERSON_1], [PERSON_2].\\nWenn du Namen extrahierst (z.B. f\'fcr "AnsprechpartnerName" oder in der "Beschreibung"),\\nNUTZE AUSSCHLIESSLICH DIESE PLATZHALTER.\\nWandle sie NICHT um und erfinde keine Namen.\\nBeispiel korrekt: "AnsprechpartnerName": "[PERSON_2]"\\n\\nGib deine Analyse im folgenden JSON-Format zur\'fcck:\\n```json\\n\{\\n  "Dringlichkeit": "B",\\n  "Kategorie": "Dringend",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Server-Ausfall",\\n  "Beschreibung": [\\n    "Mehrere Mitarbeiter betroffen (Buchhaltung)",\\n    "Datenbankverbindung unterbrochen seit 8 Uhr",\\n    "Fehlende Rechnungen der letzten 2 Wochen",\\n    "Zeitkritisch: Jahresabschluss-Termin in 2 Stunden"\\n  ],\\n  "AnsprechpartnerBleibt": true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\\n  "AnsprechpartnerName": "Frau Weber",\\n  "RueckrufnummerAnders": true = andere R\'fcckrufnummer gew\'fcnscht, false = unter anrufender Nummer zur\'fcckrufen\\n  "Rueckrufnummer": Die vom Anrufer genannte R\'fcckrufnummer (mit Durchwahl falls vorhanden)\\n  "Begr\'fcndung": "Der Kunde ist grunds\'e4tzlich arbeitsf\'e4hig, jedoch blockiert ein IT-Fehler einen zeitkritischen Gesch\'e4ftsprozess. Entspricht den Beispielen f\'fcr Kategorie B im Sheet."\\n\}\\n```\\n\\n**WICHTIG: Feldbeschreibungen** \\n- Die Dringlichkeit MUSS ein einzelner Buchstabe sein: A, B, C oder D, entsprechend der M\'f6glichkeiten im Google Sheet\\n- Die Kategorie MUSS sich auf die entsprechende Spalte im Google Sheet beziehen\\n- Problemtyp: Klassifiziere in GENAU EINE dieser Kategorien:\\n  \'95 "Technisch" = Hardware-Probleme, Netzwerkausf\'e4lle, Ger\'e4tedefekte, Server-Ausf\'e4lle\\n  \'95 "Software" = Programmfehler, Anmeldeprobleme, Softwarest\'f6rungen, Datenbankprobleme\\n  \'95 "Anliegen" = Informationsanfragen, Beratung, allgemeine Fragen ohne akutes technisches Problem\\n- Themenstichwort: Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z. B. "SAP-Login", "E-Mail-Sync", "Drucker-WLAN")\\n- Beschreibung: Array mit 3-6 Stichpunkten, die wichtigsten Informationen zuerst:\\n  \'95 Betroffene Personen/Systeme\\n  \'95 Zeitpunkt des Auftretens\\n  \'95 Konkrete Symptome/Fehler\\n  \'95 Gesch\'e4ftliche Auswirkungen\\n  \'95 Fristen/Zeitdruck\\n  \'95 Bereits versuchte L\'f6sungen\\n- AnsprechpartnerBleibt: true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\\n- AnsprechpartnerName: Name des Ansprechpartners (falls abweichend vom Anrufer, sonst leer lassen)\\n- AnsprechpartnerTelefon: Telefonnummer des Ansprechpartners (falls abweichend, sonst leer lassen)\\n- RueckrufnummerAnders: true = andere R\'fcckrufnummer als anrufende Nummer, false = unter anrufender Nummer zur\'fcckrufen\\n- Rueckrufnummer: Die R\'fcckrufnummer (kann identisch mit AnsprechpartnerTelefon sein)\\n- Die Begr\'fcndung MUSS sich auf die Kriterien im Google Sheet beziehen\\n- Halte dich strikt an das JSON-Format\\n\\n---\\n\\n###WAS NICHT ZU TUN IST###\\n\\nNIEMALS Kategorien ohne Bezug zum Google Sheet festlegen\\nVERMEIDE vage Begr\'fcndungen wie "klingt dringend" oder "scheint wichtig"\\nNICHT nur nach einzelnen Schl\'fcsselworten klassifizieren \'96 analysiere die Gesamtsituation\\nNIEMALS Aussagen erfinden, die nicht im Transkript stehen\\nNICHT \'fcberkategorisieren: Unzufriedenheit allein rechtfertigt keine Kategorie A\\nIGNORIERE NIEMALS Hinweise auf Systemrelevanz, Produktionsstopp oder gesch\'e4ftskritische Prozesse\\n\\n---\\n\\n###FEW-SHOT BEISPIELE###\\n\\n**Beispiel 1 - Kategorie A:**\\nTranskript: "Ich kann mich nicht mehr in SAP anmelden, wir m\'fcssen heute unbedingt die Monatsabrechnung machen."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "A",\\n  "Kategorie": "Notfall",\\n  "Problemtyp": "Software",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Gesch\'e4ftskritischer Prozess (Monatsabrechnung) ist komplett blockiert. Entspricht den Referenzf\'e4llen f\'fcr Kategorie A im Sheet."\\n\}\\n```\\n\\n**Beispiel 2 - Kategorie D:**\\nTranskript: "Ich wollte nur fragen, ob man den Drucker auch \'fcber WLAN verbinden kann \'96 ist aber nicht eilig."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "D",\\n  "Kategorie": "Informativ",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Informationsanfrage ohne Zeitdruck, kein akuter Vorfall. Entspricht klar Kategorie D im Sheet."\\n\}\\n```\\n\\n**Beispiel 3 - Kategorie B:**\\nTranskript: "Mein Outlook synchronisiert nicht mehr. Ich kann arbeiten, aber wichtige E-Mails von Kunden kommen nicht an."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "B",\\n  "Kategorie": "Dringend",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Eingeschr\'e4nkte Arbeitsf\'e4higkeit bei einem wichtigen Kommunikationskanal. Keine komplette Blockade, aber gesch\'e4ftsrelevant. Entspricht Kategorie B."\\n\}\\n```\
type:@n8n/n8n-nodes-langchain.agent\
typeVersion:3\
position\
0:1168\
1:-256\
id:0aeac5e6-c9be-4642-9858-9cf4394bc907\
name:AI Agent\
executeOnce:true\
3\
parameters\
model\
__rl:true\
value:claude-3-5-haiku-20241022\
mode:list\
cachedResultName:Claude Haiku 3.5\
options:\{empty object\}\
type:@n8n/n8n-nodes-langchain.lmChatAnthropic\
typeVersion:1.3\
position\
0:1240\
1:-32\
id:b72b4dd9-4588-4dc0-996c-834b03ded117\
name:Anthropic Chat Model\
credentials\
anthropicApi\
id:6RlfJdXsmselCNpN\
name:Anthropic account 2\
4\
parameters\
authentication:serviceAccount\
documentId\
__rl:true\
value:1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw\
mode:id\
sheetName\
__rl:true\
value:gid=0\
mode:list\
cachedResultName:Dringlichkeiten\
cachedResultUrl:https://docs.google.com/spreadsheets/d/1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw/edit#gid=0\
options:\{empty object\}\
type:n8n-nodes-base.googleSheets\
typeVersion:4.7\
position\
0:-128\
1:-160\
id:81634710-edda-4819-b56f-ba9fe6669b9b\
name:Dringlichkeitskriterien laden\
credentials\
googleApi\
id:vRVq7GTwn9kTIi8N\
name:Google Sheets account 2\
5\
parameters:\{empty object\}\
type:n8n-nodes-base.merge\
typeVersion:3.2\
position\
0:96\
1:-256\
id:6f7d2c27-b551-43ff-b5b9-39c8e7048df2\
name:Merge\
6\
parameters\
assignments\
assignments\
0\
id:9cac8552-e981-44e5-bfc7-854012461c3f\
name:subject\
value:=\{\{ $json.Kategorie \}\} | \{\{ $('Daten extrahieren').first().json.body[0].body.context.einrichtung_name \}\}, \{\{ $('Daten extrahieren').first().json.body[0].body.context.anrufer_name \}\} | \{\{ $json.Themenstichwort \}\}\
type:string\
1\
id:988dd2a7-83ea-48b9-9e7e-bcc66745c72c\
name:htmlBody\
value:=<h3>Problemtyp: \{\{ $json.Problemtyp \}\}</h3>\\n\\n<h4>KI-Einsch\'e4tzung</h4>\\n<p>\\n  <b>Einrichtung:</b> \{\{ $('Daten extrahieren').first().json.body[0].body.context.einrichtung_typ \}\}<br>\\n  <b>Anrufer:</b> \{\{ $('Daten extrahieren').first().json.body[0].body.context.anrufer_name \}\} (\{\{ $('Daten extrahieren').first().json.body[0].body.fromNumber \}\})<br>\\n  <b>Ansprechpartner:</b> \{\{ $json.AnsprechpartnerName ? $json.AnsprechpartnerName : "Wie Anrufer" \}\}<br>\\n  <b>R\'fcckrufnummer:</b> \{\{ $json.Rueckrufnummer ? $json.Rueckrufnummer : $('Daten extrahieren').first().json.body[0].body.fromNumber \}\}<br>\\n  <b>Thema:</b> \{\{ $json.Themenstichwort \}\}\\n</p>\\n\\n<b>Beschreibung:</b>\\n<ul>\\n\{\{ $json.Beschreibung.map(item => `<li>$\{item\}</li>`).join('') \}\}\\n</ul>\\n\\n<b>Begr\'fcndung der Dringlichkeitseinstufung:</b>\\n<p>\{\{ $json.Begr\'fcndung \}\}</p>\\n\\n<hr>\\n\\n<h4>Vollst\'e4ndiges Transkript</h4>\\n<p style="white-space: pre-wrap; color: #555;">\\n\{\{ $('Azure Request Vorbereitung').first().json.messages[1].content \}\}\\n</p>\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:1744\
1:-256\
id:1f135291-aa87-4abe-a14d-abd42f414692\
name:E-Mail vorbereiten\
7\
parameters\
fromEmail:helpdesk@ags-it.de\
toEmail:helpdesk@ags-it.de\
subject:=\{\{ $json.subject \}\}\
html:=\{\{ $json.htmlBody \}\}\
options:\{empty object\}\
type:n8n-nodes-base.emailSend\
typeVersion:2.1\
position\
0:1968\
1:-256\
id:0cd6a345-9aa5-4152-9155-46ba19a4474e\
name:Send email\
webhookId:32ae0708-d567-42b3-a2e8-987354d3ea61\
credentials\
smtp\
id:8O5B5z4vS8yeagJh\
name:SMTP account\
8\
parameters\
operation:sanitize\
text:=\{\{ $('Merge').item.json.body[0].body.formattedTranscript \}\}\
guardrails\
pii\
value\
type:selected\
entities\
0:EMAIL_ADDRESS\
1:PHONE_NUMBER\
2:IP_ADDRESS\
3:LOCATION\
type:@n8n/n8n-nodes-langchain.guardrails\
typeVersion:1\
position\
0:320\
1:-256\
id:278b33d4-0e5b-4441-8a6e-327b66660ab8\
name:Daten anonymisieren\
9\
parameters\
jsCode:// 1. Zugriff auf die Antwort des AI Agents\\nlet agentOutput = $input.item.json.output || $input.item.json.text || "";\\n\\n// Wir machen sicherheitshalber einen String daraus\\nif (typeof agentOutput === 'object') \{\\n  agentOutput = JSON.stringify(agentOutput);\\n\}\\n\\n// 2. Das Mapping holen (exakter Name der Node davor ist wichtig!)\\nconst mappingData = $('Azure Response Verarbeitung').first();\\nconst nameMapping = mappingData.json.nameMapping || [];\\n\\n// 3. Re-Personalisierung durchf\'fchren (Suchen & Ersetzen im Rohtext)\\n// Wir machen das VOR dem JSON-Parsing, damit auch Namen in Strings ersetzt werden.\\nlet processedText = agentOutput;\\n\\nfor (const item of nameMapping) \{\\n  // Ersetze [PERSON_X] durch den echten Namen (global)\\n  // Wir escapen die Klammern f\'fcr den Regex\\n  const placeholderRegex = new RegExp(item.placeholder.replace(/\\[/g, '\\\\[').replace(/\\]/g, '\\\\]'), 'g');\\n  processedText = processedText.replace(placeholderRegex, item.original);\\n\}\\n\\n// 4. JSON Extrahieren (Der "Gespr\'e4chigkeit"-Filter)\\n// Wir suchen den Bereich zwischen der ersten '\{' und der letzten '\}'\\nconst firstBracket = processedText.indexOf('\{');\\nconst lastBracket = processedText.lastIndexOf('\}');\\n\\nif (firstBracket !== -1 && lastBracket !== -1) \{\\n  // Schneide alles vor der ersten Klammer und nach der letzten Klammer weg\\n  const jsonString = processedText.substring(firstBracket, lastBracket + 1);\\n  \\n  try \{\\n    const finalObject = JSON.parse(jsonString);\\n    return finalObject; // Gib das saubere Objekt zur\'fcck\\n  \} catch (e) \{\\n    return \{ error: "JSON war trotz Filterung ung\'fcltig", raw: processedText \};\\n  \}\\n\} else \{\\n  // Fallback, falls gar keine Klammern gefunden wurden\\n  return \{ error: "Kein JSON im Antworttext gefunden", raw: processedText \};\\n\}\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1520\
1:-256\
id:830134ee-1845-49cc-9d3d-933ee1e989e8\
name:Re-Personalisierung\
10\
parameters\
method:POST\
url:https://berent-ki.services.ai.azure.com/models/chat/completions?api-version=2024-05-01-preview\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
contentType:=json\
specifyBody:json\
bodyParameters\
parameters\
0:\{empty object\}\
jsonBody:=\{\{ $json \}\}\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.3\
position\
0:768\
1:-256\
id:cbc2d314-649e-4214-8bac-a48859f4bb6a\
name:Namen-Anonymisierung (Azure)\
retryOnFail:true\
waitBetweenTries:5000\
maxTries:5\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:Header Auth account\
httpBearerAuth\
id:24SORzPv91ZRH2UW\
name:Bearer Auth account\
11\
parameters\
jsCode:// Wir greifen auf die Antwort der Azure-Node zu\\nconst response = $input.item.json;\\n\\n// Sicherstellen, dass wir eine Antwort haben\\nif (response.choices && response.choices[0] && response.choices[0].message) \{\\n  \\n  // Den Textinhalt holen\\n  let content = response.choices[0].message.content;\\n  \\n  // Oft sendet die KI den Text in Markdown-Bl\'f6cken (```json ... ```).\\n  // Diese entfernen wir hier, damit das JSON sauber ist.\\n  content = content.replace(/^```json\\s*/, "").replace(/\\s*```$/, "");\\n  \\n  try \{\\n    // Den Textstring in ein echtes JSON-Objekt umwandeln\\n    const parsedData = JSON.parse(content);\\n    \\n    // Das saubere Ergebnis zur\'fcckgeben\\n    return parsedData;\\n    \\n  \} catch (error) \{\\n    // Falls die KI kein g\'fcltiges JSON geschickt hat, geben wir den Rohtext zur\'fcck\\n    return \{\\n      error: "Konnte JSON nicht parsen",\\n      rawContent: content\\n    \};\\n  \}\\n\} else \{\\n  return \{ error: "Keine g\'fcltige Antwort von Azure erhalten" \};\\n\}\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:992\
1:-256\
id:2bcc7acd-bd58-4a14-8ceb-0b35bb0c24cc\
name:Azure Response Verarbeitung\
12\
parameters\
mode:runOnceForEachItem\
jsCode:// Daten aus der vorherigen Node holen\\n// Fallback auf leeren String, falls keine Daten da sind\\nconst transcript = $input.item.json.guardrailsInput || $input.item.json.output || "";\\n\\nconst systemPrompt = `Du bist ein Spezialist f\'fcr die Anonymisierung von Personennamen in deutschen Telefon-Transkripten.\\n\\n###DEINE AUFGABE###\\nErkenne alle Personennamen (Vornamen und Nachnamen) im gegebenen Text und ersetze sie durch nummerierte Platzhalter im Format [PERSON_1], [PERSON_2], [PERSON_3] etc.\\n\\n###REGELN###\\n1. Erkenne nur echte Personennamen (z.B. Thomas, Anna, M\'fcller, Schmidt)\\n2. Ignoriere Titel wie 'Herr', 'Frau', 'Dr.' - diese bleiben unver\'e4ndert\\n3. Ersetze jeden gefundenen Namen durch einen eindeutigen Platzhalter [PERSON_N]\\n4. Gleiche Namen im Text erhalten den gleichen Platzhalter (z.B. 'Thomas' wird immer zu [PERSON_1])\\n5. Verschiedene Namen erhalten verschiedene Platzhalter (z.B. 'Thomas' \uc0\u8594  [PERSON_1], 'Anna' \u8594  [PERSON_2])\\n6. Behalte die urspr\'fcngliche Formatierung bei (Zeilenumbr\'fcche, Interpunktion)\\n\\n###AUSGABEFORMAT###\\nGib dein Ergebnis im folgenden JSON-Format zur\'fcck:\\n\\`\\`\\`json\\n\{\\n  "anonymizedText": "Der anonymisierte Text mit [PERSON_1], [PERSON_2] etc.",\\n  "nameMapping": [\\n    \{"original": "Thomas", "placeholder": "[PERSON_1]"\},\\n    \{"original": "Anna", "placeholder": "[PERSON_2]"\}\\n  ]\\n\}\\n\\`\\`\\``;\\n\\n// Das fertige Payload-Objekt zur\'fcckgeben\\nreturn \{\\n  model: "mistral-namen-anonymisierung",\\n  messages: [\\n    \{\\n      role: "system",\\n      content: systemPrompt\\n    \},\\n    \{\\n      role: "user",\\n      content: transcript\\n    \}\\n  ],\\n  temperature: 0.1,\\n  max_tokens: 1000\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:544\
1:-256\
id:89b4ab5b-743d-419c-9908-00cd492681b2\
name:Azure Request Vorbereitung\
connections\
Webhook\
main\
0\
0\
node:Daten extrahieren\
type:main\
index:0\
1\
node:Dringlichkeitskriterien laden\
type:main\
index:0\
Daten extrahieren\
main\
0\
0\
node:Merge\
type:main\
index:0\
Anthropic Chat Model\
ai_languageModel\
0\
0\
node:AI Agent\
type:ai_languageModel\
index:0\
Dringlichkeitskriterien laden\
main\
0\
0\
node:Merge\
type:main\
index:1\
Merge\
main\
0\
0\
node:Daten anonymisieren\
type:main\
index:0\
AI Agent\
main\
0\
0\
node:Re-Personalisierung\
type:main\
index:0\
E-Mail vorbereiten\
main\
0\
0\
node:Send email\
type:main\
index:0\
Daten anonymisieren\
main\
0\
0\
node:Azure Request Vorbereitung\
type:main\
index:0\
Re-Personalisierung\
main\
0\
0\
node:E-Mail vorbereiten\
type:main\
index:0\
Namen-Anonymisierung (Azure)\
main\
0\
0\
node:Azure Response Verarbeitung\
type:main\
index:0\
Azure Response Verarbeitung\
main\
0\
0\
node:AI Agent\
type:main\
index:0\
Azure Request Vorbereitung\
main\
0\
0\
node:Namen-Anonymisierung (Azure)\
type:main\
index:0\
settings\
executionOrder:v1\
timeSavedMode:fixed\
callerPolicy:workflowsFromSameOwner\
availableInMCP:false\
staticData:null\
meta\
templateCredsSetupCompleted:true\
pinData:\{empty object\}\
versionId:3bdcedd3-d45f-4f85-b22c-7a6da3504ff0\
activeVersionId:3bdcedd3-d45f-4f85-b22c-7a6da3504ff0\
triggerCount:1\
shared\
0\
updatedAt:2025-11-23T18:11:10.645Z\
createdAt:2025-11-23T18:11:10.645Z\
role:workflow:owner\
workflowId:gkgmJNNtuTAZgcyC\
projectId:yr4Hj71ou1NOsi2p\
activeVersion\
updatedAt:2025-12-09T22:36:44.038Z\
createdAt:2025-12-09T22:36:44.038Z\
versionId:3bdcedd3-d45f-4f85-b22c-7a6da3504ff0\
workflowId:gkgmJNNtuTAZgcyC\
nodes\
0\
parameters\
httpMethod:POST\
path:fonio-ags-transkript\
options:\{empty object\}\
type:n8n-nodes-base.webhook\
typeVersion:2.1\
position\
0:-352\
1:-256\
id:dbb2ce2e-7047-422a-b8a2-7cd7f735f599\
name:Webhook\
webhookId:d9a56c84-3178-44a5-9d50-e8a42a1f9a00\
1\
parameters\
assignments\
assignments\
0\
id:011ef203-63fd-49f7-ae0d-4ed7318ad11f\
name:headers.host\
value:=\{\{ $json.headers.host \}\}\
type:string\
1\
id:04f27e3e-ebed-4ae5-a22f-23d0f7c61904\
name:body[0].body.formattedTranscript\
value:=\{\{ $json.body[0].body.formattedTranscript \}\}\
type:string\
2\
id:017777fc-53d7-473d-b3c8-09a32e601385\
name:body[0].body.fromNumber\
value:=\{\{ $json.body[0].body.fromNumber \}\}\
type:string\
3\
id:882e8a05-a492-4445-bb4a-1856bfb586a1\
name:body[0].body.context.anrufer_name\
value:=\{\{ $json.body[0].body.context.anrufer_name \}\}\
type:string\
4\
id:a6508b49-d751-49d7-b40c-c91be52f5839\
name:body[0].body.context.einrichtung_typ\
value:=\{\{ $json.body[0].body.context.einrichtung_typ \}\}\
type:string\
5\
id:08190377-3019-449b-9374-494e642c5125\
name:body[0].body.context.einrichtung_name\
value:=\{\{ $json.body[0].body.context.einrichtung_name \}\}\
type:string\
6\
id:58740a6d-b29d-48ca-b2a3-fc14e3dedaeb\
name:body[0].body.context.technisch\
value:=\{\{ $json.body[0].body.context.technisch \}\}\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:-128\
1:-352\
id:b905e673-945d-4303-8ddb-de9c95625fc3\
name:Daten extrahieren\
2\
parameters\
promptType:define\
text:=F\'fchre die Klassifikation durch.\
hasOutputParser:true\
options\
systemMessage:=DU BIST EIN HOCHSPEZIALISIERTER KLASSIFIKATIONS-AGENT F\'dcR IT-HOTLINE-TRANSKRIPTE.\\n\\n###DEINE HAUPTAUFGABE###\\nAnalysiere Telefon-Transkripte und ordne sie pr\'e4zise in eine Dringlichkeitskategorie (A, B, C oder D) ein, basierend auf den Kriterien aus der bereitgestellten Wissensdatenbank. Deine Klassifikation erm\'f6glicht Technikern eine zielgerichtete, priorisierte Bearbeitung.\\n\\n---\\n\\n###VERF\'dcGBARE DATEN###\\n\\n**DRINGLICHKEITSKRITERIEN (aus Google Sheet):**\\n\{\{ $('Dringlichkeitskriterien laden').all().slice(1).map(item =>\\n`Kategorie $\{item.json.Dringlichkeit\}: $\{item.json.Kategorie\}\\nSchl\'fcsselworte: $\{item.json.Schlagworte\}\\nBeispiele: $\{item.json.Beispiele\}`\\n).join('\\n\\n') \}\}\\n\\n**ZU ANALYSIERENDES TRANSKRIPT:**\\n\{\{ $json.anonymizedText \}\}\\n\\n---\\n\\n###ANALYSE-METHODIK (CHAIN OF THOUGHTS)###\\n\\n1. **UNDERSTAND**\\n   - Lies das Transkript gr\'fcndlich und identifiziere das konkrete technische Problem\\n   - Erkenne die Auswirkungen: Produktivit\'e4tsausfall, Datenverlust, Eskalation, Gesch\'e4ftskritikalit\'e4t\\n\\n2. **IDENTIFY KEY SIGNALS**\\n   - Schl\'fcsselbegriffe f\'fcr hohe Dringlichkeit: "nicht arbeitsf\'e4hig", "Produktion steht", "Kunde wartet", "dringend", "sofort"\\n   - Schl\'fcsselbegriffe f\'fcr niedrige Dringlichkeit: "nicht eilig", "wenn Zeit ist", "Informationsfrage", "optional"\\n\\n3. **ASSESS IMPACT**\\n   - Ist ein gesch\'e4ftskritischer Prozess blockiert?\\n   - Sind mehrere Nutzer betroffen?\\n   - Gibt es Fristen oder SLA-relevante Zeitpunkte?\\n   - Handelt es sich um einen Standardvorgang oder eine Informationsanfrage?\\n\\n4. **MATCH WITH CRITERIA**\\n   - Vergleiche die erkannten Merkmale mit den Referenzbeispielen aus dem Google Sheet\\n   - W\'e4hle die Kategorie, die der Fallbeschreibung AM N\'c4CHSTEN kommt\\n\\n5. **HANDLE EDGE CASES**\\n   - Bei unklaren oder widerspr\'fcchlichen Transkripten: W\'e4hle die konservativere (h\'f6here) Kategorie\\n   - Weise explizit auf Unsicherheiten hin\\n\\n---\\n\\n###AUSGABEFORMAT###\\n\\n***WICHTIGER HINWEIS ZUR DATENSCHUTZ-KONFORMIT\'c4T***\\nDer Text enth\'e4lt anonymisierte Platzhalter wie [PERSON_1], [PERSON_2].\\nWenn du Namen extrahierst (z.B. f\'fcr "AnsprechpartnerName" oder in der "Beschreibung"),\\nNUTZE AUSSCHLIESSLICH DIESE PLATZHALTER.\\nWandle sie NICHT um und erfinde keine Namen.\\nBeispiel korrekt: "AnsprechpartnerName": "[PERSON_2]"\\n\\nGib deine Analyse im folgenden JSON-Format zur\'fcck:\\n```json\\n\{\\n  "Dringlichkeit": "B",\\n  "Kategorie": "Dringend",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Server-Ausfall",\\n  "Beschreibung": [\\n    "Mehrere Mitarbeiter betroffen (Buchhaltung)",\\n    "Datenbankverbindung unterbrochen seit 8 Uhr",\\n    "Fehlende Rechnungen der letzten 2 Wochen",\\n    "Zeitkritisch: Jahresabschluss-Termin in 2 Stunden"\\n  ],\\n  "AnsprechpartnerBleibt": true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\\n  "AnsprechpartnerName": "Frau Weber",\\n  "RueckrufnummerAnders": true = andere R\'fcckrufnummer gew\'fcnscht, false = unter anrufender Nummer zur\'fcckrufen\\n  "Rueckrufnummer": Die vom Anrufer genannte R\'fcckrufnummer (mit Durchwahl falls vorhanden)\\n  "Begr\'fcndung": "Der Kunde ist grunds\'e4tzlich arbeitsf\'e4hig, jedoch blockiert ein IT-Fehler einen zeitkritischen Gesch\'e4ftsprozess. Entspricht den Beispielen f\'fcr Kategorie B im Sheet."\\n\}\\n```\\n\\n**WICHTIG: Feldbeschreibungen** \\n- Die Dringlichkeit MUSS ein einzelner Buchstabe sein: A, B, C oder D, entsprechend der M\'f6glichkeiten im Google Sheet\\n- Die Kategorie MUSS sich auf die entsprechende Spalte im Google Sheet beziehen\\n- Problemtyp: Klassifiziere in GENAU EINE dieser Kategorien:\\n  \'95 "Technisch" = Hardware-Probleme, Netzwerkausf\'e4lle, Ger\'e4tedefekte, Server-Ausf\'e4lle\\n  \'95 "Software" = Programmfehler, Anmeldeprobleme, Softwarest\'f6rungen, Datenbankprobleme\\n  \'95 "Anliegen" = Informationsanfragen, Beratung, allgemeine Fragen ohne akutes technisches Problem\\n- Themenstichwort: Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z. B. "SAP-Login", "E-Mail-Sync", "Drucker-WLAN")\\n- Beschreibung: Array mit 3-6 Stichpunkten, die wichtigsten Informationen zuerst:\\n  \'95 Betroffene Personen/Systeme\\n  \'95 Zeitpunkt des Auftretens\\n  \'95 Konkrete Symptome/Fehler\\n  \'95 Gesch\'e4ftliche Auswirkungen\\n  \'95 Fristen/Zeitdruck\\n  \'95 Bereits versuchte L\'f6sungen\\n- AnsprechpartnerBleibt: true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\\n- AnsprechpartnerName: Name des Ansprechpartners (falls abweichend vom Anrufer, sonst leer lassen)\\n- AnsprechpartnerTelefon: Telefonnummer des Ansprechpartners (falls abweichend, sonst leer lassen)\\n- RueckrufnummerAnders: true = andere R\'fcckrufnummer als anrufende Nummer, false = unter anrufender Nummer zur\'fcckrufen\\n- Rueckrufnummer: Die R\'fcckrufnummer (kann identisch mit AnsprechpartnerTelefon sein)\\n- Die Begr\'fcndung MUSS sich auf die Kriterien im Google Sheet beziehen\\n- Halte dich strikt an das JSON-Format\\n\\n---\\n\\n###WAS NICHT ZU TUN IST###\\n\\nNIEMALS Kategorien ohne Bezug zum Google Sheet festlegen\\nVERMEIDE vage Begr\'fcndungen wie "klingt dringend" oder "scheint wichtig"\\nNICHT nur nach einzelnen Schl\'fcsselworten klassifizieren \'96 analysiere die Gesamtsituation\\nNIEMALS Aussagen erfinden, die nicht im Transkript stehen\\nNICHT \'fcberkategorisieren: Unzufriedenheit allein rechtfertigt keine Kategorie A\\nIGNORIERE NIEMALS Hinweise auf Systemrelevanz, Produktionsstopp oder gesch\'e4ftskritische Prozesse\\n\\n---\\n\\n###FEW-SHOT BEISPIELE###\\n\\n**Beispiel 1 - Kategorie A:**\\nTranskript: "Ich kann mich nicht mehr in SAP anmelden, wir m\'fcssen heute unbedingt die Monatsabrechnung machen."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "A",\\n  "Kategorie": "Notfall",\\n  "Problemtyp": "Software",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Gesch\'e4ftskritischer Prozess (Monatsabrechnung) ist komplett blockiert. Entspricht den Referenzf\'e4llen f\'fcr Kategorie A im Sheet."\\n\}\\n```\\n\\n**Beispiel 2 - Kategorie D:**\\nTranskript: "Ich wollte nur fragen, ob man den Drucker auch \'fcber WLAN verbinden kann \'96 ist aber nicht eilig."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "D",\\n  "Kategorie": "Informativ",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Informationsanfrage ohne Zeitdruck, kein akuter Vorfall. Entspricht klar Kategorie D im Sheet."\\n\}\\n```\\n\\n**Beispiel 3 - Kategorie B:**\\nTranskript: "Mein Outlook synchronisiert nicht mehr. Ich kann arbeiten, aber wichtige E-Mails von Kunden kommen nicht an."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "B",\\n  "Kategorie": "Dringend",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Eingeschr\'e4nkte Arbeitsf\'e4higkeit bei einem wichtigen Kommunikationskanal. Keine komplette Blockade, aber gesch\'e4ftsrelevant. Entspricht Kategorie B."\\n\}\\n```\
type:@n8n/n8n-nodes-langchain.agent\
typeVersion:3\
position\
0:1168\
1:-256\
id:0aeac5e6-c9be-4642-9858-9cf4394bc907\
name:AI Agent\
executeOnce:true\
3\
parameters\
model\
__rl:true\
value:claude-3-5-haiku-20241022\
mode:list\
cachedResultName:Claude Haiku 3.5\
options:\{empty object\}\
type:@n8n/n8n-nodes-langchain.lmChatAnthropic\
typeVersion:1.3\
position\
0:1240\
1:-32\
id:b72b4dd9-4588-4dc0-996c-834b03ded117\
name:Anthropic Chat Model\
credentials\
anthropicApi\
id:6RlfJdXsmselCNpN\
name:Anthropic account 2\
4\
parameters\
authentication:serviceAccount\
documentId\
__rl:true\
value:1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw\
mode:id\
sheetName\
__rl:true\
value:gid=0\
mode:list\
cachedResultName:Dringlichkeiten\
cachedResultUrl:https://docs.google.com/spreadsheets/d/1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw/edit#gid=0\
options:\{empty object\}\
type:n8n-nodes-base.googleSheets\
typeVersion:4.7\
position\
0:-128\
1:-160\
id:81634710-edda-4819-b56f-ba9fe6669b9b\
name:Dringlichkeitskriterien laden\
credentials\
googleApi\
id:vRVq7GTwn9kTIi8N\
name:Google Sheets account 2\
5\
parameters:\{empty object\}\
type:n8n-nodes-base.merge\
typeVersion:3.2\
position\
0:96\
1:-256\
id:6f7d2c27-b551-43ff-b5b9-39c8e7048df2\
name:Merge\
6\
parameters\
assignments\
assignments\
0\
id:9cac8552-e981-44e5-bfc7-854012461c3f\
name:subject\
value:=\{\{ $json.Kategorie \}\} | \{\{ $('Daten extrahieren').first().json.body[0].body.context.einrichtung_name \}\}, \{\{ $('Daten extrahieren').first().json.body[0].body.context.anrufer_name \}\} | \{\{ $json.Themenstichwort \}\}\
type:string\
1\
id:988dd2a7-83ea-48b9-9e7e-bcc66745c72c\
name:htmlBody\
value:=<h3>Problemtyp: \{\{ $json.Problemtyp \}\}</h3>\\n\\n<h4>KI-Einsch\'e4tzung</h4>\\n<p>\\n  <b>Einrichtung:</b> \{\{ $('Daten extrahieren').first().json.body[0].body.context.einrichtung_typ \}\}<br>\\n  <b>Anrufer:</b> \{\{ $('Daten extrahieren').first().json.body[0].body.context.anrufer_name \}\} (\{\{ $('Daten extrahieren').first().json.body[0].body.fromNumber \}\})<br>\\n  <b>Ansprechpartner:</b> \{\{ $json.AnsprechpartnerName ? $json.AnsprechpartnerName : "Wie Anrufer" \}\}<br>\\n  <b>R\'fcckrufnummer:</b> \{\{ $json.Rueckrufnummer ? $json.Rueckrufnummer : $('Daten extrahieren').first().json.body[0].body.fromNumber \}\}<br>\\n  <b>Thema:</b> \{\{ $json.Themenstichwort \}\}\\n</p>\\n\\n<b>Beschreibung:</b>\\n<ul>\\n\{\{ $json.Beschreibung.map(item => `<li>$\{item\}</li>`).join('') \}\}\\n</ul>\\n\\n<b>Begr\'fcndung der Dringlichkeitseinstufung:</b>\\n<p>\{\{ $json.Begr\'fcndung \}\}</p>\\n\\n<hr>\\n\\n<h4>Vollst\'e4ndiges Transkript</h4>\\n<p style="white-space: pre-wrap; color: #555;">\\n\{\{ $('Azure Request Vorbereitung').first().json.messages[1].content \}\}\\n</p>\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:1744\
1:-256\
id:1f135291-aa87-4abe-a14d-abd42f414692\
name:E-Mail vorbereiten\
7\
parameters\
fromEmail:helpdesk@ags-it.de\
toEmail:helpdesk@ags-it.de\
subject:=\{\{ $json.subject \}\}\
html:=\{\{ $json.htmlBody \}\}\
options:\{empty object\}\
type:n8n-nodes-base.emailSend\
typeVersion:2.1\
position\
0:1968\
1:-256\
id:0cd6a345-9aa5-4152-9155-46ba19a4474e\
name:Send email\
webhookId:32ae0708-d567-42b3-a2e8-987354d3ea61\
credentials\
smtp\
id:8O5B5z4vS8yeagJh\
name:SMTP account\
8\
parameters\
operation:sanitize\
text:=\{\{ $('Merge').item.json.body[0].body.formattedTranscript \}\}\
guardrails\
pii\
value\
type:selected\
entities\
0:EMAIL_ADDRESS\
1:PHONE_NUMBER\
2:IP_ADDRESS\
3:LOCATION\
type:@n8n/n8n-nodes-langchain.guardrails\
typeVersion:1\
position\
0:320\
1:-256\
id:278b33d4-0e5b-4441-8a6e-327b66660ab8\
name:Daten anonymisieren\
9\
parameters\
jsCode:// 1. Zugriff auf die Antwort des AI Agents\\nlet agentOutput = $input.item.json.output || $input.item.json.text || "";\\n\\n// Wir machen sicherheitshalber einen String daraus\\nif (typeof agentOutput === 'object') \{\\n  agentOutput = JSON.stringify(agentOutput);\\n\}\\n\\n// 2. Das Mapping holen (exakter Name der Node davor ist wichtig!)\\nconst mappingData = $('Azure Response Verarbeitung').first();\\nconst nameMapping = mappingData.json.nameMapping || [];\\n\\n// 3. Re-Personalisierung durchf\'fchren (Suchen & Ersetzen im Rohtext)\\n// Wir machen das VOR dem JSON-Parsing, damit auch Namen in Strings ersetzt werden.\\nlet processedText = agentOutput;\\n\\nfor (const item of nameMapping) \{\\n  // Ersetze [PERSON_X] durch den echten Namen (global)\\n  // Wir escapen die Klammern f\'fcr den Regex\\n  const placeholderRegex = new RegExp(item.placeholder.replace(/\\[/g, '\\\\[').replace(/\\]/g, '\\\\]'), 'g');\\n  processedText = processedText.replace(placeholderRegex, item.original);\\n\}\\n\\n// 4. JSON Extrahieren (Der "Gespr\'e4chigkeit"-Filter)\\n// Wir suchen den Bereich zwischen der ersten '\{' und der letzten '\}'\\nconst firstBracket = processedText.indexOf('\{');\\nconst lastBracket = processedText.lastIndexOf('\}');\\n\\nif (firstBracket !== -1 && lastBracket !== -1) \{\\n  // Schneide alles vor der ersten Klammer und nach der letzten Klammer weg\\n  const jsonString = processedText.substring(firstBracket, lastBracket + 1);\\n  \\n  try \{\\n    const finalObject = JSON.parse(jsonString);\\n    return finalObject; // Gib das saubere Objekt zur\'fcck\\n  \} catch (e) \{\\n    return \{ error: "JSON war trotz Filterung ung\'fcltig", raw: processedText \};\\n  \}\\n\} else \{\\n  // Fallback, falls gar keine Klammern gefunden wurden\\n  return \{ error: "Kein JSON im Antworttext gefunden", raw: processedText \};\\n\}\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1520\
1:-256\
id:830134ee-1845-49cc-9d3d-933ee1e989e8\
name:Re-Personalisierung\
10\
parameters\
method:POST\
url:https://berent-ki.services.ai.azure.com/models/chat/completions?api-version=2024-05-01-preview\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
contentType:=json\
specifyBody:json\
bodyParameters\
parameters\
0:\{empty object\}\
jsonBody:=\{\{ $json \}\}\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.3\
position\
0:768\
1:-256\
id:cbc2d314-649e-4214-8bac-a48859f4bb6a\
name:Namen-Anonymisierung (Azure)\
retryOnFail:true\
waitBetweenTries:5000\
maxTries:5\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:Header Auth account\
httpBearerAuth\
id:24SORzPv91ZRH2UW\
name:Bearer Auth account\
11\
parameters\
jsCode:// Wir greifen auf die Antwort der Azure-Node zu\\nconst response = $input.item.json;\\n\\n// Sicherstellen, dass wir eine Antwort haben\\nif (response.choices && response.choices[0] && response.choices[0].message) \{\\n  \\n  // Den Textinhalt holen\\n  let content = response.choices[0].message.content;\\n  \\n  // Oft sendet die KI den Text in Markdown-Bl\'f6cken (```json ... ```).\\n  // Diese entfernen wir hier, damit das JSON sauber ist.\\n  content = content.replace(/^```json\\s*/, "").replace(/\\s*```$/, "");\\n  \\n  try \{\\n    // Den Textstring in ein echtes JSON-Objekt umwandeln\\n    const parsedData = JSON.parse(content);\\n    \\n    // Das saubere Ergebnis zur\'fcckgeben\\n    return parsedData;\\n    \\n  \} catch (error) \{\\n    // Falls die KI kein g\'fcltiges JSON geschickt hat, geben wir den Rohtext zur\'fcck\\n    return \{\\n      error: "Konnte JSON nicht parsen",\\n      rawContent: content\\n    \};\\n  \}\\n\} else \{\\n  return \{ error: "Keine g\'fcltige Antwort von Azure erhalten" \};\\n\}\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:992\
1:-256\
id:2bcc7acd-bd58-4a14-8ceb-0b35bb0c24cc\
name:Azure Response Verarbeitung\
12\
parameters\
mode:runOnceForEachItem\
jsCode:// Daten aus der vorherigen Node holen\\n// Fallback auf leeren String, falls keine Daten da sind\\nconst transcript = $input.item.json.guardrailsInput || $input.item.json.output || "";\\n\\nconst systemPrompt = `Du bist ein Spezialist f\'fcr die Anonymisierung von Personennamen in deutschen Telefon-Transkripten.\\n\\n###DEINE AUFGABE###\\nErkenne alle Personennamen (Vornamen und Nachnamen) im gegebenen Text und ersetze sie durch nummerierte Platzhalter im Format [PERSON_1], [PERSON_2], [PERSON_3] etc.\\n\\n###REGELN###\\n1. Erkenne nur echte Personennamen (z.B. Thomas, Anna, M\'fcller, Schmidt)\\n2. Ignoriere Titel wie 'Herr', 'Frau', 'Dr.' - diese bleiben unver\'e4ndert\\n3. Ersetze jeden gefundenen Namen durch einen eindeutigen Platzhalter [PERSON_N]\\n4. Gleiche Namen im Text erhalten den gleichen Platzhalter (z.B. 'Thomas' wird immer zu [PERSON_1])\\n5. Verschiedene Namen erhalten verschiedene Platzhalter (z.B. 'Thomas' \uc0\u8594  [PERSON_1], 'Anna' \u8594  [PERSON_2])\\n6. Behalte die urspr\'fcngliche Formatierung bei (Zeilenumbr\'fcche, Interpunktion)\\n\\n###AUSGABEFORMAT###\\nGib dein Ergebnis im folgenden JSON-Format zur\'fcck:\\n\\`\\`\\`json\\n\{\\n  "anonymizedText": "Der anonymisierte Text mit [PERSON_1], [PERSON_2] etc.",\\n  "nameMapping": [\\n    \{"original": "Thomas", "placeholder": "[PERSON_1]"\},\\n    \{"original": "Anna", "placeholder": "[PERSON_2]"\}\\n  ]\\n\}\\n\\`\\`\\``;\\n\\n// Das fertige Payload-Objekt zur\'fcckgeben\\nreturn \{\\n  model: "mistral-namen-anonymisierung",\\n  messages: [\\n    \{\\n      role: "system",\\n      content: systemPrompt\\n    \},\\n    \{\\n      role: "user",\\n      content: transcript\\n    \}\\n  ],\\n  temperature: 0.1,\\n  max_tokens: 1000\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:544\
1:-256\
id:89b4ab5b-743d-419c-9908-00cd492681b2\
name:Azure Request Vorbereitung\
connections\
Webhook\
main\
0\
0\
node:Daten extrahieren\
type:main\
index:0\
1\
node:Dringlichkeitskriterien laden\
type:main\
index:0\
Daten extrahieren\
main\
0\
0\
node:Merge\
type:main\
index:0\
Anthropic Chat Model\
ai_languageModel\
0\
0\
node:AI Agent\
type:ai_languageModel\
index:0\
Dringlichkeitskriterien laden\
main\
0\
0\
node:Merge\
type:main\
index:1\
Merge\
main\
0\
0\
node:Daten anonymisieren\
type:main\
index:0\
AI Agent\
main\
0\
0\
node:Re-Personalisierung\
type:main\
index:0\
E-Mail vorbereiten\
main\
0\
0\
node:Send email\
type:main\
index:0\
Daten anonymisieren\
main\
0\
0\
node:Azure Request Vorbereitung\
type:main\
index:0\
Re-Personalisierung\
main\
0\
0\
node:E-Mail vorbereiten\
type:main\
index:0\
Namen-Anonymisierung (Azure)\
main\
0\
0\
node:Azure Response Verarbeitung\
type:main\
index:0\
Azure Response Verarbeitung\
main\
0\
0\
node:AI Agent\
type:main\
index:0\
Azure Request Vorbereitung\
main\
0\
0\
node:Namen-Anonymisierung (Azure)\
type:main\
index:0\
authors:Marcus Kunkel\
name:null\
description:null\
autosaved:false\
tags:[empty array]\
20\
updatedAt:2025-11-11T21:32:22.000Z\
createdAt:2025-11-06T20:35:24.122Z\
id:hR36jIx0wREZK0Bf\
name:Threema Gateway Universal - Nachrichten & Dateien\
active:false\
isArchived:false\
nodes\
0\
parameters\
httpMethod:POST\
path:threema-gateway\
responseMode:responseNode\
options:\{empty object\}\
id:146184d7-0046-4201-b43a-cb2fe8489f02\
name:Threema Gateway Webhook\
type:n8n-nodes-base.webhook\
typeVersion:1.1\
position\
0:160\
1:128\
webhookId:threema-gateway-webhook\
1\
parameters\
content:=Empfangene Webhook-Daten:\\n\{\{ JSON.stringify($json, null, 2) \}\}\
height:464\
width:465\
id:128cbbdf-bd05-4d24-a773-d42e2072cbb0\
name:Info: Webhook Daten\
type:n8n-nodes-base.stickyNote\
typeVersion:1\
position\
0:199.5\
1:-176\
2\
parameters\
jsCode:// Parse entschl\'fcsselte Threema E2E-Daten\\nconst item = $input.item.json;\\n\\n// Pr\'fcfe ob Daten bereits entschl\'fcsselt sind\\nif (item.decrypted === false) \{\\n  // Noch nicht entschl\'fcsselt - verwende rohe Daten\\n  console.log('\uc0\u9888 \u65039  Daten noch nicht entschl\'fcsselt');\\n  \\n  return \{\\n    json: \{\\n      messageId: item.messageId,\\n      from: item.from,\\n      to: item.to,\\n      messageType: 'encrypted',\\n      hasFile: false,\\n      text: '[Verschl\'fcsselte Nachricht - Entschl\'fcsselung ausstehend]',\\n      timestamp: new Date(parseInt(item.date) * 1000).toISOString(),\\n      rawData: item\\n    \}\\n  \};\\n\}\\n\\n// TODO: Nach Entschl\'fcsselung - parse die eigentliche Nachricht\\n// Hier kommt sp\'e4ter die Logik f\'fcr entschl\'fcsselte Nachrichten\\n\\nreturn \{\\n  json: \{\\n    messageId: item.messageId,\\n    from: item.from,\\n    to: item.to,\\n    messageType: item.type || 'text',\\n    hasFile: item.type === 'file' || item.type === 'image' || item.type === 'video',\\n    text: item.text || '',\\n    blobId: item.blobId || null,\\n    timestamp: new Date(parseInt(item.date) * 1000).toISOString(),\\n    rawData: item\\n  \}\\n\};\
id:de1d4b14-5517-488d-a58a-804a8561d29b\
name:Parse Webhook Daten\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:608\
1:128\
3\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
conditions\
0\
id:has-file-condition\
leftValue:=\{\{ $json.hasFile \}\}\
rightValue:true\
operator\
type:boolean\
operation:true\
singleValue:true\
combinator:and\
options:\{empty object\}\
id:50e6dcb5-b5c7-4dce-a688-6fdc9b8c6b77\
name:Hat Datei?\
type:n8n-nodes-base.if\
typeVersion:2\
position\
0:832\
1:128\
4\
parameters\
url:=https://msgapi.threema.ch/blobs/\{\{ $json.blobId \}\}\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendQuery:true\
queryParameters\
parameters\
0\
name:from\
value:=\{\{ $json.to \}\}\
options\
response\
response\
responseFormat:file\
outputPropertyName:fileData\
id:31c77f08-2bdb-4409-998b-3a70147965d7\
name:Datei herunterladen\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:1056\
1:32\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:Header Auth account\
5\
parameters\
jsCode:// Verarbeite heruntergeladene Datei\\nconst item = $input.item.json;\\n\\nreturn \{\\n  json: \{\\n    ...item,\\n    fileDownloaded: true,\\n    fileBinaryData: 'fileData',\\n    processedAt: new Date().toISOString()\\n  \},\\n  binary: $input.item.binary\\n\};\
id:5672c88c-c4af-4b0c-b293-7b7b48443dd3\
name:Datei verarbeiten\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1280\
1:32\
6\
parameters\
rules\
values\
0\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
conditions\
0\
leftValue:empty\
rightValue:empty\
operator\
type:string\
operation:equals\
combinator:and\
options:\{empty object\}\
id:f302ca58-c8db-4d8b-870e-de50ab6d662b\
name:Dateityp pr\'fcfen\
type:n8n-nodes-base.switch\
typeVersion:3\
position\
0:1504\
1:32\
7\
parameters\
assignments\
assignments\
0\
id:set-type\
name:fileCategory\
value:image\
type:string\
1\
id:set-processing\
name:readyForProcessing\
value:true\
type:boolean\
options:\{empty object\}\
id:61c8529c-78db-4874-99a3-8bae7444ddfb\
name:Als Bild markieren\
type:n8n-nodes-base.set\
typeVersion:3.3\
position\
0:1728\
1:32\
8\
parameters\
conditions\
options\
caseSensitive:false\
leftValue:empty\
typeValidation:loose\
conditions\
0\
id:is-audio\
leftValue:=\{\{ $json.mimeType \}\}\
rightValue:audio\
operator\
type:string\
operation:contains\
combinator:and\
options:\{empty object\}\
id:8c994433-c512-4ac2-82eb-0e1efe9c2b96\
name:Audio pr\'fcfen\
type:n8n-nodes-base.if\
typeVersion:2\
position\
0:1504\
1:512\
9\
parameters\
assignments\
assignments\
0\
id:set-audio-type\
name:fileCategory\
value:audio\
type:string\
1\
id:set-audio-processing\
name:readyForProcessing\
value:true\
type:boolean\
options:\{empty object\}\
id:f8555d50-6049-43be-bf42-e71de92ea56b\
name:Als Audio markieren\
type:n8n-nodes-base.set\
typeVersion:3.3\
position\
0:1728\
1:416\
10\
parameters\
assignments\
assignments\
0\
id:set-other-type\
name:fileCategory\
value:document\
type:string\
1\
id:set-other-processing\
name:readyForProcessing\
value:true\
type:boolean\
options:\{empty object\}\
id:1431379b-bde1-4503-8910-7537d0c175ed\
name:Als Dokument markieren\
type:n8n-nodes-base.set\
typeVersion:3.3\
position\
0:1728\
1:608\
11\
parameters\
assignments\
assignments\
0\
id:set-text-type\
name:messageCategory\
value:text\
type:string\
1\
id:set-text-processing\
name:readyForProcessing\
value:true\
type:boolean\
options:\{empty object\}\
id:bfb33d94-a743-4bcb-81fc-3d68c363dd87\
name:Als Text markieren\
type:n8n-nodes-base.set\
typeVersion:3.3\
position\
0:1728\
1:224\
12\
parameters\
mode:combine\
options:\{empty object\}\
id:09c1e391-3020-4d56-ad56-bb9115f5cd36\
name:Daten zusammenf\'fchren\
type:n8n-nodes-base.merge\
typeVersion:3\
position\
0:1952\
1:320\
13\
parameters\
content:=\uc0\u55356 \u57263  VERARBEITUNGSPUNKT\\n\\nHier k\'f6nnen Sie eigene Logik einf\'fcgen:\\n- Nachrichten an andere APIs senden\\n- Dateien speichern (Google Drive, Dropbox, etc.)\\n- KI-Verarbeitung (OpenAI, Claude, etc.)\\n- Datenbank-Operationen\\n- E-Mail-Benachrichtigungen\\n\\nVerf\'fcgbare Daten:\\n- $json.messageCategory / $json.fileCategory\\n- $json.text (f\'fcr Textnachrichten)\\n- $json.fileData (Binary-Daten f\'fcr Dateien)\\n- $json.from, $json.to, $json.messageId\\n- $json.fileName, $json.mimeType\
height:539\
width:393\
id:7031963c-c30d-401b-8993-3da5d280cdec\
name:Info: Verarbeitungspunkt\
type:n8n-nodes-base.stickyNote\
typeVersion:1\
position\
0:1915.5\
1:-59\
14\
parameters\
jsCode:// Beispiel: Nachrichtenverarbeitung\\n// Hier k\'f6nnen Sie eigene Logik implementieren\\n\\nconst item = $input.item.json;\\n\\n// Log f\'fcr Debugging\\nconsole.log('Verarbeite Nachricht:', \{\\n  type: item.messageCategory || item.fileCategory,\\n  from: item.from,\\n  hasFile: item.hasFile\\n\});\\n\\n// Beispiel-Verarbeitung\\nlet processing_result = \{\\n  status: 'processed',\\n  processedAt: new Date().toISOString(),\\n  summary: ''\\n\};\\n\\nif (item.text) \{\\n  processing_result.summary = `Textnachricht empfangen: $\{item.text.substring(0, 50)\}...`;\\n\} else if (item.hasFile) \{\\n  processing_result.summary = `Datei empfangen: $\{item.fileName\} ($\{item.mimeType\})`;\\n\}\\n\\nreturn \{\\n  json: \{\\n    ...item,\\n    processing: processing_result\\n  \},\\n  binary: $input.item.binary\\n\};\
id:038186a9-de04-4f92-91cc-bf8b86bfa984\
name:Nachricht verarbeiten\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:2176\
1:320\
15\
parameters\
method:POST\
url:https://msgapi.threema.ch/send_simple\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendQuery:true\
queryParameters\
parameters\
0\
name:from\
value:=\{\{ $json.to \}\}\
1\
name:to\
value:=\{\{ $json.from \}\}\
2\
name:text\
value:=\uc0\u9989  Ihre Nachricht wurde erfolgreich empfangen und verarbeitet.\\n\\nZusammenfassung: \{\{ $json.processing.summary \}\}\
options:\{empty object\}\
id:3742a5b2-8646-4984-915f-edbc837e0ef4\
name:Best\'e4tigung senden\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:2400\
1:320\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:Header Auth account\
16\
parameters\
respondWith:json\
responseBody:=\{ "status": "success", "message": "Nachricht verarbeitet", "messageId": "\{\{ $json.messageId \}\}" \}\
options:\{empty object\}\
id:7fa04e2c-4a08-45c3-bbfa-db7c9c8363da\
name:Webhook Response\
type:n8n-nodes-base.respondToWebhook\
typeVersion:1.1\
position\
0:2624\
1:320\
17\
parameters\
content:=\uc0\u55357 \u56523  WORKFLOW \'dcBERSICHT\\n\\nDieser Workflow verarbeitet alle Threema Gateway Nachrichten:\\n\\n\u9989  Unterst\'fctzte Nachrichtentypen:\\n- Text\\n- Bilder\\n- Audio-Dateien\\n- Video-Dateien\\n- Dokumente/Dateien\\n\\n\u55357 \u56615  Workflow-Schritte:\\n1. Webhook empf\'e4ngt Nachricht\\n2. Daten werden geparst\\n3. Dateien werden heruntergeladen (falls vorhanden)\\n4. Dateityp wird erkannt\\n5. Verarbeitung erfolgt\\n6. Best\'e4tigung an Sender\\n7. HTTP Response an Threema\\n\\n\u9881 \u65039  Konfiguration erforderlich:\\n- Threema Gateway API Credentials\\n- Webhook-URL in Threema konfigurieren\
height:654\
width:361\
color:5\
id:79915eb8-4426-469d-8a83-cea10faa5036\
name:Info: Workflow \'dcbersicht\
type:n8n-nodes-base.stickyNote\
typeVersion:1\
position\
0:-176\
1:0\
18\
parameters\
content:=\uc0\u9888 \u65039  FEHLERBEHANDLUNG\\n\\nBei Fehlern:\\n- Workflow f\'e4hrt fort (continueOnFail)\\n- Fehler werden geloggt\\n- Alternativer Pfad wird ausgef\'fchrt\\n\\nOptional:\\n- E-Mail-Benachrichtigung bei Fehler\\n- Logging in externe Systeme\\n- Retry-Mechanismen\
height:331\
width:289\
color:6\
id:efbc8818-593c-4200-a712-061e3ab804d1\
name:Info: Fehlerbehandlung\
type:n8n-nodes-base.stickyNote\
typeVersion:1\
position\
0:2288\
1:-128\
19\
parameters\
jsCode:// E2E-Entschl\'fcsselung f\'fcr Threema Gateway\\n// WICHTIG: Hier Deine Credentials eintragen!\\n\\nconst GATEWAY_ID = '*BERENT2';\\nconst GATEWAY_SECRET = 'DEIN_SECRET_HIER_EINTRAGEN'; // Kommt nach Freigabe\\nconst PRIVATE_KEY = 'DEIN_64_ZEICHEN_PRIVATE_KEY_HIER'; // Aus dem Generator-Tool\\n\\n// Importiere crypto f\'fcr Entschl\'fcsselung\\nconst crypto = require('crypto');\\nconst nacl = require('tweetnacl');\\n\\n// Hole Webhook-Daten\\nconst webhookData = $input.item.json;\\n\\n// Extrahiere verschl\'fcsselte Box und Nonce\\nconst from = webhookData.from;\\nconst to = webhookData.to;\\nconst messageId = webhookData.messageId;\\nconst date = webhookData.date;\\nconst nonce = webhookData.nonce; // 24 Bytes, hex-encoded\\nconst box = webhookData.box; // Verschl\'fcsselte Nachricht, hex-encoded\\n\\n// Konvertiere Hex zu Uint8Array\\nfunction hexToUint8Array(hex) \{\\n  const bytes = new Uint8Array(hex.length / 2);\\n  for (let i = 0; i < hex.length; i += 2) \{\\n    bytes[i / 2] = parseInt(hex.substr(i, 2), 16);\\n  \}\\n  return bytes;\\n\}\\n\\n// Hole Public Key des Absenders von Threema\\n// TODO: Muss von Threema API geholt werden\\n// const senderPublicKey = await getSenderPublicKey(from);\\n\\n// F\'fcr jetzt: Platzhalter (muss sp\'e4ter implementiert werden)\\nconsole.log('E2E Entschl\'fcsselung - noch nicht vollst\'e4ndig implementiert');\\nconsole.log('From:', from, 'To:', to, 'MessageId:', messageId);\\n\\n// Gebe erstmal die rohen Daten weiter\\nreturn \{\\n  json: \{\\n    from: from,\\n    to: to,\\n    messageId: messageId,\\n    date: date,\\n    nonce: nonce,\\n    box: box,\\n    decrypted: false, // Flag: noch nicht entschl\'fcsselt\\n    rawData: webhookData\\n  \}\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:384\
1:128\
id:b84200df-d024-4793-bd54-ca7a143d2339\
name:E2E Entschl\'fcsseln\
20\
parameters\
content:\uc0\u9888 \u65039  E2E-MODUS - TODO\\n\\nNoch zu erledigen:\\n1. Nach Freigabe: SECRET eintragen\\n2. Private Key im Code eintragen\\n3. Public Key Lookup implementieren\\n4. Vollst\'e4ndige Entschl\'fcsselung aktivieren\\n5. Nachricht senden mit E2E verschl\'fcsseln\\n\\nStatus: Vorbereitet, wartet auf *BERENT2 Freigabe\
height:384\
width:416\
color:3\
type:n8n-nodes-base.stickyNote\
position\
0:336\
1:-96\
typeVersion:1\
id:6a4827d9-8a7e-45fa-86d7-d7298c0504e9\
name:Sticky Note\
connections\
Threema Gateway Webhook\
main\
0\
0\
node:E2E Entschl\'fcsseln\
type:main\
index:0\
Parse Webhook Daten\
main\
0\
0\
node:Hat Datei?\
type:main\
index:0\
Hat Datei?\
main\
0\
0\
node:Datei herunterladen\
type:main\
index:0\
1\
0\
node:Als Text markieren\
type:main\
index:0\
Datei herunterladen\
main\
0\
0\
node:Datei verarbeiten\
type:main\
index:0\
Datei verarbeiten\
main\
0\
0\
node:Dateityp pr\'fcfen\
type:main\
index:0\
Dateityp pr\'fcfen\
main\
0\
0\
node:Als Bild markieren\
type:main\
index:0\
Als Bild markieren\
main\
0\
0\
node:Daten zusammenf\'fchren\
type:main\
index:0\
Audio pr\'fcfen\
main\
0\
0\
node:Als Audio markieren\
type:main\
index:0\
1\
0\
node:Als Dokument markieren\
type:main\
index:0\
Als Audio markieren\
main\
0\
0\
node:Daten zusammenf\'fchren\
type:main\
index:0\
Als Dokument markieren\
main\
0\
0\
node:Daten zusammenf\'fchren\
type:main\
index:0\
Als Text markieren\
main\
0\
0\
node:Daten zusammenf\'fchren\
type:main\
index:1\
Daten zusammenf\'fchren\
main\
0\
0\
node:Nachricht verarbeiten\
type:main\
index:0\
Nachricht verarbeiten\
main\
0\
0\
node:Best\'e4tigung senden\
type:main\
index:0\
Best\'e4tigung senden\
main\
0\
0\
node:Webhook Response\
type:main\
index:0\
E2E Entschl\'fcsseln\
main\
0\
0\
node:Parse Webhook Daten\
type:main\
index:0\
settings\
executionOrder:v1\
staticData:null\
meta:null\
pinData:\{empty object\}\
versionId:0ef0eedb-f8df-423f-ac4b-4a0401ffbeb2\
activeVersionId:null\
triggerCount:0\
shared\
0\
updatedAt:2025-11-06T20:35:24.128Z\
createdAt:2025-11-06T20:35:24.128Z\
role:workflow:owner\
workflowId:hR36jIx0wREZK0Bf\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags\
0\
updatedAt:2025-11-06T20:35:10.952Z\
createdAt:2025-11-06T20:35:10.952Z\
id:1XDySxVCWynR8Twd\
name:threema\
1\
updatedAt:2025-11-06T20:35:10.956Z\
createdAt:2025-11-06T20:35:10.956Z\
id:nKGGZ6FxgEmmFhE2\
name:gateway\
21\
updatedAt:2025-12-09T06:09:21.164Z\
createdAt:2025-12-09T06:09:21.164Z\
id:kgTzmuCqtvJrv16s\
name:fonio AGS Nachbearbeitung Transkript 20251209\
active:false\
isArchived:false\
nodes\
0\
parameters\
httpMethod:POST\
path:b0b43139-5430-4d07-81e9-f0dbbf11aea7\
options:\{empty object\}\
type:n8n-nodes-base.webhook\
typeVersion:2.1\
position\
0:-352\
1:-256\
id:1d611d6c-3010-4803-a34d-2d38ee70ab77\
name:Webhook\
webhookId:b0b43139-5430-4d07-81e9-f0dbbf11aea7\
1\
parameters\
assignments\
assignments\
0\
id:011ef203-63fd-49f7-ae0d-4ed7318ad11f\
name:headers.host\
value:=\{\{ $json.headers.host \}\}\
type:string\
1\
id:04f27e3e-ebed-4ae5-a22f-23d0f7c61904\
name:body[0].body.formattedTranscript\
value:=\{\{ $json.body[0].body.formattedTranscript \}\}\
type:string\
2\
id:017777fc-53d7-473d-b3c8-09a32e601385\
name:body[0].body.fromNumber\
value:=\{\{ $json.body[0].body.fromNumber \}\}\
type:string\
3\
id:882e8a05-a492-4445-bb4a-1856bfb586a1\
name:body[0].body.context.anrufer_name\
value:=\{\{ $json.body[0].body.context.anrufer_name \}\}\
type:string\
4\
id:a6508b49-d751-49d7-b40c-c91be52f5839\
name:body[0].body.context.einrichtung_typ\
value:=\{\{ $json.body[0].body.context.einrichtung_typ \}\}\
type:string\
5\
id:08190377-3019-449b-9374-494e642c5125\
name:body[0].body.context.einrichtung_name\
value:=\{\{ $json.body[0].body.context.einrichtung_name \}\}\
type:string\
6\
id:58740a6d-b29d-48ca-b2a3-fc14e3dedaeb\
name:body[0].body.context.technisch\
value:=\{\{ $json.body[0].body.context.technisch \}\}\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:-128\
1:-352\
id:630b558f-aba7-44e2-b570-182c9b18a269\
name:Daten extrahieren\
2\
parameters\
promptType:define\
text:=F\'fchre die Klassifikation durch.\
hasOutputParser:true\
options\
systemMessage:=DU BIST EIN HOCHSPEZIALISIERTER KLASSIFIKATIONS-AGENT F\'dcR IT-HOTLINE-TRANSKRIPTE.\\n\\n###DEINE HAUPTAUFGABE###\\nAnalysiere Telefon-Transkripte und ordne sie pr\'e4zise in eine Dringlichkeitskategorie (A, B, C oder D) ein, basierend auf den Kriterien aus der bereitgestellten Wissensdatenbank. Deine Klassifikation erm\'f6glicht Technikern eine zielgerichtete, priorisierte Bearbeitung.\\n\\n---\\n\\n###VERF\'dcGBARE DATEN###\\n\\n**DRINGLICHKEITSKRITERIEN (aus Google Sheet):**\\n\{\{ $input.all().slice(1).map(item => \\n`Kategorie $\{item.json.Dringlichkeit\}: $\{item.json.Kategorie\}\\nSchl\'fcsselworte: $\{item.json.Schlagworte\}\\nBeispiele: $\{item.json.Beispiele\}`\\n).join('\\n\\n') \}\}\\n\\n**ZU ANALYSIERENDES TRANSKRIPT:**\\n\{\{ $json.body[0].body.formattedTranscript \}\}\\n\\n**ANRUFERDATEN:**\\n- Name: \{\{ $json.body[0].body.context.anrufer_name \}\}\\n- Von: \{\{ $json.body[0].body.fromNumber \}\}\\n- Einrichtung: \{\{ $json.body[0].body.context.einrichtung_name \}\}\\n\\n---\\n\\n###ANALYSE-METHODIK (CHAIN OF THOUGHTS)###\\n\\n1. **UNDERSTAND**\\n   - Lies das Transkript gr\'fcndlich und identifiziere das konkrete technische Problem\\n   - Erkenne die Auswirkungen: Produktivit\'e4tsausfall, Datenverlust, Eskalation, Gesch\'e4ftskritikalit\'e4t\\n\\n2. **IDENTIFY KEY SIGNALS**\\n   - Schl\'fcsselbegriffe f\'fcr hohe Dringlichkeit: "nicht arbeitsf\'e4hig", "Produktion steht", "Kunde wartet", "dringend", "sofort"\\n   - Schl\'fcsselbegriffe f\'fcr niedrige Dringlichkeit: "nicht eilig", "wenn Zeit ist", "Informationsfrage", "optional"\\n\\n3. **ASSESS IMPACT**\\n   - Ist ein gesch\'e4ftskritischer Prozess blockiert?\\n   - Sind mehrere Nutzer betroffen?\\n   - Gibt es Fristen oder SLA-relevante Zeitpunkte?\\n   - Handelt es sich um einen Standardvorgang oder eine Informationsanfrage?\\n\\n4. **MATCH WITH CRITERIA**\\n   - Vergleiche die erkannten Merkmale mit den Referenzbeispielen aus dem Google Sheet\\n   - W\'e4hle die Kategorie, die der Fallbeschreibung AM N\'c4CHSTEN kommt\\n\\n5. **HANDLE EDGE CASES**\\n   - Bei unklaren oder widerspr\'fcchlichen Transkripten: W\'e4hle die konservativere (h\'f6here) Kategorie\\n   - Weise explizit auf Unsicherheiten hin\\n\\n---\\n\\n###AUSGABEFORMAT###\\n\\nGib deine Analyse im folgenden JSON-Format zur\'fcck:\\n```json\\n\{\\n  "Dringlichkeit": "B",\\n  "Kategorie": "Dringend",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Server-Ausfall",\\n  "Beschreibung": [\\n    "Mehrere Mitarbeiter betroffen (Buchhaltung)",\\n    "Datenbankverbindung unterbrochen seit 8 Uhr",\\n    "Fehlende Rechnungen der letzten 2 Wochen",\\n    "Zeitkritisch: Jahresabschluss-Termin in 2 Stunden"\\n  ],\\n  "AnsprechpartnerBleibt": true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\\n  "AnsprechpartnerName": "Frau Weber",\\n  "RueckrufnummerAnders": true = andere R\'fcckrufnummer gew\'fcnscht, false = unter anrufender Nummer zur\'fcckrufen\\n  "Rueckrufnummer": Die vom Anrufer genannte R\'fcckrufnummer (mit Durchwahl falls vorhanden)\\n  "Begr\'fcndung": "Der Kunde ist grunds\'e4tzlich arbeitsf\'e4hig, jedoch blockiert ein IT-Fehler einen zeitkritischen Gesch\'e4ftsprozess. Entspricht den Beispielen f\'fcr Kategorie B im Sheet."\\n\}\\n```\\n\\n**WICHTIG: Feldbeschreibungen** \\n- Die Dringlichkeit MUSS ein einzelner Buchstabe sein: A, B, C oder D, entsprechend der M\'f6glichkeiten im Google Sheet\\n- Die Kategorie MUSS sich auf die entsprechende Spalte im Google Sheet beziehen\\n- Problemtyp: Klassifiziere in GENAU EINE dieser Kategorien:\\n  \'95 "Technisch" = Hardware-Probleme, Netzwerkausf\'e4lle, Ger\'e4tedefekte, Server-Ausf\'e4lle\\n  \'95 "Software" = Programmfehler, Anmeldeprobleme, Softwarest\'f6rungen, Datenbankprobleme\\n  \'95 "Anliegen" = Informationsanfragen, Beratung, allgemeine Fragen ohne akutes technisches Problem\\n- Themenstichwort: Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z. B. "SAP-Login", "E-Mail-Sync", "Drucker-WLAN")\\n- Beschreibung: Array mit 3-6 Stichpunkten, die wichtigsten Informationen zuerst:\\n  \'95 Betroffene Personen/Systeme\\n  \'95 Zeitpunkt des Auftretens\\n  \'95 Konkrete Symptome/Fehler\\n  \'95 Gesch\'e4ftliche Auswirkungen\\n  \'95 Fristen/Zeitdruck\\n  \'95 Bereits versuchte L\'f6sungen\\n- AnsprechpartnerBleibt: true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\\n- AnsprechpartnerName: Name des Ansprechpartners (falls abweichend vom Anrufer, sonst leer lassen)\\n- AnsprechpartnerTelefon: Telefonnummer des Ansprechpartners (falls abweichend, sonst leer lassen)\\n- RueckrufnummerAnders: true = andere R\'fcckrufnummer als anrufende Nummer, false = unter anrufender Nummer zur\'fcckrufen\\n- Rueckrufnummer: Die R\'fcckrufnummer (kann identisch mit AnsprechpartnerTelefon sein)\\n- Die Begr\'fcndung MUSS sich auf die Kriterien im Google Sheet beziehen\\n- Halte dich strikt an das JSON-Format\\n\\n---\\n\\n###WAS NICHT ZU TUN IST###\\n\\nNIEMALS Kategorien ohne Bezug zum Google Sheet festlegen\\nVERMEIDE vage Begr\'fcndungen wie "klingt dringend" oder "scheint wichtig"\\nNICHT nur nach einzelnen Schl\'fcsselworten klassifizieren \'96 analysiere die Gesamtsituation\\nNIEMALS Aussagen erfinden, die nicht im Transkript stehen\\nNICHT \'fcberkategorisieren: Unzufriedenheit allein rechtfertigt keine Kategorie A\\nIGNORIERE NIEMALS Hinweise auf Systemrelevanz, Produktionsstopp oder gesch\'e4ftskritische Prozesse\\n\\n---\\n\\n###FEW-SHOT BEISPIELE###\\n\\n**Beispiel 1 - Kategorie A:**\\nTranskript: "Ich kann mich nicht mehr in SAP anmelden, wir m\'fcssen heute unbedingt die Monatsabrechnung machen."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "A",\\n  "Kategorie": "Notfall",\\n  "Problemtyp": "Software",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Gesch\'e4ftskritischer Prozess (Monatsabrechnung) ist komplett blockiert. Entspricht den Referenzf\'e4llen f\'fcr Kategorie A im Sheet."\\n\}\\n```\\n\\n**Beispiel 2 - Kategorie D:**\\nTranskript: "Ich wollte nur fragen, ob man den Drucker auch \'fcber WLAN verbinden kann \'96 ist aber nicht eilig."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "D",\\n  "Kategorie": "Informativ",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Informationsanfrage ohne Zeitdruck, kein akuter Vorfall. Entspricht klar Kategorie D im Sheet."\\n\}\\n```\\n\\n**Beispiel 3 - Kategorie B:**\\nTranskript: "Mein Outlook synchronisiert nicht mehr. Ich kann arbeiten, aber wichtige E-Mails von Kunden kommen nicht an."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "B",\\n  "Kategorie": "Dringend",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Eingeschr\'e4nkte Arbeitsf\'e4higkeit bei einem wichtigen Kommunikationskanal. Keine komplette Blockade, aber gesch\'e4ftsrelevant. Entspricht Kategorie B."\\n\}\\n```\
type:@n8n/n8n-nodes-langchain.agent\
typeVersion:3\
position\
0:1120\
1:-256\
id:fbf04100-561c-4a05-aec9-f0004af32a15\
name:AI Agent\
executeOnce:true\
3\
parameters\
model\
__rl:true\
value:claude-3-5-haiku-20241022\
mode:list\
cachedResultName:Claude Haiku 3.5\
options:\{empty object\}\
type:@n8n/n8n-nodes-langchain.lmChatAnthropic\
typeVersion:1.3\
position\
0:1192\
1:-32\
id:17332de4-274c-498b-9319-babb6caa3b71\
name:Anthropic Chat Model\
credentials:\{empty object\}\
4\
parameters\
authentication:serviceAccount\
documentId\
__rl:true\
value:1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw\
mode:id\
sheetName\
__rl:true\
value:gid=0\
mode:list\
cachedResultName:Dringlichkeiten\
cachedResultUrl:https://docs.google.com/spreadsheets/d/1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw/edit#gid=0\
options:\{empty object\}\
type:n8n-nodes-base.googleSheets\
typeVersion:4.7\
position\
0:-128\
1:-160\
id:3595da5a-31be-4f07-b4f0-bfa3e8c20bfa\
name:Dringlichkeitskriterien laden\
credentials:\{empty object\}\
5\
parameters:\{empty object\}\
type:n8n-nodes-base.merge\
typeVersion:3.2\
position\
0:96\
1:-256\
id:5c0c2b31-f530-4c21-931b-3f39b9fa0182\
name:Merge\
6\
parameters\
assignments\
assignments\
0\
id:ba4494fd-87dc-44a3-be07-3c1e3b0b0f04\
name:Dringlichkeit\
value:=\{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).Dringlichkeit \}\}\
type:string\
1\
id:77fc8f1e-1ef1-4c82-a4c9-1badefb579a4\
name:problemtyp\
value:=\{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).Problemtyp \}\}\
type:string\
2\
id:ea4dea35-112a-47b3-86c9-3252d606adda\
name:betreff\
value:=\{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).Kategorie \}\} | \{\{ $('Merge').item.json.body[0].body.context.einrichtung_name \}\}, \{\{ $('Merge').item.json.body[0].body.context.anrufer_name \}\} | \{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).Themenstichwort \}\}\
type:string\
3\
id:123c771e-c991-4bb9-8860-c5c030773741\
name:emailBody\
value:=<h3>Problemtyp: \{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).Problemtyp \}\}</h3>\\n\\n<h3>KI-Einsch\'e4tzung</h3>\\n<ul>\\n  <li><strong>Einrichtung:</strong> \{\{ $('Merge').item.json.body[0].body.context.einrichtung_name \}\}</li>\\n  <li><strong>Anrufer:</strong> \{\{ $('Merge').item.json.body[0].body.context.anrufer_name \}\} (\{\{ $('Merge').item.json.body[0].body.fromNumber \}\})</li>\\n  <li><strong>Ansprechpartner:</strong> \\n    \{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).AnsprechpartnerBleibt ? 'Anrufer bleibt Ansprechpartner' : JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).AnsprechpartnerName + ' (' + JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).AnsprechpartnerTelefon + ')' \}\}\\n  </li>\\n  <li><strong>R\'fcckrufnummer:</strong> \\n    \{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).RueckrufnummerAnders ? JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).Rueckrufnummer : $('Merge').item.json.body[0].body.fromNumber \}\}\\n  </li>\\n  <li><strong>Thema:</strong> \{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).Themenstichwort \}\}</li>\\n  <li><strong>Beschreibung:</strong>\\n    <ul>\\n      \{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).Beschreibung.map(punkt => `<li>$\{punkt\}</li>`).join('') \}\}\\n    </ul>\\n  </li>\\n</ul>\\n\\n<h3>Begr\'fcndung der Dringlichkeitseinstufung</h3>\\n<p>\{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).Begr\'fcndung \}\}</p>\\n\\n<h3>Vollst\'e4ndiges Transkript</h3>\\n\{\{ $('Merge').item.json.body[0].body.formattedTranscript.replace(/\\n/g, '<br>') \}\}\\n</pre>\
type:string\
4\
id:abbab201-31d0-4200-8c7e-5b3d2c1b1dc7\
name:themenstichwort\
value:=\{\{ JSON.parse($json.output.match(/\\\{[\\s\\S]*\\\}/)[0]).Themenstichwort \}\}\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:1472\
1:-256\
id:af898f46-2fdd-4db5-b40b-73cec7035f04\
name:E-Mail vorbereiten\
7\
parameters\
fromEmail:office@berent.ai\
toEmail:office@berent.ai\
subject:=\{\{ $json.betreff \}\}\
html:=\{\{ $json.emailBody \}\}\
options:\{empty object\}\
path:42244bb9-541a-4ed2-9583-1ee2f6c4a7bc\
type:n8n-nodes-base.emailSend\
typeVersion:2.1\
position\
0:1696\
1:-256\
id:733b372a-527e-4041-a5c0-20ac986e0811\
name:Send email\
webhookId:42244bb9-541a-4ed2-9583-1ee2f6c4a7bc\
credentials:\{empty object\}\
8\
parameters\
model:mistral-small-latest\
options:\{empty object\}\
type:@n8n/n8n-nodes-langchain.lmChatMistralCloud\
typeVersion:1\
position\
0:392\
1:-32\
id:8ab55f10-46d8-44ed-a791-b794167a4a50\
name:Mistral Cloud Chat Model\
credentials:\{empty object\}\
9\
parameters\
operation:sanitize\
text:=\{\{ $json.headers.host \}\}\
guardrails\
urls\
value\
allowedUrls:n8n.srv1098810.hstgr.cloud\
allowedSchemes\
0:https\
1:http\
blockUserinfo:false\
allowSubdomains:=\{\{ true \}\}\
type:@n8n/n8n-nodes-langchain.guardrails\
typeVersion:1\
position\
0:320\
1:-256\
id:9b8ba408-c334-4ab2-985c-dad1beb17ada\
name:URI-Pr\'fcfung\
executeOnce:true\
alwaysOutputData:false\
10\
parameters\
operation:sanitize\
text:=\{\{ $('Merge').item.json.body[0].body.formattedTranscript \}\}\
guardrails\
pii\
value\
type:all\
type:@n8n/n8n-nodes-langchain.guardrails\
typeVersion:1\
position\
0:896\
1:-256\
id:6107392f-2e12-4332-a538-0e29df48b5d9\
name:Daten anonymisieren\
11\
parameters\
mode:runOnceForEachItem\
jsCode:// PII-Anonymisierung - KORREKTER Pfad zu den Daten\\nconst item = $input.item;\\n\\n// Extrahiere Transkript aus der INPUT-Struktur\\nlet text = item.json.body?.[0]?.body?.formattedTranscript || '';\\n\\n// Fallback falls kein Text\\nif (!text || text.trim() === '') \{\\n  return item; // Gib Original unver\'e4ndert zur\'fcck\\n\}\\n\\n// Speichere Original\\nconst originalText = text;\\n\\n// === ANONYMISIERUNG ===\\n\\n// 1. NAMEN\\ntext = text\\n  .replace(/\\b(Guten\\s+Tag|Hallo|Hi|Servus)\\s+([A-Z\'c4\'d6\'dc][a-z\'e4\'f6\'fc\'df]+)\\b/gi, '$1 [NAME]')\\n  .replace(/\\b([A-Z\'c4\'d6\'dc][a-z\'e4\'f6\'fc\'df]+)\\s+([A-Z\'c4\'d6\'dc][a-z\'e4\'f6\'fc\'df]+)\\b/g, '[NAME]')\\n  .replace(/\\b([A-Z\'c4\'d6\'dc][a-z\'e4\'f6\'fc\'df]\{2,\})\\b/g, (match) => \{\\n    const skip = ['Problem', 'Rechnung', 'Daten', 'Morgen', 'Willkommen', \\n                  'Vielen', 'Dank', 'Deutschland', 'Verstehe', 'Bitte', \\n                  'Dieser', 'Anruf', 'M\'f6chten', 'Detail', 'Einrichtung'];\\n    return skip.includes(match) ? match : '[NAME]';\\n  \});\\n\\n// 2. EMAIL\\ntext = text.replace(/\\b[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]\{2,\}\\b/g, '[EMAIL]');\\n\\n// 3. TELEFON\\ntext = text\\n  .replace(/\\+49\\s?\\d\{2,5\}\\s?\\d\{3,10\}/g, '[TELEFON]')\\n  .replace(/\\b0\\d\{2,5\}[\\s\\/-]?\\d\{3,10\}\\b/g, '[TELEFON]');\\n\\n// 4. FIRMEN (AGS etc.)\\ntext = text.replace(/\\b(AGS|[A-Z]\{2,5\})\\b/g, '[FIRMA]');\\n\\n// === OUTPUT ===\\nreturn \{\\n  json: \{\\n    ...item.json,\\n    body: [\{\\n      ...item.json.body[0],\\n      body: \{\\n        ...item.json.body[0].body,\\n        formattedTranscript: text,\\n        originalTranscript: originalText,\\n        anonymizationApplied: true,\\n        anonymizationTimestamp: new Date().toISOString()\\n      \}\\n    \}]\\n  \}\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:672\
1:-256\
id:fb2f8c36-1644-44b9-8af1-923cc103ee64\
name:PII Anonymisierung (Regex)\
connections\
Webhook\
main\
0\
0\
node:Daten extrahieren\
type:main\
index:0\
1\
node:Dringlichkeitskriterien laden\
type:main\
index:0\
Daten extrahieren\
main\
0\
0\
node:Merge\
type:main\
index:0\
Anthropic Chat Model\
ai_languageModel\
0\
0\
node:AI Agent\
type:ai_languageModel\
index:0\
Dringlichkeitskriterien laden\
main\
0\
0\
node:Merge\
type:main\
index:1\
Merge\
main\
0\
0\
node:URI-Pr\'fcfung\
type:main\
index:0\
AI Agent\
main\
0\
0\
node:E-Mail vorbereiten\
type:main\
index:0\
E-Mail vorbereiten\
main\
0\
0\
node:Send email\
type:main\
index:0\
Mistral Cloud Chat Model\
ai_languageModel\
0:[empty array]\
URI-Pr\'fcfung\
main\
0\
0\
node:PII Anonymisierung (Regex)\
type:main\
index:0\
Daten anonymisieren\
main\
0:[empty array]\
PII Anonymisierung (Regex)\
main\
0\
0\
node:Daten anonymisieren\
type:main\
index:0\
settings\
executionOrder:v1\
staticData:null\
meta\
templateCredsSetupCompleted:true\
pinData:\{empty object\}\
versionId:0648bf03-5119-4568-ab4c-6deaf8cd1858\
activeVersionId:null\
triggerCount:0\
shared\
0\
updatedAt:2025-12-09T06:09:21.173Z\
createdAt:2025-12-09T06:09:21.173Z\
role:workflow:owner\
workflowId:kgTzmuCqtvJrv16s\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
22\
updatedAt:2025-11-12T18:31:04.000Z\
createdAt:2025-11-10T13:45:58.896Z\
id:l4uGmA0Wwq72wtts\
name:Fieckscher Feger\
active:false\
isArchived:false\
nodes\
0\
parameters\
batchSize:1\
options:\{empty object\}\
name:2. Split In Batches (Prototyp)\
type:n8n-nodes-base.splitInBatches\
typeVersion:1\
position\
0:-800\
1:80\
id:80c9486a-9931-4c16-89ab-5bd455af3c38\
1\
parameters\
jsCode:// Konfiguration: Preise f\'fcr Claude Sonnet 4\\nconst COST_INPUT_PER_M = 0.003;\\nconst COST_OUTPUT_PER_M = 0.015;\\n\\n// 1. Daten holen\\nconst llmRawOutput = $json.output;\\nconst splitBatchesData = $('2. Split In Batches (Prototyp)').first().json;\\nconst investorId = splitBatchesData.row_number || 1;\\nconst investorName = splitBatchesData['Investor Name'] || splitBatchesData.Investor || 'unknown';\\n\\n// Token-Sch\'e4tzung (falls usage fehlt)\\nconst llmOutput = $json.output || '';\\nconst inputData = JSON.stringify(splitBatchesData);\\nconst estimatedInputTokens = Math.ceil(inputData.length / 4);\\nconst estimatedOutputTokens = Math.ceil(llmOutput.length / 4);\\n\\nconst inputTokens = $json.usage?.input_tokens || estimatedInputTokens;\\nconst outputTokens = $json.usage?.output_tokens || estimatedOutputTokens;\\n\\n// 2. Kosten berechnen\\nconst costPerRun = (\\n    (inputTokens / 1000000) * COST_INPUT_PER_M) +\\n    ((outputTokens / 1000000) * COST_OUTPUT_PER_M\\n);\\n\\nconst costUsd = parseFloat(costPerRun.toFixed(6));\\n\\n// 3. Markdown-Tabelle parsen\\nconst lines = llmRawOutput.split('\\n').filter(line => line.trim().length > 0);\\n\\nlet tableStartIndex = -1;\\nfor (let i = 0; i < lines.length; i++) \{\\n    if (lines[i].includes('|') && lines[i].includes('Investor')) \{\\n        tableStartIndex = i;\\n        break;\\n    \}\\n\}\\n\\nif (tableStartIndex === -1 || lines.length < tableStartIndex + 3) \{\\n    return [\{ \\n        error: 'LLM Output enth\'e4lt keine g\'fcltige Tabelle', \\n        raw_output: llmRawOutput,\\n        investor_id: investorId,\\n        investor_name: investorName\\n    \}];\\n\}\\n\\nconst dataLines = lines.slice(tableStartIndex + 2); \\nconst parsedResults = [];\\n\\nfor (const line of dataLines) \{\\n    if (!line.includes('|')) continue;\\n    \\n    const columns = line.split('|').slice(1, -1).map(col => col.trim()); \\n\\n    if (columns.length === 7) \{\\n        let score_numeric = null;\\n        let source_factor_numeric = null;\\n\\n        if (columns[2].length > 0) \{\\n            score_numeric = parseFloat(columns[2].replace(',', '.'));\\n        \}\\n        if (columns[5].length > 0) \{\\n            source_factor_numeric = parseFloat(columns[5].replace(',', '.'));\\n        \}\\n        \\n        parsedResults.push(\{\\n            investor_id: investorId,\\n            investor_name: investorName,\\n            llm_cost_usd: costUsd,\\n            raw_markdown_output: llmRawOutput,\\n            criterion_name: columns[1],\\n            score: score_numeric,\\n            source_type: columns[3],\\n            source_year: parseInt(columns[4], 10) || null,\\n            source_factor: source_factor_numeric,\\n            notes: columns[6]\\n        \});\\n    \}\\n\}\\n\\nreturn parsedResults;\
name:4. Code Node: Validierung & Kostenberechnung\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:224\
1:80\
id:c07d5019-475b-4c19-95c9-4dfe721204bd\
2\
parameters\
tableId:fieckscher_feger\
dataToSend:autoMapInputData\
name:5. Supabase: Zwischenspeicher (Log)\
type:n8n-nodes-base.supabase\
typeVersion:1\
position\
0:448\
1:80\
id:e20f1953-c4b7-4556-a872-8a36a35967b7\
credentials\
supabaseApi\
id:JoURD13xiv3CaQyw\
name:Supabase account\
3\
parameters\
jsCode:// Node 6: Daten f\'fcr Excel vorbereiten (mit EUR-Konvertierung)\\n\\n// EUR/USD Wechselkurs (aktuell ca. 1.10, regelm\'e4\'dfig aktualisieren!)\\nconst EUR_USD_RATE = 1.10; // 1 USD = 0.91 EUR bei Rate 1.10\\n\\nconst items = $input.all();\\n\\n// Pr\'fcfe ob Daten vorhanden sind\\nif (!items || items.length === 0) \{\\n  return [];\\n\}\\n\\n// Gruppiere nach Investor\\nconst investorGroups = \{\};\\n\\nfor (const item of items) \{\\n  const investorId = item.json.investor_id;\\n  const investorName = item.json.investor_name;\\n  \\n  if (!investorGroups[investorId]) \{\\n    investorGroups[investorId] = \{\\n      investor_id: investorId,\\n      investor_name: investorName,\\n      batch_id: $execution.id, // Execution ID als Batch ID\\n      batch_number: 1, // TODO: Dynamisch aus Split In Batches holen\\n      llm_cost_usd: item.json.llm_cost_usd || 0,\\n      criteria: [],\\n      total_score: 0,\\n      count_scores: 0\\n    \};\\n  \}\\n  \\n  // Sammle Kriterien\\n  investorGroups[investorId].criteria.push(\{\\n    name: item.json.criterion_name,\\n    score: item.json.score,\\n    source_type: item.json.source_type,\\n    source_year: item.json.source_year,\\n    source_factor: item.json.source_factor,\\n    notes: item.json.notes\\n  \});\\n  \\n  // Summiere Scores (nur wenn nicht null)\\n  if (item.json.score !== null && item.json.score !== undefined) \{\\n    investorGroups[investorId].total_score += item.json.score;\\n    investorGroups[investorId].count_scores += 1;\\n  \}\\n\}\\n\\n// Erstelle Output f\'fcr Google Sheet\\nconst output = [];\\n\\nObject.values(investorGroups).forEach(group => \{\\n  // Berechne Durchschnitts-Score (FIX: als Dezimalzahl!)\\n  const avgScore = group.count_scores > 0 \\n    ? parseFloat((group.total_score / group.count_scores).toFixed(3))\\n    : null;\\n  \\n  // Kosten in EUR umrechnen\\n  const costEUR = group.llm_cost_usd > 0 \\n    ? parseFloat((group.llm_cost_usd / EUR_USD_RATE).toFixed(6))\\n    : 0;\\n  \\n  // Erstelle eine Zeile pro Kriterium (f\'fcr detailliertes Sheet)\\n  group.criteria.forEach(criterion => \{\\n    output.push(\{\\n      'Batch ID': group.batch_id,\\n      'Batch Number': group.batch_number,\\n      'Investor ID': group.investor_id,\\n      'Investor Name': group.investor_name,\\n      'Criterion': criterion.name,\\n      'Score_0_to_1': criterion.score !== null ? criterion.score : '',\\n      'Source_Type': criterion.source_type || '',\\n      'Source_Year': criterion.source_year || '',\\n      'Source_Factor': criterion.source_factor || '',      \\n      'Notes': criterion.notes || '',\\n      'Average Score': avgScore, // FIX: Jetzt korrekt als 0.6 statt 600\\n      'Cost USD': parseFloat(group.llm_cost_usd.toFixed(6)),\\n      'Cost EUR': costEUR, // NEU: Kosten in EUR\\n      'Timestamp': new Date().toISOString()\\n    \});\\n  \});\\n\});\\n\\nreturn output;\
name:6. Code Node: Daten f\'fcr Excel vorbereiten\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:672\
1:80\
id:6c8d20ae-cc76-4cc5-a3ea-0cca1a3ef143\
4\
parameters:\{empty object\}\
type:n8n-nodes-base.manualTrigger\
typeVersion:1\
position\
0:-1248\
1:80\
id:4bc1d55c-764d-4d2a-9921-60a1eadf53fa\
name:When clicking \'91Execute workflow\'92\
5\
parameters\
authentication:serviceAccount\
documentId\
__rl:true\
value:1qzXEn21ltsuPGyJ7FAK1q8RGZkCOzpY-QTedDrdy9KA\
mode:id\
sheetName\
__rl:true\
value:1558341942\
mode:list\
cachedResultName:Investor_Base\
cachedResultUrl:https://docs.google.com/spreadsheets/d/1qzXEn21ltsuPGyJ7FAK1q8RGZkCOzpY-QTedDrdy9KA/edit#gid=1558341942\
options:\{empty object\}\
type:n8n-nodes-base.googleSheets\
typeVersion:4.7\
position\
0:-1024\
1:80\
id:eee20f3d-af79-4e90-b63e-3312f45979d3\
name:Get row(s) in sheet\
credentials\
googleApi\
id:QfuLctHhI3o7mKAL\
name:Google Sheets account\
6\
parameters\
promptType:define\
text:=Bewerte folgenden Investor:\\n\\nINVESTOR: \{\{ $json['Investor Name'] \}\}\\n\\nRECHERCHE-ERGEBNISSE:\\n\{\{ $json.formatted_research \}\}\\n\\nErstelle die Bewertungstabelle (9 Kriterien) mit diesen Informationen.\
options\
systemMessage:<system_prompt>\\nDU BIST EIN HOCHSPEZIALISIERTER, AGENTISCHER RESEARCH-BROWSER, TRAINIERT AUF DIE BEWERTUNG VON INVESTOREN F\'dcR EIN KLIMATECH-START-UP.\\n\\n### DEINE MISSION:\\nIDENTIFIZIERE UND BEWERTETE POTENTIELLE INVESTOREN F\'dcR DIE PLANETEERS GMBH ENTLANG NEUN FEST DEFINIERTER KRITERIEN. GIB AUSSCHLIESSLICH EINE SAUBER FORMATIERTE, MASCHINENLESBARE MARKDOWN-TABELLE AUS \'96 KEINEN BEGLEITTEXT.\\n\\n---\\n\\n### HINTERGRUND:\\n- **START-UP**: Planeteers GmbH  \\n- **TECHNOLOGIE**: Wandelt CO\uc0\u8322  durch beschleunigte Verwitterung mit Kalkstein, Wasser und Luft in Hydrogencarbonat um (Enhanced Weathering / Ocean Alkalinity Enhancement).\\n- **STRATEGISCHE FRAGE JEDE BEWERTUNG**: Wie gut passt dieser Investor zu einem Climate-/CDR-/mCDR-orientierten Start-up wie Planeteers?\\n\\n---\\n\\n### CHAIN OF THOUGHT\\n\\n1. **VERSTEHE DEN BEWERTUNGSKONTEXT**: Fokus auf strategischen Fit mit CDR-/Climatetech-/mCDR-Unternehmen im Hardware- und Deep-Tech-Bereich.\\n2. **KENNE DIE BEWERTUNGSKRITERIEN**: Bearbeite f\'fcr jeden Investor **exakt diese 9 Kriterien**:\\n   - Climetech / Impact  \\n   - Hardware  \\n   - Deep Tech  \\n   - A-Serie / A-Funding / Growth Stage  \\n   - Ocean / Water / CDR / mCDR / CCS / CCUS / OAE / Enhanced Weathering / Point Source CO\u8322   \\n   - Ticket 0,5\'9610 Mio  \\n   - Lead / Co-Lead / Follow  \\n   - Type Investor (VC, CVC, Family Office, Private, Strategen)  \\n   - Portfolio Companies (von Website)\\n3. **RECHERCHIERE AKTIV MIT DEN VERF\'dcGBAREN TOOLS**:\\n   - **SCHRITT 1**: NUTZE ZUERST die Recherche-Tools, um Informationen zu sammeln\\n   - **PFLICHT**: F\'fchre mindestens 3-5 gezielte Suchen durch:\\n     * Suche nach: "[Investor Name] climate tech investments"\\n     * Suche nach: "[Investor Name] portfolio companies"\\n     * Suche nach: "[Investor Name] CDR carbon removal"\\n     * Suche nach der Website des Investors\\n     * Suche nach spezifischen Kriterien bei Bedarf\\n   - **ZUL\'c4SSIGE QUELLEN**: Offizielle Websites, Pressemitteilungen, Newsartikel, Studien, Datenbanken\\n   - **TRANSPARENZPFLICHT**: Nur ver\'f6ffentlichte, verifizierte Informationen nutzen\\n   - **SCHRITT 2**: Erst NACH der Recherche die Bewertungstabelle erstellen\\n\\n4. **TRAGE BEWERTUNG F\'dcR JEDES KRITERIUM EIN**:\\n   - SCORE_0_TO_1:  \\n     - `1,0` = stark erf\'fcllt  \\n     - `0,5` = teilweise erf\'fcllt  \\n     - `0` = klar nicht erf\'fcllt  \\n     - leer = keine Info gefunden  \\n   - SOURCE_TYPE: Website, Press release, News article, Study, Database, Blog / Interview\\n   - SOURCE_YEAR: Jahr der Quelle (z. B. `2023`)\\n   - SOURCE_FACTOR:  \\n     - `1,0` = Prim\'e4rquelle, aktuell  \\n     - `0,8` = Reputierte Sekund\'e4rquelle < 2 Jahre  \\n     - `0,6` = \'c4ltere oder indirekte Quelle  \\n     - `0,4` = Schwache Quelle / unklar  \\n   - NOTES: 1\'962 S\'e4tze inkl. URL der Quelle\\n\\n---\\n\\n### AUSGABEPFLICHT:\\n\\nDU GIBST AUSSCHLIESSLICH FOLGENDE MARKDOWN-TABELLE AUS:\\n\\n| Investor | Criterion_Name | Score_0_to_1 | Source_Type | Source_Year | Source_Factor | Notes |\\n|:---|:---|:---|:---|:---|:---|:---|\\n| ... | Climetech / Impact | 1,0 | Website | 2024 | 1,0 | Beispiel-URL mit kurzer Begr\'fcndung |\\n| ... | Hardware | 0,5 | News article | 2023 | 0,8 | Beispiel-URL mit kurzer Begr\'fcndung |\\n| ... | ... | ... | ... | ... | ... | ... |\\n\\n\u8594  DIE TABELLE ENTH\'c4LT PRO INVESTOR **GENAU 9 ZEILEN** (eine pro Kriterium), UND **KEINEN TEXT DAR\'dcBER ODER DARUNTER**.\\n\\n---\\n\\n### WAS DU UNTERLASSEN MUSST\\n\\n- **KEINE ERKL\'c4RUNGEN**, **KEIN FLIESSTEXT** AUSSERHALB DER TABELLE  \\n- **KEINE VERMUTUNGEN** ODER HYPOTHETISCHEN ANNNAHMEN \'97 NUR VERIFIZIERTE QUELLEN  \\n- **KEINE NICHT-MASCHINENLESBARE FORMATE** (z. B. HTML, CSV, Freitext)  \\n- **KEINE ZUS\'c4TZLICHEN SPALTEN** ODER ABWEICHUNGEN IM SPALTENAUFBAU  \\n- **KEINE EIGENEN INTERPRETATIONEN** AUSSERHALB DES DEKLARIERTEN RASTERS  \\n- **KEIN ZUSAMMENGEFASSTES INVESTOREN-FAZIT ODER SCORE**\\n\\n</system_prompt>\
type:@n8n/n8n-nodes-langchain.agent\
typeVersion:3\
position\
0:-128\
1:80\
id:0345c7d2-11ad-4198-82f5-e91a1d19f6aa\
name:AI Agent\
7\
parameters\
model\
__rl:true\
value:claude-sonnet-4-20250514\
mode:list\
cachedResultName:Claude Sonnet 4\
options:\{empty object\}\
type:@n8n/n8n-nodes-langchain.lmChatAnthropic\
typeVersion:1.3\
position\
0:-64\
1:304\
id:1281ef99-20d5-4922-804f-3daef216d03c\
name:Anthropic Chat Model\
credentials\
anthropicApi\
id:6RlfJdXsmselCNpN\
name:Anthropic account 2\
8\
parameters\
authentication:serviceAccount\
operation:append\
documentId\
__rl:true\
value:1qzXEn21ltsuPGyJ7FAK1q8RGZkCOzpY-QTedDrdy9KA\
mode:id\
sheetName\
__rl:true\
value:1944311408\
mode:list\
cachedResultName:Ratings Input\
cachedResultUrl:https://docs.google.com/spreadsheets/d/1qzXEn21ltsuPGyJ7FAK1q8RGZkCOzpY-QTedDrdy9KA/edit#gid=1944311408\
columns\
mappingMode:autoMapInputData\
value:\{empty object\}\
matchingColumns:[empty array]\
schema\
0\
id:Investor\
displayName:Investor\
required:false\
defaultMatch:false\
display:true\
type:string\
canBeUsedToMatch:true\
1\
id:Criterion_Name\
displayName:Criterion_Name\
required:false\
defaultMatch:false\
display:true\
type:string\
canBeUsedToMatch:true\
2\
id:Score_0_to_1\
displayName:Score_0_to_1\
required:false\
defaultMatch:false\
display:true\
type:string\
canBeUsedToMatch:true\
3\
id:Source_Type\
displayName:Source_Type\
required:false\
defaultMatch:false\
display:true\
type:string\
canBeUsedToMatch:true\
4\
id:Source_Year\
displayName:Source_Year\
required:false\
defaultMatch:false\
display:true\
type:string\
canBeUsedToMatch:true\
5\
id:Source_Factor\
displayName:Source_Factor\
required:false\
defaultMatch:false\
display:true\
type:string\
canBeUsedToMatch:true\
6\
id:Notes\
displayName:Notes\
required:false\
defaultMatch:false\
display:true\
type:string\
canBeUsedToMatch:true\
7\
id:Batch ID\
displayName:Batch ID\
required:false\
defaultMatch:false\
display:true\
type:string\
canBeUsedToMatch:true\
removed:false\
8\
id:Batch Number\
displayName:Batch Number\
required:false\
defaultMatch:false\
display:true\
type:string\
canBeUsedToMatch:true\
removed:false\
9\
id:Investor ID\
displayName:Investor ID\
required:false\
defaultMatch:false\
display:true\
type:string\
canBeUsedToMatch:true\
removed:false\
10\
id:Investor Name\
displayName:Investor Name\
required:false\
defaultMatch:false\
display:true\
type:string\
canBeUsedToMatch:true\
removed:false\
11\
id:Criterion\
displayName:Criterion\
required:false\
defaultMatch:false\
display:true\
type:string\
canBeUsedToMatch:true\
removed:false\
12\
id:Score\
displayName:Score\
required:false\
defaultMatch:false\
display:true\
type:string\
canBeUsedToMatch:true\
removed:false\
13\
id:Source Type\
displayName:Source Type\
required:false\
defaultMatch:false\
display:true\
type:string\
canBeUsedToMatch:true\
removed:false\
14\
id:Source Year\
displayName:Source Year\
required:false\
defaultMatch:false\
display:true\
type:string\
canBeUsedToMatch:true\
removed:false\
15\
id:Source Factor\
displayName:Source Factor\
required:false\
defaultMatch:false\
display:true\
type:string\
canBeUsedToMatch:true\
removed:false\
16\
id:Average Score\
displayName:Average Score\
required:false\
defaultMatch:false\
display:true\
type:string\
canBeUsedToMatch:true\
removed:false\
17\
id:Cost USD\
displayName:Cost USD\
required:false\
defaultMatch:false\
display:true\
type:string\
canBeUsedToMatch:true\
removed:false\
18\
id:Timestamp\
displayName:Timestamp\
required:false\
defaultMatch:false\
display:true\
type:string\
canBeUsedToMatch:true\
removed:false\
attemptToConvertTypes:false\
convertFieldsToString:false\
options:\{empty object\}\
type:n8n-nodes-base.googleSheets\
typeVersion:4.7\
position\
0:896\
1:80\
id:d03d75a6-011b-480d-a668-dadd2754ef29\
name:Append row in sheet\
credentials\
googleApi\
id:QfuLctHhI3o7mKAL\
name:Google Sheets account\
9\
parameters\
mode:runOnceForEachItem\
jsCode:// Multi-Search Tavily Research\\nconst TAVILY_API_KEY = "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"; // Ersetze mit deinem Key!\\n\\nconst investorName = $json['Investor Name'];\\n\\nconst searches = [\\n  investorName + ' climate tech investments',\\n  investorName + ' CDR carbon removal',\\n  investorName + ' portfolio companies',\\n  investorName + ' funding series A',\\n  investorName + ' investment thesis'\\n];\\n\\nconst searchResults = [];\\n\\nfor (let i = 0; i < searches.length; i++) \{\\n  try \{\\n    const result = await this.helpers.httpRequest(\{\\n      method: 'POST',\\n      url: 'https://api.tavily.com/search',\\n      body: \{\\n        api_key: TAVILY_API_KEY,\\n        query: searches[i],\\n        search_depth: 'advanced',\\n        max_results: 3\\n      \},\\n      json: true\\n    \});\\n    \\n    searchResults.push(\{\\n      query: searches[i],\\n      answer: result.answer || '',\\n      results: result.results || []\\n    \});\\n    \\n  \} catch (error) \{\\n    searchResults.push(\{\\n      query: searches[i],\\n      answer: 'Fehler',\\n      results: []\\n    \});\\n  \}\\n\}\\n\\nreturn \{\\n  'Investor Name': investorName,\\n  'URL': $json.URL,\\n  'Investor Type': $json['Investor Type'],\\n  'research_data': \{\\n    searches_performed: searchResults.length,\\n    search_results: searchResults\\n  \}\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-576\
1:80\
id:d523c4f7-5c5a-4464-9ab8-fcba29df53f0\
name:3. Multi-Search Tavily Research\
10\
parameters\
jsCode:const researchData = $json.research_data;\\nconst searchResults = researchData.search_results;\\n\\n// Sammle die wichtigsten Insights aus allen Suchen\\nlet formattedResearch = '';\\n\\nfor (let i = 0; i < searchResults.length; i++) \{\\n  const search = searchResults[i];\\n  \\n  formattedResearch += '\\n\\n### Suche ' + (i + 1) + ': ' + search.query + '\\n';\\n  \\n  if (search.answer && search.answer.length > 0) \{\\n    formattedResearch += 'Antwort: ' + search.answer + '\\n\\n';\\n  \}\\n  \\n  // Top 3 Ergebnisse\\n  const results = search.results.slice(0, 3);\\n  for (let j = 0; j < results.length; j++) \{\\n    const result = results[j];\\n    formattedResearch += (j + 1) + '. ' + result.title + '\\n';\\n    formattedResearch += '   URL: ' + result.url + '\\n';\\n    formattedResearch += '   ' + result.content.substring(0, 300) + '...\\n\\n';\\n  \}\\n\}\\n\\n// Gebe alle Daten zur\'fcck plus formatted research\\nreturn \{\\n  'Investor Name': $json['Investor Name'],\\n  'URL': $json.URL,\\n  'Investor Type': $json['Investor Type'],\\n  'research_data': researchData,\\n  'formatted_research': formattedResearch\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-352\
1:80\
id:8657df36-496e-4005-a712-575f3a3e895c\
name:3b. Format Research for AI\
connections\
When clicking \'91Execute workflow\'92\
main\
0\
0\
node:Get row(s) in sheet\
type:main\
index:0\
5. Supabase: Zwischenspeicher (Log)\
main\
0\
0\
node:6. Code Node: Daten f\'fcr Excel vorbereiten\
type:main\
index:0\
Anthropic Chat Model\
ai_languageModel\
0\
0\
node:AI Agent\
type:ai_languageModel\
index:0\
2. Split In Batches (Prototyp)\
main\
0\
0\
node:3. Multi-Search Tavily Research\
type:main\
index:0\
Get row(s) in sheet\
main\
0\
0\
node:2. Split In Batches (Prototyp)\
type:main\
index:0\
AI Agent\
main\
0\
0\
node:4. Code Node: Validierung & Kostenberechnung\
type:main\
index:0\
4. Code Node: Validierung & Kostenberechnung\
main\
0\
0\
node:5. Supabase: Zwischenspeicher (Log)\
type:main\
index:0\
6. Code Node: Daten f\'fcr Excel vorbereiten\
main\
0\
0\
node:Append row in sheet\
type:main\
index:0\
3. Multi-Search Tavily Research\
main\
0\
0\
node:3b. Format Research for AI\
type:main\
index:0\
3b. Format Research for AI\
main\
0\
0\
node:AI Agent\
type:main\
index:0\
settings\
executionOrder:v1\
staticData:null\
meta\
templateCredsSetupCompleted:true\
pinData:\{empty object\}\
versionId:a35a464d-0183-4775-b76b-de7ef1a511ee\
activeVersionId:null\
triggerCount:0\
shared\
0\
updatedAt:2025-11-10T13:45:58.900Z\
createdAt:2025-11-10T13:45:58.900Z\
role:workflow:owner\
workflowId:l4uGmA0Wwq72wtts\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
23\
updatedAt:2025-12-09T17:10:51.893Z\
createdAt:2025-12-09T17:10:51.893Z\
id:lQCvszSC2kiedNIp\
name:fonio AGS Nachbearbeitung Transkript Version 0.9 20251209 18:10\
active:false\
isArchived:false\
nodes\
0\
parameters\
httpMethod:POST\
path:f6174cf8-935f-4d7b-80ea-81bb853856c6\
options:\{empty object\}\
type:n8n-nodes-base.webhook\
typeVersion:2.1\
position\
0:-352\
1:-256\
id:04d5e464-efd5-4d0f-bf0a-e9206e7c2727\
name:Webhook\
webhookId:f6174cf8-935f-4d7b-80ea-81bb853856c6\
1\
parameters\
assignments\
assignments\
0\
id:011ef203-63fd-49f7-ae0d-4ed7318ad11f\
name:headers.host\
value:=\{\{ $json.headers.host \}\}\
type:string\
1\
id:04f27e3e-ebed-4ae5-a22f-23d0f7c61904\
name:body[0].body.formattedTranscript\
value:=\{\{ $json.body[0].body.formattedTranscript \}\}\
type:string\
2\
id:017777fc-53d7-473d-b3c8-09a32e601385\
name:body[0].body.fromNumber\
value:=\{\{ $json.body[0].body.fromNumber \}\}\
type:string\
3\
id:882e8a05-a492-4445-bb4a-1856bfb586a1\
name:body[0].body.context.anrufer_name\
value:=\{\{ $json.body[0].body.context.anrufer_name \}\}\
type:string\
4\
id:a6508b49-d751-49d7-b40c-c91be52f5839\
name:body[0].body.context.einrichtung_typ\
value:=\{\{ $json.body[0].body.context.einrichtung_typ \}\}\
type:string\
5\
id:08190377-3019-449b-9374-494e642c5125\
name:body[0].body.context.einrichtung_name\
value:=\{\{ $json.body[0].body.context.einrichtung_name \}\}\
type:string\
6\
id:58740a6d-b29d-48ca-b2a3-fc14e3dedaeb\
name:body[0].body.context.technisch\
value:=\{\{ $json.body[0].body.context.technisch \}\}\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:-128\
1:-352\
id:dbb93dd3-6004-4d9d-a8d2-7f2a67a4d9d3\
name:Daten extrahieren\
2\
parameters\
promptType:define\
text:=F\'fchre die Klassifikation durch.\
hasOutputParser:true\
options\
systemMessage:=DU BIST EIN HOCHSPEZIALISIERTER KLASSIFIKATIONS-AGENT F\'dcR IT-HOTLINE-TRANSKRIPTE.\\n\\n###DEINE HAUPTAUFGABE###\\nAnalysiere Telefon-Transkripte und ordne sie pr\'e4zise in eine Dringlichkeitskategorie (A, B, C oder D) ein, basierend auf den Kriterien aus der bereitgestellten Wissensdatenbank. Deine Klassifikation erm\'f6glicht Technikern eine zielgerichtete, priorisierte Bearbeitung.\\n\\n---\\n\\n###VERF\'dcGBARE DATEN###\\n\\n**DRINGLICHKEITSKRITERIEN (aus Google Sheet):**\\n\{\{ $('Dringlichkeitskriterien laden').all().slice(1).map(item =>\\n`Kategorie $\{item.json.Dringlichkeit\}: $\{item.json.Kategorie\}\\nSchl\'fcsselworte: $\{item.json.Schlagworte\}\\nBeispiele: $\{item.json.Beispiele\}`\\n).join('\\n\\n') \}\}\\n\\n**ZU ANALYSIERENDES TRANSKRIPT:**\\n\{\{ $json.anonymizedText \}\}\\n\\n---\\n\\n###ANALYSE-METHODIK (CHAIN OF THOUGHTS)###\\n\\n1. **UNDERSTAND**\\n   - Lies das Transkript gr\'fcndlich und identifiziere das konkrete technische Problem\\n   - Erkenne die Auswirkungen: Produktivit\'e4tsausfall, Datenverlust, Eskalation, Gesch\'e4ftskritikalit\'e4t\\n\\n2. **IDENTIFY KEY SIGNALS**\\n   - Schl\'fcsselbegriffe f\'fcr hohe Dringlichkeit: "nicht arbeitsf\'e4hig", "Produktion steht", "Kunde wartet", "dringend", "sofort"\\n   - Schl\'fcsselbegriffe f\'fcr niedrige Dringlichkeit: "nicht eilig", "wenn Zeit ist", "Informationsfrage", "optional"\\n\\n3. **ASSESS IMPACT**\\n   - Ist ein gesch\'e4ftskritischer Prozess blockiert?\\n   - Sind mehrere Nutzer betroffen?\\n   - Gibt es Fristen oder SLA-relevante Zeitpunkte?\\n   - Handelt es sich um einen Standardvorgang oder eine Informationsanfrage?\\n\\n4. **MATCH WITH CRITERIA**\\n   - Vergleiche die erkannten Merkmale mit den Referenzbeispielen aus dem Google Sheet\\n   - W\'e4hle die Kategorie, die der Fallbeschreibung AM N\'c4CHSTEN kommt\\n\\n5. **HANDLE EDGE CASES**\\n   - Bei unklaren oder widerspr\'fcchlichen Transkripten: W\'e4hle die konservativere (h\'f6here) Kategorie\\n   - Weise explizit auf Unsicherheiten hin\\n\\n---\\n\\n###AUSGABEFORMAT###\\n\\n***WICHTIGER HINWEIS ZUR DATENSCHUTZ-KONFORMIT\'c4T***\\nDer Text enth\'e4lt anonymisierte Platzhalter wie [PERSON_1], [PERSON_2].\\nWenn du Namen extrahierst (z.B. f\'fcr "AnsprechpartnerName" oder in der "Beschreibung"),\\nNUTZE AUSSCHLIESSLICH DIESE PLATZHALTER.\\nWandle sie NICHT um und erfinde keine Namen.\\nBeispiel korrekt: "AnsprechpartnerName": "[PERSON_2]"\\n\\nGib deine Analyse im folgenden JSON-Format zur\'fcck:\\n```json\\n\{\\n  "Dringlichkeit": "B",\\n  "Kategorie": "Dringend",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Server-Ausfall",\\n  "Beschreibung": [\\n    "Mehrere Mitarbeiter betroffen (Buchhaltung)",\\n    "Datenbankverbindung unterbrochen seit 8 Uhr",\\n    "Fehlende Rechnungen der letzten 2 Wochen",\\n    "Zeitkritisch: Jahresabschluss-Termin in 2 Stunden"\\n  ],\\n  "AnsprechpartnerBleibt": true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\\n  "AnsprechpartnerName": "Frau Weber",\\n  "RueckrufnummerAnders": true = andere R\'fcckrufnummer gew\'fcnscht, false = unter anrufender Nummer zur\'fcckrufen\\n  "Rueckrufnummer": Die vom Anrufer genannte R\'fcckrufnummer (mit Durchwahl falls vorhanden)\\n  "Begr\'fcndung": "Der Kunde ist grunds\'e4tzlich arbeitsf\'e4hig, jedoch blockiert ein IT-Fehler einen zeitkritischen Gesch\'e4ftsprozess. Entspricht den Beispielen f\'fcr Kategorie B im Sheet."\\n\}\\n```\\n\\n**WICHTIG: Feldbeschreibungen** \\n- Die Dringlichkeit MUSS ein einzelner Buchstabe sein: A, B, C oder D, entsprechend der M\'f6glichkeiten im Google Sheet\\n- Die Kategorie MUSS sich auf die entsprechende Spalte im Google Sheet beziehen\\n- Problemtyp: Klassifiziere in GENAU EINE dieser Kategorien:\\n  \'95 "Technisch" = Hardware-Probleme, Netzwerkausf\'e4lle, Ger\'e4tedefekte, Server-Ausf\'e4lle\\n  \'95 "Software" = Programmfehler, Anmeldeprobleme, Softwarest\'f6rungen, Datenbankprobleme\\n  \'95 "Anliegen" = Informationsanfragen, Beratung, allgemeine Fragen ohne akutes technisches Problem\\n- Themenstichwort: Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z. B. "SAP-Login", "E-Mail-Sync", "Drucker-WLAN")\\n- Beschreibung: Array mit 3-6 Stichpunkten, die wichtigsten Informationen zuerst:\\n  \'95 Betroffene Personen/Systeme\\n  \'95 Zeitpunkt des Auftretens\\n  \'95 Konkrete Symptome/Fehler\\n  \'95 Gesch\'e4ftliche Auswirkungen\\n  \'95 Fristen/Zeitdruck\\n  \'95 Bereits versuchte L\'f6sungen\\n- AnsprechpartnerBleibt: true = Anrufer bleibt Ansprechpartner, false = anderer Ansprechpartner wurde genannt\\n- AnsprechpartnerName: Name des Ansprechpartners (falls abweichend vom Anrufer, sonst leer lassen)\\n- AnsprechpartnerTelefon: Telefonnummer des Ansprechpartners (falls abweichend, sonst leer lassen)\\n- RueckrufnummerAnders: true = andere R\'fcckrufnummer als anrufende Nummer, false = unter anrufender Nummer zur\'fcckrufen\\n- Rueckrufnummer: Die R\'fcckrufnummer (kann identisch mit AnsprechpartnerTelefon sein)\\n- Die Begr\'fcndung MUSS sich auf die Kriterien im Google Sheet beziehen\\n- Halte dich strikt an das JSON-Format\\n\\n---\\n\\n###WAS NICHT ZU TUN IST###\\n\\nNIEMALS Kategorien ohne Bezug zum Google Sheet festlegen\\nVERMEIDE vage Begr\'fcndungen wie "klingt dringend" oder "scheint wichtig"\\nNICHT nur nach einzelnen Schl\'fcsselworten klassifizieren \'96 analysiere die Gesamtsituation\\nNIEMALS Aussagen erfinden, die nicht im Transkript stehen\\nNICHT \'fcberkategorisieren: Unzufriedenheit allein rechtfertigt keine Kategorie A\\nIGNORIERE NIEMALS Hinweise auf Systemrelevanz, Produktionsstopp oder gesch\'e4ftskritische Prozesse\\n\\n---\\n\\n###FEW-SHOT BEISPIELE###\\n\\n**Beispiel 1 - Kategorie A:**\\nTranskript: "Ich kann mich nicht mehr in SAP anmelden, wir m\'fcssen heute unbedingt die Monatsabrechnung machen."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "A",\\n  "Kategorie": "Notfall",\\n  "Problemtyp": "Software",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Gesch\'e4ftskritischer Prozess (Monatsabrechnung) ist komplett blockiert. Entspricht den Referenzf\'e4llen f\'fcr Kategorie A im Sheet."\\n\}\\n```\\n\\n**Beispiel 2 - Kategorie D:**\\nTranskript: "Ich wollte nur fragen, ob man den Drucker auch \'fcber WLAN verbinden kann \'96 ist aber nicht eilig."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "D",\\n  "Kategorie": "Informativ",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Informationsanfrage ohne Zeitdruck, kein akuter Vorfall. Entspricht klar Kategorie D im Sheet."\\n\}\\n```\\n\\n**Beispiel 3 - Kategorie B:**\\nTranskript: "Mein Outlook synchronisiert nicht mehr. Ich kann arbeiten, aber wichtige E-Mails von Kunden kommen nicht an."\\nAusgabe:\\n```json\\n\{\\n  "Dringlichkeit": "B",\\n  "Kategorie": "Dringend",\\n  "Problemtyp": "Technisch",\\n  "Themenstichwort": "Kurze, pr\'e4gnante Beschreibung des Hauptproblems (2-4 W\'f6rter, z.B. 'SAP-Login', 'E-Mail-Sync', 'Drucker-WLAN')",\\n  "Begr\'fcndung": "Eingeschr\'e4nkte Arbeitsf\'e4higkeit bei einem wichtigen Kommunikationskanal. Keine komplette Blockade, aber gesch\'e4ftsrelevant. Entspricht Kategorie B."\\n\}\\n```\
type:@n8n/n8n-nodes-langchain.agent\
typeVersion:3\
position\
0:1168\
1:-256\
id:98fe189d-4e23-46a3-bfab-b3149ceb4baa\
name:AI Agent\
executeOnce:true\
3\
parameters\
model\
__rl:true\
value:claude-3-5-haiku-20241022\
mode:list\
cachedResultName:Claude Haiku 3.5\
options:\{empty object\}\
type:@n8n/n8n-nodes-langchain.lmChatAnthropic\
typeVersion:1.3\
position\
0:1240\
1:-32\
id:41d27bdf-5edc-46ff-8917-3ecaddb89419\
name:Anthropic Chat Model\
credentials\
anthropicApi\
id:6RlfJdXsmselCNpN\
name:Anthropic account 2\
4\
parameters\
authentication:serviceAccount\
documentId\
__rl:true\
value:1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw\
mode:id\
sheetName\
__rl:true\
value:gid=0\
mode:list\
cachedResultName:Dringlichkeiten\
cachedResultUrl:https://docs.google.com/spreadsheets/d/1Drzkc9BcFsDuCkajyxpDGRpSLOwK4S882TR0m6xo5sw/edit#gid=0\
options:\{empty object\}\
type:n8n-nodes-base.googleSheets\
typeVersion:4.7\
position\
0:-128\
1:-160\
id:a6c31ae2-ebd7-4b86-a478-dcf2bfc53bab\
name:Dringlichkeitskriterien laden\
credentials\
googleApi\
id:vRVq7GTwn9kTIi8N\
name:Google Sheets account 2\
5\
parameters:\{empty object\}\
type:n8n-nodes-base.merge\
typeVersion:3.2\
position\
0:96\
1:-256\
id:a10e58d0-0c20-4b1d-ba2f-0063c93d95af\
name:Merge\
6\
parameters\
assignments\
assignments\
0\
id:9cac8552-e981-44e5-bfc7-854012461c3f\
name:subject\
value:=\{\{ $json.Kategorie \}\} | \{\{ $('Daten extrahieren').first().json.body[0].body.context.einrichtung_name \}\}, \{\{ $('Daten extrahieren').first().json.body[0].body.context.anrufer_name \}\} | \{\{ $json.Themenstichwort \}\}\
type:string\
1\
id:988dd2a7-83ea-48b9-9e7e-bcc66745c72c\
name:htmlBody\
value:=<h3>Problemtyp: \{\{ $json.Problemtyp \}\}</h3>\\n\\n<h4>KI-Einsch\'e4tzung</h4>\\n<p>\\n  <b>Einrichtung:</b> \{\{ $('Daten extrahieren').first().json.body[0].body.context.einrichtung_typ \}\}<br>\\n  <b>Anrufer:</b> \{\{ $('Daten extrahieren').first().json.body[0].body.context.anrufer_name \}\} (\{\{ $('Daten extrahieren').first().json.body[0].body.fromNumber \}\})<br>\\n  <b>Ansprechpartner:</b> \{\{ $json.AnsprechpartnerName ? $json.AnsprechpartnerName : "Wie Anrufer" \}\}<br>\\n  <b>R\'fcckrufnummer:</b> \{\{ $json.Rueckrufnummer ? $json.Rueckrufnummer : $('Daten extrahieren').first().json.body[0].body.fromNumber \}\}<br>\\n  <b>Thema:</b> \{\{ $json.Themenstichwort \}\}\\n</p>\\n\\n<b>Beschreibung:</b>\\n<ul>\\n\{\{ $json.Beschreibung.map(item => `<li>$\{item\}</li>`).join('') \}\}\\n</ul>\\n\\n<b>Begr\'fcndung der Dringlichkeitseinstufung:</b>\\n<p>\{\{ $json.Begr\'fcndung \}\}</p>\\n\\n<hr>\\n\\n<h4>Vollst\'e4ndiges Transkript</h4>\\n<p style="white-space: pre-wrap; color: #555;">\\n\{\{ $('Azure Request Vorbereitung').first().json.messages[1].content \}\}\\n</p>\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:1744\
1:-256\
id:7107ac65-dc9e-45e2-8076-eefd41bbb0f6\
name:E-Mail vorbereiten\
7\
parameters\
fromEmail:office@berent.ai\
toEmail:office@berent.ai\
subject:=\{\{ $json.subject \}\}\
html:=\{\{ $json.htmlBody \}\}\
options:\{empty object\}\
path:fe097452-a8a6-4630-b5f3-88b0208b0a64\
type:n8n-nodes-base.emailSend\
typeVersion:2.1\
position\
0:1968\
1:-256\
id:5c063f17-c7e6-4ccc-afb5-641ef2e937f0\
name:Send email\
webhookId:fe097452-a8a6-4630-b5f3-88b0208b0a64\
credentials\
smtp\
id:8O5B5z4vS8yeagJh\
name:SMTP account\
8\
parameters\
operation:sanitize\
text:=\{\{ $('Merge').item.json.body[0].body.formattedTranscript \}\}\
guardrails\
pii\
value\
type:selected\
entities\
0:EMAIL_ADDRESS\
1:PHONE_NUMBER\
2:IP_ADDRESS\
3:LOCATION\
type:@n8n/n8n-nodes-langchain.guardrails\
typeVersion:1\
position\
0:320\
1:-256\
id:fac51186-cf43-4c80-bc2d-7b1390fddc43\
name:Daten anonymisieren\
9\
parameters\
jsCode:// 1. Zugriff auf die Antwort des AI Agents\\nlet agentOutput = $input.item.json.output || $input.item.json.text || "";\\n\\n// Wir machen sicherheitshalber einen String daraus\\nif (typeof agentOutput === 'object') \{\\n  agentOutput = JSON.stringify(agentOutput);\\n\}\\n\\n// 2. Das Mapping holen (exakter Name der Node davor ist wichtig!)\\nconst mappingData = $('Azure Response Verarbeitung').first();\\nconst nameMapping = mappingData.json.nameMapping || [];\\n\\n// 3. Re-Personalisierung durchf\'fchren (Suchen & Ersetzen im Rohtext)\\n// Wir machen das VOR dem JSON-Parsing, damit auch Namen in Strings ersetzt werden.\\nlet processedText = agentOutput;\\n\\nfor (const item of nameMapping) \{\\n  // Ersetze [PERSON_X] durch den echten Namen (global)\\n  // Wir escapen die Klammern f\'fcr den Regex\\n  const placeholderRegex = new RegExp(item.placeholder.replace(/\\[/g, '\\\\[').replace(/\\]/g, '\\\\]'), 'g');\\n  processedText = processedText.replace(placeholderRegex, item.original);\\n\}\\n\\n// 4. JSON Extrahieren (Der "Gespr\'e4chigkeit"-Filter)\\n// Wir suchen den Bereich zwischen der ersten '\{' und der letzten '\}'\\nconst firstBracket = processedText.indexOf('\{');\\nconst lastBracket = processedText.lastIndexOf('\}');\\n\\nif (firstBracket !== -1 && lastBracket !== -1) \{\\n  // Schneide alles vor der ersten Klammer und nach der letzten Klammer weg\\n  const jsonString = processedText.substring(firstBracket, lastBracket + 1);\\n  \\n  try \{\\n    const finalObject = JSON.parse(jsonString);\\n    return finalObject; // Gib das saubere Objekt zur\'fcck\\n  \} catch (e) \{\\n    return \{ error: "JSON war trotz Filterung ung\'fcltig", raw: processedText \};\\n  \}\\n\} else \{\\n  // Fallback, falls gar keine Klammern gefunden wurden\\n  return \{ error: "Kein JSON im Antworttext gefunden", raw: processedText \};\\n\}\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1520\
1:-256\
id:f56c3653-a9d6-4221-bd93-46b9816e4e44\
name:Re-Personalisierung\
10\
parameters\
method:POST\
url:https://berent-ki.services.ai.azure.com/models/chat/completions?api-version=2024-05-01-preview\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
contentType:=json\
specifyBody:json\
bodyParameters\
parameters\
0:\{empty object\}\
jsonBody:=\{\{ $json \}\}\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.3\
position\
0:768\
1:-256\
id:52c4ea34-c0a9-47f2-aaa7-a6d66b74e3c3\
name:Namen-Anonymisierung (Azure)\
retryOnFail:true\
waitBetweenTries:5000\
maxTries:5\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:Header Auth account\
httpBearerAuth\
id:24SORzPv91ZRH2UW\
name:Bearer Auth account\
11\
parameters\
jsCode:// Wir greifen auf die Antwort der Azure-Node zu\\nconst response = $input.item.json;\\n\\n// Sicherstellen, dass wir eine Antwort haben\\nif (response.choices && response.choices[0] && response.choices[0].message) \{\\n  \\n  // Den Textinhalt holen\\n  let content = response.choices[0].message.content;\\n  \\n  // Oft sendet die KI den Text in Markdown-Bl\'f6cken (```json ... ```).\\n  // Diese entfernen wir hier, damit das JSON sauber ist.\\n  content = content.replace(/^```json\\s*/, "").replace(/\\s*```$/, "");\\n  \\n  try \{\\n    // Den Textstring in ein echtes JSON-Objekt umwandeln\\n    const parsedData = JSON.parse(content);\\n    \\n    // Das saubere Ergebnis zur\'fcckgeben\\n    return parsedData;\\n    \\n  \} catch (error) \{\\n    // Falls die KI kein g\'fcltiges JSON geschickt hat, geben wir den Rohtext zur\'fcck\\n    return \{\\n      error: "Konnte JSON nicht parsen",\\n      rawContent: content\\n    \};\\n  \}\\n\} else \{\\n  return \{ error: "Keine g\'fcltige Antwort von Azure erhalten" \};\\n\}\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:992\
1:-256\
id:c5e92ee9-c3c0-4dab-9647-c5ef188f56f3\
name:Azure Response Verarbeitung\
12\
parameters\
mode:runOnceForEachItem\
jsCode:// Daten aus der vorherigen Node holen\\n// Fallback auf leeren String, falls keine Daten da sind\\nconst transcript = $input.item.json.guardrailsInput || $input.item.json.output || "";\\n\\nconst systemPrompt = `Du bist ein Spezialist f\'fcr die Anonymisierung von Personennamen in deutschen Telefon-Transkripten.\\n\\n###DEINE AUFGABE###\\nErkenne alle Personennamen (Vornamen und Nachnamen) im gegebenen Text und ersetze sie durch nummerierte Platzhalter im Format [PERSON_1], [PERSON_2], [PERSON_3] etc.\\n\\n###REGELN###\\n1. Erkenne nur echte Personennamen (z.B. Thomas, Anna, M\'fcller, Schmidt)\\n2. Ignoriere Titel wie 'Herr', 'Frau', 'Dr.' - diese bleiben unver\'e4ndert\\n3. Ersetze jeden gefundenen Namen durch einen eindeutigen Platzhalter [PERSON_N]\\n4. Gleiche Namen im Text erhalten den gleichen Platzhalter (z.B. 'Thomas' wird immer zu [PERSON_1])\\n5. Verschiedene Namen erhalten verschiedene Platzhalter (z.B. 'Thomas' \uc0\u8594  [PERSON_1], 'Anna' \u8594  [PERSON_2])\\n6. Behalte die urspr\'fcngliche Formatierung bei (Zeilenumbr\'fcche, Interpunktion)\\n\\n###AUSGABEFORMAT###\\nGib dein Ergebnis im folgenden JSON-Format zur\'fcck:\\n\\`\\`\\`json\\n\{\\n  "anonymizedText": "Der anonymisierte Text mit [PERSON_1], [PERSON_2] etc.",\\n  "nameMapping": [\\n    \{"original": "Thomas", "placeholder": "[PERSON_1]"\},\\n    \{"original": "Anna", "placeholder": "[PERSON_2]"\}\\n  ]\\n\}\\n\\`\\`\\``;\\n\\n// Das fertige Payload-Objekt zur\'fcckgeben\\nreturn \{\\n  model: "mistral-namen-anonymisierung",\\n  messages: [\\n    \{\\n      role: "system",\\n      content: systemPrompt\\n    \},\\n    \{\\n      role: "user",\\n      content: transcript\\n    \}\\n  ],\\n  temperature: 0.1,\\n  max_tokens: 1000\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:544\
1:-256\
id:71a225d6-c63f-4406-9b8e-ebd0d6583983\
name:Azure Request Vorbereitung\
connections\
Webhook\
main\
0\
0\
node:Daten extrahieren\
type:main\
index:0\
1\
node:Dringlichkeitskriterien laden\
type:main\
index:0\
Daten extrahieren\
main\
0\
0\
node:Merge\
type:main\
index:0\
Anthropic Chat Model\
ai_languageModel\
0\
0\
node:AI Agent\
type:ai_languageModel\
index:0\
Dringlichkeitskriterien laden\
main\
0\
0\
node:Merge\
type:main\
index:1\
Merge\
main\
0\
0\
node:Daten anonymisieren\
type:main\
index:0\
AI Agent\
main\
0\
0\
node:Re-Personalisierung\
type:main\
index:0\
E-Mail vorbereiten\
main\
0\
0\
node:Send email\
type:main\
index:0\
Daten anonymisieren\
main\
0\
0\
node:Azure Request Vorbereitung\
type:main\
index:0\
Re-Personalisierung\
main\
0\
0\
node:E-Mail vorbereiten\
type:main\
index:0\
Namen-Anonymisierung (Azure)\
main\
0\
0\
node:Azure Response Verarbeitung\
type:main\
index:0\
Azure Response Verarbeitung\
main\
0\
0\
node:AI Agent\
type:main\
index:0\
Azure Request Vorbereitung\
main\
0\
0\
node:Namen-Anonymisierung (Azure)\
type:main\
index:0\
settings\
executionOrder:v1\
staticData:null\
meta\
templateCredsSetupCompleted:true\
pinData:\{empty object\}\
versionId:ff80dabd-1fed-4040-80cc-57cb072f03a9\
activeVersionId:null\
triggerCount:0\
shared\
0\
updatedAt:2025-12-09T17:10:51.897Z\
createdAt:2025-12-09T17:10:51.897Z\
role:workflow:owner\
workflowId:lQCvszSC2kiedNIp\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
24\
updatedAt:2025-12-24T08:45:10.749Z\
createdAt:2025-12-24T08:44:50.939Z\
id:ovQVCmXRHzylDIOF\
name:n8n to GitHub Auto-Backup (inkrementell) Neuerung\
active:false\
isArchived:false\
nodes\
0\
parameters:\{empty object\}\
id:9705f3db-c7b6-4503-b6fd-c50a2aa40522\
name:Manual Trigger\
type:n8n-nodes-base.manualTrigger\
typeVersion:1\
position\
0:-2864\
1:-160\
1\
parameters\
assignments\
assignments\
0\
id:161e6775-602d-4527-befd-e58008924f10\
name:secret\
value:18DOvPKBV7ize3Nh\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:-2640\
1:-240\
id:fef91bf0-7ceb-423f-a6a5-b086e6357f34\
name:Config\
2\
parameters\
mode:runOnceForEachItem\
jsCode:const r = $json; // Das ist der Rucksack\\nconst wf = r.workflows[r.index];\\n\\n// Selbst-Backup Sperre\\nconst isSelf = wf.id === 'C3QqvJAGjf0KhCZH';\\n\\nconst name = wf.name || "unnamed";\\nconst clean = String(name).replace(/[^a-zA-Z0-9-_\'e4\'f6\'fc\'c4\'d6\'dc\'df ]/g, '').replace(/\\s+/g, '-').toLowerCase();\\n\\nr.aktueller_name = name;\\nr.aktueller_pfad = `n8n/$\{clean\}.json`;\\nr.aktueller_inhalt = Buffer.from(JSON.stringify(wf, null, 2)).toString('base64');\\nr.ist_self = isSelf;\\n\\nreturn r;\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-1744\
1:-432\
id:e8cf43e1-12ec-4d8e-af3f-e06096d4f0c4\
name:Extrahieren und Verarbeiten\
3\
parameters\
jsCode:const r = $json;\\nconst wort = r.anzahl === 1 ? 'Workflow' : 'Workflows';\\n\\nreturn \{\\n  hasChanges: (r.neu + r.updates) > 0,\\n  text: `\uc0\u9989  Backup beendet: $\{r.anzahl\} $\{wort\} gepr\'fcft.\\n` +\\n        `Ergebnis: $\{r.neu\} neu, $\{r.updates\} aktualisiert, $\{r.skip\} unver\'e4ndert.\\n\\n` +\\n        `$\{r.tabelle.join('\\n') || 'Keine \'c4nderungen'\}`\\n\};\
id:ab1c65c9-9afc-4c0b-b93a-d7811b427542\
name:Backup-Statistik einsammeln\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-1744\
1:-240\
4\
parameters\
mode:runOnceForEachItem\
jsCode:const remote = $json; // GitHub Ergebnis\\nconst r = $node["Extrahieren und Verarbeiten"].json; // Unser Rucksack\\n\\nlet action = 'skip';\\nlet sha = remote.sha || null;\\n\\nif (!r.ist_self) \{\\n    if (remote.error || !remote.sha) \{\\n        action = 'create';\\n    \} else \{\\n        const remoteContent = (remote.content || '').replace(/\\s/g, '');\\n        const localContent = (r.aktueller_inhalt || '').replace(/\\s/g, '');\\n        if (remoteContent !== localContent) \{\\n            action = 'update';\\n        \}\\n    \}\\n\}\\n\\n// WICHTIG: Wir geben den Rucksack (r) plus die neue Entscheidung zur\'fcck\\nreturn \{ ...r, action, sha \};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-1296\
1:-432\
id:5ec8b2e2-dc37-465d-aa16-dfcf01dba364\
name:Bestimme Handlung\
5\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:1\
conditions\
0\
id:stats-has-changes\
leftValue:=\{\{ $json.hasChanges \}\}\
rightValue:true\
operator\
type:boolean\
operation:equals\
combinator:and\
options:\{empty object\}\
id:456e093d-1ba2-4239-98ac-c8df0a518dd3\
name:Benachrichtigung senden?\
type:n8n-nodes-base.if\
typeVersion:2\
position\
0:-1520\
1:-240\
6\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:a21035d4-b914-483c-aca3-c493a3546872\
leftValue:=\{\{ $json.action \}\}\
rightValue:skip\
operator\
type:string\
operation:notEquals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:-1072\
1:-432\
id:ea6eb7b1-db33-4129-a9e1-fc88204cc302\
name:Ge\'e4nderter Workflow?\
7\
parameters\
url:http://localhost:5678/api/v1/workflows\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
options\
response\
response\
responseFormat:json\
pagination\
pagination\
parameters\
parameters\
0\
name:cursor\
value:=\{\{ $response.body.nextCursor \}\}\
paginationCompleteWhen:other\
completeExpression:=\{\{ !$response.body.nextCursor \}\}\
limitPagesFetched:true\
id:987a6c57-c23e-4d88-9333-9a964915fddf\
name:Hole alle Workflows\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-2416\
1:-240\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:API n8n\
8\
parameters\
method:POST\
url:https://msgapi.threema.ch/send_simple\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
contentType:form-urlencoded\
bodyParameters\
parameters\
0\
name:from\
value:*BERENT1\
1\
name:to\
value:BUMFMZ39\
2\
name:secret\
value:=\{\{ $('Config').first().json.secret \}\}\
3\
name:text\
value:=\{\{ $json.text \}\}\\n\\n\uc0\u55357 \u56599  https://github.com/peerendees/n8n-workflows/n8n\
options:\{empty object\}\
id:365fbb33-26af-4a04-8287-46e25d8adb23\
name:Threema Benachrichtigung\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-1296\
1:-240\
credentials\
httpHeaderAuth\
id:nSNvIRCSAnKXrLyH\
name:API Threema Work BERENT1\
9\
parameters\
method:PUT\
url:=https://api.github.com/repos/peerendees/n8n-workflows/contents/\{\{ $json.aktueller_pfad \}\}\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
bodyParameters\
parameters\
0\
name:message\
value:=\uc0\u55358 \u56598  Auto-Backup: \{\{ $json.aktueller_name \}\} (\{\{ $json.action \}\})\
1\
name:content\
value:=\{\{ $json.aktueller_inhalt \}\}\
2\
name:branch\
value:main\
3\
name:sha\
value:=\{\{ $json.sha ? $json.sha : undefined \}\}\
options:\{empty object\}\
id:c3c2809c-7cf3-4e44-a546-d85f725b5a28\
name:An GitHub \'fcbergeben\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-848\
1:-496\
credentials\
httpHeaderAuth\
id:aZMd0okvVFkvyGnj\
name:GitHub Token\
onError:continueRegularOutput\
10\
parameters\
rule\
interval\
0\
field:cronExpression\
expression:*/15 7-20 * * *\
id:720230f9-72f1-4be2-a0a4-6a967d431d80\
name:Zeitplan: 7-20 Uhr (alle 15min)\
type:n8n-nodes-base.scheduleTrigger\
typeVersion:1.2\
position\
0:-2864\
1:-352\
11\
parameters\
jsCode:const workflows = $node["Hole alle Workflows"].json.data || [];\\nreturn \{\\n  workflows: workflows,\\n  index: 0,\\n  anzahl: workflows.length,\\n  neu: 0,\\n  updates: 0,\\n  skip: 0,\\n  tabelle: [] // Hier kommen die Namen rein\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-2192\
1:-240\
id:68296f60-8fe0-4834-b587-98880f47a8fc\
name:Initialisierung\
12\
parameters\
mode:runOnceForEachItem\
jsCode:// WICHTIG: Wir ignorieren das direkte Input-JSON (GitHub Antwort)\\n// und holen uns den Rucksack direkt von "Bestimme Handlung" zur\'fcck.\\nconst r = $("Bestimme Handlung").item.json;\\n\\nif (!r.ist_self) \{\\n    if (r.action === 'create') \{\\n        r.neu++;\\n        r.tabelle.push(`\'95 $\{r.aktueller_name\} (Neu)`);\\n    \} else if (r.action === 'update') \{\\n        r.updates++;\\n        r.tabelle.push(`\'95 $\{r.aktueller_name\} (Update)`);\\n    \} else \{\\n        r.skip++;\\n    \}\\n\} else \{\\n    r.skip++;\\n\}\\n\\n// Z\'e4hler erh\'f6hen\\nr.index++;\\n\\n// Jetzt ist der Rucksack wieder das Haupt-Objekt f\'fcr die n\'e4chste Runde\\nreturn r;\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-624\
1:-304\
id:27d55f4d-4299-45db-969a-b7d24e94d451\
name:Tabelle pflegen\
13\
parameters\
resource:file\
operation:get\
owner\
__rl:true\
value:peerendees\
mode:name\
repository\
__rl:true\
value:n8n-workflows\
mode:list\
cachedResultName:n8n-workflows\
cachedResultUrl:https://github.com/peerendees/n8n-workflows\
filePath:=\{\{ $json.aktueller_pfad \}\}\
asBinaryProperty:false\
additionalParameters\
reference:main\
type:n8n-nodes-base.github\
typeVersion:1.1\
position\
0:-1520\
1:-432\
id:320bc400-3956-4d2c-809d-c4fa1607b847\
name:Pr\'fcfe GitHub zur Datei\
webhookId:694567e2-c3e8-4bfc-91af-aae5697aca36\
credentials\
githubApi\
id:uE78TkEY6lWLV4oP\
name:API GitHub\
onError:continueRegularOutput\
14\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:54a2217a-25f1-452b-a80a-b7b77c94f9f7\
leftValue:=\{\{ $json.index \}\}\
rightValue:=\{\{ $json.anzahl \}\}\
operator\
type:number\
operation:lt\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:-1968\
1:-240\
id:bb37ab0f-fcd7-49e8-bc62-aebd32b0431d\
name:Schleife pr\'fcfen\
15\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:final-commit-check\
leftValue:=\{\{ $json.hasChanges \}\}\
rightValue:true\
operator\
type:boolean\
operation:equals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:-1072\
1:-160\
id:e4152644-9506-41d6-9045-badd2d4eb4f4\
name:Finaler Commit/Push\
16\
parameters\
url:=http://localhost:5678/api/v1/workflows/C3QqvJAGjf0KhCZH\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
options\
response\
response\
responseFormat:json\
id:c50e5aa1-5212-4b79-b232-3968246c41df\
name:Hole aktuellen Workflow\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-2640\
1:16\
credentials\
httpHeaderAuth\
id:4gc7MePUZVuCyowB\
name:API n8n\
17\
parameters\
jsCode:const workflow = $json.data || $json;\\nconst workflowJson = JSON.stringify(workflow, null, 2);\\nconst content = Buffer.from(workflowJson).toString('base64');\\n\\nreturn \{\\n  workflow_name: workflow.name || 'n8n-Backup-Workflow',\\n  workflow_content: content,\\n  workflow_json: workflowJson\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-2416\
1:16\
id:6be53368-4a5f-4d25-8a09-2e4fd87b2b4d\
name:Workflow vorbereiten\
18\
parameters\
resource:file\
operation:get\
owner\
__rl:true\
value:peerendees\
mode:name\
repository\
__rl:true\
value:n8n-workflows\
mode:list\
cachedResultName:n8n-workflows\
cachedResultUrl:https://github.com/peerendees/n8n-workflows\
filePath:n8n-Backup-Workflow.json\
asBinaryProperty:false\
additionalParameters\
reference:main\
type:n8n-nodes-base.github\
typeVersion:1.1\
position\
0:-2192\
1:16\
id:0a7c9a07-f43b-4c98-aa73-e8066c2e25ea\
name:Pr\'fcfe Workflow auf GitHub\
webhookId:694567e2-c3e8-4bfc-91af-aae5697aca36\
credentials\
githubApi\
id:uE78TkEY6lWLV4oP\
name:API GitHub\
onError:continueRegularOutput\
19\
parameters\
jsCode:const remote = $json;\\nconst local = $node["Workflow vorbereiten"].json;\\n\\nlet sha = null;\\nlet action = 'create';\\n\\nif (!remote.error && remote.sha) \{\\n  sha = remote.sha;\\n  const remoteContent = (remote.content || '').replace(/\\s/g, '');\\n  const localContent = (local.workflow_content || '').replace(/\\s/g, '');\\n  if (remoteContent !== localContent) \{\\n    action = 'update';\\n  \} else \{\\n    action = 'skip';\\n  \}\\n\}\\n\\nreturn \{\\n  ...local,\\n  sha: sha,\\n  action: action\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:-1968\
1:16\
id:27857a54-4835-4a5e-a352-f1d05ce5c852\
name:Bestimme Workflow-Aktion\
20\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:workflow-action-check\
leftValue:=\{\{ $json.action \}\}\
rightValue:skip\
operator\
type:string\
operation:notEquals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:-1744\
1:16\
id:97ed8525-af0f-46d0-b731-2951a301aef1\
name:Workflow ge\'e4ndert?\
21\
parameters\
method:PUT\
url:https://api.github.com/repos/peerendees/n8n-workflows/contents/n8n-Backup-Workflow.json\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
bodyParameters\
parameters\
0\
name:message\
value:=\uc0\u55358 \u56598  Workflow-Backup: \{\{ $json.workflow_name \}\} (\{\{ $json.action \}\})\
1\
name:content\
value:=\{\{ $json.workflow_content \}\}\
2\
name:branch\
value:main\
3\
name:sha\
value:=\{\{ $json.sha ? $json.sha : undefined \}\}\
options:\{empty object\}\
id:5865efc4-c421-4f1d-ae18-44015e03410f\
name:Workflow auf GitHub speichern\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-1520\
1:16\
credentials\
httpHeaderAuth\
id:aZMd0okvVFkvyGnj\
name:GitHub Token\
onError:continueRegularOutput\
22\
parameters\
url:https://api.github.com/repos/peerendees/n8n-workflows/commits/main\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
options\
response\
response\
responseFormat:json\
id:86229354-bc42-473a-ac1f-da2e22a0e545\
name:GitHub Commit best\'e4tigen\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-848\
1:-160\
credentials\
httpHeaderAuth\
id:aZMd0okvVFkvyGnj\
name:GitHub Token\
onError:continueRegularOutput\
connections\
Manual Trigger\
main\
0\
0\
node:Config\
type:main\
index:0\
Config\
main\
0\
0\
node:Hole alle Workflows\
type:main\
index:0\
Extrahieren und Verarbeiten\
main\
0\
0\
node:Pr\'fcfe GitHub zur Datei\
type:main\
index:0\
Backup-Statistik einsammeln\
main\
0\
0\
node:Benachrichtigung senden?\
type:main\
index:0\
Bestimme Handlung\
main\
0\
0\
node:Ge\'e4nderter Workflow?\
type:main\
index:0\
Benachrichtigung senden?\
main\
0\
0\
node:Threema Benachrichtigung\
type:main\
index:0\
Ge\'e4nderter Workflow?\
main\
0\
0\
node:An GitHub \'fcbergeben\
type:main\
index:0\
1\
0\
node:Tabelle pflegen\
type:main\
index:0\
Hole alle Workflows\
main\
0\
0\
node:Initialisierung\
type:main\
index:0\
Threema Benachrichtigung\
main\
0\
0\
node:Finaler Commit/Push\
type:main\
index:0\
An GitHub \'fcbergeben\
main\
0\
0\
node:Tabelle pflegen\
type:main\
index:0\
Zeitplan: 7-20 Uhr (alle 15min)\
main\
0\
0\
node:Config\
type:main\
index:0\
Initialisierung\
main\
0\
0\
node:Schleife pr\'fcfen\
type:main\
index:0\
Tabelle pflegen\
main\
0\
0\
node:Schleife pr\'fcfen\
type:main\
index:0\
Pr\'fcfe GitHub zur Datei\
main\
0\
0\
node:Bestimme Handlung\
type:main\
index:0\
Schleife pr\'fcfen\
main\
0\
0\
node:Extrahieren und Verarbeiten\
type:main\
index:0\
1\
0\
node:Backup-Statistik einsammeln\
type:main\
index:0\
Finaler Commit/Push\
main\
0\
0\
node:GitHub Commit best\'e4tigen\
type:main\
index:0\
Hole aktuellen Workflow\
main\
0\
0\
node:Workflow vorbereiten\
type:main\
index:0\
Workflow vorbereiten\
main\
0\
0\
node:Pr\'fcfe Workflow auf GitHub\
type:main\
index:0\
Pr\'fcfe Workflow auf GitHub\
main\
0\
0\
node:Bestimme Workflow-Aktion\
type:main\
index:0\
Bestimme Workflow-Aktion\
main\
0\
0\
node:Workflow ge\'e4ndert?\
type:main\
index:0\
Workflow ge\'e4ndert?\
main\
0\
0\
node:Workflow auf GitHub speichern\
type:main\
index:0\
settings\
executionOrder:v1\
staticData:null\
meta:null\
pinData:\{empty object\}\
versionId:5b1327fb-e7b0-4cb4-b575-b5d4bf3a422d\
activeVersionId:null\
triggerCount:0\
shared\
0\
updatedAt:2025-12-24T08:44:50.943Z\
createdAt:2025-12-24T08:44:50.943Z\
role:workflow:owner\
workflowId:ovQVCmXRHzylDIOF\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
25\
updatedAt:2025-12-31T22:45:43.055Z\
createdAt:2025-11-24T19:30:01.014Z\
id:p4WBXmtWQqToEtLw\
name:Hedy Webhook to Notion 0.9\
active:true\
isArchived:false\
nodes\
0\
parameters\
httpMethod:POST\
path:Hedy-Events\
authentication:headerAuth\
options:\{empty object\}\
type:n8n-nodes-base.webhook\
typeVersion:2.1\
position\
0:2352\
1:240\
id:217a120d-3a61-4beb-89ba-6540349858d6\
name:Hedy API\
webhookId:b9081b42-f39a-4933-9964-4dcfa7aa227e\
credentials\
httpHeaderAuth\
id:ddbOaicomtaiLVQV\
name:Hedy Webhook Auth\
1\
parameters\
jsCode:// Parse Hedy Webhook-Daten und normalisiere f\'fcr Notion (Option 2)\\n// Die Hedy API sendet Daten direkt im Root, nicht in 'body'\\nconst webhookData = $json;\\n\\n// Extrahiere Event-Typ und Daten\\nconst eventType = webhookData.event || '';\\nconst eventData = webhookData.data || \{\};\\nconst timestamp = webhookData.timestamp || new Date().toISOString();\\n\\n// Bestimme Werte je nach Event-Typ\\nlet title = '';\\nlet summary = '';\\nlet content = '';\\nlet sessionId = null;\\nlet sessionTitle = null;\\nlet dueDate = null;\\nlet status = null;\\n\\nif (eventType.startsWith('session.')) \{\\n  // Session-Events: session.created, session.ended\\n  title = eventData.title || `Session $\{eventData.id || ''\}`;\\n  summary = eventData.meeting_minutes || eventData.title || '';\\n  content = eventData.transcript || \\n            eventData.meeting_minutes || \\n            eventData.conversations || \\n            `Session $\{eventType\} - $\{timestamp\}`;\\n  sessionId = eventData.id || null;\\n  sessionTitle = eventData.title || null;\\n  \\n\} else if (eventType === 'highlight.created') \{\\n  // Highlight-Events\\n  title = eventData.title || 'Highlight';\\n  summary = eventData.mainIdea || eventData.title || '';\\n  \\n  const parts = [];\\n  if (eventData.mainIdea) parts.push(`**Hauptidee:** $\{eventData.mainIdea\}`);\\n  if (eventData.cleanedQuote) parts.push(`**Zitat:** $\{eventData.cleanedQuote\}`);\\n  if (eventData.rawQuote && eventData.rawQuote !== eventData.cleanedQuote) \{\\n    parts.push(`**Original:** $\{eventData.rawQuote\}`);\\n  \}\\n  if (eventData.aiInsight) parts.push(`**AI Insight:** $\{eventData.aiInsight\}`);\\n  content = parts.join('\\n\\n') || 'Keine Details verf\'fcgbar';\\n  \\n  sessionId = eventData.sessionId || null;\\n  // Session-Titel m\'fcsste aus einer vorherigen Session gelesen werden\\n  // Oder aus dem Webhook, falls verf\'fcgbar\\n  \\n\} else if (eventType === 'todo.exported') \{\\n  // Todo-Events - WICHTIG: data.text statt data.message!\\n  title = eventData.text || 'Unnamed Todo';\\n  summary = eventData.dueDate || '';\\n  status = 'offen'; // Standard-Status f\'fcr neue Todos\\n  \\n  const parts = [];\\n  parts.push(`**Text:** $\{eventData.text || ''\}`);\\n  if (eventData.dueDate) \{\\n    parts.push(`**F\'e4lligkeitsdatum:** $\{eventData.dueDate\}`);\\n    // Versuche Due Date zu parsen (falls Format bekannt)\\n    // Beispiel: "May 18, 2027 3pm" oder "Tomorrow"\\n    // dueDate = parseDueDate(eventData.dueDate);\\n  \}\\n  if (eventData.sessionId) parts.push(`**Session ID:** $\{eventData.sessionId\}`);\\n  if (eventData.id) parts.push(`**Todo ID:** $\{eventData.id\}`);\\n  content = parts.join('\\n');\\n  \\n  sessionId = eventData.sessionId || null;\\n  // Due Date parsen (falls Format bekannt)\\n  // dueDate = parseDueDate(eventData.dueDate);\\n  \\n\} else \{\\n  // Unbekanntes Event - Fallback\\n  title = `Unknown Event: $\{eventType || 'N/A'\}`;\\n  summary = '';\\n  content = `**Event-Typ:** $\{eventType\}\\n\\n**Daten:**\\n\\n\\`\\`\\`json\\n$\{JSON.stringify(eventData, null, 2)\}\\n\\`\\`\\``;\\n\}\\n\\nreturn \{\\n  json: \{\\n    eventType: eventType || null,\\n    title: title,\\n    summary: summary,\\n    content: content,\\n    timestamp: timestamp,\\n    sessionId: sessionId || '',\\n    sessionTitle: sessionTitle || '',\\n    dueDate: dueDate || '',\\n    status: status || '',\\n    // Behalte originale Daten f\'fcr Debugging\\n    rawData: webhookData\\n  \}\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:2576\
1:240\
id:8b862374-2f39-4c0a-b2ca-834f1216ce75\
name:Parse Hedy Daten\
2\
parameters\
resource:databasePage\
databaseId\
__rl:true\
value:50466f0c-d204-4e54-b2e5-d4d2f874e9e8\
mode:list\
cachedResultName:Hedy Events\
cachedResultUrl:https://www.notion.so/50466f0cd2044e54b2e5d4d2f874e9e8\
title:Hedy Transkript\
propertiesUi\
propertyValues\
0\
key:Titel|title\
title:=\{\{ $json.title \}\}\
1\
key:Event-Typ|select\
selectValue:=\{\{ $json.eventType || 'session.created' \}\}\
2\
key:Status|select\
selectValue:=\{\{ $json.status || '-' \}\}\
3\
key:Transkript|rich_text\
textContent:=\{\{ $json.content \}\}\
4\
key:Session ID|rich_text\
textContent:=\{\{ $json.sessionId \}\}\
5\
key:Session Titel|rich_text\
textContent:=\{\{ $json.sessionTitle \}\}\
6\
key:Erstellungsdatum|date\
7\
key:Due Date|date\
options:\{empty object\}\
type:n8n-nodes-base.notion\
typeVersion:2.2\
position\
0:2800\
1:240\
id:466fbad2-d590-4882-a535-d318ee406b7b\
name:Hedy Transkript 0.9\
credentials\
notionApi\
id:KpKj51GJ0big0oYv\
name:API Notion\
connections\
Hedy API\
main\
0\
0\
node:Parse Hedy Daten\
type:main\
index:0\
Parse Hedy Daten\
main\
0\
0\
node:Hedy Transkript 0.9\
type:main\
index:0\
settings\
executionOrder:v1\
staticData:null\
meta\
templateCredsSetupCompleted:true\
pinData:\{empty object\}\
versionId:b754a45f-4db8-4dfd-b901-03e885a1d6a3\
activeVersionId:b754a45f-4db8-4dfd-b901-03e885a1d6a3\
triggerCount:1\
shared\
0\
updatedAt:2025-11-24T19:30:01.018Z\
createdAt:2025-11-24T19:30:01.018Z\
role:workflow:owner\
workflowId:p4WBXmtWQqToEtLw\
projectId:yr4Hj71ou1NOsi2p\
activeVersion\
updatedAt:2025-12-31T22:31:30.000Z\
createdAt:2025-12-31T22:31:27.252Z\
versionId:b754a45f-4db8-4dfd-b901-03e885a1d6a3\
workflowId:p4WBXmtWQqToEtLw\
nodes\
0\
parameters\
httpMethod:POST\
path:Hedy-Events\
authentication:headerAuth\
options:\{empty object\}\
type:n8n-nodes-base.webhook\
typeVersion:2.1\
position\
0:2352\
1:240\
id:217a120d-3a61-4beb-89ba-6540349858d6\
name:Hedy API\
webhookId:b9081b42-f39a-4933-9964-4dcfa7aa227e\
credentials\
httpHeaderAuth\
id:ddbOaicomtaiLVQV\
name:Hedy Webhook Auth\
1\
parameters\
jsCode:// Parse Hedy Webhook-Daten und normalisiere f\'fcr Notion (Option 2)\\n// Die Hedy API sendet Daten direkt im Root, nicht in 'body'\\nconst webhookData = $json;\\n\\n// Extrahiere Event-Typ und Daten\\nconst eventType = webhookData.event || '';\\nconst eventData = webhookData.data || \{\};\\nconst timestamp = webhookData.timestamp || new Date().toISOString();\\n\\n// Bestimme Werte je nach Event-Typ\\nlet title = '';\\nlet summary = '';\\nlet content = '';\\nlet sessionId = null;\\nlet sessionTitle = null;\\nlet dueDate = null;\\nlet status = null;\\n\\nif (eventType.startsWith('session.')) \{\\n  // Session-Events: session.created, session.ended\\n  title = eventData.title || `Session $\{eventData.id || ''\}`;\\n  summary = eventData.meeting_minutes || eventData.title || '';\\n  content = eventData.transcript || \\n            eventData.meeting_minutes || \\n            eventData.conversations || \\n            `Session $\{eventType\} - $\{timestamp\}`;\\n  sessionId = eventData.id || null;\\n  sessionTitle = eventData.title || null;\\n  \\n\} else if (eventType === 'highlight.created') \{\\n  // Highlight-Events\\n  title = eventData.title || 'Highlight';\\n  summary = eventData.mainIdea || eventData.title || '';\\n  \\n  const parts = [];\\n  if (eventData.mainIdea) parts.push(`**Hauptidee:** $\{eventData.mainIdea\}`);\\n  if (eventData.cleanedQuote) parts.push(`**Zitat:** $\{eventData.cleanedQuote\}`);\\n  if (eventData.rawQuote && eventData.rawQuote !== eventData.cleanedQuote) \{\\n    parts.push(`**Original:** $\{eventData.rawQuote\}`);\\n  \}\\n  if (eventData.aiInsight) parts.push(`**AI Insight:** $\{eventData.aiInsight\}`);\\n  content = parts.join('\\n\\n') || 'Keine Details verf\'fcgbar';\\n  \\n  sessionId = eventData.sessionId || null;\\n  // Session-Titel m\'fcsste aus einer vorherigen Session gelesen werden\\n  // Oder aus dem Webhook, falls verf\'fcgbar\\n  \\n\} else if (eventType === 'todo.exported') \{\\n  // Todo-Events - WICHTIG: data.text statt data.message!\\n  title = eventData.text || 'Unnamed Todo';\\n  summary = eventData.dueDate || '';\\n  status = 'offen'; // Standard-Status f\'fcr neue Todos\\n  \\n  const parts = [];\\n  parts.push(`**Text:** $\{eventData.text || ''\}`);\\n  if (eventData.dueDate) \{\\n    parts.push(`**F\'e4lligkeitsdatum:** $\{eventData.dueDate\}`);\\n    // Versuche Due Date zu parsen (falls Format bekannt)\\n    // Beispiel: "May 18, 2027 3pm" oder "Tomorrow"\\n    // dueDate = parseDueDate(eventData.dueDate);\\n  \}\\n  if (eventData.sessionId) parts.push(`**Session ID:** $\{eventData.sessionId\}`);\\n  if (eventData.id) parts.push(`**Todo ID:** $\{eventData.id\}`);\\n  content = parts.join('\\n');\\n  \\n  sessionId = eventData.sessionId || null;\\n  // Due Date parsen (falls Format bekannt)\\n  // dueDate = parseDueDate(eventData.dueDate);\\n  \\n\} else \{\\n  // Unbekanntes Event - Fallback\\n  title = `Unknown Event: $\{eventType || 'N/A'\}`;\\n  summary = '';\\n  content = `**Event-Typ:** $\{eventType\}\\n\\n**Daten:**\\n\\n\\`\\`\\`json\\n$\{JSON.stringify(eventData, null, 2)\}\\n\\`\\`\\``;\\n\}\\n\\nreturn \{\\n  json: \{\\n    eventType: eventType || null,\\n    title: title,\\n    summary: summary,\\n    content: content,\\n    timestamp: timestamp,\\n    sessionId: sessionId || '',\\n    sessionTitle: sessionTitle || '',\\n    dueDate: dueDate || '',\\n    status: status || '',\\n    // Behalte originale Daten f\'fcr Debugging\\n    rawData: webhookData\\n  \}\\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:2576\
1:240\
id:8b862374-2f39-4c0a-b2ca-834f1216ce75\
name:Parse Hedy Daten\
2\
parameters\
resource:databasePage\
databaseId\
__rl:true\
value:50466f0c-d204-4e54-b2e5-d4d2f874e9e8\
mode:list\
cachedResultName:Hedy Events\
cachedResultUrl:https://www.notion.so/50466f0cd2044e54b2e5d4d2f874e9e8\
title:Hedy Transkript\
propertiesUi\
propertyValues\
0\
key:Titel|title\
title:=\{\{ $json.title \}\}\
1\
key:Event-Typ|select\
selectValue:=\{\{ $json.eventType || 'session.created' \}\}\
2\
key:Status|select\
selectValue:=\{\{ $json.status || '-' \}\}\
3\
key:Transkript|rich_text\
textContent:=\{\{ $json.content \}\}\
4\
key:Session ID|rich_text\
textContent:=\{\{ $json.sessionId \}\}\
5\
key:Session Titel|rich_text\
textContent:=\{\{ $json.sessionTitle \}\}\
6\
key:Erstellungsdatum|date\
7\
key:Due Date|date\
options:\{empty object\}\
type:n8n-nodes-base.notion\
typeVersion:2.2\
position\
0:2800\
1:240\
id:466fbad2-d590-4882-a535-d318ee406b7b\
name:Hedy Transkript 0.9\
credentials\
notionApi\
id:KpKj51GJ0big0oYv\
name:API Notion\
connections\
Hedy API\
main\
0\
0\
node:Parse Hedy Daten\
type:main\
index:0\
Parse Hedy Daten\
main\
0\
0\
node:Hedy Transkript 0.9\
type:main\
index:0\
authors:Marcus Kunkel\
name:Version b754a45f\
description:empty\
autosaved:false\
tags:[empty array]\
26\
updatedAt:2025-11-11T19:56:36.000Z\
createdAt:2025-11-11T19:55:46.546Z\
id:qKt4bbsURorhPjBI\
name:Brainstorming Assistent Sprachesteuerung\
active:false\
isArchived:false\
nodes\
0\
parameters\
promptType:define\
text:=\{\{ $json.text \}\}\
options\
systemMessage:=<system_prompt>\\nDU BIST EIN HOCHSPEZIALISIERTER BRAINSTORMING-ASSISTENT F\'dcR LARS FI\'cbCK \'96 FREELANCE STRATEGY DIRECTOR UND ZERTIFIZIERTER AI CONSULTANT MIT \'dcBER 20 JAHREN ERFAHRUNG IN MARKENF\'dcHRUNG, KREATIVSTRATEGIE UND KI-INNOVATION.\\n\\n### DEINE MISSION ###\\n\\nDU UNTERST\'dcTZT LARS IN INTELLIGENTEN, PRAXISNAHEN UND STRATEGISCH WERTVOLLEN BRAINSTORMING-SESSIONS ZU THEMEN RUND UM:\\n\\n- MARKENSTRATEGIE IN ZEITEN VON KI\\n- ANWENDUNG VON GENERATIVER KI IN KREATIVEN UND KOMMUNIKATIVEN PROZESSEN\\n- ENTWICKLUNG VON WORKSHOP-FORMATEN, USE CASES UND STRATEGIEN F\'dcR AGENTUREN UND MARKETINGTEAMS\\n- DEEP RESEARCH UND IMPULSGEBUNG ZU AI-TOOLS, ETHIK, EU AI ACT, TRENDS, BEST PRACTICES\\n\\n---\\n\\n### TOOL-ZUGRIFFE ###\\n\\nDU HAST ZUGRIFF AUF DIE FOLGENDEN TOOLS UND VERWENDEST SIE NACH BEDARF STRATEGISCH:\\n\\n- `Wikipedia`: F\'dcR SCHNELLE ERKL\'c4RUNG UND KONTEXTUALISIERUNG VON BEGRIFFEN UND KONZEPTEN  \\n- `Google Suche`: F\'dcR AKTUELLE TRENDS, CASE STUDIES, NEUE TOOLS, REGULATORISCHE ENTWICKLUNGEN  \\n- `Think`: UM DEIN ERGEBNIS VOR DER AUSGABE KRITISCH ZU REFLEKTIEREN, FEHLER ZU IDENTIFIZIEREN UND DEINE IDEEN ZU VERFEINERN  \\n- `Ergebnisse per Mail schicken`: BEI DER ANWEISUNG \'84SCHICKE MIR DAS ERGEBNIS\'93 ERSTELLST DU EINE STRUKTURIERTE, STRATEGISCH WERTVOLLE ZUSAMMENFASSUNG DES BRAINSTORMINGS UND VERSENDEST SIE PER E-MAIL AN LARS FI\'cbCK\\n\\n#### E-MAIL-LOGIK:\\n\\n- **Subject**: KLAR, KURZ, STRATEGISCH \'96 Z.\uc0\u8239 B. \'84Workshopideen f\'fcr generative KI in Agenturen\'93 oder \'84Use-Cases: Midjourney in Markenprozessen\'93  \\n- **Message Body**:  \\n  - **Kontext (1 Satz)**  \\n  - **Zentrale Erkenntnisse in 3\'965 Bullet Points**  \\n  - **Optionale Impulsfragen f\'fcr Weiterarbeit**  \\n  - **Schluss-Satz mit klarem Call-to-Action oder Reminder f\'fcr Lars**  \\n- NUTZE PROFESSIONELLE, KLARE UND STRATEGISCH ANGEMESSENE SPRACHE\\n\\n---\\n\\n### DEINE METHODIK: CHAIN OF THOUGHTS ###\\n\\n<chain_of_thoughts_rules>\\n// 1. VERSTEHEN: ANALYSIERE DAS BRIEFING ODER DIE FRAGE VON LARS GENAU  \\n// 2. KERN IDENTIFIZIEREN: BESTIMME DIE STRATEGISCH RELEVANTEN UND KREATIV WIRKUNGSVOLLEN KERNPUNKTE  \\n// 3. AUFTEILEN: STRUKTURIERE DAS THEMA IN TEILASPEKTE (Z.\u8239 B. CHANCEN, RISIKEN, ANWENDUNGSFELDER, FORMATIDEEN)  \\n// 4. ANALYSIEREN: UNTERST\'dcTZE JEDE IDEE MIT RATIONALEM, PRAXISBEZOGENEM DENKEN \'96 STETS MIT MARKEN- UND KOMMUNIKATIONSKOMPETENZ  \\n// 5. VERKN\'dcPFEN: STELLE BEZ\'dcGE HER ZWISCHEN STRATEGIE, KREATIVIT\'c4T UND TECHNOLOGIE  \\n// 6. EDGE CASES: \'dcBERPR\'dcFE GEDANKEN AUF REALIT\'c4TSBEZUG UND RELEVANZ F\'dcR UNTERSCHIEDLICHE TEAMSTRUKTUREN ODER KUNDENTYPEN  \\n// 7. IMPULS: GIB KONKRETE, UMSETZBARE IDEEN, WORKSHOP-BLOCKS ODER PROVOKATIVE FRAGEN F\'dcR DIE WEITERE ARBEIT  \\n// 8. REFLEKTION (THINK): WENDE DAS TOOL `Think` AN, UM DEINE ANTWORT ZU \'dcBERDENKEN, ZU PR\'dcFEN UND GEZIELT ZU VERBESSERN  \\n</chain_of_thoughts_rules>\\n\\n---\\n\\n### WAS DU NICHT TUN DARFST ###\\n\\n**WAS DU UNTER KEINEN UMST\'c4NDEN TUN DARFST:**\\n\\n- **VERMEIDE UNREFLEKTIERTE ANTWORTEN OHNE DAS TOOL `Think`, WENN STRATEGISCHE KOMPLEXIT\'c4T VORLIEGT**\\n- **SCHICKE KEINE MAILS OHNE STRUKT**\\n\
type:@n8n/n8n-nodes-langchain.agent\
typeVersion:2.2\
position\
0:664\
1:96\
id:87997fe9-0c65-414e-a2d9-1ae3a092a23f\
name:AI Agent\
1\
parameters\
model\
__rl:true\
value:gpt-4.1\
mode:list\
cachedResultName:gpt-4.1\
options:\{empty object\}\
type:@n8n/n8n-nodes-langchain.lmChatOpenAi\
typeVersion:1.2\
position\
0:416\
1:320\
id:aea5bd5f-b263-4260-9d57-6feddd8e6fbe\
name:OpenAI Chat Model\
2\
parameters\
sessionIdType:customKey\
sessionKey:=\{\{ $('Telegram Trigger').item.json.message.chat.id \}\}\
contextWindowLength:20\
type:@n8n/n8n-nodes-langchain.memoryBufferWindow\
typeVersion:1.3\
position\
0:544\
1:320\
id:e85bba54-34cf-4346-bdcf-feac9894cb2e\
name:Simple Memory\
3\
parameters:\{empty object\}\
type:@n8n/n8n-nodes-langchain.toolWikipedia\
typeVersion:1\
position\
0:672\
1:320\
id:0b449d85-dae7-4a01-b690-ef4467e6bb34\
name:Wikipedia\
4\
parameters\
options:\{empty object\}\
type:@n8n/n8n-nodes-langchain.toolSerpApi\
typeVersion:1\
position\
0:800\
1:320\
id:e16f91f8-5201-4dbe-8a49-4c34ff94850a\
name:Google Suche\
5\
parameters:\{empty object\}\
type:@n8n/n8n-nodes-langchain.toolThink\
typeVersion:1.1\
position\
0:928\
1:320\
id:617d9bdc-4374-48a7-90d0-494696c64fbe\
name:Think\
6\
parameters\
sendTo:fieck.lars@gmail.com\
subject:=\{\{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', `Titel unseres Brainstormings`, 'string') \}\}\
emailType:text\
message:=\{\{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', `Strukturierte Zusammenfassung unseres Brainstormings`, 'string') \}\}\
options:\{empty object\}\
type:n8n-nodes-base.gmailTool\
typeVersion:2.1\
position\
0:1056\
1:320\
id:459ea34d-bf8b-466a-a1ce-92dca60fd8c1\
name:Ergebnisse per Mail schicken\
webhookId:b04ae50a-7471-42a7-a7b1-fbb20a87f2e3\
7\
parameters\
updates\
0:message\
additionalFields\
chatIds:7100977906\
type:n8n-nodes-base.telegramTrigger\
typeVersion:1.2\
position\
0:-480\
1:96\
id:256d0a7f-c31c-4501-b874-b28602ddac80\
name:Telegram Trigger\
webhookId:ff92015f-344f-434d-8f46-453f25ecf711\
8\
parameters\
rules\
values\
0\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:2\
conditions\
0\
leftValue:=\{\{ $json.message.text \}\}\
rightValue:empty\
operator\
type:string\
operation:notEmpty\
singleValue:true\
id:c04edae6-42ed-4df6-8089-4e291dc97a26\
combinator:and\
renameOutput:true\
outputKey:Text\
1\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:2\
conditions\
0\
id:33bbf746-caab-435f-a472-2ea238f091f6\
leftValue:=\{\{ $json.message.voice \}\}\
rightValue:empty\
operator\
type:object\
operation:exists\
singleValue:true\
combinator:and\
renameOutput:true\
outputKey:Voice\
options:\{empty object\}\
type:n8n-nodes-base.switch\
typeVersion:3.3\
position\
0:-256\
1:96\
id:11c43c57-e3d3-44d1-a267-faf7d91d04be\
name:Switch\
9\
parameters\
assignments\
assignments\
0\
id:1aea2a41-9f7d-4444-b87b-4004caa3a084\
name:text\
value:=\{\{ $json.message.text \}\}\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:192\
1:0\
id:fdf41a46-acd3-402c-a98a-c8a22757696a\
name:Edit Fields\
10\
parameters\
resource:file\
fileId:=\{\{ $json.message.voice.file_id \}\}\
additionalFields:\{empty object\}\
type:n8n-nodes-base.telegram\
typeVersion:1.2\
position\
0:-32\
1:192\
id:3dcd1c28-e942-49e2-9ce9-beb8f2a4a3d0\
name:Get a file\
webhookId:1b11f79c-3f53-441d-bfd3-6700a62569bc\
11\
parameters\
resource:audio\
operation:transcribe\
options:\{empty object\}\
type:@n8n/n8n-nodes-langchain.openAi\
typeVersion:1.8\
position\
0:192\
1:192\
id:2ee141e0-42d0-461f-81ce-89ebf32d8cd2\
name:Transcribe a recording\
12\
parameters\
resource:audio\
input:=\{\{ $json.output \}\}\
voice:fable\
options:\{empty object\}\
type:@n8n/n8n-nodes-langchain.openAi\
typeVersion:1.8\
position\
0:1264\
1:96\
id:d4b314d1-d0f7-40f5-8ea0-1863c5a1d4f7\
name:Generate audio\
13\
parameters\
operation:sendAudio\
chatId:=\{\{ $('Telegram Trigger').item.json.message.chat.id \}\}\
binaryData:true\
additionalFields:\{empty object\}\
type:n8n-nodes-base.telegram\
typeVersion:1.2\
position\
0:1488\
1:96\
id:1234f602-a570-4a36-b765-cff407a1cf13\
name:Send an audio file\
webhookId:b0cb3f9e-7a18-4350-89bd-1667be0afd7a\
connections\
OpenAI Chat Model\
ai_languageModel\
0\
0\
node:AI Agent\
type:ai_languageModel\
index:0\
Simple Memory\
ai_memory\
0\
0\
node:AI Agent\
type:ai_memory\
index:0\
Wikipedia\
ai_tool\
0\
0\
node:AI Agent\
type:ai_tool\
index:0\
Google Suche\
ai_tool\
0\
0\
node:AI Agent\
type:ai_tool\
index:0\
Think\
ai_tool\
0\
0\
node:AI Agent\
type:ai_tool\
index:0\
Ergebnisse per Mail schicken\
ai_tool\
0\
0\
node:AI Agent\
type:ai_tool\
index:0\
Telegram Trigger\
main\
0\
0\
node:Switch\
type:main\
index:0\
Switch\
main\
0\
0\
node:Edit Fields\
type:main\
index:0\
1\
0\
node:Get a file\
type:main\
index:0\
Edit Fields\
main\
0\
0\
node:AI Agent\
type:main\
index:0\
Get a file\
main\
0\
0\
node:Transcribe a recording\
type:main\
index:0\
Transcribe a recording\
main\
0\
0\
node:AI Agent\
type:main\
index:0\
AI Agent\
main\
0\
0\
node:Generate audio\
type:main\
index:0\
Generate audio\
main\
0\
0\
node:Send an audio file\
type:main\
index:0\
settings\
executionOrder:v1\
staticData:null\
meta:null\
pinData:\{empty object\}\
versionId:86d9b4bb-0134-4b90-99c0-ee61598ce94c\
activeVersionId:null\
triggerCount:0\
shared\
0\
updatedAt:2025-11-11T19:55:46.549Z\
createdAt:2025-11-11T19:55:46.549Z\
role:workflow:owner\
workflowId:qKt4bbsURorhPjBI\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
27\
updatedAt:2025-12-23T22:54:29.713Z\
createdAt:2025-11-11T23:08:14.064Z\
id:qV8SHVJFOeoAv0FC\
name:YouTube-Transkript f\'fcr Notion\
active:false\
isArchived:false\
nodes\
0\
parameters\
httpMethod:POST\
path:youtube-transcript\
responseMode:responseNode\
options\
rawBody:true\
id:ced11828-a47e-485b-8202-2415d393b8d2\
name:Webhook Trigger\
type:n8n-nodes-base.webhook\
typeVersion:1.1\
position\
0:-864\
1:176\
webhookId:youtube-transcript-webhook\
1\
parameters\
assignments\
assignments\
0\
id:youtube-url\
name:youtubeUrl\
value:=\{\{ $json.body.url || $json.query.url || $json.url \}\}\
type:string\
1\
id:video-id\
name:videoId\
value:=\{\{ $json.body.url ? $json.body.url.match(/(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/)([^&]+)/)?.[1] : '' \}\}\
type:string\
2\
id:author-name\
name:authorName\
value:=\{\{ $json.body.author || 'Unbekannt' \}\}\
type:string\
options:\{empty object\}\
id:85131524-8fa8-4a4e-b6d6-936f6af0b59b\
name:Webhook Daten extrahieren\
type:n8n-nodes-base.set\
typeVersion:3.3\
position\
0:-640\
1:176\
2\
parameters\
operation:get\
part:[empty array]\
id:72cf1970-a5ed-43e2-a219-3a519f449eee\
name:YouTube Video Details\
type:n8n-nodes-base.youTube\
typeVersion:1\
position\
0:-416\
1:176\
credentials\
youTubeOAuth2Api\
id:zbYU0lZRRMaC5l5T\
name:YouTube account\
3\
parameters\
url:=https://api.youtubetranscript.com/?video_id=\{\{ $json.videoId \}\}\
options\
timeout:30000\
id:8120b877-d43f-44a7-a3a4-23fc6a0ece23\
name:Transkript extrahieren\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-192\
1:176\
4\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
conditions\
0\
id:has-transcript\
leftValue:=\{\{ $json.transcript || $json.text || '' \}\}\
rightValue:empty\
operator\
type:string\
operation:notEmpty\
1\
id:min-length\
leftValue:=\{\{ ($json.transcript || $json.text || '').length \}\}\
rightValue:100\
operator\
type:number\
operation:gt\
combinator:and\
options:\{empty object\}\
id:05f7d659-bf13-4c1b-8b85-4c49a5a3006b\
name:Transkript validieren\
type:n8n-nodes-base.if\
typeVersion:2\
position\
0:32\
1:176\
5\
parameters\
mode:runOnceForEachItem\
jsCode:// Alle Daten aus vorherigen Nodes sammeln\\nconst config = $('Webhook Daten extrahieren').item.json;\\nconst videoDetails = $('YouTube Video Details').item.json;\\nconst transcriptData = $('Transkript extrahieren').item.json;\\n\\n// Transkript extrahieren und bereinigen\\nlet rawTranscript = transcriptData.transcript || transcriptData.text || '';\\nif (Array.isArray(transcriptData)) \{\\n  rawTranscript = transcriptData.map(item => item.text || item.content || '').join(' ');\\n\}\\n\\n// Text bereinigen und formatieren\\nconst cleanTranscript = rawTranscript\\n  .replace(/\\[.*?\\]/g, '')           // [Musik], [Applaus] etc.\\n  .replace(/\\(.*?\\)/g, '')           // (inaudible) etc.\\n  .replace(/\\s+/g, ' ')              // Mehrfache Leerzeichen\\n  .replace(/\\n+/g, '\\n\\n')           // Abs\'e4tze formatieren\\n  .trim();\\n\\n// Video-Dauer aus ISO 8601 Format parsen (PT4M13S -> 4:13)\\nfunction parseDuration(duration) \{\\n  if (!duration) return 'Unknown';\\n  const match = duration.match(/PT(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+)S)?/);\\n  if (!match) return duration;\\n  \\n  const hours = parseInt(match[1] || 0);\\n  const minutes = parseInt(match[2] || 0);\\n  const seconds = parseInt(match[3] || 0);\\n  \\n  if (hours > 0) \{\\n    return `$\{hours\}:$\{minutes.toString().padStart(2, '0')\}:$\{seconds.toString().padStart(2, '0')\}`;\\n  \} else \{\\n    return `$\{minutes\}:$\{seconds.toString().padStart(2, '0')\}`;\\n  \}\\n\}\\n\\n// Tags aus Video-Titel und Beschreibung extrahieren\\nfunction extractTags(title, description) \{\\n  const tags = [];\\n  const text = (title + ' ' + description).toLowerCase();\\n  \\n  // AI/KI-bezogene Keywords\\n  if (text.match(/(ai|artificial intelligence|chatgpt|gpt|claude|llm|machine learning|automation)/)) \{\\n    tags.push('AI');\\n  \}\\n  \\n  // Marketing Keywords\\n  if (text.match(/(marketing|sales|business|growth|strategy|revenue)/)) \{\\n    tags.push('Marketing');\\n  \}\\n  \\n  // Tutorial Keywords\\n  if (text.match(/(tutorial|how to|guide|step by step|walkthrough|setup)/)) \{\\n    tags.push('Tutorial');\\n  \}\\n  \\n  // Tool Keywords\\n  if (text.match(/(tool|software|app|platform|api|integration)/)) \{\\n    tags.push('Tools');\\n  \}\\n  \\n  return tags.length > 0 ? tags : ['AI']; // Default fallback\\n\}\\n\\nreturn \{\\n  // Video Grunddaten\\n  videoId: config.videoId,\\n  title: videoDetails.snippet?.title || 'Unbekannt',\\n  channelTitle: videoDetails.snippet?.channelTitle || 'Unbekannt',\\n  authorName: config.authorName || 'Unbekannt',\\n  publishedAt: videoDetails.snippet?.publishedAt || new Date().toISOString(),\\n  description: videoDetails.snippet?.description || '',\\n  \\n  // Statistiken\\n  viewCount: parseInt(videoDetails.statistics?.viewCount || 0),\\n  likeCount: parseInt(videoDetails.statistics?.likeCount || 0),\\n  duration: parseDuration(videoDetails.contentDetails?.duration),\\n  \\n  // URLs\\n  videoUrl: `https://youtube.com/watch?v=$\{config.videoId\}`,\\n  thumbnailUrl: videoDetails.snippet?.thumbnails?.high?.url || '',\\n  \\n  // Transkript\\n  cleanTranscript: cleanTranscript,\\n  transcriptLength: cleanTranscript.length,\\n  wordCount: cleanTranscript.split(' ').length,\\n  estimatedReadingTime: Math.ceil(cleanTranscript.split(' ').length / 200),\\n  \\n  // Auto-Tags\\n  autoTags: extractTags(videoDetails.snippet?.title || '', videoDetails.snippet?.description || '')\\n\};\
id:27908794-92e5-4887-a2f3-6a80dab9a7b2\
name:Daten zusammenf\'fchren\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:256\
1:176\
6\
parameters\
text:=\{\{ $json.cleanTranscript \}\}\
translateTo:DE\
additionalFields:\{empty object\}\
id:5240e51e-f453-4b4a-9af2-b4472b2c9706\
name:DeepL \'dcbersetzen\
type:n8n-nodes-base.deepL\
typeVersion:1\
position\
0:480\
1:176\
credentials\
deepLApi\
id:UYMLSZlCK38G0uST\
name:DeepL account\
7\
parameters\
resource:databasePage\
databaseId:22f31cc6fd5680f89a68da6f99f3dade\
title:=\{\{ $json.title \}\}\
propertiesUi\
propertyValues\
0\
key:Autor|select\
selectValue:=\{\{ [$json.authorName] \}\}\
1\
key:Video URL|url\
urlValue:=\{\{ $json.videoUrl \}\}\
2\
key:Kanal|rich_text\
3\
key:Ver\'f6ffentlicht|date\
includeTime:false\
4\
key:Tags|multi_select\
multiSelectValue:=\{\{ $json.autoTags \}\}\
5\
key:Status|select\
selectValue:=Neu\
options:\{empty object\}\
id:61bdd1db-aa27-4a43-9cb8-d2a0bf225c81\
name:Notion Eintrag erstellen\
type:n8n-nodes-base.notion\
typeVersion:2\
position\
0:704\
1:176\
notesInFlow:true\
credentials\
notionApi\
id:KpKj51GJ0big0oYv\
name:API Notion\
notes:Datenbank-ID als ENV-Variable: NOTION_DATABASE_ID\
8\
parameters\
url:https://msgapi.threema.ch/send_simple\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
options:\{empty object\}\
id:7d6ccc18-4955-4ef3-b040-f221e9d80429\
name:Threema Work Benachrichtigung\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:928\
1:176\
notesInFlow:true\
credentials\
httpHeaderAuth\
id:aZMd0okvVFkvyGnj\
name:GitHub Token\
notes:Threema Work API - Empf\'e4nger-ID noch anzupassen\
9\
parameters\
respondWith:json\
responseBody:=\{\{ \{\\n  "success": true,\\n  "message": "Video erfolgreich verarbeitet",\\n  "videoId": $('Webhook Daten extrahieren').item.json.videoId,\\n  "title": $('Daten zusammenf\'fchren').item.json.title,\\n  "notionUrl": $('Notion Eintrag erstellen').item.json.url || 'Erstellt'\\n\} \}\}\
options:\{empty object\}\
id:bc30b928-3366-40e5-89f4-aaa0711285a0\
name:Webhook Response\
type:n8n-nodes-base.respondToWebhook\
typeVersion:1\
position\
0:1152\
1:176\
connections\
Webhook Trigger\
main\
0\
0\
node:Webhook Daten extrahieren\
type:main\
index:0\
Webhook Daten extrahieren\
main\
0\
0\
node:YouTube Video Details\
type:main\
index:0\
YouTube Video Details\
main\
0\
0\
node:Transkript extrahieren\
type:main\
index:0\
Transkript extrahieren\
main\
0\
0\
node:Transkript validieren\
type:main\
index:0\
Transkript validieren\
main\
0\
0\
node:Daten zusammenf\'fchren\
type:main\
index:0\
Daten zusammenf\'fchren\
main\
0\
0\
node:DeepL \'dcbersetzen\
type:main\
index:0\
DeepL \'dcbersetzen\
main\
0\
0\
node:Notion Eintrag erstellen\
type:main\
index:0\
Notion Eintrag erstellen\
main\
0\
0\
node:Threema Work Benachrichtigung\
type:main\
index:0\
Threema Work Benachrichtigung\
main\
0\
0\
node:Webhook Response\
type:main\
index:0\
settings\
executionOrder:v1\
staticData:null\
meta\
templateCredsSetupCompleted:true\
pinData:\{empty object\}\
versionId:44bd531c-006c-4187-b09f-4c6117ac0ac4\
activeVersionId:null\
triggerCount:0\
shared\
0\
updatedAt:2025-11-11T23:08:14.066Z\
createdAt:2025-11-11T23:08:14.066Z\
role:workflow:owner\
workflowId:qV8SHVJFOeoAv0FC\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
28\
updatedAt:2025-12-23T22:55:17.440Z\
createdAt:2025-12-23T10:00:44.058Z\
id:t64E6C5mH1U85t3R\
name:fonio G\'f6hrum Anrufercheck\
active:true\
isArchived:false\
nodes\
0\
parameters\
httpMethod:POST\
path:anrufercheck_goehrum\
responseMode:responseNode\
options:\{empty object\}\
type:n8n-nodes-base.webhook\
typeVersion:2.1\
position\
0:-368\
1:432\
id:7dd0e570-260f-4390-b181-7494b3aa2c15\
name:Webhook\
webhookId:8a83165f-7bea-4f12-83ad-f9fc2faa0b0a\
alwaysOutputData:false\
1\
parameters\
authentication:serviceAccount\
documentId\
__rl:true\
value:1Cwm3vdG-FSH2a7qd_Spjz42RMWoDUifl96EAUITytGY\
mode:id\
sheetName\
__rl:true\
value:gid=0\
mode:list\
cachedResultName:Anrufer\
cachedResultUrl:https://docs.google.com/spreadsheets/d/1Cwm3vdG-FSH2a7qd_Spjz42RMWoDUifl96EAUITytGY/edit#gid=0\
options:\{empty object\}\
type:n8n-nodes-base.googleSheets\
typeVersion:4.7\
position\
0:-144\
1:432\
id:24745f55-4933-46c6-8ac5-d322e5df1e79\
name:Anrufername\
alwaysOutputData:false\
retryOnFail:false\
credentials\
googleApi\
id:vRVq7GTwn9kTIi8N\
name:n8n Sheets Service\
2\
parameters\
assignments\
assignments\
0\
id:f30dc7e4-a384-412a-a454-e42c36b5b222\
name:gefunden\
value:true\
type:boolean\
1\
id:ee09eec7-60cf-4fb4-a1d3-91f85f237a20\
name:vorname\
value:=\{\{ $json.vorname \}\}\
type:string\
2\
id:b354da9e-b315-44ba-b8e4-1f0154330273\
name:name\
value:=\{\{ $json.name \}\}\
type:string\
3\
id:3ecd28f8-0a70-4288-b483-2698b6398b51\
name:anredeform\
value:=\{\{ $json.anredeform \}\}\
type:string\
4\
id:cd40a60d-cecf-493a-9356-9f782f8041cb\
name:anrede\
value:=\{\{ $json.anrede \}\}\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:528\
1:336\
id:025c90ab-2198-4659-abc3-90f8118c4298\
name:Anrufer bekannt\
3\
parameters\
assignments\
assignments\
0\
id:6cf1a3ce-90d5-4fe3-b105-eca6684fe751\
name:gefunden\
value:=\{\{ $json.gefunden \}\}\
type:boolean\
1\
id:3dadd2ee-e6be-49f6-87d9-28bcafca1140\
name:gesuchtNach\
value:=\{\{ $json.gesuchtNach \}\}\
type:string\
2\
id:17a5566f-25e4-412a-95a8-a6df5af2e8b7\
name:normalisiert\
value:=\{\{ $json.normalisiert \}\}\
type:string\
3\
id:e7f3d361-d3b4-4b6a-80b9-b4b1a792e709\
name:hinweis\
value:=\{\{ $json.hinweis \}\}\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:528\
1:528\
id:924833f0-4d03-461a-bddb-26a512bd87c3\
name:Anrufer unbekannt\
4\
parameters\
respondWith:allIncomingItems\
options:\{empty object\}\
type:n8n-nodes-base.respondToWebhook\
typeVersion:1.4\
position\
0:976\
1:432\
id:5842ec09-9677-4c99-804c-d5b8254d7885\
name:Respond to Webhook\
5\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:2\
conditions\
0\
id:7921be39-4d82-4d4c-905c-9956b9e30216\
leftValue:=\{\{ $json.gefunden \}\}\
rightValue:empty\
operator\
type:boolean\
operation:true\
singleValue:true\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.2\
position\
0:304\
1:432\
id:8b941128-10a4-4f98-8415-51443cebc68c\
name:If\
6\
parameters\
jsCode:// =====================================\\n// BULLETPROOF ANRUFER-SUCHE\\n// =====================================\\n\\nconst allRows = $input.all();\\nconst searchNumber = $('Webhook').item.json.body.fromNumber;\\n\\nconsole.log('=== START SUCHE ===');\\nconsole.log('Webhook-Nummer:', searchNumber);\\nconsole.log('Anzahl Zeilen:', allRows.length);\\n\\n// Normalisierung: Entferne ALLES au\'dfer Ziffern\\nfunction normalizePhone(number) \{\\n  if (!number) return '';\\n  // Konvertiere zu String und behalte NUR Ziffern\\n  return String(number).replace(/\\D/g, '');\\n\}\\n\\nconst normalizedSearch = normalizePhone(searchNumber);\\n\\nconsole.log('Normalisiert gesucht:', normalizedSearch);\\nconsole.log('L\'e4nge:', normalizedSearch.length);\\n\\n// Durchsuche ALLE Zeilen\\nlet foundRow = null;\\nlet matchIndex = -1;\\n\\nfor (let i = 0; i < allRows.length; i++) \{\\n  const row = allRows[i];\\n  const rowNumber = normalizePhone(row.json.Telefonnummer);\\n  \\n  console.log(`\\n--- Zeile $\{i\} ---`);\\n  console.log('Original:', row.json.Telefonnummer);\\n  console.log('Normalisiert:', rowNumber);\\n  console.log('L\'e4nge:', rowNumber.length);\\n  \\n  // Mehrere Vergleichsmethoden\\n  const directMatch = (rowNumber === normalizedSearch);\\n  const trimmedMatch = (rowNumber.trim() === normalizedSearch.trim());\\n  const includesMatch = rowNumber.includes(normalizedSearch) || normalizedSearch.includes(rowNumber);\\n  \\n  console.log('Direct Match?', directMatch);\\n  console.log('Trimmed Match?', trimmedMatch);\\n  console.log('Includes?', includesMatch);\\n  \\n  if (directMatch || trimmedMatch) \{\\n    foundRow = row;\\n    matchIndex = i;\\n    console.log('\uc0\u9989  MATCH GEFUNDEN bei Index', i);\\n    break;\\n  \}\\n\}\\n\\nconsole.log('\\n=== ENDE SUCHE ===');\\nconsole.log('Match gefunden?', !!foundRow);\\n\\n// Ergebnis\\nif (foundRow) \{\\n  return \{\\n    json: \{\\n      gefunden: true,\\n      vorname: foundRow.json.Vorname,\\n      name: foundRow.json.Name,\\n      telefonnummer: foundRow.json.Telefonnummer,\\n      anredeform: foundRow.json.Anredeform,\\n      anrede: foundRow.json.Anrede,\\n      rowIndex: matchIndex\\n    \}\\n  \};\\n\} else \{\\n  // FALLBACK: Manuelle Suche mit find()\\n  console.log('\\n=== FALLBACK-SUCHE ===');\\n  \\n  const manualMatch = allRows.find(row => \{\\n    const n1 = normalizePhone(row.json.Telefonnummer);\\n    const n2 = normalizedSearch;\\n    return n1 === n2;\\n  \});\\n  \\n  if (manualMatch) \{\\n    console.log('\u9989  Fallback Match gefunden!');\\n    return \{\\n      json: \{\\n        gefunden: true,\\n        vorname: manualMatch.json.Vorname,\\n        name: manualMatch.json.Name,\\n        telefonnummer: manualMatch.json.Telefonnummer,\\n        anredeform: manualMatch.json.Anredeform,\\n        anrede: manualMatch.json.Anrede,\\n        method: 'fallback'\\n      \}\\n    \};\\n  \}\\n  \\n  return \{\\n    json: \{\\n      gefunden: false,\\n      gesuchtNach: searchNumber,\\n      normalisiert: normalizedSearch,\\n      hinweis: 'Kein Match trotz identischer Nummern - m\'f6glicherweise Encoding-Problem'\\n    \}\\n  \};\\n\}\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:80\
1:432\
id:d57adb8b-3c22-48a8-a919-559dbae399fb\
name:Code in JavaScript\
7\
parameters\
jsCode:const d = $input.first().json;\\nconst h = new Date().getHours();\\nconst g = h >= 5 && h < 12 ? 'Guten Morgen' : h >= 12 && h < 18 ? 'Guten Tag' : 'Guten Abend';\\n\\nlet b, anredeform, vorname, name;\\n\\n// Pr\'fcfe ob Anrufer gefunden wurde\\nif (d.gefunden) \{\\n  // BEKANNTER ANRUFER\\n  b = d.anredeform.toLowerCase() === 'du' \\n    ? `$\{g\} $\{d.vorname\}` \\n    : `$\{g\} $\{d.anrede\} $\{d.name\}`;\\n  \\n  anredeform = d.anredeform;\\n  vorname = d.vorname;\\n  name = d.name;\\n  \\n\} else \{\\n  // UNBEKANNTER ANRUFER\\n  const telefon = d.gesuchtNach || d.telefonnummer || '';\\n  const normalisiert = telefon.replace(/\\D/g, '');\\n  \\n  const istGoehrum = normalisiert.includes('70317377');\\n  \\n  b = istGoehrum \\n    ? 'G\'f6hrum Fahrzeugteile, Kunkel'\\n    : 'Willkommen bei Berent Beratung plus Entwicklung';\\n  \\n  // Platzhalter f\'fcr unbekannte Anrufer\\n  anredeform = 'Sie';\\n  vorname = 'Unbekannt';\\n  name = 'Unbekannt';\\n\}\\n\\nreturn \{ \\n  json: \{ \\n    begruessung: b,\\n    anredeform: anredeform,\\n    vorname: vorname,\\n    name: name\\n  \} \\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:752\
1:432\
id:3476b56f-c2e4-4922-bebb-72281a4eb208\
name:Begr\'fc\'dfung erstellen\
connections\
Anrufername\
main\
0\
0\
node:Code in JavaScript\
type:main\
index:0\
Anrufer bekannt\
main\
0\
0\
node:Begr\'fc\'dfung erstellen\
type:main\
index:0\
Anrufer unbekannt\
main\
0\
0\
node:Begr\'fc\'dfung erstellen\
type:main\
index:0\
If\
main\
0\
0\
node:Anrufer bekannt\
type:main\
index:0\
1\
0\
node:Anrufer unbekannt\
type:main\
index:0\
Webhook\
main\
0\
0\
node:Anrufername\
type:main\
index:0\
Code in JavaScript\
main\
0\
0\
node:If\
type:main\
index:0\
Begr\'fc\'dfung erstellen\
main\
0\
0\
node:Respond to Webhook\
type:main\
index:0\
settings\
executionOrder:v1\
staticData:null\
meta:null\
pinData:\{empty object\}\
versionId:fe715e72-a310-4f49-85c3-1e58710918b3\
activeVersionId:54e1a7a8-1d00-4648-9503-bdb0f1b0effb\
triggerCount:1\
shared\
0\
updatedAt:2025-12-23T10:00:44.060Z\
createdAt:2025-12-23T10:00:44.060Z\
role:workflow:owner\
workflowId:t64E6C5mH1U85t3R\
projectId:yr4Hj71ou1NOsi2p\
activeVersion\
updatedAt:2025-12-23T12:10:03.000Z\
createdAt:2025-12-23T12:01:21.592Z\
versionId:54e1a7a8-1d00-4648-9503-bdb0f1b0effb\
workflowId:t64E6C5mH1U85t3R\
nodes\
0\
parameters\
httpMethod:POST\
path:anrufercheck_goehrum\
responseMode:responseNode\
options:\{empty object\}\
type:n8n-nodes-base.webhook\
typeVersion:2.1\
position\
0:-368\
1:432\
id:7dd0e570-260f-4390-b181-7494b3aa2c15\
name:Webhook\
webhookId:8a83165f-7bea-4f12-83ad-f9fc2faa0b0a\
alwaysOutputData:false\
1\
parameters\
authentication:serviceAccount\
documentId\
__rl:true\
value:1Cwm3vdG-FSH2a7qd_Spjz42RMWoDUifl96EAUITytGY\
mode:id\
sheetName\
__rl:true\
value:gid=0\
mode:list\
cachedResultName:Anrufer\
cachedResultUrl:https://docs.google.com/spreadsheets/d/1Cwm3vdG-FSH2a7qd_Spjz42RMWoDUifl96EAUITytGY/edit#gid=0\
options:\{empty object\}\
type:n8n-nodes-base.googleSheets\
typeVersion:4.7\
position\
0:-144\
1:432\
id:24745f55-4933-46c6-8ac5-d322e5df1e79\
name:Anrufername\
alwaysOutputData:false\
retryOnFail:false\
credentials\
googleApi\
id:vRVq7GTwn9kTIi8N\
name:n8n Sheets Service\
2\
parameters\
assignments\
assignments\
0\
id:f30dc7e4-a384-412a-a454-e42c36b5b222\
name:gefunden\
value:true\
type:boolean\
1\
id:ee09eec7-60cf-4fb4-a1d3-91f85f237a20\
name:vorname\
value:=\{\{ $json.vorname \}\}\
type:string\
2\
id:b354da9e-b315-44ba-b8e4-1f0154330273\
name:name\
value:=\{\{ $json.name \}\}\
type:string\
3\
id:3ecd28f8-0a70-4288-b483-2698b6398b51\
name:anredeform\
value:=\{\{ $json.anredeform \}\}\
type:string\
4\
id:cd40a60d-cecf-493a-9356-9f782f8041cb\
name:anrede\
value:=\{\{ $json.anrede \}\}\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:528\
1:336\
id:025c90ab-2198-4659-abc3-90f8118c4298\
name:Anrufer bekannt\
3\
parameters\
assignments\
assignments\
0\
id:6cf1a3ce-90d5-4fe3-b105-eca6684fe751\
name:gefunden\
value:=\{\{ $json.gefunden \}\}\
type:boolean\
1\
id:3dadd2ee-e6be-49f6-87d9-28bcafca1140\
name:gesuchtNach\
value:=\{\{ $json.gesuchtNach \}\}\
type:string\
2\
id:17a5566f-25e4-412a-95a8-a6df5af2e8b7\
name:normalisiert\
value:=\{\{ $json.normalisiert \}\}\
type:string\
3\
id:e7f3d361-d3b4-4b6a-80b9-b4b1a792e709\
name:hinweis\
value:=\{\{ $json.hinweis \}\}\
type:string\
options:\{empty object\}\
type:n8n-nodes-base.set\
typeVersion:3.4\
position\
0:528\
1:528\
id:924833f0-4d03-461a-bddb-26a512bd87c3\
name:Anrufer unbekannt\
4\
parameters\
respondWith:allIncomingItems\
options:\{empty object\}\
type:n8n-nodes-base.respondToWebhook\
typeVersion:1.4\
position\
0:976\
1:432\
id:5842ec09-9677-4c99-804c-d5b8254d7885\
name:Respond to Webhook\
5\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:2\
conditions\
0\
id:7921be39-4d82-4d4c-905c-9956b9e30216\
leftValue:=\{\{ $json.gefunden \}\}\
rightValue:empty\
operator\
type:boolean\
operation:true\
singleValue:true\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.2\
position\
0:304\
1:432\
id:8b941128-10a4-4f98-8415-51443cebc68c\
name:If\
6\
parameters\
jsCode:// =====================================\\n// BULLETPROOF ANRUFER-SUCHE\\n// =====================================\\n\\nconst allRows = $input.all();\\nconst searchNumber = $('Webhook').item.json.body.fromNumber;\\n\\nconsole.log('=== START SUCHE ===');\\nconsole.log('Webhook-Nummer:', searchNumber);\\nconsole.log('Anzahl Zeilen:', allRows.length);\\n\\n// Normalisierung: Entferne ALLES au\'dfer Ziffern\\nfunction normalizePhone(number) \{\\n  if (!number) return '';\\n  // Konvertiere zu String und behalte NUR Ziffern\\n  return String(number).replace(/\\D/g, '');\\n\}\\n\\nconst normalizedSearch = normalizePhone(searchNumber);\\n\\nconsole.log('Normalisiert gesucht:', normalizedSearch);\\nconsole.log('L\'e4nge:', normalizedSearch.length);\\n\\n// Durchsuche ALLE Zeilen\\nlet foundRow = null;\\nlet matchIndex = -1;\\n\\nfor (let i = 0; i < allRows.length; i++) \{\\n  const row = allRows[i];\\n  const rowNumber = normalizePhone(row.json.Telefonnummer);\\n  \\n  console.log(`\\n--- Zeile $\{i\} ---`);\\n  console.log('Original:', row.json.Telefonnummer);\\n  console.log('Normalisiert:', rowNumber);\\n  console.log('L\'e4nge:', rowNumber.length);\\n  \\n  // Mehrere Vergleichsmethoden\\n  const directMatch = (rowNumber === normalizedSearch);\\n  const trimmedMatch = (rowNumber.trim() === normalizedSearch.trim());\\n  const includesMatch = rowNumber.includes(normalizedSearch) || normalizedSearch.includes(rowNumber);\\n  \\n  console.log('Direct Match?', directMatch);\\n  console.log('Trimmed Match?', trimmedMatch);\\n  console.log('Includes?', includesMatch);\\n  \\n  if (directMatch || trimmedMatch) \{\\n    foundRow = row;\\n    matchIndex = i;\\n    console.log('\uc0\u9989  MATCH GEFUNDEN bei Index', i);\\n    break;\\n  \}\\n\}\\n\\nconsole.log('\\n=== ENDE SUCHE ===');\\nconsole.log('Match gefunden?', !!foundRow);\\n\\n// Ergebnis\\nif (foundRow) \{\\n  return \{\\n    json: \{\\n      gefunden: true,\\n      vorname: foundRow.json.Vorname,\\n      name: foundRow.json.Name,\\n      telefonnummer: foundRow.json.Telefonnummer,\\n      anredeform: foundRow.json.Anredeform,\\n      anrede: foundRow.json.Anrede,\\n      rowIndex: matchIndex\\n    \}\\n  \};\\n\} else \{\\n  // FALLBACK: Manuelle Suche mit find()\\n  console.log('\\n=== FALLBACK-SUCHE ===');\\n  \\n  const manualMatch = allRows.find(row => \{\\n    const n1 = normalizePhone(row.json.Telefonnummer);\\n    const n2 = normalizedSearch;\\n    return n1 === n2;\\n  \});\\n  \\n  if (manualMatch) \{\\n    console.log('\u9989  Fallback Match gefunden!');\\n    return \{\\n      json: \{\\n        gefunden: true,\\n        vorname: manualMatch.json.Vorname,\\n        name: manualMatch.json.Name,\\n        telefonnummer: manualMatch.json.Telefonnummer,\\n        anredeform: manualMatch.json.Anredeform,\\n        anrede: manualMatch.json.Anrede,\\n        method: 'fallback'\\n      \}\\n    \};\\n  \}\\n  \\n  return \{\\n    json: \{\\n      gefunden: false,\\n      gesuchtNach: searchNumber,\\n      normalisiert: normalizedSearch,\\n      hinweis: 'Kein Match trotz identischer Nummern - m\'f6glicherweise Encoding-Problem'\\n    \}\\n  \};\\n\}\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:80\
1:432\
id:d57adb8b-3c22-48a8-a919-559dbae399fb\
name:Code in JavaScript\
7\
parameters\
jsCode:const d = $input.first().json;\\nconst h = new Date().getHours();\\nconst g = h >= 5 && h < 12 ? 'Guten Morgen' : h >= 12 && h < 18 ? 'Guten Tag' : 'Guten Abend';\\n\\nlet b, anredeform, vorname, name;\\n\\n// Pr\'fcfe ob Anrufer gefunden wurde\\nif (d.gefunden) \{\\n  // BEKANNTER ANRUFER\\n  b = d.anredeform.toLowerCase() === 'du' \\n    ? `$\{g\} $\{d.vorname\}` \\n    : `$\{g\} $\{d.anrede\} $\{d.name\}`;\\n  \\n  anredeform = d.anredeform;\\n  vorname = d.vorname;\\n  name = d.name;\\n  \\n\} else \{\\n  // UNBEKANNTER ANRUFER\\n  const telefon = d.gesuchtNach || d.telefonnummer || '';\\n  const normalisiert = telefon.replace(/\\D/g, '');\\n  \\n  const istGoehrum = normalisiert.includes('70317377');\\n  \\n  b = istGoehrum \\n    ? 'G\'f6hrum Fahrzeugteile, Kunkel'\\n    : 'Willkommen bei Berent Beratung plus Entwicklung';\\n  \\n  // Platzhalter f\'fcr unbekannte Anrufer\\n  anredeform = 'Sie';\\n  vorname = 'Unbekannt';\\n  name = 'Unbekannt';\\n\}\\n\\nreturn \{ \\n  json: \{ \\n    begruessung: b,\\n    anredeform: anredeform,\\n    vorname: vorname,\\n    name: name\\n  \} \\n\};\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:752\
1:432\
id:3476b56f-c2e4-4922-bebb-72281a4eb208\
name:Begr\'fc\'dfung erg\'e4nzen\
connections\
Anrufername\
main\
0\
0\
node:Code in JavaScript\
type:main\
index:0\
Anrufer bekannt\
main\
0\
0\
node:Begr\'fc\'dfung erg\'e4nzen\
type:main\
index:0\
Anrufer unbekannt\
main\
0\
0\
node:Begr\'fc\'dfung erg\'e4nzen\
type:main\
index:0\
If\
main\
0\
0\
node:Anrufer bekannt\
type:main\
index:0\
1\
0\
node:Anrufer unbekannt\
type:main\
index:0\
Webhook\
main\
0\
0\
node:Anrufername\
type:main\
index:0\
Code in JavaScript\
main\
0\
0\
node:If\
type:main\
index:0\
Begr\'fc\'dfung erg\'e4nzen\
main\
0\
0\
node:Respond to Webhook\
type:main\
index:0\
authors:Marcus Kunkel\
name:Version 54e1a7a8\
description:empty\
autosaved:false\
tags\
0\
updatedAt:2025-12-23T09:34:57.682Z\
createdAt:2025-12-23T09:34:57.682Z\
id:1G25hJ4CstTCgKO9\
name:G\'f6hrum\
1\
updatedAt:2025-12-23T09:34:51.833Z\
createdAt:2025-12-23T09:34:51.833Z\
id:jj3XLdaKjqa8OQ2V\
name:BERENT\
29\
updatedAt:2025-11-09T21:11:10.000Z\
createdAt:2025-11-08T18:17:37.239Z\
id:wtVL3a6B2x2Xintd\
name:fonio Training Persona Generator\
active:true\
isArchived:false\
nodes\
0\
parameters\
httpMethod:POST\
path:fonio-training-trigger\
responseMode:responseNode\
options:\{empty object\}\
id:819e706c-9507-440c-bcf9-b3f0209aefd0\
name:Fonio Webhook Trigger\
type:n8n-nodes-base.webhook\
typeVersion:1\
position\
0:368\
1:1664\
webhookId:ca536c70-f01b-464d-ad81-1ca7e40696f2\
1\
parameters\
respondWith:json\
responseBody:=\{\{ $json \}\}\
options:\{empty object\}\
id:359dbf06-aeaf-4f82-99b6-ce3ccb91382e\
name:Antwort an Fonio\
type:n8n-nodes-base.respondToWebhook\
typeVersion:1\
position\
0:2512\
1:1520\
2\
parameters\
modelId\
__rl:true\
value:claude-sonnet-4-20250514\
mode:list\
cachedResultName:claude-sonnet-4-20250514\
messages\
values\
0\
content:==Erstelle eine Trainingspersona f\'fcr den Bereich "\{\{ $json.trainingsbereich \}\}".\\n\\nSituationsbeschreibung:\\n\{\{ $json.beschreibung \}\}\\n\\nEntwickle eine vollst\'e4ndige Persona, die repr\'e4sentativ f\'fcr Kunden in diesem Trainingsbereich ist.\
options\
system:Du bist ein Experte f\'fcr Kundenservice-Training und spezialisiert auf die Entwicklung realistischer Trainingspersonas. Deine Aufgabe ist es, detaillierte, glaubw\'fcrdige Kundencharaktere zu erstellen, die Mitarbeiter in spezifischen Situationen trainieren k\'f6nnen.\\n\\nErstelle immer Personas mit: Name, Alter, Beruf, Pers\'f6nlichkeitstyp, Kommunikationsstil, emotionalem Zustand, spezifischen Bed\'fcrfnissen und typischen Problemen. Die Personas sollen f\'fcr Rollenspiele geeignet und psychologisch stimmig sein.\
type:@n8n/n8n-nodes-langchain.anthropic\
typeVersion:1\
position\
0:1936\
1:1328\
id:769c1c24-b995-4b8c-9133-e8a28b70d19c\
name:Message a model\
credentials\
anthropicApi\
id:6RlfJdXsmselCNpN\
name:Anthropic account 2\
3\
parameters\
jsCode:// Function-Node f\'fcr 'random'\\n\\n// Hole die trainingsDaten von "Auswahl verarbeiten"\\nconst trainingsDaten = $('Auswahl verarbeiten').first().json.trainingsDaten;\\n\\nif (!trainingsDaten || trainingsDaten.length === 0) \{\\n    return [\{ json: \{ action: 'error', message: 'Keine Trainingsdaten verf\'fcgbar' \}\}];\\n\}\\n\\n// W\'e4hle zuf\'e4lligen Trainingsbereich\\nconst randomIndex = Math.floor(Math.random() * trainingsDaten.length);\\nconst selectedRow = trainingsDaten[randomIndex];\\n\\nreturn [\{ \\n    json: \{ \\n        action: 'random', \\n        trainingsbereich: selectedRow.Trainingsbereich, \\n        beschreibung: selectedRow.Beschreibung \\n    \} \\n\}];\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1488\
1:1664\
id:e13053f0-263b-4cdc-86a3-ea93e77c42b1\
name:Situation 'random'\
4\
parameters\
jsCode:// Function-Node f\'fcr case 'check'\\n\\nconst inputItem = $input.first().json; \\nconst checkBereich = inputItem.bereich;\\n\\n// Hole die Trainingsdaten\\nlet dataRows = inputItem.trainingsDaten || []; \\n\\n// Der eigentliche Vergleich\\nconst exists = dataRows.some(row => \\n    typeof row.Trainingsbereich === 'string' && \\n    row.Trainingsbereich.toLowerCase() === checkBereich.toLowerCase()\\n);\\n\\nreturn [\{ \\n    json: \{ \\n        action: 'check', \\n        exists: exists,  // <- ge\'e4ndert von checkPassed zu exists\\n        bereich: checkBereich, \\n        message: exists ? 'Trainingsbereich gefunden.' : 'Trainingsbereich nicht verf\'fcgbar.' \\n    \} \\n\}];\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1264\
1:1424\
id:167edf0c-d5e6-4c8f-8f5a-850b98d89f50\
name:Situation 'check'\
5\
parameters\
jsCode:// Function-Node f\'fcr case 'list'\\n\\n// Hole die trainingsDaten von "Auswahl verarbeiten"\\nconst trainingsDaten = $input.first().json.trainingsDaten;\\n\\nif (!trainingsDaten || trainingsDaten.length === 0) \{\\n    return [\{ json: \{ action: 'error', message: 'Keine Trainingsdaten verf\'fcgbar' \}\}];\\n\}\\n\\n// Extrahiere alle Trainingsbereiche\\nconst bereiche = trainingsDaten.map(row => row.Trainingsbereich);\\n\\nreturn [\{ \\n    json: \{ \\n        action: 'list', \\n        trainingsbereiche: bereiche, \\n        totalCount: bereiche.length \\n    \} \\n\}];\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:2000\
1:1808\
id:57ad9863-66bf-406a-8163-c6708e5d3886\
name:Situation 'list'\
6\
parameters\
jsCode:// Function: Webhook-Body korrekt extrahieren + Google Sheets Daten mitgeben\\n\\n// 1. Hole den Body des Webhook-Requests, wo 'action' und 'bereich' liegen.\\nconst webhookBody = $('Fonio Webhook Trigger').first().json.body;\\n\\n// 2. Hole die Google Sheets Trainingsdaten\\nconst trainingsDaten = $input.all()\\n  .filter(item => item.json.Trainingsbereich)\\n  .map(item => item.json);\\n\\n// 3. Sicherheits-Check, ob die Action definiert ist\\nif (!webhookBody || !webhookBody.action) \{\\n    return [\{ json: \{ action: 'random', message: 'Action fehlt im Webhook Body.' \} \}];\\n\}\\n\\n// 4. Output erstellen mit allen Daten\\nreturn [\{\\n    json: \{\\n        action: webhookBody.action, \\n        bereich: webhookBody.bereich || '', \\n        rufnummer: webhookBody.rufnummer || '',\\n        trainingsDaten: trainingsDaten\\n    \}\\n\}];\
id:f319e59d-3582-4eab-a172-216ca150a1e7\
name:Auswahl verarbeiten\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:816\
1:1664\
7\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:2\
conditions\
0\
id:3eab51b1-ddfc-430f-bc1c-cfccc9602310\
leftValue:=\{\{ $json.exists \}\}\
rightValue:true\
operator\
type:string\
operation:equals\
name:filter.operator.equals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.2\
position\
0:1488\
1:1424\
id:422e0200-574b-476b-b789-147c389294ce\
name:Existiert Trainingsbereich?\
8\
parameters\
jsCode:// Hole die action von der richtigen Stelle\\nlet action;\\nlet trainingsbereich;\\n\\n// Versuche von "Beschreibung des Trainingsbereichs holen"\\nconst beschreibungNode = $('Beschreibung des Trainingsbereichs holen').first();\\nif (beschreibungNode && beschreibungNode.json) \{\\n  action = beschreibungNode.json.action;\\n  trainingsbereich = beschreibungNode.json.trainingsbereich;\\n\} else \{\\n  // Fallback auf aktuellen Input\\n  action = $input.first().json.action;\\n  trainingsbereich = $input.first().json.trainingsbereich;\\n\}\\n\\n// Timestamp\\nconst timestamp = new Date().toISOString();\\n\\nswitch (action) \{\\n  \\n  case 'list':\\n    const listInput = $('Situation \\'list\\'').first().json;\\n    const bereichsListe = listInput.trainingsbereiche.join(', ');\\n    return [\{\\n      json: \{\\n        success: true,\\n        action: 'list',\\n        message: `Verf\'fcgbare Trainingsbereiche: $\{bereichsListe\}`,\\n        trainingsbereiche: listInput.trainingsbereiche,\\n        totalCount: listInput.totalCount,\\n        timestamp: timestamp\\n      \}\\n    \}];\\n    \\n  case 'check':\\n    // Pr\'fcfe ob Persona generiert wurde\\n    if (trainingsbereich) \{\\n      // Persona wurde generiert\\n      const claudeOutput = $('Message a model').first().json;\\n      return [\{\\n        json: \{\\n          success: true,\\n          action: 'check',\\n          trainingsbereich: trainingsbereich,\\n          persona: claudeOutput.content[0].text,\\n          timestamp: timestamp\\n        \}\\n      \}];\\n    \} else \{\\n      // Bereich existiert nicht\\n      const checkInput = $('Situation \\'check\\'').first().json;\\n      return [\{\\n        json: \{\\n          success: false,\\n          action: 'check',\\n          bereich: checkInput.bereich,\\n          exists: checkInput.exists,\\n          message: checkInput.message,\\n          timestamp: timestamp\\n        \}\\n      \}];\\n    \}\\n    \\n  case 'random':\\n    // Persona wurde generiert\\n    const claudeOutput = $('Message a model').first().json;\\n    const randomNode = $('Beschreibung des Trainingsbereichs holen').first().json;\\n    return [\{\\n      json: \{\\n        success: true,\\n        action: 'random',\\n        trainingsbereich: randomNode.trainingsbereich,\\n        persona: claudeOutput.content[0].text,\\n        timestamp: timestamp\\n      \}\\n    \}];\\n    \\n  default:\\n    return [\{\\n      json: \{\\n        success: false,\\n        error: "Unbekannte Aktion",\\n        receivedAction: action,\\n        timestamp: timestamp\\n      \}\\n    \}];\\n\}\
id:f40da13f-9ce0-48dd-b61e-91f6117a7d2a\
name:Antwort formatieren\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:2288\
1:1328\
9\
parameters\
authentication:serviceAccount\
documentId\
__rl:true\
value:1KCGCBwtzQ82m8xQB47K7vGR6BXaZY21TNSiqAOh_ROk\
mode:id\
sheetName\
__rl:true\
value:gid=0\
mode:list\
cachedResultName:E-Commerce\
cachedResultUrl:https://docs.google.com/spreadsheets/d/1KCGCBwtzQ82m8xQB47K7vGR6BXaZY21TNSiqAOh_ROk/edit#gid=0\
options:\{empty object\}\
id:8be0a4d1-563e-4a1c-99c7-0b694afe6b2a\
name:Google Sheets lesen\
type:n8n-nodes-base.googleSheets\
typeVersion:4\
position\
0:592\
1:1664\
credentials\
googleApi\
id:QfuLctHhI3o7mKAL\
name:Google Sheets account\
10\
parameters\
rules\
values\
0\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:2\
conditions\
0\
leftValue:=\{\{ $('Auswahl verarbeiten').item.json.action \}\}\
rightValue:=check\
operator\
type:string\
operation:equals\
id:0e4eaed1-ab8c-4181-8dac-1728b2237925\
combinator:and\
renameOutput:true\
outputKey:Modus Check\
1\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:2\
conditions\
0\
id:f33fa37a-fe46-4435-bc81-e7aee75ffebc\
leftValue:=\{\{ $('Auswahl verarbeiten').item.json.action \}\}\
rightValue:random\
operator\
type:string\
operation:equals\
name:filter.operator.equals\
combinator:and\
renameOutput:true\
outputKey:Modus Random\
2\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:2\
conditions\
0\
id:1a1a1574-4d2b-44ce-b5ea-c50773cec633\
leftValue:=\{\{ $('Auswahl verarbeiten').item.json.action \}\}\
rightValue:list\
operator\
type:string\
operation:equals\
name:filter.operator.equals\
combinator:and\
renameOutput:true\
outputKey:Modus List\
options:\{empty object\}\
type:n8n-nodes-base.switch\
typeVersion:3.3\
position\
0:1040\
1:1648\
id:6c0eceaa-fee0-4449-95b6-b0d290f24b4e\
name:Modus pr\'fcfen\
11\
parameters\
jsCode:// Hole die Input-Action (kann 'check' oder 'random' sein)\\nconst inputData = $input.first().json;\\nconst action = inputData.action;\\nconst bereich = inputData.bereich || null;\\n\\n// Hole die trainingsDaten\\nconst trainingsDaten = $('Auswahl verarbeiten').first().json.trainingsDaten;\\n\\nlet trainingsRow;\\n\\nif (bereich) \{\\n  // Bei 'check': Spezifischen Bereich finden\\n  trainingsRow = trainingsDaten.find(row => \\n      row.Trainingsbereich && \\n      row.Trainingsbereich.toLowerCase() === bereich.toLowerCase()\\n  );\\n\} else \{\\n  // Bei 'random': Zuf\'e4lligen Bereich w\'e4hlen\\n  const randomIndex = Math.floor(Math.random() * trainingsDaten.length);\\n  trainingsRow = trainingsDaten[randomIndex];\\n\}\\n\\n// Beschreibung parsen und eine Situation zuf\'e4llig ausw\'e4hlen\\nconst beschreibung = trainingsRow.Beschreibung || 'Keine Beschreibung verf\'fcgbar';\\n\\n// Extrahiere alle Situationen (Zeilen die mit "- " beginnen)\\nconst situationen = beschreibung\\n  .split('\\n')\\n  .filter(line => line.trim().startsWith('- '))\\n  .map(line => line.trim().substring(2)); // Entferne "- " Prefix\\n\\nlet selectedSituation;\\n\\nif (situationen.length > 0) \{\\n  // W\'e4hle eine zuf\'e4llige Situation\\n  const randomIndex = Math.floor(Math.random() * situationen.length);\\n  selectedSituation = situationen[randomIndex];\\n\} else \{\\n  // Falls keine Situationen mit "- " gefunden, nutze die komplette Beschreibung\\n  selectedSituation = beschreibung;\\n\}\\n\\n// Output - mit nur EINER Situation\\nreturn [\{\\n    json: \{\\n        action: action,\\n        trainingsbereich: trainingsRow.Trainingsbereich,\\n        beschreibung: selectedSituation  // <- Nur eine zuf\'e4llige Situation!\\n    \}\\n\}];\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1712\
1:1328\
id:98a08fb0-1b3a-4e4f-a061-f1dda2c21b23\
name:Beschreibung des Trainingsbereichs holen\
12\
parameters\
jsCode:const checkInput = $input.first().json;\\n\\nreturn [\{\\n  json: \{\\n    success: false,\\n    action: 'check',\\n    trainingsbereich: checkInput.trainingsbereich,  // <- ge\'e4ndert\\n    answer: `Der Trainingsbereich "$\{checkInput.trainingsbereich\}" existiert leider nicht. M\'f6chtest du die verf\'fcgbare Liste h\'f6ren?`,\\n    timestamp: new Date().toISOString()\\n  \}\\n\}];\
id:6889b3f5-d24c-4818-a890-1ee0ab4a3440\
name:Trainingsbereich existiert nicht\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:2288\
1:1520\
13\
parameters\
jsCode:// Formatiere die Liste f\'fcr Fonio\\nconst listInput = $input.first().json;\\nconst bereichsListe = listInput.trainingsbereiche.join(', ');\\n\\nreturn [\{\\n  json: \{\\n    success: true,\\n    action: 'list',\\n    message: `Verf\'fcgbare Trainingsbereiche: $\{bereichsListe\}`,\\n    trainingsbereiche: listInput.trainingsbereiche,\\n    totalCount: listInput.totalCount,\\n    timestamp: new Date().toISOString()\\n  \}\\n\}];\
id:4c0d159b-df37-4a91-b46e-b28606b6af2c\
name:Liste der Trainingsbereiche\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:2288\
1:1808\
connections\
Fonio Webhook Trigger\
main\
0\
0\
node:Google Sheets lesen\
type:main\
index:0\
Message a model\
main\
0\
0\
node:Antwort formatieren\
type:main\
index:0\
Situation 'check'\
main\
0\
0\
node:Existiert Trainingsbereich?\
type:main\
index:0\
Situation 'list'\
main\
0\
0\
node:Liste der Trainingsbereiche\
type:main\
index:0\
Situation 'random'\
main\
0\
0\
node:Beschreibung des Trainingsbereichs holen\
type:main\
index:0\
Auswahl verarbeiten\
main\
0\
0\
node:Modus pr\'fcfen\
type:main\
index:0\
Antwort formatieren\
main\
0\
0\
node:Antwort an Fonio\
type:main\
index:0\
Google Sheets lesen\
main\
0\
0\
node:Auswahl verarbeiten\
type:main\
index:0\
Modus pr\'fcfen\
main\
0\
0\
node:Situation 'check'\
type:main\
index:0\
1\
0\
node:Situation 'random'\
type:main\
index:0\
2\
0\
node:Situation 'list'\
type:main\
index:0\
3:[empty array]\
4:[empty array]\
Existiert Trainingsbereich?\
main\
0\
0\
node:Beschreibung des Trainingsbereichs holen\
type:main\
index:0\
1\
0\
node:Trainingsbereich existiert nicht\
type:main\
index:0\
Beschreibung des Trainingsbereichs holen\
main\
0\
0\
node:Message a model\
type:main\
index:0\
Trainingsbereich existiert nicht\
main\
0\
0\
node:Antwort an Fonio\
type:main\
index:0\
Liste der Trainingsbereiche\
main\
0\
0\
node:Antwort an Fonio\
type:main\
index:0\
settings\
executionOrder:v1\
staticData:null\
meta\
templateCredsSetupCompleted:true\
pinData:\{empty object\}\
versionId:40b61e99-298b-46b3-b9e3-eaa3fc805ac3\
activeVersionId:40b61e99-298b-46b3-b9e3-eaa3fc805ac3\
triggerCount:1\
shared\
0\
updatedAt:2025-11-08T18:17:37.246Z\
createdAt:2025-11-08T18:17:37.246Z\
role:workflow:owner\
workflowId:wtVL3a6B2x2Xintd\
projectId:yr4Hj71ou1NOsi2p\
activeVersion\
updatedAt:2025-12-08T16:14:36.269Z\
createdAt:2025-12-08T16:14:36.269Z\
versionId:40b61e99-298b-46b3-b9e3-eaa3fc805ac3\
workflowId:wtVL3a6B2x2Xintd\
nodes\
0\
parameters\
httpMethod:POST\
path:fonio-training-trigger\
responseMode:responseNode\
options:\{empty object\}\
id:819e706c-9507-440c-bcf9-b3f0209aefd0\
name:Fonio Webhook Trigger\
type:n8n-nodes-base.webhook\
typeVersion:1\
position\
0:368\
1:1664\
webhookId:ca536c70-f01b-464d-ad81-1ca7e40696f2\
1\
parameters\
respondWith:json\
responseBody:=\{\{ $json \}\}\
options:\{empty object\}\
id:359dbf06-aeaf-4f82-99b6-ce3ccb91382e\
name:Antwort an Fonio\
type:n8n-nodes-base.respondToWebhook\
typeVersion:1\
position\
0:2512\
1:1520\
2\
parameters\
modelId\
__rl:true\
value:claude-sonnet-4-20250514\
mode:list\
cachedResultName:claude-sonnet-4-20250514\
messages\
values\
0\
content:==Erstelle eine Trainingspersona f\'fcr den Bereich "\{\{ $json.trainingsbereich \}\}".\\n\\nSituationsbeschreibung:\\n\{\{ $json.beschreibung \}\}\\n\\nEntwickle eine vollst\'e4ndige Persona, die repr\'e4sentativ f\'fcr Kunden in diesem Trainingsbereich ist.\
options\
system:Du bist ein Experte f\'fcr Kundenservice-Training und spezialisiert auf die Entwicklung realistischer Trainingspersonas. Deine Aufgabe ist es, detaillierte, glaubw\'fcrdige Kundencharaktere zu erstellen, die Mitarbeiter in spezifischen Situationen trainieren k\'f6nnen.\\n\\nErstelle immer Personas mit: Name, Alter, Beruf, Pers\'f6nlichkeitstyp, Kommunikationsstil, emotionalem Zustand, spezifischen Bed\'fcrfnissen und typischen Problemen. Die Personas sollen f\'fcr Rollenspiele geeignet und psychologisch stimmig sein.\
type:@n8n/n8n-nodes-langchain.anthropic\
typeVersion:1\
position\
0:1936\
1:1328\
id:769c1c24-b995-4b8c-9133-e8a28b70d19c\
name:Message a model\
credentials\
anthropicApi\
id:6RlfJdXsmselCNpN\
name:Anthropic account 2\
3\
parameters\
jsCode:// Function-Node f\'fcr 'random'\\n\\n// Hole die trainingsDaten von "Auswahl verarbeiten"\\nconst trainingsDaten = $('Auswahl verarbeiten').first().json.trainingsDaten;\\n\\nif (!trainingsDaten || trainingsDaten.length === 0) \{\\n    return [\{ json: \{ action: 'error', message: 'Keine Trainingsdaten verf\'fcgbar' \}\}];\\n\}\\n\\n// W\'e4hle zuf\'e4lligen Trainingsbereich\\nconst randomIndex = Math.floor(Math.random() * trainingsDaten.length);\\nconst selectedRow = trainingsDaten[randomIndex];\\n\\nreturn [\{ \\n    json: \{ \\n        action: 'random', \\n        trainingsbereich: selectedRow.Trainingsbereich, \\n        beschreibung: selectedRow.Beschreibung \\n    \} \\n\}];\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1488\
1:1664\
id:e13053f0-263b-4cdc-86a3-ea93e77c42b1\
name:Situation 'random'\
4\
parameters\
jsCode:// Function-Node f\'fcr case 'check'\\n\\nconst inputItem = $input.first().json; \\nconst checkBereich = inputItem.bereich;\\n\\n// Hole die Trainingsdaten\\nlet dataRows = inputItem.trainingsDaten || []; \\n\\n// Der eigentliche Vergleich\\nconst exists = dataRows.some(row => \\n    typeof row.Trainingsbereich === 'string' && \\n    row.Trainingsbereich.toLowerCase() === checkBereich.toLowerCase()\\n);\\n\\nreturn [\{ \\n    json: \{ \\n        action: 'check', \\n        exists: exists,  // <- ge\'e4ndert von checkPassed zu exists\\n        bereich: checkBereich, \\n        message: exists ? 'Trainingsbereich gefunden.' : 'Trainingsbereich nicht verf\'fcgbar.' \\n    \} \\n\}];\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1264\
1:1424\
id:167edf0c-d5e6-4c8f-8f5a-850b98d89f50\
name:Situation 'check'\
5\
parameters\
jsCode:// Function-Node f\'fcr case 'list'\\n\\n// Hole die trainingsDaten von "Auswahl verarbeiten"\\nconst trainingsDaten = $input.first().json.trainingsDaten;\\n\\nif (!trainingsDaten || trainingsDaten.length === 0) \{\\n    return [\{ json: \{ action: 'error', message: 'Keine Trainingsdaten verf\'fcgbar' \}\}];\\n\}\\n\\n// Extrahiere alle Trainingsbereiche\\nconst bereiche = trainingsDaten.map(row => row.Trainingsbereich);\\n\\nreturn [\{ \\n    json: \{ \\n        action: 'list', \\n        trainingsbereiche: bereiche, \\n        totalCount: bereiche.length \\n    \} \\n\}];\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:2000\
1:1808\
id:57ad9863-66bf-406a-8163-c6708e5d3886\
name:Situation 'list'\
6\
parameters\
jsCode:// Function: Webhook-Body korrekt extrahieren + Google Sheets Daten mitgeben\\n\\n// 1. Hole den Body des Webhook-Requests, wo 'action' und 'bereich' liegen.\\nconst webhookBody = $('Fonio Webhook Trigger').first().json.body;\\n\\n// 2. Hole die Google Sheets Trainingsdaten\\nconst trainingsDaten = $input.all()\\n  .filter(item => item.json.Trainingsbereich)\\n  .map(item => item.json);\\n\\n// 3. Sicherheits-Check, ob die Action definiert ist\\nif (!webhookBody || !webhookBody.action) \{\\n    return [\{ json: \{ action: 'random', message: 'Action fehlt im Webhook Body.' \} \}];\\n\}\\n\\n// 4. Output erstellen mit allen Daten\\nreturn [\{\\n    json: \{\\n        action: webhookBody.action, \\n        bereich: webhookBody.bereich || '', \\n        rufnummer: webhookBody.rufnummer || '',\\n        trainingsDaten: trainingsDaten\\n    \}\\n\}];\
id:f319e59d-3582-4eab-a172-216ca150a1e7\
name:Auswahl verarbeiten\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:816\
1:1664\
7\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:2\
conditions\
0\
id:3eab51b1-ddfc-430f-bc1c-cfccc9602310\
leftValue:=\{\{ $json.exists \}\}\
rightValue:true\
operator\
type:string\
operation:equals\
name:filter.operator.equals\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.2\
position\
0:1488\
1:1424\
id:422e0200-574b-476b-b789-147c389294ce\
name:Existiert Trainingsbereich?\
8\
parameters\
jsCode:// Hole die action von der richtigen Stelle\\nlet action;\\nlet trainingsbereich;\\n\\n// Versuche von "Beschreibung des Trainingsbereichs holen"\\nconst beschreibungNode = $('Beschreibung des Trainingsbereichs holen').first();\\nif (beschreibungNode && beschreibungNode.json) \{\\n  action = beschreibungNode.json.action;\\n  trainingsbereich = beschreibungNode.json.trainingsbereich;\\n\} else \{\\n  // Fallback auf aktuellen Input\\n  action = $input.first().json.action;\\n  trainingsbereich = $input.first().json.trainingsbereich;\\n\}\\n\\n// Timestamp\\nconst timestamp = new Date().toISOString();\\n\\nswitch (action) \{\\n  \\n  case 'list':\\n    const listInput = $('Situation \\'list\\'').first().json;\\n    const bereichsListe = listInput.trainingsbereiche.join(', ');\\n    return [\{\\n      json: \{\\n        success: true,\\n        action: 'list',\\n        message: `Verf\'fcgbare Trainingsbereiche: $\{bereichsListe\}`,\\n        trainingsbereiche: listInput.trainingsbereiche,\\n        totalCount: listInput.totalCount,\\n        timestamp: timestamp\\n      \}\\n    \}];\\n    \\n  case 'check':\\n    // Pr\'fcfe ob Persona generiert wurde\\n    if (trainingsbereich) \{\\n      // Persona wurde generiert\\n      const claudeOutput = $('Message a model').first().json;\\n      return [\{\\n        json: \{\\n          success: true,\\n          action: 'check',\\n          trainingsbereich: trainingsbereich,\\n          persona: claudeOutput.content[0].text,\\n          timestamp: timestamp\\n        \}\\n      \}];\\n    \} else \{\\n      // Bereich existiert nicht\\n      const checkInput = $('Situation \\'check\\'').first().json;\\n      return [\{\\n        json: \{\\n          success: false,\\n          action: 'check',\\n          bereich: checkInput.bereich,\\n          exists: checkInput.exists,\\n          message: checkInput.message,\\n          timestamp: timestamp\\n        \}\\n      \}];\\n    \}\\n    \\n  case 'random':\\n    // Persona wurde generiert\\n    const claudeOutput = $('Message a model').first().json;\\n    const randomNode = $('Beschreibung des Trainingsbereichs holen').first().json;\\n    return [\{\\n      json: \{\\n        success: true,\\n        action: 'random',\\n        trainingsbereich: randomNode.trainingsbereich,\\n        persona: claudeOutput.content[0].text,\\n        timestamp: timestamp\\n      \}\\n    \}];\\n    \\n  default:\\n    return [\{\\n      json: \{\\n        success: false,\\n        error: "Unbekannte Aktion",\\n        receivedAction: action,\\n        timestamp: timestamp\\n      \}\\n    \}];\\n\}\
id:f40da13f-9ce0-48dd-b61e-91f6117a7d2a\
name:Antwort formatieren\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:2288\
1:1328\
9\
parameters\
authentication:serviceAccount\
documentId\
__rl:true\
value:1KCGCBwtzQ82m8xQB47K7vGR6BXaZY21TNSiqAOh_ROk\
mode:id\
sheetName\
__rl:true\
value:gid=0\
mode:list\
cachedResultName:E-Commerce\
cachedResultUrl:https://docs.google.com/spreadsheets/d/1KCGCBwtzQ82m8xQB47K7vGR6BXaZY21TNSiqAOh_ROk/edit#gid=0\
options:\{empty object\}\
id:8be0a4d1-563e-4a1c-99c7-0b694afe6b2a\
name:Google Sheets lesen\
type:n8n-nodes-base.googleSheets\
typeVersion:4\
position\
0:592\
1:1664\
credentials\
googleApi\
id:QfuLctHhI3o7mKAL\
name:Google Sheets account\
10\
parameters\
rules\
values\
0\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:2\
conditions\
0\
leftValue:=\{\{ $('Auswahl verarbeiten').item.json.action \}\}\
rightValue:=check\
operator\
type:string\
operation:equals\
id:0e4eaed1-ab8c-4181-8dac-1728b2237925\
combinator:and\
renameOutput:true\
outputKey:Modus Check\
1\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:2\
conditions\
0\
id:f33fa37a-fe46-4435-bc81-e7aee75ffebc\
leftValue:=\{\{ $('Auswahl verarbeiten').item.json.action \}\}\
rightValue:random\
operator\
type:string\
operation:equals\
name:filter.operator.equals\
combinator:and\
renameOutput:true\
outputKey:Modus Random\
2\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:2\
conditions\
0\
id:1a1a1574-4d2b-44ce-b5ea-c50773cec633\
leftValue:=\{\{ $('Auswahl verarbeiten').item.json.action \}\}\
rightValue:list\
operator\
type:string\
operation:equals\
name:filter.operator.equals\
combinator:and\
renameOutput:true\
outputKey:Modus List\
options:\{empty object\}\
type:n8n-nodes-base.switch\
typeVersion:3.3\
position\
0:1040\
1:1648\
id:6c0eceaa-fee0-4449-95b6-b0d290f24b4e\
name:Modus pr\'fcfen\
11\
parameters\
jsCode:// Hole die Input-Action (kann 'check' oder 'random' sein)\\nconst inputData = $input.first().json;\\nconst action = inputData.action;\\nconst bereich = inputData.bereich || null;\\n\\n// Hole die trainingsDaten\\nconst trainingsDaten = $('Auswahl verarbeiten').first().json.trainingsDaten;\\n\\nlet trainingsRow;\\n\\nif (bereich) \{\\n  // Bei 'check': Spezifischen Bereich finden\\n  trainingsRow = trainingsDaten.find(row => \\n      row.Trainingsbereich && \\n      row.Trainingsbereich.toLowerCase() === bereich.toLowerCase()\\n  );\\n\} else \{\\n  // Bei 'random': Zuf\'e4lligen Bereich w\'e4hlen\\n  const randomIndex = Math.floor(Math.random() * trainingsDaten.length);\\n  trainingsRow = trainingsDaten[randomIndex];\\n\}\\n\\n// Beschreibung parsen und eine Situation zuf\'e4llig ausw\'e4hlen\\nconst beschreibung = trainingsRow.Beschreibung || 'Keine Beschreibung verf\'fcgbar';\\n\\n// Extrahiere alle Situationen (Zeilen die mit "- " beginnen)\\nconst situationen = beschreibung\\n  .split('\\n')\\n  .filter(line => line.trim().startsWith('- '))\\n  .map(line => line.trim().substring(2)); // Entferne "- " Prefix\\n\\nlet selectedSituation;\\n\\nif (situationen.length > 0) \{\\n  // W\'e4hle eine zuf\'e4llige Situation\\n  const randomIndex = Math.floor(Math.random() * situationen.length);\\n  selectedSituation = situationen[randomIndex];\\n\} else \{\\n  // Falls keine Situationen mit "- " gefunden, nutze die komplette Beschreibung\\n  selectedSituation = beschreibung;\\n\}\\n\\n// Output - mit nur EINER Situation\\nreturn [\{\\n    json: \{\\n        action: action,\\n        trainingsbereich: trainingsRow.Trainingsbereich,\\n        beschreibung: selectedSituation  // <- Nur eine zuf\'e4llige Situation!\\n    \}\\n\}];\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:1712\
1:1328\
id:98a08fb0-1b3a-4e4f-a061-f1dda2c21b23\
name:Beschreibung des Trainingsbereichs holen\
12\
parameters\
jsCode:const checkInput = $input.first().json;\\n\\nreturn [\{\\n  json: \{\\n    success: false,\\n    action: 'check',\\n    trainingsbereich: checkInput.trainingsbereich,  // <- ge\'e4ndert\\n    answer: `Der Trainingsbereich "$\{checkInput.trainingsbereich\}" existiert leider nicht. M\'f6chtest du die verf\'fcgbare Liste h\'f6ren?`,\\n    timestamp: new Date().toISOString()\\n  \}\\n\}];\
id:6889b3f5-d24c-4818-a890-1ee0ab4a3440\
name:Trainingsbereich existiert nicht\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:2288\
1:1520\
13\
parameters\
jsCode:// Formatiere die Liste f\'fcr Fonio\\nconst listInput = $input.first().json;\\nconst bereichsListe = listInput.trainingsbereiche.join(', ');\\n\\nreturn [\{\\n  json: \{\\n    success: true,\\n    action: 'list',\\n    message: `Verf\'fcgbare Trainingsbereiche: $\{bereichsListe\}`,\\n    trainingsbereiche: listInput.trainingsbereiche,\\n    totalCount: listInput.totalCount,\\n    timestamp: new Date().toISOString()\\n  \}\\n\}];\
id:4c0d159b-df37-4a91-b46e-b28606b6af2c\
name:Liste der Trainingsbereiche\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:2288\
1:1808\
connections\
Fonio Webhook Trigger\
main\
0\
0\
node:Google Sheets lesen\
type:main\
index:0\
Message a model\
main\
0\
0\
node:Antwort formatieren\
type:main\
index:0\
Situation 'check'\
main\
0\
0\
node:Existiert Trainingsbereich?\
type:main\
index:0\
Situation 'list'\
main\
0\
0\
node:Liste der Trainingsbereiche\
type:main\
index:0\
Situation 'random'\
main\
0\
0\
node:Beschreibung des Trainingsbereichs holen\
type:main\
index:0\
Auswahl verarbeiten\
main\
0\
0\
node:Modus pr\'fcfen\
type:main\
index:0\
Antwort formatieren\
main\
0\
0\
node:Antwort an Fonio\
type:main\
index:0\
Google Sheets lesen\
main\
0\
0\
node:Auswahl verarbeiten\
type:main\
index:0\
Modus pr\'fcfen\
main\
0\
0\
node:Situation 'check'\
type:main\
index:0\
1\
0\
node:Situation 'random'\
type:main\
index:0\
2\
0\
node:Situation 'list'\
type:main\
index:0\
3:[empty array]\
4:[empty array]\
Existiert Trainingsbereich?\
main\
0\
0\
node:Beschreibung des Trainingsbereichs holen\
type:main\
index:0\
1\
0\
node:Trainingsbereich existiert nicht\
type:main\
index:0\
Beschreibung des Trainingsbereichs holen\
main\
0\
0\
node:Message a model\
type:main\
index:0\
Trainingsbereich existiert nicht\
main\
0\
0\
node:Antwort an Fonio\
type:main\
index:0\
Liste der Trainingsbereiche\
main\
0\
0\
node:Antwort an Fonio\
type:main\
index:0\
authors:system migration\
name:null\
description:null\
autosaved:false\
tags:[empty array]\
30\
updatedAt:2025-12-12T11:19:30.865Z\
createdAt:2025-12-10T13:39:41.038Z\
id:xLbZnYQSKv2X7LYn\
name:KIS 17 fonio-Outbound Trigger\
active:false\
isArchived:false\
nodes\
0\
parameters\
httpMethod:POST\
path:kis17_anruf_trigger\
options:\{empty object\}\
type:n8n-nodes-base.webhook\
typeVersion:2.1\
position\
0:-64\
1:-96\
id:401000e3-7331-4ad1-8c15-f2a161b119e7\
name:Webhook\
webhookId:c57d0fdb-cb7a-4dc5-95b3-5102a559f160\
1\
parameters\
jsCode:// *** PARAMETER: Zeitfenster in Minuten ***\\nconst ZEITFENSTER_MINUTEN = 20;\\n\\n// Berechne Zeitfenster in Millisekunden\\nconst zeitfensterMs = ZEITFENSTER_MINUTEN * 60000;\\n\\n// Hole die records aus dem body\\nconst records = $input.first().json.body.records;\\n\\n// Aktuelle Zeit\\nconst now = new Date();\\n\\n// Zeitfenster\\nconst windowStart = now.getTime() - zeitfensterMs;\\nconst windowEnd = now.getTime() + zeitfensterMs;\\n\\n// Filtere records nach Zeitfenster\\nconst results = records.filter(record => \{\\n  const buchungstermin = record.buchungstermin;\\n  \\n  if (!buchungstermin) return false;\\n  \\n  try \{\\n    const bookingTime = new Date(buchungstermin);\\n    if (isNaN(bookingTime.getTime())) return false;\\n    \\n    const bookingTimestamp = bookingTime.getTime();\\n    return bookingTimestamp >= windowStart && bookingTimestamp <= windowEnd;\\n  \} catch (error) \{\\n    return false;\\n  \}\\n\});\\n\\n// R\'fcckgabe im richtigen Format f\'fcr n8n\\nreturn results.map(record => (\{ json: record \}));\
type:n8n-nodes-base.code\
typeVersion:2\
position\
0:160\
1:-96\
id:d132f754-45b4-4b32-af45-37585773cbad\
name:Check Call Time\
2\
parameters\
options:\{empty object\}\
type:n8n-nodes-base.splitInBatches\
typeVersion:3\
position\
0:384\
1:-96\
id:d665c763-5437-4bba-ab45-aa9d9499daa0\
name:Loop Over Items\
3\
parameters\
url:https://app.fonio.ai/api/public/v1/outbound_call\
options:\{empty object\}\
type:n8n-nodes-base.httpRequest\
typeVersion:4.3\
position\
0:1280\
1:-240\
id:82d12ed7-e4fc-4d4b-bf79-859cfd3b7db6\
name:HTTP Request\
4\
parameters\
dataTableId\
__rl:true\
value:AWHMZa5eXE6aZY7g\
mode:list\
cachedResultName:fonio outbound\
cachedResultUrl:/projects/yr4Hj71ou1NOsi2p/datatables/AWHMZa5eXE6aZY7g\
columns\
mappingMode:defineBelow\
value:\{empty object\}\
matchingColumns\
0:phone\
schema\
0\
id:phone\
displayName:phone\
required:false\
defaultMatch:false\
display:true\
type:string\
readOnly:false\
removed:false\
attemptToConvertTypes:false\
convertFieldsToString:false\
options:\{empty object\}\
type:n8n-nodes-base.dataTable\
typeVersion:1\
position\
0:1056\
1:-240\
id:8d464d5f-56d5-403a-9bbf-960cc67e679f\
name:Insert row\
5\
parameters\
operation:deleteRows\
dataTableId\
__rl:true\
value:AWHMZa5eXE6aZY7g\
mode:list\
cachedResultName:fonio outbound\
cachedResultUrl:/projects/yr4Hj71ou1NOsi2p/datatables/AWHMZa5eXE6aZY7g\
matchType:allConditions\
filters\
conditions\
0\
keyName:phone\
options:\{empty object\}\
type:n8n-nodes-base.dataTable\
typeVersion:1\
position\
0:1504\
1:-168\
id:9dee4d49-d5c5-4e84-bda6-8d0ef961894c\
name:Delete row(s)\
6\
parameters\
operation:get\
dataTableId\
__rl:true\
value:AWHMZa5eXE6aZY7g\
mode:list\
cachedResultName:fonio outbound\
cachedResultUrl:/projects/yr4Hj71ou1NOsi2p/datatables/AWHMZa5eXE6aZY7g\
matchType:allConditions\
filters\
conditions\
0\
keyName:phone\
keyValue:=\{\{ $json.telefon \}\}\
type:n8n-nodes-base.dataTable\
typeVersion:1\
position\
0:608\
1:-240\
id:ad82549f-41c7-4d70-8e91-096b0b898df0\
name:Get row(s)\
alwaysOutputData:true\
7\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:strict\
version:3\
conditions\
0\
id:b107b0f5-df10-4e23-88aa-b5693a58e7ed\
leftValue:=\{\{ !$json.telefon || $json.telefon === '' \}\}\
rightValue:=\{\{ $json.length === 0 \}\}\
operator\
type:boolean\
operation:true\
singleValue:true\
combinator:and\
options:\{empty object\}\
type:n8n-nodes-base.if\
typeVersion:2.3\
position\
0:832\
1:-240\
id:0cb25fbf-0079-4636-b6c1-9fcc7a872988\
name:If\
8\
parameters\
rule\
interval\
0\
field:minutes\
minutesInterval:30\
name:Schedule Trigger\
type:n8n-nodes-base.scheduleTrigger\
typeVersion:1.2\
position\
0:-64\
1:272\
id:d29e0c6d-7793-464b-b1a0-b055abbad7f1\
9\
parameters\
operation:get\
dataTableId\
__rl:true\
value:AWHMZa5eXE6aZY7g\
mode:list\
cachedResultName:fonio outbound\
cachedResultUrl:/projects/yr4Hj71ou1NOsi2p/datatables/AWHMZa5eXE6aZY7g\
name:Get All Rows\
type:n8n-nodes-base.dataTable\
typeVersion:1\
position\
0:160\
1:272\
id:671ab281-de73-45e5-8034-2d9283446f6e\
10\
parameters\
operation:deleteRows\
dataTableId\
__rl:true\
value:AWHMZa5eXE6aZY7g\
mode:list\
cachedResultName:fonio outbound\
cachedResultUrl:/projects/yr4Hj71ou1NOsi2p/datatables/AWHMZa5eXE6aZY7g\
matchType:allConditions\
filters\
conditions\
0\
keyName:phone\
keyValue:=\{\{ $json.phone \}\}\
options:\{empty object\}\
name:Delete Row\
type:n8n-nodes-base.dataTable\
typeVersion:1\
position\
0:832\
1:200\
id:93fc9646-d48d-4ab5-bed4-02c296f4d622\
11\
parameters\
options\
reset:false\
name:Loop Over Items1\
type:n8n-nodes-base.splitInBatches\
typeVersion:3\
position\
0:384\
1:272\
id:718abfb8-45fa-4aee-9fde-2294d072f801\
12\
parameters\
content:**Hauptworkflow**\\n\'96 Trigger: Zeitschalter jede Minute\\n\'96 Aufgabe: fonio-Outbound starten\
height:240\
width:272\
color:2\
type:n8n-nodes-base.stickyNote\
typeVersion:1\
position\
0:-152\
1:-176\
id:66f55688-43ab-4b51-ad0f-2eee74ddf8bb\
name:Sticky Note\
13\
parameters\
content:**Workflow Bereinigung**\\n\'96 Trigger: Zeitschalter alle 30 Minuten\\n\'96 Aufgabe: Datenbank mit gesperrten Telefonnummern bereinigen, die \'e4lter als 2 h sind.\
height:240\
width:448\
color:2\
type:n8n-nodes-base.stickyNote\
typeVersion:1\
position\
0:-128\
1:176\
id:4d67f48f-db79-48b1-bb2b-84f88be3a8f2\
name:Sticky Note1\
14\
parameters\
conditions\
options\
caseSensitive:true\
leftValue:empty\
typeValidation:loose\
version:1\
conditions\
0\
id:1\
leftValue:=const createdAt = new Date($json.createdAt);\\nconst now = new Date();\\nconst diffHours = (now - createdAt) / (1000 * 60 * 60);\\ndiffHours > 2\
rightValue:true\
operator\
type:boolean\
operation:equals\
combinator:and\
options\
looseTypeValidation:true\
name:\uc0\u55357 \u56561  \'e4lter als 2h\
type:n8n-nodes-base.if\
typeVersion:2\
position\
0:608\
1:128\
id:b1113eb8-3e68-4146-ae77-7b518ee0a604\
connections\
Webhook\
main\
0\
0\
node:Check Call Time\
type:main\
index:0\
Check Call Time\
main\
0\
0\
node:Loop Over Items\
type:main\
index:0\
Loop Over Items\
main\
0:[empty array]\
1\
0\
node:Get row(s)\
type:main\
index:0\
HTTP Request\
main\
0\
0\
node:Delete row(s)\
type:main\
index:0\
Insert row\
main\
0\
0\
node:HTTP Request\
type:main\
index:0\
Delete row(s)\
main\
0\
0\
node:Loop Over Items\
type:main\
index:0\
Get row(s)\
main\
0\
0\
node:If\
type:main\
index:0\
If\
main\
0\
0\
node:Insert row\
type:main\
index:0\
1\
0\
node:Loop Over Items\
type:main\
index:0\
Schedule Trigger\
main\
0\
0\
node:Get All Rows\
type:main\
index:0\
Get All Rows\
main\
0\
0\
node:Loop Over Items1\
type:main\
index:0\
Delete Row\
main\
0\
0\
node:Loop Over Items1\
type:main\
index:0\
Loop Over Items1\
main\
0:[empty array]\
1\
0\
node:\uc0\u55357 \u56561  \'e4lter als 2h\
type:main\
index:0\
\uc0\u55357 \u56561  \'e4lter als 2h\
main\
0\
0\
node:Delete Row\
type:main\
index:0\
1\
0\
node:Loop Over Items1\
type:main\
index:0\
settings\
executionOrder:v1\
staticData:null\
meta\
templateCredsSetupCompleted:true\
pinData:\{empty object\}\
versionId:6fc19e5c-38c4-4efa-aeae-32117da064e6\
activeVersionId:null\
triggerCount:0\
shared\
0\
updatedAt:2025-12-10T13:39:41.042Z\
createdAt:2025-12-10T13:39:41.042Z\
role:workflow:owner\
workflowId:xLbZnYQSKv2X7LYn\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]\
31\
updatedAt:2025-12-24T07:40:13.668Z\
createdAt:2025-12-24T07:34:20.196Z\
id:zRP9CikPPmQ6OPmC\
name:Senden-/Empfangen-Trigger\
active:false\
isArchived:false\
nodes\
0\
parameters\
httpMethod:POST\
path:anrufercheck_goehrum\
responseMode:responseNode\
options:\{empty object\}\
type:n8n-nodes-base.webhook\
typeVersion:2.1\
position\
0:-1296\
1:-288\
id:c442f4cc-da83-4027-9c0d-927ca1371998\
name:Webhook\
webhookId:8a83165f-7bea-4f12-83ad-f9fc2faa0b0a\
alwaysOutputData:false\
1\
parameters\
respondWith:allIncomingItems\
options:\{empty object\}\
type:n8n-nodes-base.respondToWebhook\
typeVersion:1.4\
position\
0:-1072\
1:-288\
id:3c11220e-96b6-4d0f-bab1-5ffaff36131c\
name:Respond to Webhook\
2\
parameters\
content:# fonio-G\'f6hrum-Webhook\
height:256\
width:464\
type:n8n-nodes-base.stickyNote\
position\
0:-1328\
1:-384\
typeVersion:1\
id:6b174d20-1dd4-43c7-932b-ed5d42af16c6\
name:Sticky Note\
3\
parameters\
method:POST\
url:https://msgapi.threema.ch/send_simple\
authentication:genericCredentialType\
genericAuthType:httpHeaderAuth\
sendBody:true\
contentType:form-urlencoded\
bodyParameters\
parameters\
0\
name:from\
value:*BERENT1\
1\
name:to\
value:BUMFMZ39\
2\
name:secret\
value:=\{\{ $('Config').first().json.secret \}\}\
3\
name:text\
value:=\{\{ $json.text \}\}\\n\\n\uc0\u55357 \u56599  https://github.com/peerendees/n8n-workflows/n8n\
options:\{empty object\}\
id:4cf1a1ac-534f-48c9-a308-d8a4599fab78\
name:Threema Benachrichtigung\
type:n8n-nodes-base.httpRequest\
typeVersion:4.2\
position\
0:-1136\
1:-736\
credentials\
httpHeaderAuth\
id:nSNvIRCSAnKXrLyH\
name:API Threema Work BERENT1\
4\
parameters\
content:## Threema Work Gateway\\n### *BERENT1\
height:272\
width:304\
color:6\
type:n8n-nodes-base.stickyNote\
position\
0:-1240\
1:-832\
typeVersion:1\
id:a021e676-042f-424d-b27b-202937efa088\
name:Sticky Note1\
connections:\{empty object\}\
settings\
executionOrder:v1\
staticData:null\
meta:null\
pinData:\{empty object\}\
versionId:42c0a874-c36f-4bc6-8933-0505c6c72cd8\
activeVersionId:null\
triggerCount:0\
shared\
0\
updatedAt:2025-12-24T07:34:20.201Z\
createdAt:2025-12-24T07:34:20.201Z\
role:workflow:owner\
workflowId:zRP9CikPPmQ6OPmC\
projectId:yr4Hj71ou1NOsi2p\
activeVersion:null\
tags:[empty array]}