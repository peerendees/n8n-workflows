{
  "name": "GitHub → n8n Synchronisation",
  "nodes": [
    {
      "parameters": {},
      "id": "github-webhook-trigger",
      "name": "GitHub Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -720,
        -656
      ],
      "webhookId": "github-sync-webhook"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "check-push-event",
              "leftValue": "={{ $json.headers['x-github-event'] }}",
              "rightValue": "push",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -496,
        -656
      ],
      "id": "pruefe-push-event",
      "name": "Prüfe Push Event"
    },
    {
      "parameters": {
        "jsCode": "// Extrahiere geänderte Dateien aus GitHub Webhook\nconst body = $json.body || {};\nconst commits = body.commits || [];\nconst changedFiles = [];\n\n// Sammle alle geänderten Dateien\nfor (const commit of commits) {\n  const added = commit.added || [];\n  const modified = commit.modified || [];\n  \n  for (const file of [...added, ...modified]) {\n    // Alle JSON-Dateien die Workflows sein könnten\n    // Ignoriere: .gitignore, package.json, README.md, etc.\n    if (file.endsWith('.json') && \n        !file.includes('package.json') && \n        !file.includes('package-lock.json') &&\n        !file.includes('.gitignore') &&\n        (file.startsWith('n8n/') || file.includes('workflow') || file.includes('Workflow'))) {\n      changedFiles.push(file);\n    }\n  }\n}\n\nreturn changedFiles.map(file => ({ filePath: file }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -272,
        -656
      ],
      "id": "extrahiere-dateien",
      "name": "Extrahiere geänderte Dateien"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const filePath = $json.filePath;\nreturn { filePath };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -48,
        -656
      ],
      "id": "vorbereiten-datei",
      "name": "Vorbereiten Datei"
    },
    {
      "parameters": {
        "resource": "file",
        "operation": "get",
        "owner": {
          "__rl": true,
          "value": "peerendees",
          "mode": "name"
        },
        "repository": {
          "__rl": true,
          "value": "n8n-workflows",
          "mode": "list",
          "cachedResultName": "n8n-workflows",
          "cachedResultUrl": "https://github.com/peerendees/n8n-workflows"
        },
        "filePath": "={{ $json.filePath }}",
        "asBinaryProperty": false,
        "additionalParameters": {
          "reference": "main"
        }
      },
      "type": "n8n-nodes-base.github",
      "typeVersion": 1.1,
      "position": [
        176,
        -656
      ],
      "id": "hole-datei-von-github",
      "name": "Hole Datei von GitHub",
      "webhookId": "694567e2-c3e8-4bfc-91af-aae5697aca36",
      "credentials": {
        "githubApi": {
          "id": "uE78TkEY6lWLV4oP",
          "name": "API GitHub"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "// Extrahiere Workflow-Daten aus GitHub-Datei\nconst githubFile = $json;\n\nif (githubFile.error || !githubFile.content) {\n  return { error: 'Datei konnte nicht geladen werden' };\n}\n\ntry {\n  const content = Buffer.from(githubFile.content, 'base64').toString('utf-8');\n  const workflow = JSON.parse(content);\n  \n  // Prüfe ob es ein Backup-Workflow ist (vermeide Kollisionen)\n  const isBackupWorkflow = workflow.name && (\n    workflow.name.toLowerCase().includes('backup') ||\n    (workflow.name.toLowerCase().includes('github') && workflow.name.toLowerCase().includes('sync'))\n  );\n  \n  if (isBackupWorkflow) {\n    return { error: 'Backup-Workflow wird übersprungen (vermeidet Kollisionen)' };\n  }\n  \n  // Stelle sicher, dass name vorhanden ist\n  const workflowName = workflow.name || 'Unnamed Workflow';\n  \n  // Stelle sicher, dass workflowData das name-Feld hat\n  const workflowData = {\n    ...workflow,\n    name: workflowName\n  };\n  \n  return {\n    workflowId: workflow.id || '',\n    workflowName: workflowName,\n    workflowData: workflowData,\n    filePath: githubFile.path || githubFile.name\n  };\n} catch (e) {\n  return { error: 'Fehler beim Parsen der Workflow-Datei: ' + e.message };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        400,
        -656
      ],
      "id": "parse-workflow",
      "name": "Parse Workflow"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "check-error",
              "leftValue": "={{ $json.error || '' }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "check-workflow-id",
              "leftValue": "={{ $json.workflowId || '' }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        624,
        -656
      ],
      "id": "pruefe-workflow",
      "name": "Prüfe Workflow"
    },
    {
      "parameters": {
        "url": "=https://n8n.srv1098810.hstgr.cloud/api/v1/workflows/{{ $node[\"Parse Workflow\"].json.workflowId }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        848,
        -656
      ],
      "id": "pruefe-workflow-existiert",
      "name": "Prüfe ob Workflow existiert",
      "credentials": {
        "httpHeaderAuth": {
          "id": "4gc7MePUZVuCyowB",
          "name": "API n8n"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "// Analysiere die Antwort vom HTTP Request Node\nconst response = $json;\n\n// Prüfe ob ein Fehler vorhanden ist\nif (response.error) {\n  return {\n    exists: false,\n    error: response.error,\n    originalResponse: response\n  };\n}\n\n// Prüfe ob data vorhanden ist (kann direkt sein oder in einem Array)\n// n8n API gibt bei GET /workflows/{id} die Daten direkt zurück\n// oder in einem data-Array wenn es ein Array ist\nconst hasData = response.data && Array.isArray(response.data) && response.data.length > 0;\nconst hasDirectData = response.id && response.name; // Workflow-Daten direkt im Root\n\nif (hasData || hasDirectData) {\n  return {\n    exists: true,\n    workflowData: hasData ? response.data[0] : response,\n    originalResponse: response\n  };\n}\n\n// Wenn weder Fehler noch Daten vorhanden sind, existiert der Workflow nicht\nreturn {\n  exists: false,\n  originalResponse: response\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1072,
        -656
      ],
      "id": "analysiere-workflow-response",
      "name": "Analysiere Workflow Response"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "check-exists",
              "leftValue": "={{ $json.exists }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1296,
        -656
      ],
      "id": "workflow-existiert",
      "name": "Workflow existiert?"
    },
    {
      "parameters": {
        "method": "PUT",
        "url": "=https://n8n.srv1098810.hstgr.cloud/api/v1/workflows/{{ $node[\"Parse Workflow\"].json.workflowId }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "contentType": "json",
        "body": "={{ JSON.stringify($node[\"Parse Workflow\"].json.workflowData) }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1296,
        -592
      ],
      "id": "update-workflow",
      "name": "Update Workflow",
      "credentials": {
        "httpHeaderAuth": {
          "id": "4gc7MePUZVuCyowB",
          "name": "API n8n"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://n8n.srv1098810.hstgr.cloud/api/v1/workflows",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "contentType": "json",
        "body": "={{ JSON.stringify($json.workflowData) }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1296,
        -720
      ],
      "id": "create-workflow",
      "name": "Erstelle Workflow",
      "credentials": {
        "httpHeaderAuth": {
          "id": "4gc7MePUZVuCyowB",
          "name": "API n8n"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "// Stelle sicher, dass workflowData das name-Feld hat\nconst data = $json;\n\n// Falls data.error existiert, weiterleiten\nif (data.error) {\n  return data;\n}\n\n// Stelle sicher, dass workflowData existiert und das name-Feld hat\nif (!data.workflowData) {\n  return { error: 'workflowData fehlt' };\n}\n\nconst workflowData = {\n  ...data.workflowData,\n  name: data.workflowName || data.workflowData.name || 'Unnamed Workflow'\n};\n\nreturn {\n  ...data,\n  workflowData: workflowData\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1072,
        -720
      ],
      "id": "vorbereite-workflow-daten",
      "name": "Vorbereite Workflow-Daten"
    }
  ],
  "connections": {
    "GitHub Webhook Trigger": {
      "main": [
        [
          {
            "node": "Prüfe Push Event",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prüfe Push Event": {
      "main": [
        [
          {
            "node": "Extrahiere geänderte Dateien",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Extrahiere geänderte Dateien": {
      "main": [
        [
          {
            "node": "Vorbereiten Datei",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Vorbereiten Datei": {
      "main": [
        [
          {
            "node": "Hole Datei von GitHub",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Hole Datei von GitHub": {
      "main": [
        [
          {
            "node": "Parse Workflow",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Workflow": {
      "main": [
        [
          {
            "node": "Prüfe Workflow",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prüfe Workflow": {
      "main": [
        [
          {
            "node": "Prüfe ob Workflow existiert",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Vorbereite Workflow-Daten",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prüfe ob Workflow existiert": {
      "main": [
        [
          {
            "node": "Analysiere Workflow Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analysiere Workflow Response": {
      "main": [
        [
          {
            "node": "Workflow existiert?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Workflow existiert?": {
      "main": [
        [
          {
            "node": "Update Workflow",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Vorbereite Workflow-Daten",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Vorbereite Workflow-Daten": {
      "main": [
        [
          {
            "node": "Erstelle Workflow",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Workflow": {
      "main": [
        []
      ]
    },
    "Erstelle Workflow": {
      "main": [
        []
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "github-to-n8n-sync"
  }
}

